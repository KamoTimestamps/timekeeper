// ==UserScript==
// @name         Timekeeper
// @namespace    https://violentmonkey.github.io/
// @version      4.6.0
// @description  Enhanced timestamp tool for YouTube videos with DVR/rewind enablement for live streams
// @author       Silent Shout
// @match        https://www.youtube.com/*
// @run-at       document-start
// @noframes
// @icon         https://raw.githubusercontent.com/KamoTimestamps/timekeeper/refs/heads/main/assets/Kamo_64px_Indexed.png
// @grant        GM.getValue
// @grant        GM.setValue
// @grant        GM.setClipboard
// @homepageURL  https://github.com/KamoTimestamps/timekeeper
// @supportURL   https://github.com/KamoTimestamps/timekeeper/issues
// @downloadURL  https://raw.githubusercontent.com/KamoTimestamps/timekeeper/main/timekeeper.user.js
// @updateURL    https://raw.githubusercontent.com/KamoTimestamps/timekeeper/main/timekeeper.user.js
// @license MIT
// ==/UserScript==

(()=>{var sl=Object.defineProperty;var Xa=(t,e)=>{for(var n in e)sl(t,n,{get:e[n],enumerable:!0})};var z={};Xa(z,{BRAND:()=>Dl,DIRTY:()=>hn,EMPTY_PATH:()=>ul,INVALID:()=>B,NEVER:()=>gc,OK:()=>Ne,ParseStatus:()=>De,Schema:()=>q,ZodAny:()=>Qt,ZodArray:()=>jt,ZodBigInt:()=>yn,ZodBoolean:()=>vn,ZodBranded:()=>_r,ZodCatch:()=>Cn,ZodDate:()=>xn,ZodDefault:()=>Ln,ZodDiscriminatedUnion:()=>pi,ZodEffects:()=>pt,ZodEnum:()=>_n,ZodError:()=>Ye,ZodFirstPartyTypeKind:()=>O,ZodFunction:()=>hi,ZodIntersection:()=>kn,ZodIssueCode:()=>T,ZodLazy:()=>Sn,ZodLiteral:()=>En,ZodMap:()=>Jn,ZodNaN:()=>Xn,ZodNativeEnum:()=>An,ZodNever:()=>wt,ZodNull:()=>wn,ZodNullable:()=>It,ZodNumber:()=>gn,ZodObject:()=>Je,ZodOptional:()=>dt,ZodParsedType:()=>C,ZodPipeline:()=>Ar,ZodPromise:()=>en,ZodReadonly:()=>In,ZodRecord:()=>fi,ZodSchema:()=>q,ZodSet:()=>Kn,ZodString:()=>Xt,ZodSymbol:()=>Wn,ZodTransformer:()=>pt,ZodTuple:()=>Ct,ZodType:()=>q,ZodUndefined:()=>bn,ZodUnion:()=>Tn,ZodUnknown:()=>Ft,ZodVoid:()=>Yn,addIssueToContext:()=>A,any:()=>Fl,array:()=>Gl,bigint:()=>Ol,boolean:()=>cs,coerce:()=>hc,custom:()=>ss,date:()=>Nl,datetimeRegex:()=>is,defaultErrorMap:()=>zt,discriminatedUnion:()=>Yl,effect:()=>oc,enum:()=>ic,function:()=>tc,getErrorMap:()=>Gn,getParsedType:()=>Lt,instanceof:()=>Bl,intersection:()=>Jl,isAborted:()=>di,isAsync:()=>qn,isDirty:()=>mi,isValid:()=>Kt,late:()=>Rl,lazy:()=>nc,literal:()=>rc,makeIssue:()=>Er,map:()=>Ql,nan:()=>Pl,nativeEnum:()=>ac,never:()=>Ul,null:()=>Hl,nullable:()=>cc,number:()=>ls,object:()=>ql,objectUtil:()=>Wi,oboolean:()=>fc,onumber:()=>pc,optional:()=>lc,ostring:()=>mc,pipeline:()=>dc,preprocess:()=>uc,promise:()=>sc,quotelessJson:()=>ol,record:()=>Xl,set:()=>ec,setErrorMap:()=>cl,strictObject:()=>Zl,string:()=>os,symbol:()=>$l,transformer:()=>oc,tuple:()=>Kl,undefined:()=>zl,union:()=>Wl,unknown:()=>jl,util:()=>J,void:()=>Vl});var J;(function(t){t.assertEqual=a=>{};function e(a){}t.assertIs=e;function n(a){throw new Error}t.assertNever=n,t.arrayToEnum=a=>{let i={};for(let o of a)i[o]=o;return i},t.getValidEnumValues=a=>{let i=t.objectKeys(a).filter(s=>typeof a[a[s]]!="number"),o={};for(let s of i)o[s]=a[s];return t.objectValues(o)},t.objectValues=a=>t.objectKeys(a).map(function(i){return a[i]}),t.objectKeys=typeof Object.keys=="function"?a=>Object.keys(a):a=>{let i=[];for(let o in a)Object.prototype.hasOwnProperty.call(a,o)&&i.push(o);return i},t.find=(a,i)=>{for(let o of a)if(i(o))return o},t.isInteger=typeof Number.isInteger=="function"?a=>Number.isInteger(a):a=>typeof a=="number"&&Number.isFinite(a)&&Math.floor(a)===a;function r(a,i=" | "){return a.map(o=>typeof o=="string"?`'${o}'`:o).join(i)}t.joinValues=r,t.jsonStringifyReplacer=(a,i)=>typeof i=="bigint"?i.toString():i})(J||(J={}));var Wi;(function(t){t.mergeShapes=(e,n)=>({...e,...n})})(Wi||(Wi={}));var C=J.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Lt=t=>{switch(typeof t){case"undefined":return C.undefined;case"string":return C.string;case"number":return Number.isNaN(t)?C.nan:C.number;case"boolean":return C.boolean;case"function":return C.function;case"bigint":return C.bigint;case"symbol":return C.symbol;case"object":return Array.isArray(t)?C.array:t===null?C.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?C.promise:typeof Map<"u"&&t instanceof Map?C.map:typeof Set<"u"&&t instanceof Set?C.set:typeof Date<"u"&&t instanceof Date?C.date:C.object;default:return C.unknown}};var T=J.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),ol=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:"),Ye=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};let n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=e}format(e){let n=e||function(i){return i.message},r={_errors:[]},a=i=>{for(let o of i.issues)if(o.code==="invalid_union")o.unionErrors.map(a);else if(o.code==="invalid_return_type")a(o.returnTypeError);else if(o.code==="invalid_arguments")a(o.argumentsError);else if(o.path.length===0)r._errors.push(n(o));else{let s=r,p=0;for(;p<o.path.length;){let u=o.path[p];p===o.path.length-1?(s[u]=s[u]||{_errors:[]},s[u]._errors.push(n(o))):s[u]=s[u]||{_errors:[]},s=s[u],p++}}};return a(this),r}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,J.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=n=>n.message){let n={},r=[];for(let a of this.issues)if(a.path.length>0){let i=a.path[0];n[i]=n[i]||[],n[i].push(e(a))}else r.push(e(a));return{formErrors:r,fieldErrors:n}}get formErrors(){return this.flatten()}};Ye.create=t=>new Ye(t);var ll=(t,e)=>{let n;switch(t.code){case T.invalid_type:t.received===C.undefined?n="Required":n=`Expected ${t.expected}, received ${t.received}`;break;case T.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(t.expected,J.jsonStringifyReplacer)}`;break;case T.unrecognized_keys:n=`Unrecognized key(s) in object: ${J.joinValues(t.keys,", ")}`;break;case T.invalid_union:n="Invalid input";break;case T.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${J.joinValues(t.options)}`;break;case T.invalid_enum_value:n=`Invalid enum value. Expected ${J.joinValues(t.options)}, received '${t.received}'`;break;case T.invalid_arguments:n="Invalid function arguments";break;case T.invalid_return_type:n="Invalid function return type";break;case T.invalid_date:n="Invalid date";break;case T.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(n=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(n=`${n} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?n=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?n=`Invalid input: must end with "${t.validation.endsWith}"`:J.assertNever(t.validation):t.validation!=="regex"?n=`Invalid ${t.validation}`:n="Invalid";break;case T.too_small:t.type==="array"?n=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?n=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?n=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="bigint"?n=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?n=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:n="Invalid input";break;case T.too_big:t.type==="array"?n=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?n=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?n=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?n=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?n=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:n="Invalid input";break;case T.custom:n="Invalid input";break;case T.invalid_intersection_types:n="Intersection results could not be merged";break;case T.not_multiple_of:n=`Number must be a multiple of ${t.multipleOf}`;break;case T.not_finite:n="Number must be finite";break;default:n=e.defaultError,J.assertNever(t)}return{message:n}},zt=ll;var Qa=zt;function cl(t){Qa=t}function Gn(){return Qa}var Er=t=>{let{data:e,path:n,errorMaps:r,issueData:a}=t,i=[...n,...a.path||[]],o={...a,path:i};if(a.message!==void 0)return{...a,path:i,message:a.message};let s="",p=r.filter(u=>!!u).slice().reverse();for(let u of p)s=u(o,{data:e,defaultError:s}).message;return{...a,path:i,message:s}},ul=[];function A(t,e){let n=Gn(),r=Er({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,n,n===zt?void 0:zt].filter(a=>!!a)});t.common.issues.push(r)}var De=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,n){let r=[];for(let a of n){if(a.status==="aborted")return B;a.status==="dirty"&&e.dirty(),r.push(a.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,n){let r=[];for(let a of n){let i=await a.key,o=await a.value;r.push({key:i,value:o})}return t.mergeObjectSync(e,r)}static mergeObjectSync(e,n){let r={};for(let a of n){let{key:i,value:o}=a;if(i.status==="aborted"||o.status==="aborted")return B;i.status==="dirty"&&e.dirty(),o.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof o.value<"u"||a.alwaysSet)&&(r[i.value]=o.value)}return{status:e.value,value:r}}},B=Object.freeze({status:"aborted"}),hn=t=>({status:"dirty",value:t}),Ne=t=>({status:"valid",value:t}),di=t=>t.status==="aborted",mi=t=>t.status==="dirty",Kt=t=>t.status==="valid",qn=t=>typeof Promise<"u"&&t instanceof Promise;var M;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(M||(M={}));var mt=class{constructor(e,n,r,a){this._cachedPath=[],this.parent=e,this.data=n,this._path=r,this._key=a}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},es=(t,e)=>{if(Kt(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let n=new Ye(t.common.issues);return this._error=n,this._error}}};function G(t){if(!t)return{};let{errorMap:e,invalid_type_error:n,required_error:r,description:a}=t;if(e&&(n||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:a}:{errorMap:(o,s)=>{let{message:p}=t;return o.code==="invalid_enum_value"?{message:p??s.defaultError}:typeof s.data>"u"?{message:p??r??s.defaultError}:o.code!=="invalid_type"?{message:s.defaultError}:{message:p??n??s.defaultError}},description:a}}var q=class{get description(){return this._def.description}_getType(e){return Lt(e.data)}_getOrReturnCtx(e,n){return n||{common:e.parent.common,data:e.data,parsedType:Lt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new De,ctx:{common:e.parent.common,data:e.data,parsedType:Lt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let n=this._parse(e);if(qn(n))throw new Error("Synchronous parse encountered promise.");return n}_parseAsync(e){let n=this._parse(e);return Promise.resolve(n)}parse(e,n){let r=this.safeParse(e,n);if(r.success)return r.data;throw r.error}safeParse(e,n){let r={common:{issues:[],async:n?.async??!1,contextualErrorMap:n?.errorMap},path:n?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Lt(e)},a=this._parseSync({data:e,path:r.path,parent:r});return es(r,a)}"~validate"(e){let n={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Lt(e)};if(!this["~standard"].async)try{let r=this._parseSync({data:e,path:[],parent:n});return Kt(r)?{value:r.value}:{issues:n.common.issues}}catch(r){r?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),n.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:n}).then(r=>Kt(r)?{value:r.value}:{issues:n.common.issues})}async parseAsync(e,n){let r=await this.safeParseAsync(e,n);if(r.success)return r.data;throw r.error}async safeParseAsync(e,n){let r={common:{issues:[],contextualErrorMap:n?.errorMap,async:!0},path:n?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Lt(e)},a=this._parse({data:e,path:r.path,parent:r}),i=await(qn(a)?a:Promise.resolve(a));return es(r,i)}refine(e,n){let r=a=>typeof n=="string"||typeof n>"u"?{message:n}:typeof n=="function"?n(a):n;return this._refinement((a,i)=>{let o=e(a),s=()=>i.addIssue({code:T.custom,...r(a)});return typeof Promise<"u"&&o instanceof Promise?o.then(p=>p?!0:(s(),!1)):o?!0:(s(),!1)})}refinement(e,n){return this._refinement((r,a)=>e(r)?!0:(a.addIssue(typeof n=="function"?n(r,a):n),!1))}_refinement(e){return new pt({schema:this,typeName:O.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:n=>this["~validate"](n)}}optional(){return dt.create(this,this._def)}nullable(){return It.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return jt.create(this)}promise(){return en.create(this,this._def)}or(e){return Tn.create([this,e],this._def)}and(e){return kn.create(this,e,this._def)}transform(e){return new pt({...G(this._def),schema:this,typeName:O.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let n=typeof e=="function"?e:()=>e;return new Ln({...G(this._def),innerType:this,defaultValue:n,typeName:O.ZodDefault})}brand(){return new _r({typeName:O.ZodBranded,type:this,...G(this._def)})}catch(e){let n=typeof e=="function"?e:()=>e;return new Cn({...G(this._def),innerType:this,catchValue:n,typeName:O.ZodCatch})}describe(e){let n=this.constructor;return new n({...this._def,description:e})}pipe(e){return Ar.create(this,e)}readonly(){return In.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},dl=/^c[^\s-]{8,}$/i,ml=/^[0-9a-z]+$/,pl=/^[0-9A-HJKMNP-TV-Z]{26}$/i,fl=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,hl=/^[a-z0-9_-]{21}$/i,gl=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,yl=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,vl=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,xl="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",Yi,bl=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,wl=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Tl=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,kl=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Sl=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,El=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,ns="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",_l=new RegExp(`^${ns}$`);function rs(t){let e="[0-5]\\d";t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`);let n=t.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${n}`}function Al(t){return new RegExp(`^${rs(t)}$`)}function is(t){let e=`${ns}T${rs(t)}`,n=[];return n.push(t.local?"Z?":"Z"),t.offset&&n.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${n.join("|")})`,new RegExp(`^${e}$`)}function Ll(t,e){return!!((e==="v4"||!e)&&bl.test(t)||(e==="v6"||!e)&&Tl.test(t))}function Cl(t,e){if(!gl.test(t))return!1;try{let[n]=t.split(".");if(!n)return!1;let r=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(n.length+(4-n.length%4)%4,"="),a=JSON.parse(atob(r));return!(typeof a!="object"||a===null||"typ"in a&&a?.typ!=="JWT"||!a.alg||e&&a.alg!==e)}catch{return!1}}function Il(t,e){return!!((e==="v4"||!e)&&wl.test(t)||(e==="v6"||!e)&&kl.test(t))}var Xt=class t extends q{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==C.string){let i=this._getOrReturnCtx(e);return A(i,{code:T.invalid_type,expected:C.string,received:i.parsedType}),B}let r=new De,a;for(let i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(a=this._getOrReturnCtx(e,a),A(a,{code:T.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),r.dirty());else if(i.kind==="max")e.data.length>i.value&&(a=this._getOrReturnCtx(e,a),A(a,{code:T.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),r.dirty());else if(i.kind==="length"){let o=e.data.length>i.value,s=e.data.length<i.value;(o||s)&&(a=this._getOrReturnCtx(e,a),o?A(a,{code:T.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):s&&A(a,{code:T.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),r.dirty())}else if(i.kind==="email")vl.test(e.data)||(a=this._getOrReturnCtx(e,a),A(a,{validation:"email",code:T.invalid_string,message:i.message}),r.dirty());else if(i.kind==="emoji")Yi||(Yi=new RegExp(xl,"u")),Yi.test(e.data)||(a=this._getOrReturnCtx(e,a),A(a,{validation:"emoji",code:T.invalid_string,message:i.message}),r.dirty());else if(i.kind==="uuid")fl.test(e.data)||(a=this._getOrReturnCtx(e,a),A(a,{validation:"uuid",code:T.invalid_string,message:i.message}),r.dirty());else if(i.kind==="nanoid")hl.test(e.data)||(a=this._getOrReturnCtx(e,a),A(a,{validation:"nanoid",code:T.invalid_string,message:i.message}),r.dirty());else if(i.kind==="cuid")dl.test(e.data)||(a=this._getOrReturnCtx(e,a),A(a,{validation:"cuid",code:T.invalid_string,message:i.message}),r.dirty());else if(i.kind==="cuid2")ml.test(e.data)||(a=this._getOrReturnCtx(e,a),A(a,{validation:"cuid2",code:T.invalid_string,message:i.message}),r.dirty());else if(i.kind==="ulid")pl.test(e.data)||(a=this._getOrReturnCtx(e,a),A(a,{validation:"ulid",code:T.invalid_string,message:i.message}),r.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{a=this._getOrReturnCtx(e,a),A(a,{validation:"url",code:T.invalid_string,message:i.message}),r.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(a=this._getOrReturnCtx(e,a),A(a,{validation:"regex",code:T.invalid_string,message:i.message}),r.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(a=this._getOrReturnCtx(e,a),A(a,{code:T.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),r.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(a=this._getOrReturnCtx(e,a),A(a,{code:T.invalid_string,validation:{startsWith:i.value},message:i.message}),r.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(a=this._getOrReturnCtx(e,a),A(a,{code:T.invalid_string,validation:{endsWith:i.value},message:i.message}),r.dirty()):i.kind==="datetime"?is(i).test(e.data)||(a=this._getOrReturnCtx(e,a),A(a,{code:T.invalid_string,validation:"datetime",message:i.message}),r.dirty()):i.kind==="date"?_l.test(e.data)||(a=this._getOrReturnCtx(e,a),A(a,{code:T.invalid_string,validation:"date",message:i.message}),r.dirty()):i.kind==="time"?Al(i).test(e.data)||(a=this._getOrReturnCtx(e,a),A(a,{code:T.invalid_string,validation:"time",message:i.message}),r.dirty()):i.kind==="duration"?yl.test(e.data)||(a=this._getOrReturnCtx(e,a),A(a,{validation:"duration",code:T.invalid_string,message:i.message}),r.dirty()):i.kind==="ip"?Ll(e.data,i.version)||(a=this._getOrReturnCtx(e,a),A(a,{validation:"ip",code:T.invalid_string,message:i.message}),r.dirty()):i.kind==="jwt"?Cl(e.data,i.alg)||(a=this._getOrReturnCtx(e,a),A(a,{validation:"jwt",code:T.invalid_string,message:i.message}),r.dirty()):i.kind==="cidr"?Il(e.data,i.version)||(a=this._getOrReturnCtx(e,a),A(a,{validation:"cidr",code:T.invalid_string,message:i.message}),r.dirty()):i.kind==="base64"?Sl.test(e.data)||(a=this._getOrReturnCtx(e,a),A(a,{validation:"base64",code:T.invalid_string,message:i.message}),r.dirty()):i.kind==="base64url"?El.test(e.data)||(a=this._getOrReturnCtx(e,a),A(a,{validation:"base64url",code:T.invalid_string,message:i.message}),r.dirty()):J.assertNever(i);return{status:r.value,value:e.data}}_regex(e,n,r){return this.refinement(a=>e.test(a),{validation:n,code:T.invalid_string,...M.errToObj(r)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...M.errToObj(e)})}url(e){return this._addCheck({kind:"url",...M.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...M.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...M.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...M.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...M.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...M.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...M.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...M.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...M.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...M.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...M.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...M.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...M.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...M.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...M.errToObj(e)})}regex(e,n){return this._addCheck({kind:"regex",regex:e,...M.errToObj(n)})}includes(e,n){return this._addCheck({kind:"includes",value:e,position:n?.position,...M.errToObj(n?.message)})}startsWith(e,n){return this._addCheck({kind:"startsWith",value:e,...M.errToObj(n)})}endsWith(e,n){return this._addCheck({kind:"endsWith",value:e,...M.errToObj(n)})}min(e,n){return this._addCheck({kind:"min",value:e,...M.errToObj(n)})}max(e,n){return this._addCheck({kind:"max",value:e,...M.errToObj(n)})}length(e,n){return this._addCheck({kind:"length",value:e,...M.errToObj(n)})}nonempty(e){return this.min(1,M.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxLength(){let e=null;for(let n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}};Xt.create=t=>new Xt({checks:[],typeName:O.ZodString,coerce:t?.coerce??!1,...G(t)});function Ml(t,e){let n=(t.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,a=n>r?n:r,i=Number.parseInt(t.toFixed(a).replace(".","")),o=Number.parseInt(e.toFixed(a).replace(".",""));return i%o/10**a}var gn=class t extends q{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==C.number){let i=this._getOrReturnCtx(e);return A(i,{code:T.invalid_type,expected:C.number,received:i.parsedType}),B}let r,a=new De;for(let i of this._def.checks)i.kind==="int"?J.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),A(r,{code:T.invalid_type,expected:"integer",received:"float",message:i.message}),a.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(r=this._getOrReturnCtx(e,r),A(r,{code:T.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),a.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(r=this._getOrReturnCtx(e,r),A(r,{code:T.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),a.dirty()):i.kind==="multipleOf"?Ml(e.data,i.value)!==0&&(r=this._getOrReturnCtx(e,r),A(r,{code:T.not_multiple_of,multipleOf:i.value,message:i.message}),a.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),A(r,{code:T.not_finite,message:i.message}),a.dirty()):J.assertNever(i);return{status:a.value,value:e.data}}gte(e,n){return this.setLimit("min",e,!0,M.toString(n))}gt(e,n){return this.setLimit("min",e,!1,M.toString(n))}lte(e,n){return this.setLimit("max",e,!0,M.toString(n))}lt(e,n){return this.setLimit("max",e,!1,M.toString(n))}setLimit(e,n,r,a){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:r,message:M.toString(a)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:M.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:M.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:M.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:M.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:M.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:M.toString(n)})}finite(e){return this._addCheck({kind:"finite",message:M.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:M.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:M.toString(e)})}get minValue(){let e=null;for(let n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(let n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&J.isInteger(e.value))}get isFinite(){let e=null,n=null;for(let r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(n===null||r.value>n)&&(n=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(n)&&Number.isFinite(e)}};gn.create=t=>new gn({checks:[],typeName:O.ZodNumber,coerce:t?.coerce||!1,...G(t)});var yn=class t extends q{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==C.bigint)return this._getInvalidInput(e);let r,a=new De;for(let i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(r=this._getOrReturnCtx(e,r),A(r,{code:T.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),a.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(r=this._getOrReturnCtx(e,r),A(r,{code:T.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),a.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),A(r,{code:T.not_multiple_of,multipleOf:i.value,message:i.message}),a.dirty()):J.assertNever(i);return{status:a.value,value:e.data}}_getInvalidInput(e){let n=this._getOrReturnCtx(e);return A(n,{code:T.invalid_type,expected:C.bigint,received:n.parsedType}),B}gte(e,n){return this.setLimit("min",e,!0,M.toString(n))}gt(e,n){return this.setLimit("min",e,!1,M.toString(n))}lte(e,n){return this.setLimit("max",e,!0,M.toString(n))}lt(e,n){return this.setLimit("max",e,!1,M.toString(n))}setLimit(e,n,r,a){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:r,message:M.toString(a)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:M.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:M.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:M.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:M.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:M.toString(n)})}get minValue(){let e=null;for(let n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(let n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}};yn.create=t=>new yn({checks:[],typeName:O.ZodBigInt,coerce:t?.coerce??!1,...G(t)});var vn=class extends q{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==C.boolean){let r=this._getOrReturnCtx(e);return A(r,{code:T.invalid_type,expected:C.boolean,received:r.parsedType}),B}return Ne(e.data)}};vn.create=t=>new vn({typeName:O.ZodBoolean,coerce:t?.coerce||!1,...G(t)});var xn=class t extends q{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==C.date){let i=this._getOrReturnCtx(e);return A(i,{code:T.invalid_type,expected:C.date,received:i.parsedType}),B}if(Number.isNaN(e.data.getTime())){let i=this._getOrReturnCtx(e);return A(i,{code:T.invalid_date}),B}let r=new De,a;for(let i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(a=this._getOrReturnCtx(e,a),A(a,{code:T.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),r.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(a=this._getOrReturnCtx(e,a),A(a,{code:T.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),r.dirty()):J.assertNever(i);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}min(e,n){return this._addCheck({kind:"min",value:e.getTime(),message:M.toString(n)})}max(e,n){return this._addCheck({kind:"max",value:e.getTime(),message:M.toString(n)})}get minDate(){let e=null;for(let n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e!=null?new Date(e):null}};xn.create=t=>new xn({checks:[],coerce:t?.coerce||!1,typeName:O.ZodDate,...G(t)});var Wn=class extends q{_parse(e){if(this._getType(e)!==C.symbol){let r=this._getOrReturnCtx(e);return A(r,{code:T.invalid_type,expected:C.symbol,received:r.parsedType}),B}return Ne(e.data)}};Wn.create=t=>new Wn({typeName:O.ZodSymbol,...G(t)});var bn=class extends q{_parse(e){if(this._getType(e)!==C.undefined){let r=this._getOrReturnCtx(e);return A(r,{code:T.invalid_type,expected:C.undefined,received:r.parsedType}),B}return Ne(e.data)}};bn.create=t=>new bn({typeName:O.ZodUndefined,...G(t)});var wn=class extends q{_parse(e){if(this._getType(e)!==C.null){let r=this._getOrReturnCtx(e);return A(r,{code:T.invalid_type,expected:C.null,received:r.parsedType}),B}return Ne(e.data)}};wn.create=t=>new wn({typeName:O.ZodNull,...G(t)});var Qt=class extends q{constructor(){super(...arguments),this._any=!0}_parse(e){return Ne(e.data)}};Qt.create=t=>new Qt({typeName:O.ZodAny,...G(t)});var Ft=class extends q{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Ne(e.data)}};Ft.create=t=>new Ft({typeName:O.ZodUnknown,...G(t)});var wt=class extends q{_parse(e){let n=this._getOrReturnCtx(e);return A(n,{code:T.invalid_type,expected:C.never,received:n.parsedType}),B}};wt.create=t=>new wt({typeName:O.ZodNever,...G(t)});var Yn=class extends q{_parse(e){if(this._getType(e)!==C.undefined){let r=this._getOrReturnCtx(e);return A(r,{code:T.invalid_type,expected:C.void,received:r.parsedType}),B}return Ne(e.data)}};Yn.create=t=>new Yn({typeName:O.ZodVoid,...G(t)});var jt=class t extends q{_parse(e){let{ctx:n,status:r}=this._processInputParams(e),a=this._def;if(n.parsedType!==C.array)return A(n,{code:T.invalid_type,expected:C.array,received:n.parsedType}),B;if(a.exactLength!==null){let o=n.data.length>a.exactLength.value,s=n.data.length<a.exactLength.value;(o||s)&&(A(n,{code:o?T.too_big:T.too_small,minimum:s?a.exactLength.value:void 0,maximum:o?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),r.dirty())}if(a.minLength!==null&&n.data.length<a.minLength.value&&(A(n,{code:T.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),r.dirty()),a.maxLength!==null&&n.data.length>a.maxLength.value&&(A(n,{code:T.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),r.dirty()),n.common.async)return Promise.all([...n.data].map((o,s)=>a.type._parseAsync(new mt(n,o,n.path,s)))).then(o=>De.mergeArray(r,o));let i=[...n.data].map((o,s)=>a.type._parseSync(new mt(n,o,n.path,s)));return De.mergeArray(r,i)}get element(){return this._def.type}min(e,n){return new t({...this._def,minLength:{value:e,message:M.toString(n)}})}max(e,n){return new t({...this._def,maxLength:{value:e,message:M.toString(n)}})}length(e,n){return new t({...this._def,exactLength:{value:e,message:M.toString(n)}})}nonempty(e){return this.min(1,e)}};jt.create=(t,e)=>new jt({type:t,minLength:null,maxLength:null,exactLength:null,typeName:O.ZodArray,...G(e)});function Zn(t){if(t instanceof Je){let e={};for(let n in t.shape){let r=t.shape[n];e[n]=dt.create(Zn(r))}return new Je({...t._def,shape:()=>e})}else return t instanceof jt?new jt({...t._def,type:Zn(t.element)}):t instanceof dt?dt.create(Zn(t.unwrap())):t instanceof It?It.create(Zn(t.unwrap())):t instanceof Ct?Ct.create(t.items.map(e=>Zn(e))):t}var Je=class t extends q{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),n=J.objectKeys(e);return this._cached={shape:e,keys:n},this._cached}_parse(e){if(this._getType(e)!==C.object){let u=this._getOrReturnCtx(e);return A(u,{code:T.invalid_type,expected:C.object,received:u.parsedType}),B}let{status:r,ctx:a}=this._processInputParams(e),{shape:i,keys:o}=this._getCached(),s=[];if(!(this._def.catchall instanceof wt&&this._def.unknownKeys==="strip"))for(let u in a.data)o.includes(u)||s.push(u);let p=[];for(let u of o){let m=i[u],k=a.data[u];p.push({key:{status:"valid",value:u},value:m._parse(new mt(a,k,a.path,u)),alwaysSet:u in a.data})}if(this._def.catchall instanceof wt){let u=this._def.unknownKeys;if(u==="passthrough")for(let m of s)p.push({key:{status:"valid",value:m},value:{status:"valid",value:a.data[m]}});else if(u==="strict")s.length>0&&(A(a,{code:T.unrecognized_keys,keys:s}),r.dirty());else if(u!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let u=this._def.catchall;for(let m of s){let k=a.data[m];p.push({key:{status:"valid",value:m},value:u._parse(new mt(a,k,a.path,m)),alwaysSet:m in a.data})}}return a.common.async?Promise.resolve().then(async()=>{let u=[];for(let m of p){let k=await m.key,_=await m.value;u.push({key:k,value:_,alwaysSet:m.alwaysSet})}return u}).then(u=>De.mergeObjectSync(r,u)):De.mergeObjectSync(r,p)}get shape(){return this._def.shape()}strict(e){return M.errToObj,new t({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(n,r)=>{let a=this._def.errorMap?.(n,r).message??r.defaultError;return n.code==="unrecognized_keys"?{message:M.errToObj(e).message??a}:{message:a}}}:{}})}strip(){return new t({...this._def,unknownKeys:"strip"})}passthrough(){return new t({...this._def,unknownKeys:"passthrough"})}extend(e){return new t({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new t({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:O.ZodObject})}setKey(e,n){return this.augment({[e]:n})}catchall(e){return new t({...this._def,catchall:e})}pick(e){let n={};for(let r of J.objectKeys(e))e[r]&&this.shape[r]&&(n[r]=this.shape[r]);return new t({...this._def,shape:()=>n})}omit(e){let n={};for(let r of J.objectKeys(this.shape))e[r]||(n[r]=this.shape[r]);return new t({...this._def,shape:()=>n})}deepPartial(){return Zn(this)}partial(e){let n={};for(let r of J.objectKeys(this.shape)){let a=this.shape[r];e&&!e[r]?n[r]=a:n[r]=a.optional()}return new t({...this._def,shape:()=>n})}required(e){let n={};for(let r of J.objectKeys(this.shape))if(e&&!e[r])n[r]=this.shape[r];else{let i=this.shape[r];for(;i instanceof dt;)i=i._def.innerType;n[r]=i}return new t({...this._def,shape:()=>n})}keyof(){return as(J.objectKeys(this.shape))}};Je.create=(t,e)=>new Je({shape:()=>t,unknownKeys:"strip",catchall:wt.create(),typeName:O.ZodObject,...G(e)});Je.strictCreate=(t,e)=>new Je({shape:()=>t,unknownKeys:"strict",catchall:wt.create(),typeName:O.ZodObject,...G(e)});Je.lazycreate=(t,e)=>new Je({shape:t,unknownKeys:"strip",catchall:wt.create(),typeName:O.ZodObject,...G(e)});var Tn=class extends q{_parse(e){let{ctx:n}=this._processInputParams(e),r=this._def.options;function a(i){for(let s of i)if(s.result.status==="valid")return s.result;for(let s of i)if(s.result.status==="dirty")return n.common.issues.push(...s.ctx.common.issues),s.result;let o=i.map(s=>new Ye(s.ctx.common.issues));return A(n,{code:T.invalid_union,unionErrors:o}),B}if(n.common.async)return Promise.all(r.map(async i=>{let o={...n,common:{...n.common,issues:[]},parent:null};return{result:await i._parseAsync({data:n.data,path:n.path,parent:o}),ctx:o}})).then(a);{let i,o=[];for(let p of r){let u={...n,common:{...n.common,issues:[]},parent:null},m=p._parseSync({data:n.data,path:n.path,parent:u});if(m.status==="valid")return m;m.status==="dirty"&&!i&&(i={result:m,ctx:u}),u.common.issues.length&&o.push(u.common.issues)}if(i)return n.common.issues.push(...i.ctx.common.issues),i.result;let s=o.map(p=>new Ye(p));return A(n,{code:T.invalid_union,unionErrors:s}),B}}get options(){return this._def.options}};Tn.create=(t,e)=>new Tn({options:t,typeName:O.ZodUnion,...G(e)});var Ht=t=>t instanceof Sn?Ht(t.schema):t instanceof pt?Ht(t.innerType()):t instanceof En?[t.value]:t instanceof _n?t.options:t instanceof An?J.objectValues(t.enum):t instanceof Ln?Ht(t._def.innerType):t instanceof bn?[void 0]:t instanceof wn?[null]:t instanceof dt?[void 0,...Ht(t.unwrap())]:t instanceof It?[null,...Ht(t.unwrap())]:t instanceof _r||t instanceof In?Ht(t.unwrap()):t instanceof Cn?Ht(t._def.innerType):[],pi=class t extends q{_parse(e){let{ctx:n}=this._processInputParams(e);if(n.parsedType!==C.object)return A(n,{code:T.invalid_type,expected:C.object,received:n.parsedType}),B;let r=this.discriminator,a=n.data[r],i=this.optionsMap.get(a);return i?n.common.async?i._parseAsync({data:n.data,path:n.path,parent:n}):i._parseSync({data:n.data,path:n.path,parent:n}):(A(n,{code:T.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),B)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,n,r){let a=new Map;for(let i of n){let o=Ht(i.shape[e]);if(!o.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let s of o){if(a.has(s))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(s)}`);a.set(s,i)}}return new t({typeName:O.ZodDiscriminatedUnion,discriminator:e,options:n,optionsMap:a,...G(r)})}};function Ji(t,e){let n=Lt(t),r=Lt(e);if(t===e)return{valid:!0,data:t};if(n===C.object&&r===C.object){let a=J.objectKeys(e),i=J.objectKeys(t).filter(s=>a.indexOf(s)!==-1),o={...t,...e};for(let s of i){let p=Ji(t[s],e[s]);if(!p.valid)return{valid:!1};o[s]=p.data}return{valid:!0,data:o}}else if(n===C.array&&r===C.array){if(t.length!==e.length)return{valid:!1};let a=[];for(let i=0;i<t.length;i++){let o=t[i],s=e[i],p=Ji(o,s);if(!p.valid)return{valid:!1};a.push(p.data)}return{valid:!0,data:a}}else return n===C.date&&r===C.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}var kn=class extends q{_parse(e){let{status:n,ctx:r}=this._processInputParams(e),a=(i,o)=>{if(di(i)||di(o))return B;let s=Ji(i.value,o.value);return s.valid?((mi(i)||mi(o))&&n.dirty(),{status:n.value,value:s.data}):(A(r,{code:T.invalid_intersection_types}),B)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([i,o])=>a(i,o)):a(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}};kn.create=(t,e,n)=>new kn({left:t,right:e,typeName:O.ZodIntersection,...G(n)});var Ct=class t extends q{_parse(e){let{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==C.array)return A(r,{code:T.invalid_type,expected:C.array,received:r.parsedType}),B;if(r.data.length<this._def.items.length)return A(r,{code:T.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),B;!this._def.rest&&r.data.length>this._def.items.length&&(A(r,{code:T.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),n.dirty());let i=[...r.data].map((o,s)=>{let p=this._def.items[s]||this._def.rest;return p?p._parse(new mt(r,o,r.path,s)):null}).filter(o=>!!o);return r.common.async?Promise.all(i).then(o=>De.mergeArray(n,o)):De.mergeArray(n,i)}get items(){return this._def.items}rest(e){return new t({...this._def,rest:e})}};Ct.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Ct({items:t,typeName:O.ZodTuple,rest:null,...G(e)})};var fi=class t extends q{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==C.object)return A(r,{code:T.invalid_type,expected:C.object,received:r.parsedType}),B;let a=[],i=this._def.keyType,o=this._def.valueType;for(let s in r.data)a.push({key:i._parse(new mt(r,s,r.path,s)),value:o._parse(new mt(r,r.data[s],r.path,s)),alwaysSet:s in r.data});return r.common.async?De.mergeObjectAsync(n,a):De.mergeObjectSync(n,a)}get element(){return this._def.valueType}static create(e,n,r){return n instanceof q?new t({keyType:e,valueType:n,typeName:O.ZodRecord,...G(r)}):new t({keyType:Xt.create(),valueType:e,typeName:O.ZodRecord,...G(n)})}},Jn=class extends q{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==C.map)return A(r,{code:T.invalid_type,expected:C.map,received:r.parsedType}),B;let a=this._def.keyType,i=this._def.valueType,o=[...r.data.entries()].map(([s,p],u)=>({key:a._parse(new mt(r,s,r.path,[u,"key"])),value:i._parse(new mt(r,p,r.path,[u,"value"]))}));if(r.common.async){let s=new Map;return Promise.resolve().then(async()=>{for(let p of o){let u=await p.key,m=await p.value;if(u.status==="aborted"||m.status==="aborted")return B;(u.status==="dirty"||m.status==="dirty")&&n.dirty(),s.set(u.value,m.value)}return{status:n.value,value:s}})}else{let s=new Map;for(let p of o){let u=p.key,m=p.value;if(u.status==="aborted"||m.status==="aborted")return B;(u.status==="dirty"||m.status==="dirty")&&n.dirty(),s.set(u.value,m.value)}return{status:n.value,value:s}}}};Jn.create=(t,e,n)=>new Jn({valueType:e,keyType:t,typeName:O.ZodMap,...G(n)});var Kn=class t extends q{_parse(e){let{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==C.set)return A(r,{code:T.invalid_type,expected:C.set,received:r.parsedType}),B;let a=this._def;a.minSize!==null&&r.data.size<a.minSize.value&&(A(r,{code:T.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),n.dirty()),a.maxSize!==null&&r.data.size>a.maxSize.value&&(A(r,{code:T.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),n.dirty());let i=this._def.valueType;function o(p){let u=new Set;for(let m of p){if(m.status==="aborted")return B;m.status==="dirty"&&n.dirty(),u.add(m.value)}return{status:n.value,value:u}}let s=[...r.data.values()].map((p,u)=>i._parse(new mt(r,p,r.path,u)));return r.common.async?Promise.all(s).then(p=>o(p)):o(s)}min(e,n){return new t({...this._def,minSize:{value:e,message:M.toString(n)}})}max(e,n){return new t({...this._def,maxSize:{value:e,message:M.toString(n)}})}size(e,n){return this.min(e,n).max(e,n)}nonempty(e){return this.min(1,e)}};Kn.create=(t,e)=>new Kn({valueType:t,minSize:null,maxSize:null,typeName:O.ZodSet,...G(e)});var hi=class t extends q{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:n}=this._processInputParams(e);if(n.parsedType!==C.function)return A(n,{code:T.invalid_type,expected:C.function,received:n.parsedType}),B;function r(s,p){return Er({data:s,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,Gn(),zt].filter(u=>!!u),issueData:{code:T.invalid_arguments,argumentsError:p}})}function a(s,p){return Er({data:s,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,Gn(),zt].filter(u=>!!u),issueData:{code:T.invalid_return_type,returnTypeError:p}})}let i={errorMap:n.common.contextualErrorMap},o=n.data;if(this._def.returns instanceof en){let s=this;return Ne(async function(...p){let u=new Ye([]),m=await s._def.args.parseAsync(p,i).catch(L=>{throw u.addIssue(r(p,L)),u}),k=await Reflect.apply(o,this,m);return await s._def.returns._def.type.parseAsync(k,i).catch(L=>{throw u.addIssue(a(k,L)),u})})}else{let s=this;return Ne(function(...p){let u=s._def.args.safeParse(p,i);if(!u.success)throw new Ye([r(p,u.error)]);let m=Reflect.apply(o,this,u.data),k=s._def.returns.safeParse(m,i);if(!k.success)throw new Ye([a(m,k.error)]);return k.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new t({...this._def,args:Ct.create(e).rest(Ft.create())})}returns(e){return new t({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,n,r){return new t({args:e||Ct.create([]).rest(Ft.create()),returns:n||Ft.create(),typeName:O.ZodFunction,...G(r)})}},Sn=class extends q{get schema(){return this._def.getter()}_parse(e){let{ctx:n}=this._processInputParams(e);return this._def.getter()._parse({data:n.data,path:n.path,parent:n})}};Sn.create=(t,e)=>new Sn({getter:t,typeName:O.ZodLazy,...G(e)});var En=class extends q{_parse(e){if(e.data!==this._def.value){let n=this._getOrReturnCtx(e);return A(n,{received:n.data,code:T.invalid_literal,expected:this._def.value}),B}return{status:"valid",value:e.data}}get value(){return this._def.value}};En.create=(t,e)=>new En({value:t,typeName:O.ZodLiteral,...G(e)});function as(t,e){return new _n({values:t,typeName:O.ZodEnum,...G(e)})}var _n=class t extends q{_parse(e){if(typeof e.data!="string"){let n=this._getOrReturnCtx(e),r=this._def.values;return A(n,{expected:J.joinValues(r),received:n.parsedType,code:T.invalid_type}),B}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let n=this._getOrReturnCtx(e),r=this._def.values;return A(n,{received:n.data,code:T.invalid_enum_value,options:r}),B}return Ne(e.data)}get options(){return this._def.values}get enum(){let e={};for(let n of this._def.values)e[n]=n;return e}get Values(){let e={};for(let n of this._def.values)e[n]=n;return e}get Enum(){let e={};for(let n of this._def.values)e[n]=n;return e}extract(e,n=this._def){return t.create(e,{...this._def,...n})}exclude(e,n=this._def){return t.create(this.options.filter(r=>!e.includes(r)),{...this._def,...n})}};_n.create=as;var An=class extends q{_parse(e){let n=J.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==C.string&&r.parsedType!==C.number){let a=J.objectValues(n);return A(r,{expected:J.joinValues(a),received:r.parsedType,code:T.invalid_type}),B}if(this._cache||(this._cache=new Set(J.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let a=J.objectValues(n);return A(r,{received:r.data,code:T.invalid_enum_value,options:a}),B}return Ne(e.data)}get enum(){return this._def.values}};An.create=(t,e)=>new An({values:t,typeName:O.ZodNativeEnum,...G(e)});var en=class extends q{unwrap(){return this._def.type}_parse(e){let{ctx:n}=this._processInputParams(e);if(n.parsedType!==C.promise&&n.common.async===!1)return A(n,{code:T.invalid_type,expected:C.promise,received:n.parsedType}),B;let r=n.parsedType===C.promise?n.data:Promise.resolve(n.data);return Ne(r.then(a=>this._def.type.parseAsync(a,{path:n.path,errorMap:n.common.contextualErrorMap})))}};en.create=(t,e)=>new en({type:t,typeName:O.ZodPromise,...G(e)});var pt=class extends q{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===O.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:n,ctx:r}=this._processInputParams(e),a=this._def.effect||null,i={addIssue:o=>{A(r,o),o.fatal?n.abort():n.dirty()},get path(){return r.path}};if(i.addIssue=i.addIssue.bind(i),a.type==="preprocess"){let o=a.transform(r.data,i);if(r.common.async)return Promise.resolve(o).then(async s=>{if(n.value==="aborted")return B;let p=await this._def.schema._parseAsync({data:s,path:r.path,parent:r});return p.status==="aborted"?B:p.status==="dirty"?hn(p.value):n.value==="dirty"?hn(p.value):p});{if(n.value==="aborted")return B;let s=this._def.schema._parseSync({data:o,path:r.path,parent:r});return s.status==="aborted"?B:s.status==="dirty"?hn(s.value):n.value==="dirty"?hn(s.value):s}}if(a.type==="refinement"){let o=s=>{let p=a.refinement(s,i);if(r.common.async)return Promise.resolve(p);if(p instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return s};if(r.common.async===!1){let s=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?B:(s.status==="dirty"&&n.dirty(),o(s.value),{status:n.value,value:s.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(s=>s.status==="aborted"?B:(s.status==="dirty"&&n.dirty(),o(s.value).then(()=>({status:n.value,value:s.value}))))}if(a.type==="transform")if(r.common.async===!1){let o=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!Kt(o))return B;let s=a.transform(o.value,i);if(s instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:n.value,value:s}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(o=>Kt(o)?Promise.resolve(a.transform(o.value,i)).then(s=>({status:n.value,value:s})):B);J.assertNever(a)}};pt.create=(t,e,n)=>new pt({schema:t,typeName:O.ZodEffects,effect:e,...G(n)});pt.createWithPreprocess=(t,e,n)=>new pt({schema:e,effect:{type:"preprocess",transform:t},typeName:O.ZodEffects,...G(n)});var dt=class extends q{_parse(e){return this._getType(e)===C.undefined?Ne(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};dt.create=(t,e)=>new dt({innerType:t,typeName:O.ZodOptional,...G(e)});var It=class extends q{_parse(e){return this._getType(e)===C.null?Ne(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};It.create=(t,e)=>new It({innerType:t,typeName:O.ZodNullable,...G(e)});var Ln=class extends q{_parse(e){let{ctx:n}=this._processInputParams(e),r=n.data;return n.parsedType===C.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:n.path,parent:n})}removeDefault(){return this._def.innerType}};Ln.create=(t,e)=>new Ln({innerType:t,typeName:O.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...G(e)});var Cn=class extends q{_parse(e){let{ctx:n}=this._processInputParams(e),r={...n,common:{...n.common,issues:[]}},a=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return qn(a)?a.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new Ye(r.common.issues)},input:r.data})})):{status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new Ye(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}};Cn.create=(t,e)=>new Cn({innerType:t,typeName:O.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...G(e)});var Xn=class extends q{_parse(e){if(this._getType(e)!==C.nan){let r=this._getOrReturnCtx(e);return A(r,{code:T.invalid_type,expected:C.nan,received:r.parsedType}),B}return{status:"valid",value:e.data}}};Xn.create=t=>new Xn({typeName:O.ZodNaN,...G(t)});var Dl=Symbol("zod_brand"),_r=class extends q{_parse(e){let{ctx:n}=this._processInputParams(e),r=n.data;return this._def.type._parse({data:r,path:n.path,parent:n})}unwrap(){return this._def.type}},Ar=class t extends q{_parse(e){let{status:n,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{let i=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return i.status==="aborted"?B:i.status==="dirty"?(n.dirty(),hn(i.value)):this._def.out._parseAsync({data:i.value,path:r.path,parent:r})})();{let a=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return a.status==="aborted"?B:a.status==="dirty"?(n.dirty(),{status:"dirty",value:a.value}):this._def.out._parseSync({data:a.value,path:r.path,parent:r})}}static create(e,n){return new t({in:e,out:n,typeName:O.ZodPipeline})}},In=class extends q{_parse(e){let n=this._def.innerType._parse(e),r=a=>(Kt(a)&&(a.value=Object.freeze(a.value)),a);return qn(n)?n.then(a=>r(a)):r(n)}unwrap(){return this._def.innerType}};In.create=(t,e)=>new In({innerType:t,typeName:O.ZodReadonly,...G(e)});function ts(t,e){let n=typeof t=="function"?t(e):typeof t=="string"?{message:t}:t;return typeof n=="string"?{message:n}:n}function ss(t,e={},n){return t?Qt.create().superRefine((r,a)=>{let i=t(r);if(i instanceof Promise)return i.then(o=>{if(!o){let s=ts(e,r),p=s.fatal??n??!0;a.addIssue({code:"custom",...s,fatal:p})}});if(!i){let o=ts(e,r),s=o.fatal??n??!0;a.addIssue({code:"custom",...o,fatal:s})}}):Qt.create()}var Rl={object:Je.lazycreate},O;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(O||(O={}));var Bl=(t,e={message:`Input not instance of ${t.name}`})=>ss(n=>n instanceof t,e),os=Xt.create,ls=gn.create,Pl=Xn.create,Ol=yn.create,cs=vn.create,Nl=xn.create,$l=Wn.create,zl=bn.create,Hl=wn.create,Fl=Qt.create,jl=Ft.create,Ul=wt.create,Vl=Yn.create,Gl=jt.create,ql=Je.create,Zl=Je.strictCreate,Wl=Tn.create,Yl=pi.create,Jl=kn.create,Kl=Ct.create,Xl=fi.create,Ql=Jn.create,ec=Kn.create,tc=hi.create,nc=Sn.create,rc=En.create,ic=_n.create,ac=An.create,sc=en.create,oc=pt.create,lc=dt.create,cc=It.create,uc=pt.createWithPreprocess,dc=Ar.create,mc=()=>os().optional(),pc=()=>ls().optional(),fc=()=>cs().optional(),hc={string:(t=>Xt.create({...t,coerce:!0})),number:(t=>gn.create({...t,coerce:!0})),boolean:(t=>vn.create({...t,coerce:!0})),bigint:(t=>yn.create({...t,coerce:!0})),date:(t=>xn.create({...t,coerce:!0}))};var gc=B;function c(t,...e){let n="debug",r=[...e];e.length>0&&typeof e[e.length-1]=="string"&&["debug","info","warn","error"].includes(e[e.length-1])&&(n=r.pop());let i=`[Timekeeper v${GM_info.script.version}]`;({debug:console.log,info:console.info,warn:console.warn,error:console.error})[n](`${i} ${t}`,...r)}function Ut(t,e=t){let n=Math.floor(t/3600),r=Math.floor(t%3600/60),a=String(t%60).padStart(2,"0");return e<3600?`${r<10?r:String(r).padStart(2,"0")}:${a}`:`${e>=36e3?String(n).padStart(2,"0"):n}:${String(r).padStart(2,"0")}:${a}`}function Lr(t,e=window.location.href){try{let n=new URL(e);return n.searchParams.set("t",`${t}s`),n.toString()}catch{return`https://www.youtube.com/watch?v=${e.search(/[?&]v=/)>=0?e.split(/[?&]v=/)[1].split(/&/)[0]:e.split(/\/live\/|\/shorts\/|\?|&/)[1]}&t=${t}s`}}function Mn(){let t=new Date;return t.getUTCFullYear()+"-"+String(t.getUTCMonth()+1).padStart(2,"0")+"-"+String(t.getUTCDate()).padStart(2,"0")+"--"+String(t.getUTCHours()).padStart(2,"0")+"-"+String(t.getUTCMinutes()).padStart(2,"0")+"-"+String(t.getUTCSeconds()).padStart(2,"0")}var yc=[{emoji:"\u{1F942}",month:1,day:1,name:"New Year's Day"},{emoji:"\u{1F49D}",month:2,day:14,name:"Valentine's Day"},{emoji:"\u{1F986}",month:5,day:25,name:"Kanna's Debut Anniversary"},{emoji:"\u{1F383}",month:10,day:31,name:"Halloween"},{emoji:"\u{1F382}",month:9,day:15,name:"Kanna's Birthday"},{emoji:"\u{1F332}",month:12,day:25,name:"Christmas"}];function us(){let t=new Date,e=t.getFullYear(),n=t.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});for(let r of yc){let a=new Date(e,r.month-1,r.day),i=a.getTime()-t.getTime(),o=i/(1e3*60*60*24);if(o<=5&&o>=-2)return c(`Current date: ${n}, Selected emoji: ${r.emoji} (${r.name}), Days until holiday: ${Math.ceil(o)}`),r.emoji;if(o<-2&&(a=new Date(e+1,r.month-1,r.day),i=a.getTime()-t.getTime(),o=i/(1e3*60*60*24),o<=5&&o>=-2))return c(`Current date: ${n}, Selected emoji: ${r.emoji} (${r.name}), Days until holiday: ${Math.ceil(o)}`),r.emoji;if(o>5&&(a=new Date(e-1,r.month-1,r.day),i=a.getTime()-t.getTime(),o=i/(1e3*60*60*24),o<=5&&o>=-2))return c(`Current date: ${n}, Selected emoji: ${r.emoji} (${r.name}), Days until holiday: ${Math.ceil(o)}`),r.emoji}return c(`Current date: ${n}, No holiday emoji (not within range)`),null}var Ke=null,Qn=null,vc=250,Tt=null,er=!1,Xe=null;function xc(){return(!Ke||!document.body.contains(Ke))&&(Ke=document.createElement("div"),Ke.className="ytls-tooltip",Ke.style.pointerEvents="none",document.body.appendChild(Ke),window.addEventListener("scroll",ds,!0),window.addEventListener("resize",ds,!0)),Ke}function bc(t,e,n){let a=window.innerWidth,i=window.innerHeight,o=t.getBoundingClientRect(),s=o.width,p=o.height,u=e+10,m=n+10;u+s>a-10&&(u=e-s-10),m+p>i-10&&(m=n-p-10),u=Math.max(10,Math.min(u,a-s-10)),m=Math.max(10,Math.min(m,i-p-10)),t.style.left=`${u}px`,t.style.top=`${m}px`}function ms(t,e){let r=window.innerWidth,a=window.innerHeight,i=e.getBoundingClientRect(),o=t.getBoundingClientRect(),s=o.width,p=o.height,u=Math.round(i.left+i.width/2-s/2),m=Math.round(i.top-p-8);m<8&&(m=Math.round(i.bottom+8)),u<8&&(u=Math.round(i.left)),u+s>r-8&&(u=Math.round(i.right-s)),u=Math.max(8,Math.min(u,r-s-8)),m=Math.max(8,Math.min(m,a-p-8)),t.style.left=`${u}px`,t.style.top=`${m}px`}function ds(){if(!(!Ke||!Tt)&&Ke.classList.contains("ytls-tooltip-visible"))try{ms(Ke,Tt)}catch{}}function wc(t=50){Xe&&(clearTimeout(Xe),Xe=null),!er&&(Xe=setTimeout(()=>{Cr(),Xe=null},t))}function Tc(t,e,n,r){Xe&&(clearTimeout(Xe),Xe=null),Tt&&r&&Tt!==r&&Ke?.classList.contains("ytls-tooltip-visible")&&Ke.classList.remove("ytls-tooltip-visible"),Qn&&clearTimeout(Qn),r&&(Tt=r,er=!0),Qn=setTimeout(()=>{let a=xc();a.textContent=t,a.classList.remove("ytls-tooltip-visible"),r?requestAnimationFrame(()=>{ms(a,r),requestAnimationFrame(()=>{a.classList.add("ytls-tooltip-visible")})}):(bc(a,e,n),requestAnimationFrame(()=>{a.classList.add("ytls-tooltip-visible")}))},vc)}function Cr(){Qn&&(clearTimeout(Qn),Qn=null),Xe&&(clearTimeout(Xe),Xe=null),Ke&&Ke.classList.remove("ytls-tooltip-visible"),Tt=null,er=!1}function Ki(){Cr()}function at(t,e){let n=0,r=0,a=u=>{n=u.clientX,r=u.clientY,Xe&&(clearTimeout(Xe),Xe=null),er=!0,Tt=t;let m=typeof e=="function"?e():e;m&&Tc(m,n,r,t)},i=u=>{n=u.clientX,r=u.clientY},o=()=>{Tt===t&&(er=!1,wc())};t.addEventListener("mouseenter",a),t.addEventListener("mousemove",i),t.addEventListener("mouseleave",o);let s=u=>{er=!1,Tt===t&&Cr()};t.addEventListener("click",s,!0);let p=new MutationObserver(()=>{try{if(!document.body.contains(t))Tt===t&&Cr();else{let u=window.getComputedStyle(t);(u.display==="none"||u.visibility==="hidden"||u.opacity==="0")&&Tt===t&&Cr()}}catch{}});try{p.observe(t,{attributes:!0,attributeFilter:["class","style"]}),p.observe(document.body,{childList:!0,subtree:!0})}catch{}t.__tooltipCleanup=()=>{t.removeEventListener("mouseenter",a),t.removeEventListener("mousemove",i),t.removeEventListener("mouseleave",o),t.removeEventListener("click",s,!0);try{p.disconnect()}catch{}delete t.__tooltipObserver},t.__tooltipObserver=p}var sa={};Xa(sa,{addTimestamp:()=>Cc,buildExportCsvPayload:()=>zc,buildExportPayload:()=>Nc,deleteSingleTimestampFromIndexedDB:()=>Rc,exportAllTimestamps:()=>$c,exportAllTimestampsCsv:()=>Hc,loadFromIndexedDB:()=>Dc,loadGlobalSettings:()=>Oc,removeFromIndexedDB:()=>Bc,saveGlobalSettings:()=>Pc,saveSingleTimestampToIndexedDB:()=>Mc,saveToIndexedDB:()=>Ic});var kc=z.preprocess(t=>typeof t=="string"&&t.trim().length>0?t:crypto.randomUUID(),z.string()),tr=z.object({guid:kc,start:z.number().finite().nonnegative(),comment:z.string()}),Ir=tr.array(),Xi=tr.extend({video_id:z.string()}),fs=z.object({x:z.number().finite(),y:z.number().finite(),width:z.number().finite().positive().optional(),height:z.number().finite().positive().optional()}),gi=z.object({video_id:z.string(),timestamps:Ir}),Xu=z.record(gi),ps=z.object({isSignedIn:z.boolean().catch(!1),accessToken:z.string().nullable().catch(null),userName:z.string().nullable().catch(null),email:z.string().nullable().catch(null)}),Qi=z.union([ps,z.string().transform((t,e)=>{try{let n=JSON.parse(t);return ps.parse(n)}catch{return e.addIssue({code:z.ZodIssueCode.custom,message:"Invalid JSON string for auth state"}),z.NEVER}})]).catch({isSignedIn:!1,accessToken:null,userName:null,email:null}),ea=z.object({autoBackupEnabled:z.boolean(),autoBackupIntervalMinutes:z.number().int().min(5).max(1440),lastAutoBackupAt:z.number().int().positive().nullable().optional()});var Sc="ytls-timestamps-db",Ec=3,nr="timestamps",ft="timestamps_v2",yi="settings",rr=null,ir=null;function ar(){if(rr)try{if(rr.objectStoreNames.length>=0)return Promise.resolve(rr)}catch(t){c("IndexedDB connection is no longer usable:",t,"warn"),rr=null}return ir||(ir=_c().then(t=>(rr=t,ir=null,t.onclose=()=>{c("IndexedDB connection closed unexpectedly","warn"),rr=null},t.onerror=e=>{c("IndexedDB connection error:",e,"error")},t)).catch(t=>{throw ir=null,t}),ir)}function _c(){return new Promise((t,e)=>{let n=indexedDB.open(Sc,Ec);n.onupgradeneeded=r=>{let a=r.target.result,i=r.oldVersion,o=r.target.transaction;if(i<1&&a.createObjectStore(nr,{keyPath:"video_id"}),i<2&&!a.objectStoreNames.contains(yi)&&a.createObjectStore(yi,{keyPath:"key"}),i<3){if(a.objectStoreNames.contains(nr)){c("Exporting backup before v2 migration...");let u=o.objectStore(nr).getAll();u.onsuccess=()=>{let m=gi.array().safeParse(u.result);if(m.success&&m.data.length>0)try{let k={},_=0;m.data.forEach(re=>{if(re.timestamps.length>0){let ce=Ir.parse(re.timestamps);k[`ytls-${re.video_id}`]={video_id:re.video_id,timestamps:[...ce].sort((pe,Q)=>pe.start-Q.start)},_+=ce.length}});let L=new Blob([JSON.stringify(k,null,2)],{type:"application/json"}),j=URL.createObjectURL(L),U=document.createElement("a");U.href=j,U.download=`timekeeper-data-${Mn()}.json`,U.click(),URL.revokeObjectURL(j),c(`Pre-migration backup exported: ${m.data.length} videos, ${_} timestamps`)}catch(k){c("Failed to export pre-migration backup:",k,"error")}else m.success||c("Skipping pre-migration backup: legacy data failed validation",m.error.format(),"warn")}}let s=a.createObjectStore(ft,{keyPath:"guid"});if(s.createIndex("video_id","video_id",{unique:!1}),s.createIndex("video_start",["video_id","start"],{unique:!1}),a.objectStoreNames.contains(nr)){let u=o.objectStore(nr).getAll();u.onsuccess=()=>{let m=gi.array().safeParse(u.result);if(m.success&&m.data.length>0){let k=0;m.data.forEach(_=>{_.timestamps.length>0&&_.timestamps.forEach(L=>{s.put({guid:L.guid,video_id:_.video_id,start:L.start,comment:L.comment}),k++})}),c(`Migrated ${k} timestamps from ${m.data.length} videos to v2 store`)}else m.success||c("Skipping v1 \u2192 v2 migration: legacy data failed validation",m.error.format(),"warn")},a.deleteObjectStore(nr),c("Deleted old timestamps store after migration to v2")}}},n.onsuccess=r=>{t(r.target.result)},n.onerror=r=>{let a=r.target.error;e(a??new Error("Failed to open IndexedDB"))}})}function ta(t,e,n){return ar().then(r=>new Promise((a,i)=>{let o;try{o=r.transaction(t,e)}catch(u){i(new Error(`Failed to create transaction for ${t}: ${u}`));return}let s=o.objectStore(t),p;try{p=n(s)}catch(u){i(new Error(`Failed to execute operation on ${t}: ${u}`));return}p&&(p.onsuccess=()=>a(p.result),p.onerror=()=>i(p.error??new Error(`IndexedDB ${e} operation failed`))),o.oncomplete=()=>{p||a(void 0)},o.onerror=()=>i(o.error??new Error("IndexedDB transaction failed")),o.onabort=()=>i(o.error??new Error("IndexedDB transaction aborted"))}))}function hs(t,e){let n=Ir.safeParse(e);if(!n.success)return Promise.reject(new Error(`Invalid timestamp payload for ${t}`));let r=n.data;return ar().then(a=>new Promise((i,o)=>{let s;try{s=a.transaction([ft],"readwrite")}catch(k){o(new Error(`Failed to create transaction: ${k}`));return}let p=s.objectStore(ft),m=p.index("video_id").getAll(IDBKeyRange.only(t));m.onsuccess=()=>{try{let k=m.result,_=new Set(r.map(L=>L.guid));k.forEach(L=>{_.has(L.guid)||p.delete(L.guid)}),r.forEach(L=>{p.put({guid:L.guid,video_id:t,start:L.start,comment:L.comment})})}catch(k){c("Error during save operation:",k,"error")}},m.onerror=()=>{o(m.error??new Error("Failed to get existing records"))},s.oncomplete=()=>i(),s.onerror=()=>o(s.error??new Error("Failed to save to IndexedDB")),s.onabort=()=>o(s.error??new Error("Transaction aborted during save"))}))}function gs(t,e){let n=tr.safeParse(e);if(!n.success)return Promise.reject(new Error(`Invalid timestamp: ${n.error.message}`));let r=n.data;return ar().then(a=>new Promise((i,o)=>{let s;try{s=a.transaction([ft],"readwrite")}catch(m){o(new Error(`Failed to create transaction: ${m}`));return}let u=s.objectStore(ft).put({guid:r.guid,video_id:t,start:r.start,comment:r.comment});u.onerror=()=>{o(u.error??new Error("Failed to put timestamp"))},s.oncomplete=()=>i(),s.onerror=()=>o(s.error??new Error("Failed to save single timestamp to IndexedDB")),s.onabort=()=>o(s.error??new Error("Transaction aborted during single timestamp save"))}))}function ys(t){return c(`Deleting timestamp ${t}`),ar().then(e=>new Promise((n,r)=>{let a;try{a=e.transaction([ft],"readwrite")}catch(s){r(new Error(`Failed to create transaction: ${s}`));return}let o=a.objectStore(ft).delete(t);o.onerror=()=>{r(o.error??new Error("Failed to delete timestamp"))},a.oncomplete=()=>n(),a.onerror=()=>r(a.error??new Error("Failed to delete single timestamp from IndexedDB")),a.onabort=()=>r(a.error??new Error("Transaction aborted during timestamp deletion"))}))}function vs(t){return ar().then(e=>new Promise(n=>{let r;try{r=e.transaction([ft],"readonly")}catch(s){c("Failed to create read transaction:",s,"warn"),n(null);return}let o=r.objectStore(ft).index("video_id").getAll(IDBKeyRange.only(t));o.onsuccess=()=>{let s=o.result;if(s.length===0){n(null);return}let p=s.map(k=>({guid:k.guid,start:k.start,comment:k.comment})),u=Ir.safeParse(p);if(!u.success){c("Failed to parse timestamps from IndexedDB:",u.error.format(),"warn"),n(null);return}let m=[...u.data].sort((k,_)=>k.start-_.start);n(m)},o.onerror=()=>{c("Failed to load timestamps:",o.error,"warn"),n(null)},r.onabort=()=>{c("Transaction aborted during load:",r.error,"warn"),n(null)}}))}function xs(t){return ar().then(e=>new Promise((n,r)=>{let a;try{a=e.transaction([ft],"readwrite")}catch(p){r(new Error(`Failed to create transaction: ${p}`));return}let i=a.objectStore(ft),s=i.index("video_id").getAll(IDBKeyRange.only(t));s.onsuccess=()=>{try{s.result.forEach(u=>{i.delete(u.guid)})}catch(p){c("Error during remove operation:",p,"error")}},s.onerror=()=>{r(s.error??new Error("Failed to get records for removal"))},a.oncomplete=()=>n(),a.onerror=()=>r(a.error??new Error("Failed to remove timestamps")),a.onabort=()=>r(a.error??new Error("Transaction aborted during timestamp removal"))}))}function na(){return ta(ft,"readonly",t=>t.getAll()).then(t=>Array.isArray(t)?t:[])}function bs(t,e){ta(yi,"readwrite",n=>{n.put({key:t,value:e})}).catch(n=>{c(`Failed to save setting '${t}' to IndexedDB:`,n,"error")})}function ws(t){return ta(yi,"readonly",e=>e.get(t)).then(e=>e?.value).catch(e=>{c(`Failed to load setting '${t}' from IndexedDB:`,e,"error")})}async function ra(){let t={},e=await na(),n=Xi.array().safeParse(e);if(!n.success)return c("Failed to parse timestamp rows for export:",n.error.format(),"warn"),{json:"{}",filename:"timekeeper-data.json",totalVideos:0,totalTimestamps:0};let r=new Map;for(let o of n.data)r.has(o.video_id)||r.set(o.video_id,[]),r.get(o.video_id).push({guid:o.guid,start:o.start,comment:o.comment});for(let[o,s]of r)t[`ytls-${o}`]={video_id:o,timestamps:s.sort((p,u)=>p.start-u.start)};return{json:JSON.stringify(t,null,2),filename:"timekeeper-data.json",totalVideos:r.size,totalTimestamps:n.data.length}}async function Ts(){try{let{json:t,filename:e,totalVideos:n,totalTimestamps:r}=await ra(),a=new Blob([t],{type:"application/json"}),i=URL.createObjectURL(a),o=document.createElement("a");o.href=i,o.download=e,o.click(),URL.revokeObjectURL(i),c(`Exported ${n} videos with ${r} timestamps`)}catch(t){throw c("Failed to export data:",t,"error"),t}}async function ia(){let t=Xi.array().safeParse(await na());if(!t.success||t.data.length===0){t.success||c("Failed to parse timestamp rows for CSV export:",t.error.format(),"warn");let m=`Tag,Timestamp,URL
`,k=`timestamps-${Mn()}.csv`;return{csv:m,filename:k,totalVideos:0,totalTimestamps:0}}let e=t.data,n=new Map;for(let m of e)n.has(m.video_id)||n.set(m.video_id,[]),n.get(m.video_id).push({start:m.start,comment:m.comment});let r=[];r.push("Tag,Timestamp,URL");let a=0,i=m=>`"${String(m).replace(/"/g,'""')}"`,o=m=>{let k=Math.floor(m/3600),_=Math.floor(m%3600/60),L=String(m%60).padStart(2,"0");return`${String(k).padStart(2,"0")}:${String(_).padStart(2,"0")}:${L}`},s=Array.from(n.keys()).sort();for(let m of s){let k=n.get(m).sort((_,L)=>_.start-L.start);for(let _ of k){let L=_.comment,j=o(_.start),U=Lr(_.start,`https://www.youtube.com/watch?v=${m}`);r.push([i(L),i(j),i(U)].join(",")),a++}}let p=r.join(`
`),u=`timestamps-${Mn()}.csv`;return{csv:p,filename:u,totalVideos:n.size,totalTimestamps:a}}async function ks(){try{let{csv:t,filename:e,totalVideos:n,totalTimestamps:r}=await ia(),a=new Blob([t],{type:"text/csv;charset=utf-8;"}),i=URL.createObjectURL(a),o=document.createElement("a");o.href=i,o.download=e,o.click(),URL.revokeObjectURL(i),c(`Exported ${n} videos with ${r} timestamps (CSV)`)}catch(t){throw c("Failed to export CSV data:",t,"error"),t}}async function aa(t,e){if(!t)throw new Error("Video ID is required");if(!e.guid||!e.start)throw new Error("Timestamp must have GUID and start time");return gs(t,e)}async function Ss(t,e){if(!t)throw new Error("Video ID is required");if(!Array.isArray(e))throw new Error("Timestamps must be an array");return hs(t,e)}async function Es(t){if(!t)throw new Error("GUID is required");return ys(t)}async function _s(t){if(!t)throw new Error("Video ID is required");return xs(t)}async function As(t){if(!t)throw new Error("Video ID is required");return vs(t)}function Ls(t,e){if(!t)throw new Error("Setting key is required");bs(t,e)}async function Cs(t){if(!t)throw new Error("Setting key is required");return ws(t)}function Cc(t,e){return aa(t,e)}function Ic(t,e){return Ss(t,e)}function Mc(t,e){return aa(t,e)}function Dc(t){return As(t)}function Rc(t,e){return Es(e)}function Bc(t){return _s(t)}function Pc(t,e){Ls(t,e)}function Oc(t){return Cs(t)}function Nc(){return ra()}function $c(){return Ts()}function zc(){return ia()}function Hc(){return ks()}var Fc=!1;function vi(t){return t?Array.from(t.querySelectorAll("li:not(.ytls-placeholder):not(.ytls-error-message)")):[]}function oa(t){if(t)for(;t.firstChild;)t.removeChild(t.firstChild)}function la(t,e){if(!t)return;oa(t);let n=document.createElement("li");n.className="ytls-placeholder",n.textContent=e,t.appendChild(n),t.style.overflowY="hidden"}function Is(t){if(!t)return;let e=t.querySelector(".ytls-placeholder");e&&e.remove(),t.style.overflowY=""}function Ms(t,e){if(!t||e)return;Array.from(t.children).some(r=>!r.classList.contains("ytls-placeholder")&&!r.classList.contains("ytls-error-message"))||la(t,"No timestamps for this video")}function Ds(t){if(!t)return[];let e=vi(t),n=[];return e.forEach(r=>{let a=r.querySelector("a[data-time]"),i=r.querySelector("input"),o=r.dataset.guid;if(!a||!i||!o)return;let s=a.dataset.time;if(!s)return;let p=Number.parseInt(s,10);Number.isFinite(p)&&n.push({guid:o,start:p,comment:i.value})}),n.sort((r,a)=>r.start-a.start)}function Mr(t){Fc=t}function Rs(t){if(!t)return 0;let e=vi(t),n=0;return e.forEach(r=>{let i=r.querySelector("a[data-time]")?.dataset.time;if(i){let o=Number.parseInt(i,10);Number.isFinite(o)&&(n=Math.max(n,o))}}),n}var Uc={auth:{googleAuthState:{isSignedIn:!1,accessToken:null,userName:null,email:null},autoBackupEnabled:!0,autoBackupIntervalMinutes:30,autoBackupRetryAttempts:0,autoBackupBackoffMs:null,lastAutoBackupAt:null,isAutoBackupRunning:!1},ui:{panePosition:null,currentVideoId:"",minPaneHeight:250,lastHandledUrl:null,urlChangeHandlersSetup:!1},timestamps:{items:[],currentIndex:null}},we=JSON.parse(JSON.stringify(Uc)),Vc=new Set;function He(){return JSON.parse(JSON.stringify(we))}function st(t){let e=JSON.parse(JSON.stringify(we));we={...we,...t,auth:{...we.auth,...t.auth||{}},ui:{...we.ui,...t.ui||{}},timestamps:{...we.timestamps,...t.timestamps||{}}},Gc(e)}function Mt(){return He().auth.googleAuthState}function Vt(t){st({auth:{...we.auth,googleAuthState:t}})}function Bs(t){st({auth:{...we.auth,autoBackupEnabled:t}})}function Ps(t){st({auth:{...we.auth,autoBackupIntervalMinutes:t}})}function Os(t){st({auth:{...we.auth,isAutoBackupRunning:t}})}function Ns(t){st({auth:{...we.auth,autoBackupRetryAttempts:t}})}function $s(t){st({auth:{...we.auth,autoBackupBackoffMs:t}})}function zs(t){st({auth:{...we.auth,lastAutoBackupAt:t}})}function Hs(t){st({ui:{...we.ui,minPaneHeight:t}})}function Fs(t){st({ui:{...we.ui,panePosition:t}})}function js(t){st({ui:{...we.ui,lastHandledUrl:t}})}function Us(t){st({ui:{...we.ui,urlChangeHandlersSetup:t}})}function Vs(t){st({timestamps:{...we.timestamps,items:t}})}function Gs(t){st({timestamps:{...we.timestamps,currentIndex:t}})}function Gc(t){Vc.forEach(e=>{try{e(we,t)}catch(n){console.error("Error in state listener:",n)}})}function Zs(){let{get:t,set:e}=Object.getOwnPropertyDescriptor(Object.prototype,"playerResponse")??{set(a){this[Symbol.for("YTBetter")]=a},get(){return this[Symbol.for("YTBetter")]}},n=a=>a!=null&&typeof a=="object",r=(a,i)=>Object.keys(a).find(o=>a[o]&&a[o][i]);Object.defineProperty(Object.prototype,"playerResponse",{set(a){if(n(a)){let{streamingData:i,videoDetails:o,playerConfig:s,microformat:p}=a;if(n(o)&&o.isLive){if(o.isLiveDvrEnabled=!0,n(s)&&s.mediaCommonConfig){let u=s.mediaCommonConfig;u.useServerDrivenAbr=!1,u.serverPlaybackStartConfig&&(u.serverPlaybackStartConfig.enable=!1)}if(n(i)){i.serverAbrStreamingUrl&&(i.hlsManifestUrl||i.dashManifestUrl)&&delete i.serverAbrStreamingUrl;let u=43200,m=u*14,k=0,_="playerMicroformatRenderer",L="liveBroadcastDetails",j="html5_max_live_dvr_window_plus_margin_secs";if(n(p)&&n(p[_])&&n(p[_][L])){let U=Date.now(),re=new Date(p[_][L].startTimestamp).getTime();k=Math.floor((U-re)/1e3)}if(k>u){if(Array.isArray(i.adaptiveFormats))for(let re of i.adaptiveFormats)re.maxDvrDurationSec=m;let U=r(this,"experiments");U&&this[U]?.experiments?.flags&&(this[U].experiments.flags[j]=m)}}}}e.call(this,a)},get(){return t.call(this)},configurable:!0}),c("[Timekeeper] DVR/Rewind enablement initialized for live streams")}var ca="#ytls-pane{background:rgba(19,19,19,.8);text-align:left;position:fixed;bottom:0;right:0;padding:0;margin:0;border-radius:12px;border:1px solid rgba(85,85,85,.8);opacity:.9;z-index:5000;font-family:Arial,sans-serif;width:300px;height:90vh;min-width:300px;max-width:800px;min-height:400px;max-height:90vh;user-select:none;display:flex;flex-direction:column;will-change:width,height;transform:translateZ(0);backface-visibility:hidden;contain:layout style paint;overflow:hidden}#ytls-pane:hover{opacity:1}#ytls-resize-handle{position:absolute;bottom:0;right:0;width:20px;height:20px;cursor:auto;z-index:10;pointer-events:none;background:0 0;margin:0;padding:0}#ytls-resize-handle::before{display:none;content:none}#ytls-resize-bl,#ytls-resize-br,#ytls-resize-tl,#ytls-resize-tr{position:absolute;width:16px;height:16px;z-index:11;background:0 0;pointer-events:auto}#ytls-resize-tl{top:0;left:0;cursor:nwse-resize}#ytls-resize-tr{top:0;right:0;cursor:nesw-resize}#ytls-resize-bl{bottom:0;left:0;cursor:nesw-resize}#ytls-resize-br{bottom:0;right:0;cursor:nwse-resize}#ytls-content{display:flex;flex-direction:column;width:100%;height:100%;min-height:0;box-sizing:border-box;position:relative}#ytls-content ul{flex:1 1 auto;overflow-y:auto;margin:0!important;padding:0!important;border:none!important;box-sizing:border-box;width:100%;max-width:100%;min-height:0;z-index:1}#ytls-content ul li.ytls-placeholder{display:flex;align-items:center;justify-content:center;height:100%;width:100%;color:#bfbfbf;font-size:14px;font-style:italic;padding:12px;text-align:center;box-sizing:border-box}#ytls-pane-header{position:relative;z-index:2}#ytls-buttons{position:relative;z-index:2;flex-shrink:0;display:flex;gap:8px;justify-content:flex-end;padding:10px 18px 10px 16px;background:linear-gradient(0deg,#23272b 0,#212121 100%);border-radius:0 0 12px 12px;border-top:1px solid #23272b;margin-top:auto}#ytls-pane li{display:flex;flex-direction:column;padding:8px 12px;margin:0!important;border:none;border-top:1px solid rgba(85,85,85,.8);user-select:none;box-sizing:border-box;width:100%;max-width:100%}#ytls-pane li:first-child{border-top:none}#ytls-pane li.ytls-timestamp-highlight{background:rgba(66,79,66,.8)}#ytls-pane li.ytls-timestamp-pending-delete{background:rgba(128,0,0,.8)}#ytls-pane .time-row{display:flex;gap:5px;align-items:center}#ytls-pane .time-row a{flex-grow:0;flex-shrink:0;max-width:100%;text-align:left;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}#ytls-pane .time-row .time-diff{flex-grow:1;text-align:right}#ytls-pane .ytls-marker{position:absolute;height:100%;width:2px;background-color:red;cursor:pointer}#ytls-pane a,#ytls-pane input,#ytls-pane span{background:0 0;color:#fff;font-family:inherit;font-size:14px;text-decoration:none;border:none;outline:0}#ytls-pane input,#ytls-pane textarea{-webkit-user-select:text;-moz-user-select:text;-ms-user-select:text;user-select:text;caret-color:white}#ytls-buttons{flex-shrink:0;display:flex;gap:5px;justify-content:space-between;padding:8px 12px;background:#212121;border-radius:0 0 12px 12px;border-top:1px solid rgba(85,85,85,.8);z-index:2}#ytls-buttons button:hover{background:rgba(255,255,255,.2)}.ytls-main-button{background:#272727;color:#fff;font-size:24px;border:none;border-radius:5px;padding:5px;cursor:pointer;position:relative}.ytls-main-button:hover{background:#3f3f3f}.ytls-holiday-emoji{position:absolute;bottom:0;right:0;font-size:.25em;pointer-events:none}#ytls-pane-header{display:flex;justify-content:space-between;align-items:center;padding:10px 18px 10px 16px;white-space:nowrap;cursor:default;border-radius:12px 12px 0 0;border:none;background:linear-gradient(180deg,#23272b 0,#212121 100%);box-shadow:0 1px 0 0 #23272b;flex-shrink:0;color:#fafafa}#ytls-pane .ytls-version-display{font-size:14px;color:#666;margin-left:auto;padding-right:5px;cursor:default}#ytls-pane .ytls-google-user-display{font-size:12px;color:#4285f4;margin-left:8px;padding:2px 6px;cursor:default;background:rgba(66,133,244,.1);border-radius:4px}#ytls-pane .ytls-backup-status-display{font-size:12px;color:#9acd32;margin-left:8px;padding:2px 6px;cursor:default;background:rgba(154,205,50,.12);border-radius:4px}#ytls-current-time{color:#fff;font-size:14px;cursor:pointer;position:relative}#ytls-playback-speed{color:#cfcfcf;font-size:14px;margin-left:8px;cursor:pointer;user-select:none}#ytls-playback-speed{color:#cfcfcf;font-size:14px;cursor:pointer;user-select:none;padding:0 2px;border-radius:3px;outline:0}#ytls-playback-speed.ytls-playback-speed-active{color:#7ad;text-shadow:0 0 6px rgba(122,217,255,.4);font-weight:700;box-shadow:0 0 8px rgba(122,217,255,.08)}#ytls-playback-speed:hover{text-decoration:underline}#ytls-playback-speed-decrease,#ytls-playback-speed-increase{color:#cfcfcf;font-size:14px;cursor:pointer;user-select:none;margin:0}#ytls-playback-speed-group{display:inline-flex;align-items:center;gap:2px;margin-left:4px;align-self:center}#ytls-playback-speed-decrease:hover,#ytls-playback-speed-increase:hover{text-decoration:underline}.ytls-backup-indicator{display:inline-block;width:8px;height:8px;border-radius:50%;background-color:#666;cursor:help;flex-shrink:0}#ytls-settings-modal{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#1a1a1a;padding:8px;border-radius:10px;z-index:10000;color:#fff;text-align:center;width:200px;box-shadow:0 0 10px rgba(0,0,0,.5)}#ytls-delete-all-modal,#ytls-load-modal,#ytls-save-modal{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#333;padding:8px;border-radius:10px;z-index:10000;color:#fff;text-align:center;width:fit-content;max-width:90vw;box-shadow:0 0 10px rgba(0,0,0,.5)}.ytls-modal-header{display:flex;align-items:flex-end;margin-bottom:0;gap:10px}.ytls-modal-close-button{position:absolute;top:8px;right:8px;width:16px;height:16px;background:#f44;color:#fff;border:none;border-radius:3px;font-size:14px;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;line-height:1;padding:0;flex-shrink:0;z-index:1}.ytls-modal-close-button:hover{background:#f66}#ytls-settings-content{display:flex;flex-direction:column;gap:10px;align-items:center;background:#2a2a2a;border:2px solid #3a3a3a;border-radius:0 4px 4px 4px;padding:10px;margin-top:-2px;position:relative;z-index:1}.ytls-section-heading{margin:0 0 10px 0;padding:0;font-size:16px;font-weight:700;color:#fff;text-align:center}#ytls-settings-nav{display:flex;gap:6px;flex:0}#ytls-settings-nav .ytls-settings-modal-button{flex:0;width:auto;height:24px;margin-bottom:0;background:#2a2a2a;font-size:13px;padding:0 8px;display:flex;align-items:center;justify-content:center;line-height:1;border:2px solid transparent;border-radius:4px 4px 0 0;border-bottom:2px solid transparent;white-space:nowrap;position:relative}#ytls-settings-nav .ytls-settings-modal-button .ytls-tab-text{display:none}#ytls-settings-nav .ytls-settings-modal-button.active .ytls-tab-text{display:inline}#ytls-settings-nav .ytls-settings-modal-button:hover{background:#3a3a3a}#ytls-settings-nav .ytls-settings-modal-button.active{background:#2a2a2a;border:2px solid #3a3a3a;border-bottom:2px solid #2a2a2a;z-index:2}.ytls-button-grid{display:grid;grid-template-columns:1fr;gap:5px;width:100%}.ytls-settings-modal-button{width:100%;height:32px;background:#555;color:#fff;border:none;border-radius:5px;cursor:pointer;font-size:13px;display:flex;justify-content:center;align-items:center;margin-bottom:5px;padding:0 8px}.ytls-settings-modal-button:hover{background:#777}#ytls-delete-all-modal p,#ytls-load-modal p,#ytls-save-modal p{margin-bottom:15px;font-size:16px}.ytls-save-modal-button{background:#555;color:#fff;padding:10px 20px;border:none;border-radius:5px;cursor:pointer;margin-right:10px}.ytls-save-modal-button:last-of-type{margin-right:0}.ytls-save-modal-cancel-button{background:#444;color:#fff;padding:10px 20px;border:none;border-radius:5px;cursor:pointer;margin-top:15px;display:block;width:100%}.ytls-file-operation-button{background:#555;color:#fff;font-size:12px;padding:5px 10px;border:none;border-radius:5px;cursor:pointer}.ytls-file-operation-button:hover{background:#777}.ytls-hidden-file-input{display:none}#ytls-header-button{align-items:center;background:0 0;border:none;color:var(--yt-spec-text-primary,currentColor);cursor:pointer;display:inline-flex;font-size:20px;height:40px;margin-left:6px;padding:0 6px;text-decoration:none}#ytls-header-button:hover{color:var(--yt-spec-call-to-action,#3ea6ff)}#ytls-header-button:focus-visible{outline:2px solid var(--yt-spec-call-to-action,#3ea6ff);outline-offset:2px}#ytls-header-button img{display:block;height:32px;max-width:48px;pointer-events:none;width:auto}.ytls-fade-in{animation:fadeIn .3s ease-in-out forwards}.ytls-fade-out{animation:fadeOut .3s ease-in-out forwards}.ytls-zoom-in{animation:zoomIn .4s cubic-bezier(.68,-.55,.265,1.55) forwards;transform-origin:center center}.ytls-zoom-out{animation:zoomOut .4s cubic-bezier(.68,-.55,.265,1.55) forwards;transform-origin:center center}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes fadeOut{from{opacity:1}to{opacity:0}}@keyframes zoomIn{from{opacity:0;transform:scale(.1)}to{opacity:1;transform:scale(1)}}@keyframes zoomOut{from{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.1)}}.ytls-tooltip{position:fixed;background:rgba(97,97,97,.92);color:#fff;padding:8px 10px;border-radius:2px;font-size:12px;font-family:Roboto,Arial,sans-serif;font-weight:400;line-height:1.4;letter-spacing:.2px;z-index:10001;pointer-events:none;white-space:pre-line;max-width:300px;box-shadow:0 1px 2px rgba(0,0,0,.1);opacity:0;transition:opacity .2s cubic-bezier(0, 0, .2, 1)}.ytls-tooltip.ytls-tooltip-visible{opacity:1}";var Be=Uint8Array,ot=Uint16Array,ha=Int32Array,ga=new Be([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ya=new Be([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Ws=new Be([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),eo=function(t,e){for(var n=new ot(31),r=0;r<31;++r)n[r]=e+=1<<t[r-1];for(var a=new ha(n[30]),r=1;r<30;++r)for(var i=n[r];i<n[r+1];++i)a[i]=i-n[r]<<5|r;return{b:n,r:a}},to=eo(ga,2),qc=to.b,da=to.r;qc[28]=258,da[258]=28;var no=eo(ya,0),hd=no.b,Ys=no.r,ma=new ot(32768);for(te=0;te<32768;++te)Gt=(te&43690)>>1|(te&21845)<<1,Gt=(Gt&52428)>>2|(Gt&13107)<<2,Gt=(Gt&61680)>>4|(Gt&3855)<<4,ma[te]=((Gt&65280)>>8|(Gt&255)<<8)>>1;var Gt,te,Br=(function(t,e,n){for(var r=t.length,a=0,i=new ot(e);a<r;++a)t[a]&&++i[t[a]-1];var o=new ot(e);for(a=1;a<e;++a)o[a]=o[a-1]+i[a-1]<<1;var s;if(n){s=new ot(1<<e);var p=15-e;for(a=0;a<r;++a)if(t[a])for(var u=a<<4|t[a],m=e-t[a],k=o[t[a]-1]++<<m,_=k|(1<<m)-1;k<=_;++k)s[ma[k]>>p]=u}else for(s=new ot(r),a=0;a<r;++a)t[a]&&(s[a]=ma[o[t[a]-1]++]>>15-t[a]);return s}),Dn=new Be(288);for(te=0;te<144;++te)Dn[te]=8;var te;for(te=144;te<256;++te)Dn[te]=9;var te;for(te=256;te<280;++te)Dn[te]=7;var te;for(te=280;te<288;++te)Dn[te]=8;var te,xi=new Be(32);for(te=0;te<32;++te)xi[te]=5;var te,Zc=Br(Dn,9,0);var Wc=Br(xi,5,0);var ro=function(t){return(t+7)/8|0},io=function(t,e,n){return(e==null||e<0)&&(e=0),(n==null||n>t.length)&&(n=t.length),new Be(t.subarray(e,n))};var Yc=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],wi=function(t,e,n){var r=new Error(e||Yc[t]);if(r.code=t,Error.captureStackTrace&&Error.captureStackTrace(r,wi),!n)throw r;return r};var qt=function(t,e,n){n<<=e&7;var r=e/8|0;t[r]|=n,t[r+1]|=n>>8},Dr=function(t,e,n){n<<=e&7;var r=e/8|0;t[r]|=n,t[r+1]|=n>>8,t[r+2]|=n>>16},ua=function(t,e){for(var n=[],r=0;r<t.length;++r)t[r]&&n.push({s:r,f:t[r]});var a=n.length,i=n.slice();if(!a)return{t:so,l:0};if(a==1){var o=new Be(n[0].s+1);return o[n[0].s]=1,{t:o,l:1}}n.sort(function(Te,Le){return Te.f-Le.f}),n.push({s:-1,f:25001});var s=n[0],p=n[1],u=0,m=1,k=2;for(n[0]={s:-1,f:s.f+p.f,l:s,r:p};m!=a-1;)s=n[n[u].f<n[k].f?u++:k++],p=n[u!=m&&n[u].f<n[k].f?u++:k++],n[m++]={s:-1,f:s.f+p.f,l:s,r:p};for(var _=i[0].s,r=1;r<a;++r)i[r].s>_&&(_=i[r].s);var L=new ot(_+1),j=pa(n[m-1],L,0);if(j>e){var r=0,U=0,re=j-e,ce=1<<re;for(i.sort(function(Le,ye){return L[ye.s]-L[Le.s]||Le.f-ye.f});r<a;++r){var pe=i[r].s;if(L[pe]>e)U+=ce-(1<<j-L[pe]),L[pe]=e;else break}for(U>>=re;U>0;){var Q=i[r].s;L[Q]<e?U-=1<<e-L[Q]++-1:++r}for(;r>=0&&U;--r){var ie=i[r].s;L[ie]==e&&(--L[ie],++U)}j=e}return{t:new Be(L),l:j}},pa=function(t,e,n){return t.s==-1?Math.max(pa(t.l,e,n+1),pa(t.r,e,n+1)):e[t.s]=n},Js=function(t){for(var e=t.length;e&&!t[--e];);for(var n=new ot(++e),r=0,a=t[0],i=1,o=function(p){n[r++]=p},s=1;s<=e;++s)if(t[s]==a&&s!=e)++i;else{if(!a&&i>2){for(;i>138;i-=138)o(32754);i>2&&(o(i>10?i-11<<5|28690:i-3<<5|12305),i=0)}else if(i>3){for(o(a),--i;i>6;i-=6)o(8304);i>2&&(o(i-3<<5|8208),i=0)}for(;i--;)o(a);i=1,a=t[s]}return{c:n.subarray(0,r),n:e}},Rr=function(t,e){for(var n=0,r=0;r<e.length;++r)n+=t[r]*e[r];return n},ao=function(t,e,n){var r=n.length,a=ro(e+2);t[a]=r&255,t[a+1]=r>>8,t[a+2]=t[a]^255,t[a+3]=t[a+1]^255;for(var i=0;i<r;++i)t[a+i+4]=n[i];return(a+4+r)*8},Ks=function(t,e,n,r,a,i,o,s,p,u,m){qt(e,m++,n),++a[256];for(var k=ua(a,15),_=k.t,L=k.l,j=ua(i,15),U=j.t,re=j.l,ce=Js(_),pe=ce.c,Q=ce.n,ie=Js(U),Te=ie.c,Le=ie.n,ye=new ot(19),Y=0;Y<pe.length;++Y)++ye[pe[Y]&31];for(var Y=0;Y<Te.length;++Y)++ye[Te[Y]&31];for(var K=ua(ye,7),Ce=K.t,rn=K.l,je=19;je>4&&!Ce[Ws[je-1]];--je);var ct=u+5<<3,$e=Rr(a,Dn)+Rr(i,xi)+o,Ie=Rr(a,_)+Rr(i,U)+o+14+3*je+Rr(ye,Ce)+2*ye[16]+3*ye[17]+7*ye[18];if(p>=0&&ct<=$e&&ct<=Ie)return ao(e,m,t.subarray(p,p+u));var Ue,ke,et,St;if(qt(e,m,1+(Ie<$e)),m+=2,Ie<$e){Ue=Br(_,L,0),ke=_,et=Br(U,re,0),St=U;var Rn=Br(Ce,rn,0);qt(e,m,Q-257),qt(e,m+5,Le-1),qt(e,m+10,je-4),m+=14;for(var Y=0;Y<je;++Y)qt(e,m+3*Y,Ce[Ws[Y]]);m+=3*je;for(var ut=[pe,Te],Et=0;Et<2;++Et)for(var tt=ut[Et],Y=0;Y<tt.length;++Y){var ue=tt[Y]&31;qt(e,m,Rn[ue]),m+=Ce[ue],ue>15&&(qt(e,m,tt[Y]>>5&127),m+=tt[Y]>>12)}}else Ue=Zc,ke=Dn,et=Wc,St=xi;for(var Y=0;Y<s;++Y){var fe=r[Y];if(fe>255){var ue=fe>>18&31;Dr(e,m,Ue[ue+257]),m+=ke[ue+257],ue>7&&(qt(e,m,fe>>23&31),m+=ga[ue]);var nt=fe&31;Dr(e,m,et[nt]),m+=St[nt],nt>3&&(Dr(e,m,fe>>5&8191),m+=ya[nt])}else Dr(e,m,Ue[fe]),m+=ke[fe]}return Dr(e,m,Ue[256]),m+ke[256]},Jc=new ha([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),so=new Be(0),Kc=function(t,e,n,r,a,i){var o=i.z||t.length,s=new Be(r+o+5*(1+Math.ceil(o/7e3))+a),p=s.subarray(r,s.length-a),u=i.l,m=(i.r||0)&7;if(e){m&&(p[0]=i.r>>3);for(var k=Jc[e-1],_=k>>13,L=k&8191,j=(1<<n)-1,U=i.p||new ot(32768),re=i.h||new ot(j+1),ce=Math.ceil(n/3),pe=2*ce,Q=function(Pn){return(t[Pn]^t[Pn+1]<<ce^t[Pn+2]<<pe)&j},ie=new ha(25e3),Te=new ot(288),Le=new ot(32),ye=0,Y=0,K=i.i||0,Ce=0,rn=i.w||0,je=0;K+2<o;++K){var ct=Q(K),$e=K&32767,Ie=re[ct];if(U[$e]=Ie,re[ct]=$e,rn<=K){var Ue=o-K;if((ye>7e3||Ce>24576)&&(Ue>423||!u)){m=Ks(t,p,0,ie,Te,Le,Y,Ce,je,K-je,m),Ce=ye=Y=0,je=K;for(var ke=0;ke<286;++ke)Te[ke]=0;for(var ke=0;ke<30;++ke)Le[ke]=0}var et=2,St=0,Rn=L,ut=$e-Ie&32767;if(Ue>2&&ct==Q(K-ut))for(var Et=Math.min(_,Ue)-1,tt=Math.min(32767,K),ue=Math.min(258,Ue);ut<=tt&&--Rn&&$e!=Ie;){if(t[K+et]==t[K+et-ut]){for(var fe=0;fe<ue&&t[K+fe]==t[K+fe-ut];++fe);if(fe>et){if(et=fe,St=ut,fe>Et)break;for(var nt=Math.min(ut,fe-2),an=0,ke=0;ke<nt;++ke){var Bn=K-ut+ke&32767,Ci=U[Bn],zr=Bn-Ci&32767;zr>an&&(an=zr,Ie=Bn)}}}$e=Ie,Ie=U[$e],ut+=$e-Ie&32767}if(St){ie[Ce++]=268435456|da[et]<<18|Ys[St];var lr=da[et]&31,Hr=Ys[St]&31;Y+=ga[lr]+ya[Hr],++Te[257+lr],++Le[Hr],rn=K+et,++ye}else ie[Ce++]=t[K],++Te[t[K]]}}for(K=Math.max(K,rn);K<o;++K)ie[Ce++]=t[K],++Te[t[K]];m=Ks(t,p,u,ie,Te,Le,Y,Ce,je,K-je,m),u||(i.r=m&7|p[m/8|0]<<3,m-=7,i.h=re,i.p=U,i.i=K,i.w=rn)}else{for(var K=i.w||0;K<o+u;K+=65535){var cr=K+65535;cr>=o&&(p[m/8|0]=u,cr=o),m=ao(p,m+1,t.subarray(K,cr))}i.i=o}return io(s,0,r+ro(m)+a)},Xc=(function(){for(var t=new Int32Array(256),e=0;e<256;++e){for(var n=e,r=9;--r;)n=(n&1&&-306674912)^n>>>1;t[e]=n}return t})(),Qc=function(){var t=-1;return{p:function(e){for(var n=t,r=0;r<e.length;++r)n=Xc[n&255^e[r]]^n>>>8;t=n},d:function(){return~t}}};var eu=function(t,e,n,r,a){if(!a&&(a={l:1},e.dictionary)){var i=e.dictionary.subarray(-32768),o=new Be(i.length+t.length);o.set(i),o.set(t,i.length),t=o,a.w=i.length}return Kc(t,e.level==null?6:e.level,e.mem==null?a.l?Math.ceil(Math.max(8,Math.min(13,Math.log(t.length)))*1.5):20:12+e.mem,n,r,a)},oo=function(t,e){var n={};for(var r in t)n[r]=t[r];for(var r in e)n[r]=e[r];return n};var Re=function(t,e,n){for(;n;++e)t[e]=n,n>>>=8};function tu(t,e){return eu(t,e||{},0,0)}var lo=function(t,e,n,r){for(var a in t){var i=t[a],o=e+a,s=r;Array.isArray(i)&&(s=oo(r,i[1]),i=i[0]),i instanceof Be?n[o]=[i,s]:(n[o+="/"]=[new Be(0),s],lo(i,o,n,r))}},Xs=typeof TextEncoder<"u"&&new TextEncoder,nu=typeof TextDecoder<"u"&&new TextDecoder,ru=0;try{nu.decode(so,{stream:!0}),ru=1}catch{}function bi(t,e){if(e){for(var n=new Be(t.length),r=0;r<t.length;++r)n[r]=t.charCodeAt(r);return n}if(Xs)return Xs.encode(t);for(var a=t.length,i=new Be(t.length+(t.length>>1)),o=0,s=function(m){i[o++]=m},r=0;r<a;++r){if(o+5>i.length){var p=new Be(o+8+(a-r<<1));p.set(i),i=p}var u=t.charCodeAt(r);u<128||e?s(u):u<2048?(s(192|u>>6),s(128|u&63)):u>55295&&u<57344?(u=65536+(u&1047552)|t.charCodeAt(++r)&1023,s(240|u>>18),s(128|u>>12&63),s(128|u>>6&63),s(128|u&63)):(s(224|u>>12),s(128|u>>6&63),s(128|u&63))}return io(i,0,o)}var fa=function(t){var e=0;if(t)for(var n in t){var r=t[n].length;r>65535&&wi(9),e+=r+4}return e},Qs=function(t,e,n,r,a,i,o,s){var p=r.length,u=n.extra,m=s&&s.length,k=fa(u);Re(t,e,o!=null?33639248:67324752),e+=4,o!=null&&(t[e++]=20,t[e++]=n.os),t[e]=20,e+=2,t[e++]=n.flag<<1|(i<0&&8),t[e++]=a&&8,t[e++]=n.compression&255,t[e++]=n.compression>>8;var _=new Date(n.mtime==null?Date.now():n.mtime),L=_.getFullYear()-1980;if((L<0||L>119)&&wi(10),Re(t,e,L<<25|_.getMonth()+1<<21|_.getDate()<<16|_.getHours()<<11|_.getMinutes()<<5|_.getSeconds()>>1),e+=4,i!=-1&&(Re(t,e,n.crc),Re(t,e+4,i<0?-i-2:i),Re(t,e+8,n.size)),Re(t,e+12,p),Re(t,e+14,k),e+=16,o!=null&&(Re(t,e,m),Re(t,e+6,n.attrs),Re(t,e+10,o),e+=14),t.set(r,e),e+=p,k)for(var j in u){var U=u[j],re=U.length;Re(t,e,+j),Re(t,e+2,re),t.set(U,e+4),e+=4+re}return m&&(t.set(s,e),e+=m),e},iu=function(t,e,n,r,a){Re(t,e,101010256),Re(t,e+8,n),Re(t,e+10,n),Re(t,e+12,r),Re(t,e+16,a)};function co(t,e){e||(e={});var n={},r=[];lo(t,"",n,e);var a=0,i=0;for(var o in n){var s=n[o],p=s[0],u=s[1],m=u.level==0?0:8,k=bi(o),_=k.length,L=u.comment,j=L&&bi(L),U=j&&j.length,re=fa(u.extra);_>65535&&wi(11);var ce=m?tu(p,u):p,pe=ce.length,Q=Qc();Q.p(p),r.push(oo(u,{size:p.length,crc:Q.d(),c:ce,f:k,m:j,u:_!=o.length||j&&L.length!=U,o:a,compression:m})),a+=30+_+re+pe,i+=76+2*(_+re)+(U||0)+pe}for(var ie=new Be(i+22),Te=a,Le=i-a,ye=0;ye<r.length;++ye){var k=r[ye];Qs(ie,k.o,k,k.f,k.u,k.c.length);var Y=30+k.f.length+fa(k.extra);ie.set(k.c,k.o+Y),Qs(ie,a,k,k.f,k.u,k.c.length,k.o,k.m),a+=16+Y+(k.m?k.m.length:0)}return iu(ie,a,r.length,Le,Te),ie}function kt(){return Mt()}function go(t){Vt(t)}var Fe={get isSignedIn(){return Mt().isSignedIn},get accessToken(){return Mt().accessToken},get userName(){return Mt().userName},get email(){return Mt().email},set isSignedIn(t){let e=Mt();Vt({...e,isSignedIn:t})},set accessToken(t){let e=Mt();Vt({...e,accessToken:t})},set userName(t){let e=Mt();Vt({...e,userName:t})},set email(t){let e=Mt();Vt({...e,email:t})}};function Rt(){return He().auth.autoBackupEnabled}function yo(t){Bs(t)}function ht(){return He().auth.autoBackupIntervalMinutes}function vo(t){Ps(t)}function Dt(){return He().auth.lastAutoBackupAt}function xo(t){zs(t)}function Ei(){return He().auth.isAutoBackupRunning}function uo(t){Os(t)}function mo(){return He().auth.autoBackupRetryAttempts}function va(t){Ns(t)}function tn(){return He().auth.autoBackupBackoffMs}function Ti(t){$s(t)}var xa=null,_e=null,ne=null,ki=null;function bo(t){xa=t}function wo(t){_e=t}function To(t){ne=t}function ba(t){ki=t}var po=!1;function ko(){if(!po)try{let t=document.createElement("style");t.textContent=`
@keyframes tk-spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
@keyframes tk-blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.2; } }
.tk-auth-spinner { display:inline-block; width:12px; height:12px; border:2px solid rgba(255,165,0,0.3); border-top-color:#ffa500; border-radius:50%; margin-right:6px; vertical-align:-2px; animation: tk-spin 0.9s linear infinite; }
.tk-auth-blink { animation: tk-blink 0.4s ease-in-out 3; }
`,document.head.appendChild(t),po=!0}catch{}}var So=null,Pr=null,Or=null;function wa(t){So=t}function _i(t){Pr=t}function Ai(t){Or=t}var fo="1023528652072-45cu3dr7o5j79vsdn8643bhle9ee8kds.apps.googleusercontent.com",au="https://www.googleapis.com/auth/drive.file https://www.googleapis.com/auth/userinfo.profile",su="https://www.youtube.com/",ou=30*1e3,lu=1800*1e3,ho=5,Si=null,lt=null;async function Ta(){try{let t=await Or("googleAuthState"),e=t&&typeof t=="object"?{...t,accessToken:t.accessToken?"[REDACTED]":null}:t;c("Loading Google auth state from IndexedDB:",e);let n=Qi.safeParse(t);if(n.success){let r=kt();go({...r,...n.data});let a=kt();a.isSignedIn&&a.accessToken&&c(`Reusing stored Google auth token for ${a.userName||a.email||"user"}`),$r();let i=kt();i.isSignedIn&&i.accessToken&&await or(!0)}else if(t!==void 0){let r=t&&typeof t=="object"?{...t,accessToken:t.accessToken?"[REDACTED]":null}:t;c("Google auth state failed validation:",{stored:r,errors:n.error.format()},"warn")}}catch(t){c("Failed to load Google auth state:",t,"error")}}async function Li(){try{let t=kt(),e=Qi.safeParse(t);if(!e.success){let n={...t,accessToken:t.accessToken?"[REDACTED]":null};c("Invalid auth state, cannot save",{state:n,errors:e.error.format()},"error");return}await Pr("googleAuthState",t),t.isSignedIn&&t.accessToken?c(`Saved Google auth state to IndexedDB for ${t.userName||t.email||"user"}`):c("Cleared Google auth state in IndexedDB (signed out)")}catch(t){c("Failed to save Google auth state:",t,"error")}}function $r(){xa&&(xa.style.display="none")}function Qe(t,e){if(!ne)return;if(ne.style.fontWeight="bold",t==="authenticating"){for(ko(),ne.style.color="#ffa500";ne.firstChild;)ne.removeChild(ne.firstChild);let r=document.createElement("span");r.className="tk-auth-spinner";let a=document.createTextNode(` ${e||"Authorizing with Google\u2026"}`);ne.appendChild(r),ne.appendChild(a);return}if(t==="error"){ne.textContent=`\u274C ${e||"Authorization failed"}`,ne.style.color="#ff4d4f",ve();return}let n=kt();n.isSignedIn?(ne.textContent="\u2705 Signed in",ne.style.color="#52c41a",ne.removeAttribute("title"),n.userName?(ne.onmouseenter=()=>{ne.textContent=`\u2705 Signed in as ${n.userName}`},ne.onmouseleave=()=>{ne.textContent="\u2705 Signed in"}):(ne.onmouseenter=null,ne.onmouseleave=null)):(ne.textContent="\u274C Not signed in",ne.style.color="#ff4d4f",ne.removeAttribute("title"),ne.onmouseenter=null,ne.onmouseleave=null),ve()}function cu(){ne&&(ko(),ne.classList.remove("tk-auth-blink"),ne.offsetWidth,ne.classList.add("tk-auth-blink"),setTimeout(()=>{ne.classList.remove("tk-auth-blink")},1200))}function uu(t){return new Promise((e,n)=>{if(!t){c&&c("OAuth monitor: popup is null",null,"error"),n(new Error("Failed to open popup"));return}c&&c("OAuth monitor: starting to monitor popup for token");let r=Date.now(),a=300*1e3,i="timekeeper_oauth",o=null,s=null,p=null,u=()=>{if(o){try{o.close()}catch{}o=null}s&&(clearInterval(s),s=null),p&&(clearInterval(p),p=null)};try{o=new BroadcastChannel(i),c&&c("OAuth monitor: BroadcastChannel created successfully"),o.onmessage=_=>{let L=_.data?.token?{..._.data,token:"[REDACTED]"}:_.data;c&&c("OAuth monitor: received BroadcastChannel message",L);let j=z.object({type:z.string(),token:z.string().optional(),error:z.string().optional()}).safeParse(_.data);if(!j.success){c&&c("OAuth monitor: invalid message format",j.error,"warn");return}if(j.data.type==="timekeeper_oauth_token"&&j.data.token){c&&c("OAuth monitor: token received via BroadcastChannel"),u();try{t.close()}catch{}e(j.data.token)}else if(j.data.type==="timekeeper_oauth_error"){c&&c("OAuth monitor: error received via BroadcastChannel",j.data.error,"error"),u();try{t.close()}catch{}n(new Error(j.data.error||"OAuth failed"))}}}catch(_){c&&c("OAuth monitor: BroadcastChannel not supported, using IndexedDB fallback",_)}c&&c("OAuth monitor: setting up IndexedDB polling");let m=Date.now();s=setInterval(async()=>{try{let _=indexedDB.open("ytls-timestamps-db",3);_.onsuccess=()=>{let L=_.result,re=L.transaction("settings","readonly").objectStore("settings").get("oauth_message");re.onsuccess=()=>{let ce=re.result;if(ce&&ce.value){let pe=ce.value,Q=z.object({type:z.string(),token:z.string().optional(),error:z.string().optional(),timestamp:z.number().optional()}).safeParse(pe);if(!Q.success){c&&c("OAuth monitor: invalid IndexedDB message format",Q.error,"warn");return}if(Q.data.timestamp&&Q.data.timestamp>m){let ie=Q.data.token?{...Q.data,token:"[REDACTED]"}:Q.data;if(c&&c("OAuth monitor: received IndexedDB message",ie),Q.data.type==="timekeeper_oauth_token"&&Q.data.token){c&&c("OAuth monitor: token received via IndexedDB"),u();try{t.close()}catch{}L.transaction("settings","readwrite").objectStore("settings").delete("oauth_message"),e(Q.data.token)}else if(Q.data.type==="timekeeper_oauth_error"){c&&c("OAuth monitor: error received via IndexedDB",Q.data.error,"error"),u();try{t.close()}catch{}L.transaction("settings","readwrite").objectStore("settings").delete("oauth_message"),n(new Error(Q.data.error||"OAuth failed"))}m=Q.data.timestamp||Date.now()}}L.close()}}}catch(_){c&&c("OAuth monitor: IndexedDB polling error",_,"error")}},500),p=setInterval(()=>{if(Date.now()-r>a){c&&c("OAuth monitor: popup timed out after 5 minutes",null,"error"),u();try{t.close()}catch{}n(new Error("OAuth popup timed out"));return}},1e3)})}async function Eo(){if(!fo){Qe("error","Google Client ID not configured");return}try{c&&c("OAuth signin: starting OAuth flow"),Qe("authenticating","Opening authentication window...");let t=new URL("https://accounts.google.com/o/oauth2/v2/auth");t.searchParams.set("client_id",fo),t.searchParams.set("redirect_uri",su),t.searchParams.set("response_type","token"),t.searchParams.set("scope",au),t.searchParams.set("include_granted_scopes","true"),t.searchParams.set("state","timekeeper_auth"),c&&c("OAuth signin: opening popup");let e=window.open(t.toString(),"TimekeeperGoogleAuth","width=500,height=600,menubar=no,toolbar=no,location=no");if(!e){c&&c("OAuth signin: popup blocked by browser",null,"error"),Qe("error","Popup blocked. Please enable popups for YouTube.");return}c&&c("OAuth signin: popup opened successfully"),Qe("authenticating","Waiting for authentication...");try{let n=await uu(e),r=await fetch("https://www.googleapis.com/oauth2/v2/userinfo",{headers:{Authorization:`Bearer ${n}`}});if(r.ok){let a=await r.json(),i=z.object({name:z.string().optional(),email:z.string().optional()}).safeParse(a);if(!i.success)throw c&&c("Failed to validate user info response",i.error,"error"),new Error("Invalid user info response");let o=i.data;Vt({isSignedIn:!0,accessToken:n,userName:o.name||null,email:o.email||null}),await Li(),$r(),Qe(),ve(),nn(),await or(),c?c(`Successfully authenticated as ${o.name}`):console.log(`[Timekeeper] Successfully authenticated as ${o.name}`)}else throw new Error("Failed to fetch user info")}catch(n){let r=n instanceof Error?n.message:"Authentication failed";c?c("OAuth failed:",n,"error"):console.error("[Timekeeper] OAuth failed:",n),Qe("error",r);return}}catch(t){let e=t instanceof Error?t.message:"Sign in failed";c?c("Failed to sign in to Google:",t,"error"):console.error("[Timekeeper] Failed to sign in to Google:",t),Qe("error",`Failed to sign in: ${e}`)}}async function _o(){if(!window.opener||window.opener===window)return!1;c&&c("OAuth popup: detected popup window, checking for OAuth response");let t=window.location.hash;if(!t||t.length<=1)return c&&c("OAuth popup: no hash params found"),!1;let e=t.startsWith("#")?t.substring(1):t,n=new URLSearchParams(e),r=n.get("state");if(c&&c("OAuth popup: hash params found, state="+r),r!=="timekeeper_auth")return c&&c("OAuth popup: not our OAuth flow (wrong state)"),!1;let a=n.get("error"),i=n.get("access_token"),o="timekeeper_oauth";if(a){try{let s=new BroadcastChannel(o);s.postMessage({type:"timekeeper_oauth_error",error:n.get("error_description")||a}),s.close(),c&&c("OAuth popup: error broadcast via BroadcastChannel")}catch{let p={type:"timekeeper_oauth_error",error:n.get("error_description")||a,timestamp:Date.now()};c&&c("OAuth popup: writing error to IndexedDB",p);let u=indexedDB.open("ytls-timestamps-db",3);u.onsuccess=()=>{let m=u.result,_=m.transaction("settings","readwrite").objectStore("settings").put({key:"oauth_message",value:p});_.onsuccess=()=>{c&&c("OAuth popup: error written to IndexedDB successfully")},_.onerror=()=>{c&&c("OAuth popup: failed to write error to IndexedDB",_.error,"error")},m.close()},u.onerror=()=>{c&&c("OAuth popup: failed to open IndexedDB",u.error,"error")}}return setTimeout(()=>{try{window.close()}catch{}},500),!0}if(i){c&&c("OAuth popup: access token found, broadcasting to opener");try{let s=new BroadcastChannel(o);s.postMessage({type:"timekeeper_oauth_token",token:i}),s.close(),c&&c("OAuth popup: token broadcast via BroadcastChannel")}catch(s){c&&c("OAuth popup: BroadcastChannel failed, using IndexedDB",s);let p={type:"timekeeper_oauth_token",token:i,timestamp:Date.now()},u={...p,token:"[REDACTED]"};c&&c("OAuth popup: writing token to IndexedDB",u);let m=indexedDB.open("ytls-timestamps-db",3);m.onsuccess=()=>{let k=m.result,L=k.transaction("settings","readwrite").objectStore("settings").put({key:"oauth_message",value:p});L.onsuccess=()=>{c&&c("OAuth popup: token written to IndexedDB successfully")},L.onerror=()=>{c&&c("OAuth popup: failed to write token to IndexedDB",L.error,"error")},k.close()},m.onerror=()=>{c&&c("OAuth popup: failed to open IndexedDB",m.error,"error")}}return setTimeout(()=>{try{window.close()}catch{}},500),!0}return!1}async function Ao(){go({isSignedIn:!1,accessToken:null,userName:null,email:null}),await Li(),$r(),Qe(),ve(),nn()}async function Lo(){let t=kt();if(!t.isSignedIn||!t.accessToken)return!1;try{let e=await fetch("https://www.googleapis.com/oauth2/v2/userinfo",{headers:{Authorization:`Bearer ${t.accessToken}`}});return e.status===401?(await Co({silent:!0}),!1):e.ok}catch(e){return c("Failed to verify auth state:",e,"error"),!1}}async function du(t){let e={Authorization:`Bearer ${t}`},r=`https://www.googleapis.com/drive/v3/files?q=${encodeURIComponent("name = 'Timekeeper' and mimeType = 'application/vnd.google-apps.folder' and trashed = false")}&fields=files(id,name)&pageSize=10`,a=await fetch(r,{headers:e});if(a.status===401)throw new Error("unauthorized");if(!a.ok)throw new Error("drive search failed");let i=await a.json();if(Array.isArray(i.files)&&i.files.length>0)return i.files[0].id;let o=await fetch("https://www.googleapis.com/drive/v3/files",{method:"POST",headers:{...e,"Content-Type":"application/json"},body:JSON.stringify({name:"Timekeeper",mimeType:"application/vnd.google-apps.folder"})});if(o.status===401)throw new Error("unauthorized");if(!o.ok)throw new Error("drive folder create failed");return(await o.json()).id}async function mu(t,e,n){let r=`name='${t}' and '${e}' in parents and trashed=false`,a=encodeURIComponent(r),i=await fetch(`https://www.googleapis.com/drive/v3/files?q=${a}&fields=files(id,name)`,{method:"GET",headers:{Authorization:`Bearer ${n}`}});if(i.status===401)throw new Error("unauthorized");if(!i.ok)return null;let o=await i.json();return o.files&&o.files.length>0?o.files[0].id:null}function pu(t,e){let n=bi(t),r=e.replace(/\\/g,"/").replace(/^\/+/,"");return r.endsWith(".json")||(r+=".json"),co({[r]:[n,{level:6,mtime:new Date,os:0}]})}async function fu(t,e,n,r){let a=t.replace(/\.json$/,".zip"),i=await mu(a,n,r),o=new TextEncoder().encode(e).length,s=pu(e,t),p=s.length;c(`Compressing data: ${o} bytes -> ${p} bytes (${Math.round(100-p/o*100)}% reduction)`);let u="-------314159265358979",m=`\r
--${u}\r
`,k=`\r
--${u}--`,_=i?{name:a,mimeType:"application/zip"}:{name:a,mimeType:"application/zip",parents:[n]},L=8192,j="";for(let ie=0;ie<s.length;ie+=L){let Te=s.subarray(ie,Math.min(ie+L,s.length));j+=String.fromCharCode.apply(null,Array.from(Te))}let U=btoa(j),re=m+`Content-Type: application/json; charset=UTF-8\r
\r
`+JSON.stringify(_)+m+`Content-Type: application/zip\r
Content-Transfer-Encoding: base64\r
\r
`+U+k,ce,pe;i?(ce=`https://www.googleapis.com/upload/drive/v3/files/${i}?uploadType=multipart&fields=id,name`,pe="PATCH"):(ce="https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart&fields=id,name",pe="POST");let Q=await fetch(ce,{method:pe,headers:{Authorization:`Bearer ${r}`,"Content-Type":`multipart/related; boundary=${u}`},body:re});if(Q.status===401)throw new Error("unauthorized");if(!Q.ok)throw new Error("drive upload failed")}async function Co(t){c("Auth expired, clearing token",null,"warn"),Vt({isSignedIn:!1,accessToken:null,userName:null,email:null}),await Li(),Qe("error","Authorization expired. Please sign in again."),ve(),nn()}async function hu(t){if(!Fe.isSignedIn||!Fe.accessToken){t?.silent||Qe("error","Please sign in to Google Drive first");return}try{let{json:e,filename:n,totalVideos:r,totalTimestamps:a}=await So();if(a===0){t?.silent||c("Skipping export: no timestamps to back up");return}let i=await du(Fe.accessToken);await fu(n,e,i,Fe.accessToken),c(`Exported to Google Drive (${n}) with ${r} videos / ${a} timestamps.`)}catch(e){throw e.message==="unauthorized"?(await Co({silent:t?.silent}),e):(c("Drive export failed:",e,"error"),t?.silent||Qe("error","Failed to export to Google Drive."),e)}}async function Io(){try{let t=ea.partial().safeParse({autoBackupEnabled:await Or("autoBackupEnabled"),autoBackupIntervalMinutes:await Or("autoBackupIntervalMinutes"),lastAutoBackupAt:await Or("lastAutoBackupAt")});t.success?(typeof t.data.autoBackupEnabled=="boolean"&&yo(t.data.autoBackupEnabled),typeof t.data.autoBackupIntervalMinutes=="number"&&vo(t.data.autoBackupIntervalMinutes),typeof t.data.lastAutoBackupAt=="number"&&xo(t.data.lastAutoBackupAt)):c("Failed to validate auto backup settings:",t.error.format(),"warn")}catch(t){c("Failed to load auto backup settings:",t,"error")}}async function ka(){try{let t={autoBackupEnabled:Rt(),autoBackupIntervalMinutes:ht(),lastAutoBackupAt:Dt()??0},e=ea.safeParse(t);if(!e.success){c("Invalid auto backup settings, cannot save",{settings:t,errors:e.error.format()},"error");return}await Pr("autoBackupEnabled",Rt()),await Pr("autoBackupIntervalMinutes",ht()),await Pr("lastAutoBackupAt",Dt()??0)}catch(t){c("Failed to save auto backup settings:",t,"error")}}function gu(){Si&&(clearInterval(Si),Si=null),lt&&(clearTimeout(lt),lt=null)}function sr(t){try{let e=new Date(t),n=new Date,r=e.toDateString()===n.toDateString(),a=e.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"});return r?a:`${e.toLocaleDateString()} ${a}`}catch{return""}}function Mo(){return Rt()?Ei()?"#4285f4":tn()&&tn()>0?"#ffa500":kt().isSignedIn&&Dt()?"#52c41a":kt().isSignedIn?"#ffa500":"#ff4d4f":"#ff4d4f"}function ve(){if(!_e)return;let t="",e="";if(!Rt())t="\u{1F501} Backup: Off",_e.onmouseenter=null,_e.onmouseleave=null;else if(Ei())t="\u{1F501} Backing up\u2026",_e.onmouseenter=null,_e.onmouseleave=null;else if(tn()&&tn()>0)t=`\u26A0\uFE0F Retry in ${Math.ceil(tn()/6e4)}m`,_e.onmouseenter=null,_e.onmouseleave=null;else if(Dt()){t=`\u{1F5C4}\uFE0F Last backup: ${sr(Dt())}`;let n=Dt()+Math.max(1,ht())*60*1e3;e=`\u{1F5C4}\uFE0F Next backup: ${sr(n)}`,_e.onmouseenter=()=>{_e.textContent=e},_e.onmouseleave=()=>{_e.textContent=t}}else{t="\u{1F5C4}\uFE0F Last backup: never";let n=Date.now()+Math.max(1,ht())*60*1e3;e=`\u{1F5C4}\uFE0F Next backup: ${sr(n)}`,_e.onmouseenter=()=>{_e.textContent=e},_e.onmouseleave=()=>{_e.textContent=t}}_e.textContent=t,_e.style.display=t?"inline":"none";try{let n=Mo();_e.style.color=n}catch{}nn()}function nn(){if(!ki)return;let t=Mo();ki.style.backgroundColor=t,at(ki,()=>{let e="";if(!Rt())e="Auto backup is disabled";else if(Ei())e="Backup in progress";else if(tn()&&tn()>0)e=`Retrying backup in ${Math.ceil(tn()/6e4)}m`;else if(kt().isSignedIn&&Dt()){let n=Dt()+Math.max(1,ht())*60*1e3,r=sr(n);e=`Last backup: ${sr(Dt())}
Next backup: ${r}`}else if(kt().isSignedIn){let n=Date.now()+Math.max(1,ht())*60*1e3;e=`No backup yet
Next backup: ${sr(n)}`}else e="Not signed in to Google Drive";return e})}async function Nr(t=!0){if(!Fe.isSignedIn||!Fe.accessToken){t||cu();return}if(lt){c("Auto backup: backoff in progress, skipping scheduled run");return}if(!Ei()){uo(!0),ve();try{await hu({silent:t}),xo(Date.now()),va(0),Ti(null),lt&&(clearTimeout(lt),lt=null),await ka()}catch(e){if(c("Auto backup failed:",e,"error"),e.message==="unauthorized"){c("Auth error detected, clearing token and stopping retries",null,"warn");let r=kt();Vt({...r,accessToken:null,isSignedIn:!1}),await Li(),Qe("error","Authorization expired. Please sign in again."),ve(),nn(),va(0),Ti(null),lt&&(clearTimeout(lt),lt=null)}else if(mo()<ho){let r=mo()+1;va(r);let i=Math.min(ou*Math.pow(2,r-1),lu);Ti(i),lt&&clearTimeout(lt),lt=setTimeout(()=>{Nr(!0)},i),c(`Scheduling backup retry ${r}/${ho} in ${Math.round(i/1e3)}s`),ve()}else Ti(null)}finally{uo(!1),ve()}}}async function or(t=!1){if(gu(),!!Rt()&&!(!Fe.isSignedIn||!Fe.accessToken)){if(Si=setInterval(()=>{Nr(!0)},Math.max(1,ht())*60*1e3),!t){let e=Date.now(),n=Math.max(1,ht())*60*1e3,r=Dt();(!r||e-r>=n)&&Nr(!0)}ve()}}async function Do(){let t=Rt();yo(!t),await ka(),await or(),ve()}async function Ro(){let t=ht(),e=prompt("Set Auto Backup interval (minutes):",String(t));if(e===null)return;let n=Math.floor(Number(e));if(!Number.isFinite(n)||n<5||n>1440){alert("Please enter a number between 5 and 1440 minutes.");return}vo(n),await ka(),await or(),ve()}var Sa=window.location.hash;if(Sa&&Sa.length>1){let t=new URLSearchParams(Sa.substring(1));if(t.get("state")==="timekeeper_auth"){let n=t.get("access_token");if(n){console.log("[Timekeeper] Auth token detected in URL, broadcasting token"),console.log("[Timekeeper] Token length:",n.length,"characters");try{let r=new BroadcastChannel("timekeeper_oauth"),a={type:"timekeeper_oauth_token",token:n};console.log("[Timekeeper] Sending auth message via BroadcastChannel:",{type:a.type,tokenLength:n.length}),r.postMessage(a),r.close(),console.log("[Timekeeper] Token broadcast via BroadcastChannel completed")}catch(r){console.log("[Timekeeper] BroadcastChannel failed, using IndexedDB fallback:",r);let a={type:"timekeeper_oauth_token",token:n,timestamp:Date.now()},i=indexedDB.open("ytls-timestamps-db",3);i.onsuccess=()=>{let o=i.result,s=o.transaction("settings","readwrite");s.objectStore("settings").put({key:"oauth_message",value:a}),s.oncomplete=()=>{console.log("[Timekeeper] Token broadcast via IndexedDB completed, timestamp:",a.timestamp),o.close()}}}if(history.replaceState){let r=window.location.pathname+window.location.search;history.replaceState(null,"",r)}throw console.log("[Timekeeper] Closing window after broadcasting auth token"),window.close(),new Error("OAuth window closed")}}}Zs();(async function(){"use strict";if(window.top!==window.self)return;function t(l){return GM.getValue(`timekeeper_${l}`,void 0)}function e(l,d){return GM.setValue(`timekeeper_${l}`,JSON.stringify(d))}if(Ai(t),_i(e),await _o()){c("OAuth popup detected, broadcasting token and closing");return}await Ta();let r=["/watch","/live"];function a(l=window.location.href){try{let d=new URL(l);return d.origin!=="https://www.youtube.com"?!1:r.some(h=>d.pathname===h||d.pathname.startsWith(`${h}/`))}catch(d){return c("Timekeeper failed to parse URL for support check:",d,"error"),!1}}let i=null,o=null,s=null,p=null,u=null,m=null,k=null,_=null,L=null,j=250,U=null,re=!1;function ce(){return He().ui.minPaneHeight}function pe(l){Hs(l)}function Q(){return He().ui.lastHandledUrl}function ie(l){js(l)}function Te(){return He().ui.urlChangeHandlersSetup}function Le(l){Us(l)}function ye(){return He().ui.panePosition}function Y(l){Fs(l)}function K(){return He().timestamps.items}function Ce(l){Vs(l)}function rn(){return He().timestamps.currentIndex}function je(l){Gs(l)}function ct(){return i?i.getBoundingClientRect():null}function $e(l,d,h){l&&Y({x:Math.round(typeof d=="number"?d:l.left),y:Math.round(typeof h=="number"?h:l.top),width:Math.round(l.width),height:Math.round(l.height)})}function Ie(l=!0){if(!i)return;Hn();let d=ct();if(d&&(d.width||d.height)&&($e(d),l)){let h=ye();ri("windowPosition",h),ur({type:"window_position_updated",position:h,timestamp:Date.now()})}}function Ue(){if(!i||!o||!p||!s)return;let l=40,d=me();if(d.length>0)l=d[0].offsetHeight;else{let h=document.createElement("li");h.style.visibility="hidden",h.style.position="absolute",h.textContent="00:00 Example",s.appendChild(h),l=h.offsetHeight,s.removeChild(h)}j=o.offsetHeight+p.offsetHeight+l,pe(j),i.style.minHeight=ce()+"px"}function ke(){requestAnimationFrame(()=>{typeof window.recalculateTimestampsArea=="function"&&window.recalculateTimestampsArea(),Ue(),Ie(!0)})}function et(l=450){Se&&(clearTimeout(Se),Se=null),Se=setTimeout(()=>{Et(),ke(),Se=null},l)}function St(){Se&&(clearTimeout(Se),Se=null)}function Rn(){s&&(s.style.visibility="hidden",c("Hiding timestamps during show animation")),ke(),et()}function ut(){Et(),St(),gt&&(clearTimeout(gt),gt=null),gt=setTimeout(()=>{i&&(i.style.display="none",Ga(),gt=null)},400)}function Et(){if(!s){rt&&(rt(),rt=null,Bt=null,ln=null);return}if(!ln){s.style.visibility==="hidden"&&(s.style.visibility="",c("Restoring timestamp visibility (no deferred fragment)")),rt&&(rt(),rt=null,Bt=null);return}c("Appending deferred timestamps after animation"),s.appendChild(ln),ln=null,s.style.visibility==="hidden"&&(s.style.visibility="",c("Restoring timestamp visibility after append")),rt&&(rt(),rt=null,Bt=null),xt(),ze(),typeof window.recalculateTimestampsArea=="function"&&requestAnimationFrame(()=>window.recalculateTimestampsArea()),bt(!0)}let tt=null,ue=!1,fe="ytls-timestamp-pending-delete",nt="ytls-timestamp-highlight",an="https://raw.githubusercontent.com/KamoTimestamps/timekeeper/refs/heads/main/assets/Kamo_64px_Indexed.png",Bn="https://raw.githubusercontent.com/KamoTimestamps/timekeeper/refs/heads/main/assets/Kamo_Eyebrow_64px_Indexed.png";function Ci(){let l=d=>{let h=new Image;h.src=d};l(an),l(Bn)}Ci();async function zr(){for(;!document.querySelector("video")||!document.querySelector("#movie_player");)await new Promise(l=>setTimeout(l,100));for(;!document.querySelector(".ytp-progress-bar");)await new Promise(l=>setTimeout(l,100));await new Promise(l=>setTimeout(l,200))}let lr=["getCurrentTime","seekTo","getPlayerState","seekToLiveHead","getVideoData","getDuration"],Hr=5e3,cr=new Set(["getCurrentTime","seekTo","getPlayerState","seekToLiveHead","getVideoData","getDuration"]);function Pn(l){return cr.has(l)}function Zt(){return document.querySelector("video")}let sn=null;function de(){if(sn&&document.contains(sn))return sn;let l=document.getElementById("movie_player");return l&&document.contains(l)?l:null}function Ii(l){return lr.every(d=>typeof l?.[d]=="function"?!0:Pn(d)?!!Zt():!1)}function Bo(l){return lr.filter(d=>typeof l?.[d]=="function"?!1:Pn(d)?!Zt():!0)}async function Po(l=Hr){let d=Date.now();for(;Date.now()-d<l;){let y=de();if(Ii(y))return y;await new Promise(S=>setTimeout(S,100))}let h=de();return Ii(h),h}let Ea="timestampOffsetSeconds",Oo=-5,_a="shiftClickTimeSkipSeconds",No=10,Mi=300,Di=300,_t=null;function Aa(){try{return new URL(window.location.href).origin==="https://www.youtube.com"}catch{return!1}}function La(){if(Aa()&&!_t)try{_t=new BroadcastChannel("ytls_timestamp_channel"),_t.onmessage=Ca}catch(l){c("Failed to create BroadcastChannel:",l,"warn"),_t=null}}function ur(l){if(!Aa()){c("Skipping BroadcastChannel message: not on https://www.youtube.com","warn");return}if(La(),!_t){c("No BroadcastChannel available to post message","warn");return}try{_t.postMessage(l)}catch(d){c("BroadcastChannel error, reopening:",d,"warn");try{_t=new BroadcastChannel("ytls_timestamp_channel"),_t.onmessage=Ca,_t.postMessage(l)}catch(h){c("Failed to reopen BroadcastChannel:",h,"error")}}}function Ca(l){if(c("Received message from another tab:",l.data),!(!a()||!s||!i)&&l.data){if(l.data.type==="timestamps_updated"&&l.data.videoId===Ae)c("Debouncing timestamp load due to external update for video:",l.data.videoId),clearTimeout(mr),mr=setTimeout(()=>{c("Reloading timestamps due to external update for video:",l.data.videoId),Ua()},500);else if(l.data.type==="window_position_updated"&&i){let d=l.data.position;if(d&&typeof d.x=="number"&&typeof d.y=="number"){i.style.left=`${d.x}px`,i.style.top=`${d.y}px`,i.style.right="auto",i.style.bottom="auto",typeof d.width=="number"&&d.width>0&&(i.style.width=`${d.width}px`),typeof d.height=="number"&&d.height>0&&(i.style.height=`${d.height}px`);let h=i.getBoundingClientRect();Y({x:Math.round(d.x),y:Math.round(d.y),width:Math.round(h.width),height:Math.round(h.height)});let y=document.documentElement.clientWidth,S=document.documentElement.clientHeight;(h.left<0||h.top<0||h.right>y||h.bottom>S)&&Hn()}}}}La();let On=await GM.getValue(Ea);(typeof On!="number"||Number.isNaN(On))&&(On=Oo,await GM.setValue(Ea,On));let dr=await GM.getValue(_a);(typeof dr!="number"||Number.isNaN(dr))&&(dr=No,await GM.setValue(_a,dr));let mr=null,on=new Map,Nn=!1,H=null,Fr=null,Ae=null,gt=null,Se=null,ln=null,Bt=null,rt=null,Wt=null,jr=!1,vu=null,Ri=!1,Ur=null,Vr=null,Gr=null,qr=null,Zr=null,Wr=null,Yr=null,pr=null,fr=null,hr=null,yt=null,vt=null,Ia=0,gr=!1,cn=null,yr=null;function me(){return vi(s)}function Bi(){return Ds(s)}function Pt(){return yr!==null||(yr=Rs(s)),yr}function Jr(){yr=null}function $o(l){let d=l.querySelector(".time-diff");return d?(d.textContent?.trim()||"").startsWith("-"):!1}let zo="\u251C\u2500 ",Ma="\u2514\u2500 ",Da=/^[]\s/;function Kr(l){return Da.test(l)}function Ra(l){return l.replace(Da,"")}function Ba(l){let d=me();if(l>=d.length-1)return Ma;let S=d[l+1].querySelector("input");return S&&Kr(S.value)?zo:Ma}function Ho(l,d){return`${Ba(d)}${l}`}function xt(){if(!s)return;let l=me(),d=!0,h=0;for(;d&&h<l.length;)d=!1,h++,l.forEach((y,S)=>{let E=y.querySelector("input");if(!E||!Kr(E.value))return;let x=Ra(E.value),b=Ho(x,S);E.value!==b&&(E.value=b,d=!0)})}function $n(){oa(s),ln&&(ln=null),rt&&(rt(),rt=null,Bt=null)}function vr(){Ms(s,ue)}function Pa(l){la(s,l)}function Pi(){Is(s)}function Oi(l){if(!(!i||!s)){if(ue=l,l)i.style.display="",i.classList.remove("ytls-fade-out"),i.classList.add("ytls-fade-in"),Pa("Loading timestamps...");else if(Pi(),i.style.display="",i.classList.remove("ytls-fade-out"),i.classList.add("ytls-fade-in"),u){let d=de();if(d){let h=d.getCurrentTime(),y=Number.isFinite(h)?Math.max(0,Math.floor(h)):Math.max(0,Pt()),S=Math.floor(y/3600),E=Math.floor(y/60)%60,x=y%60,{isLive:b}=d.getVideoData()||{isLive:!1},I=s?me().map(P=>{let F=P.querySelector("a[data-time]");return F?parseFloat(F.getAttribute("data-time")??"0"):0}):[],R="";if(I.length>0)if(b){let P=Math.max(1,y/60),F=I.filter(ee=>ee<=y);if(F.length>0){let ee=(F.length/P).toFixed(2);parseFloat(ee)>0&&(R=` (${ee}/min)`)}}else{let P=d.getDuration(),F=Number.isFinite(P)&&P>0?P:0,ee=Math.max(1,F/60),ae=(I.length/ee).toFixed(1);parseFloat(ae)>0&&(R=` (${ae}/min)`)}u.textContent=`\u23F3${S?S+":"+String(E).padStart(2,"0"):E}:${String(x).padStart(2,"0")}${R}`}}!ue&&s&&!s.querySelector(".ytls-error-message")&&vr(),Ot()}}function Fo(l){return l?tr.safeParse(l).success:!1}function Xr(l,d){l.textContent=Ut(d),l.dataset.time=String(d),l.href=Lr(d,window.location.href)}let Qr=null,ei=null,Yt=!1;function Oa(l){if(!l||typeof l.getVideoData!="function"||!l.getVideoData()?.isLive)return!1;if(typeof l.getProgressState=="function"){let h=l.getProgressState(),y=Number(h?.seekableEnd??h?.liveHead??h?.head??h?.duration),S=Number(h?.current??l.getCurrentTime?.());if(Number.isFinite(y)&&Number.isFinite(S))return y-S>2}return!1}function jo(l,d){if(!Number.isFinite(l))return;let h=Na(l);Ni(h,d)}function bt(l=!1,d){if(Nn&&!l)return;let h;if(typeof d=="number"&&Number.isFinite(d))h=Math.max(0,Math.floor(d));else{let y=de(),S=y?y.getCurrentTime():NaN;h=Number.isFinite(S)?Math.max(0,Math.floor(S)):Math.max(0,Pt())}Number.isFinite(h)&&jo(h,l)}function Na(l){if(!Number.isFinite(l))return null;let d=me();if(d.length===0)return null;let h=null,y=-1/0;for(let S of d){let x=S.querySelector("a[data-time]")?.dataset.time;if(!x)continue;let b=Number.parseInt(x,10);Number.isFinite(b)&&b<=l&&b>y&&(y=b,h=S)}return h}function Ni(l,d=!1){if(me().forEach(y=>{y.classList.contains(fe)||y.classList.remove(nt)}),!!l&&!l.classList.contains(fe)&&(l.classList.add(nt),d))try{if(s instanceof HTMLElement){let y=l.getBoundingClientRect(),S=s.getBoundingClientRect();!(y.bottom<S.top||y.top>S.bottom)||l.scrollIntoView({behavior:"smooth",block:"center"})}else l.scrollIntoView({behavior:"smooth",block:"center"})}catch{try{l.scrollIntoView({behavior:"smooth",block:"center"})}catch{}}}function Uo(l){if(!s||s.querySelector(".ytls-error-message")||!Number.isFinite(l)||l===0)return!1;let d=me();if(d.length===0)return!1;let h=!1;return d.forEach(y=>{let S=y.querySelector("a[data-time]"),E=S?.dataset.time;if(!S||!E)return;let x=Number.parseInt(E,10);if(!Number.isFinite(x))return;let b=Math.max(0,x+l);b!==x&&(Xr(S,b),h=!0)}),h?(br(),xt(),ze(),ni(Ae),cn=null,!0):!1}function $a(l,d={}){if(!Number.isFinite(l)||l===0)return!1;if(!Uo(l)){if(d.alertOnNoChange){let x=d.failureMessage??"Offset did not change any timestamps.";alert(x)}return!1}let y=d.logLabel??"bulk offset";c(`Timestamps changed: Offset all timestamps by ${l>0?"+":""}${l} seconds (${y})`);let S=de(),E=S?Math.floor(S.getCurrentTime()):0;if(Number.isFinite(E)){let x=Na(E);Ni(x,!1)}return!0}function za(l){if(!s||ue)return;let d=l.target instanceof HTMLElement?l.target:null;if(d)if(d.dataset.time){l.preventDefault();let h=Number(d.dataset.time);if(Number.isFinite(h)){Yt=!0;let S=de();S&&S.seekTo(h),setTimeout(()=>{Yt=!1},500)}let y=d.closest("li");y&&(me().forEach(S=>{S.classList.contains(fe)||S.classList.remove(nt)}),y.classList.contains(fe)||(y.classList.add(nt),y.scrollIntoView({behavior:"smooth",block:"center"})))}else if(d.dataset.increment){l.preventDefault();let y=d.parentElement?.querySelector("a[data-time]");if(!y||!y.dataset.time)return;let S=parseInt(y.dataset.time,10),E=parseInt(d.dataset.increment,10);if("shiftKey"in l&&l.shiftKey&&(E*=dr),"altKey"in l?l.altKey:!1){$a(E,{logLabel:"Alt adjust"});return}let I=Math.max(0,S+E);c(`Timestamps changed: Timestamp time incremented from ${S} to ${I}`),Xr(y,I),Jr();let R=d.closest("li");if(ei=I,Qr&&clearTimeout(Qr),Yt=!0,Qr=setTimeout(()=>{if(ei!==null){let P=de();P&&P.seekTo(ei)}Qr=null,ei=null,setTimeout(()=>{Yt=!1},500)},500),br(),xt(),ze(),R){let P=R.querySelector("input"),F=R.dataset.guid;P&&F&&(zn(Ae,F,I,P.value),cn=F)}}else d.dataset.action==="clear"&&(l.preventDefault(),c("Timestamps changed: All timestamps cleared from UI"),s.textContent="",Jr(),ze(),ti(),ni(Ae,{allowEmpty:!0}),cn=null,vr())}function xr(l,d="",h=!1,y=null,S=!0){if(!s)return null;let E=Math.max(0,l),x=y??crypto.randomUUID(),b=document.createElement("li"),I=document.createElement("div"),R=document.createElement("span"),P=document.createElement("span"),F=document.createElement("span"),ee=document.createElement("a"),ae=document.createElement("span"),Z=document.createElement("input"),se=document.createElement("button");b.dataset.guid=x,I.className="time-row";let At=document.createElement("div");At.style.cssText="position:absolute;left:0;top:0;width:20px;height:100%;display:flex;align-items:center;justify-content:center;cursor:pointer;",at(At,"Click to toggle indent");let Nt=document.createElement("span");Nt.style.cssText="color:#999;font-size:12px;pointer-events:none;display:none;";let un=()=>{Nt.textContent=Kr(Z.value)?"\u25C0":"\u25B6"},ii=xe=>{xe.stopPropagation();let X=Kr(Z.value),he=Ra(Z.value),be="";if(!X){let Ge=me().indexOf(b);be=Ba(Ge)}Z.value=be?`${be}${he}`:he,un(),xt();let ge=Number.parseInt(ee.dataset.time??"0",10);zn(Ae,x,ge,Z.value)};At.onclick=ii,At.append(Nt),b.style.cssText="position:relative;padding-left:20px;",b.addEventListener("mouseenter",()=>{un(),Nt.style.display="inline"}),b.addEventListener("mouseleave",()=>{Nt.style.display="none"}),b.addEventListener("mouseleave",()=>{b.dataset.guid===cn&&$o(b)&&Ha()}),Z.value=d||"",Z.style.cssText="width:100%;margin-top:5px;display:block;",Z.type="text",Z.setAttribute("inputmode","text"),Z.autocapitalize="off",Z.autocomplete="off",Z.spellcheck=!1,Z.addEventListener("focusin",()=>{gr=!1}),Z.addEventListener("focusout",xe=>{let X=xe.relatedTarget,he=Date.now()-Ia<250,be=!!X&&!!i&&i.contains(X);!he&&!be&&(gr=!0,setTimeout(()=>{(document.activeElement===document.body||document.activeElement==null)&&(Z.focus({preventScroll:!0}),gr=!1)},0))}),Z.addEventListener("input",xe=>{let X=xe;if(X&&(X.isComposing||X.inputType==="insertCompositionText"))return;let he=on.get(x);he&&clearTimeout(he);let be=setTimeout(()=>{let ge=Number.parseInt(ee.dataset.time??"0",10);zn(Ae,x,ge,Z.value),on.delete(x)},500);on.set(x,be)}),Z.addEventListener("compositionend",()=>{let xe=Number.parseInt(ee.dataset.time??"0",10);setTimeout(()=>{zn(Ae,x,xe,Z.value)},50)}),R.textContent="\u2796",R.dataset.increment="-1",R.style.cursor="pointer",R.style.margin="0px",R.addEventListener("mouseenter",()=>{R.style.textShadow="0 0 8px rgba(255, 255, 255, 0.8), 0 0 12px rgba(100, 200, 255, 0.6)"}),R.addEventListener("mouseleave",()=>{R.style.textShadow="none"}),F.textContent="\u2795",F.dataset.increment="1",F.style.cursor="pointer",F.style.margin="0px",F.addEventListener("mouseenter",()=>{F.style.textShadow="0 0 8px rgba(255, 255, 255, 0.8), 0 0 12px rgba(100, 200, 255, 0.6)"}),F.addEventListener("mouseleave",()=>{F.style.textShadow="none"}),P.textContent="\u23FA\uFE0F",P.style.cursor="pointer",P.style.margin="0px",at(P,"Set to current playback time"),P.addEventListener("mouseenter",()=>{P.style.textShadow="0 0 8px rgba(255, 255, 255, 0.8), 0 0 12px rgba(100, 200, 255, 0.6)"}),P.addEventListener("mouseleave",()=>{P.style.textShadow="none"}),P.onclick=()=>{let xe=de(),X=xe?Math.floor(xe.getCurrentTime()):0;Number.isFinite(X)&&(c(`Timestamps changedset to current playback time ${X}`),Xr(ee,X),br(),xt(),zn(Ae,x,X,Z.value),cn=x)},Xr(ee,E),Jr(),se.textContent="\u{1F5D1}\uFE0F",se.style.cssText="background:transparent;border:none;color:white;cursor:pointer;margin-left:5px;",se.addEventListener("mouseenter",()=>{se.style.textShadow="0 0 8px rgba(255, 255, 255, 0.8), 0 0 12px rgba(255, 100, 100, 0.6)"}),se.addEventListener("mouseleave",()=>{se.style.textShadow="none"}),se.onclick=()=>{let xe=null,X=null,he=null,be=()=>{try{b.removeEventListener("click",X,!0)}catch{}try{document.removeEventListener("click",X,!0)}catch{}if(s)try{s.removeEventListener("mouseleave",he)}catch{}xe&&(clearTimeout(xe),xe=null)};if(b.dataset.deleteConfirmed==="true"){c("Timestamps changed: Timestamp deleted");let ge=b.dataset.guid??"",Ee=on.get(ge);Ee&&(clearTimeout(Ee),on.delete(ge)),be(),b.remove(),Jr(),br(),xt(),ze(),ti(),Vo(Ae,ge),cn=null,vr()}else{b.dataset.deleteConfirmed="true",b.classList.add(fe),b.classList.remove(nt);let ge=()=>{b.dataset.deleteConfirmed="false",b.classList.remove(fe);let Ee=de(),Ge=Ee?Ee.getCurrentTime():0,dn=Number.parseInt(b.querySelector("a[data-time]")?.dataset.time??"0",10);Number.isFinite(Ge)&&Number.isFinite(dn)&&Ge>=dn&&b.classList.add(nt),be()};X=Ee=>{Ee.target!==se&&ge()},he=()=>{b.dataset.deleteConfirmed==="true"&&ge()},b.addEventListener("click",X,!0),document.addEventListener("click",X,!0),s&&s.addEventListener("mouseleave",he),xe=setTimeout(()=>{b.dataset.deleteConfirmed==="true"&&ge(),be()},5e3)}},ae.className="time-diff",ae.style.color="#888",ae.style.marginLeft="5px",I.append(R,P,F,ee,ae,se),b.append(At,I,Z);let Ve=Number.parseInt(ee.dataset.time??"0",10);if(S){Pi();let xe=!1,X=me();for(let he=0;he<X.length;he++){let be=X[he],Ee=be.querySelector("a[data-time]")?.dataset.time;if(!Ee)continue;let Ge=Number.parseInt(Ee,10);if(Number.isFinite(Ge)&&Ve<Ge){s.insertBefore(b,be),xe=!0;let dn=X[he-1];if(dn){let Tr=dn.querySelector("a[data-time]")?.dataset.time;if(Tr){let kr=Number.parseInt(Tr,10);Number.isFinite(kr)&&(ae.textContent=Ut(Ve-kr))}}else ae.textContent="";let wr=be.querySelector(".time-diff");wr&&(wr.textContent=Ut(Ge-Ve));break}}if(!xe&&(s.appendChild(b),X.length>0)){let ge=X[X.length-1].querySelector("a[data-time]")?.dataset.time;if(ge){let Ee=Number.parseInt(ge,10);Number.isFinite(Ee)&&(ae.textContent=Ut(Ve-Ee))}}b.scrollIntoView({behavior:"smooth",block:"center"}),ti(),xt(),ze(),h||(zn(Ae,x,E,d),cn=x,Ni(b,!1))}else Z.__ytls_li=b;return Z}function br(){if(!s||s.querySelector(".ytls-error-message"))return;let l=me();l.forEach((d,h)=>{let y=d.querySelector(".time-diff");if(!y)return;let E=d.querySelector("a[data-time]")?.dataset.time;if(!E){y.textContent="";return}let x=Number.parseInt(E,10);if(!Number.isFinite(x)){y.textContent="";return}if(h===0){y.textContent="";return}let R=l[h-1].querySelector("a[data-time]")?.dataset.time;if(!R){y.textContent="";return}let P=Number.parseInt(R,10);if(!Number.isFinite(P)){y.textContent="";return}let F=x-P,ee=F<0?"-":"";y.textContent=` ${ee}${Ut(Math.abs(F))}`})}function Ha(){if(!s||s.querySelector(".ytls-error-message")||ue)return;let l=null;if(document.activeElement instanceof HTMLInputElement&&s.contains(document.activeElement)){let x=document.activeElement,I=x.closest("li")?.dataset.guid;if(I){let R=x.selectionStart??x.value.length,P=x.selectionEnd??R,F=x.scrollLeft;l={guid:I,start:R,end:P,scroll:F}}}let d=me();if(d.length===0)return;let h=d.map(x=>x.dataset.guid),y=d.map(x=>{let b=x.querySelector("a[data-time]"),I=b?.dataset.time;if(!b||!I)return null;let R=Number.parseInt(I,10);if(!Number.isFinite(R))return null;let P=x.dataset.guid??"";return{time:R,guid:P,element:x}}).filter(x=>x!==null).sort((x,b)=>{let I=x.time-b.time;return I!==0?I:x.guid.localeCompare(b.guid)}),S=y.map(x=>x.guid),E=h.length!==S.length||h.some((x,b)=>x!==S[b]);for(;s.firstChild;)s.removeChild(s.firstChild);if(y.forEach(x=>{s.appendChild(x.element)}),br(),xt(),ze(),l){let b=me().find(I=>I.dataset.guid===l.guid)?.querySelector("input");if(b)try{b.focus({preventScroll:!0})}catch{}}E&&(c("Timestamps changed: Timestamps sorted"),ni(Ae))}function ti(){if(!s||!i||!o||!p)return;let l=me().length;typeof window.recalculateTimestampsArea=="function"&&window.recalculateTimestampsArea();let d=i.getBoundingClientRect(),h=o.getBoundingClientRect(),y=p.getBoundingClientRect(),S=Math.max(0,d.height-(h.height+y.height));l===0?(vr(),s.style.overflowY="hidden"):s.style.overflowY=s.scrollHeight>S?"auto":"hidden"}function ze(){if(!s)return;let l=Zt(),d=document.querySelector(".ytp-progress-bar"),h=de(),y=h?h.getVideoData():null,S=!!y&&!!y.isLive;if(!l||!d||!isFinite(l.duration)||S)return;ja(),me().map(x=>{let b=x.querySelector("a[data-time]"),I=b?.dataset.time;if(!b||!I)return null;let R=Number.parseInt(I,10);if(!Number.isFinite(R))return null;let F=x.querySelector("input")?.value??"",ee=x.dataset.guid??crypto.randomUUID();return x.dataset.guid||(x.dataset.guid=ee),{start:R,comment:F,guid:ee}}).filter(Fo).forEach(x=>{if(!Number.isFinite(x.start))return;let b=document.createElement("div");b.className="ytls-marker",b.style.position="absolute",b.style.height="100%",b.style.width="2px",b.style.backgroundColor="#ff0000",b.style.cursor="pointer",b.style.left=x.start/l.duration*100+"%",b.dataset.time=String(x.start),b.addEventListener("click",()=>{let I=de();I&&I.seekTo(x.start)}),d.appendChild(b)})}function ni(l,d={}){if(!s||s.querySelector(".ytls-error-message")||!l)return;if(ue){c("Save blocked: timestamps are currently loading");return}xt();let h=Bi().sort((y,S)=>y.start-S.start);if(h.length===0&&!d.allowEmpty){c("Save skipped: no timestamps to save");return}Ce(h),Va(l,h).then(()=>c(`Successfully saved ${h.length} timestamps for ${l} to IndexedDB`)).catch(y=>c(`Failed to save timestamps for ${l} to IndexedDB:`,y,"error")),ur({type:"timestamps_updated",videoId:l,action:"saved"})}function zn(l,d,h,y){if(!l||ue)return;let S={guid:d,start:h,comment:y};c(`Saving timestamp: guid=${d}, start=${h}, comment="${y}"`),Jo(l,S).catch(E=>c(`Failed to save timestamp ${d}:`,E,"error")),ur({type:"timestamps_updated",videoId:l,action:"saved"})}function Vo(l,d){!l||ue||(c(`Deleting timestamp: guid=${d}`),Ko(l,d).catch(h=>c(`Failed to delete timestamp ${d}:`,h,"error")),ur({type:"timestamps_updated",videoId:l,action:"saved"}))}async function Fa(l){if(!s||s.querySelector(".ytls-error-message")){alert("Cannot export timestamps while displaying an error message.");return}let d=Ae;if(!d)return;c(`Exporting timestamps for video ID: ${d}`);let h=Bi(),y=Math.max(Pt(),0),S=Mn();if(l==="json"){let E=new Blob([JSON.stringify(h,null,2)],{type:"application/json"}),x=URL.createObjectURL(E),b=document.createElement("a");b.href=x,b.download=`timestamps-${d}-${S}.json`,b.click(),URL.revokeObjectURL(x)}else if(l==="text"){let E=h.map(R=>{let P=Ut(R.start,y),F=`${R.comment} <!-- guid:${R.guid} -->`.trimStart();return`${P} ${F}`}).join(`
`),x=new Blob([E],{type:"text/plain"}),b=URL.createObjectURL(x),I=document.createElement("a");I.href=b,I.download=`timestamps-${d}-${S}.txt`,I.click(),URL.revokeObjectURL(b)}}function $i(l){if(!i||!s){c("Timekeeper error:",l,"error");return}$n();let d=document.createElement("li");d.textContent=l,d.classList.add("ytls-error-message"),d.style.color="#ff6b6b",d.style.fontWeight="bold",d.style.padding="8px",d.style.background="rgba(255, 0, 0, 0.1)",s.appendChild(d),ze()}function ja(){document.querySelectorAll(".ytls-marker").forEach(l=>l.remove())}function Hn(){if(!i||!document.body.contains(i))return;let l=i.getBoundingClientRect(),d=document.documentElement.clientWidth,h=document.documentElement.clientHeight,y=l.width,S=l.height;if(l.left<0&&(i.style.left="0",i.style.right="auto"),l.right>d){let E=Math.max(0,d-y);i.style.left=`${E}px`,i.style.right="auto"}if(l.top<0&&(i.style.top="0",i.style.bottom="auto"),l.bottom>h){let E=Math.max(0,h-S);i.style.top=`${E}px`,i.style.bottom="auto"}}function Go(){if(Ur&&(document.removeEventListener("mousemove",Ur),Ur=null),Vr&&(document.removeEventListener("mouseup",Vr),Vr=null),pr&&(document.removeEventListener("keydown",pr),pr=null),Gr&&(window.removeEventListener("resize",Gr),Gr=null),fr&&(document.removeEventListener("pointerdown",fr,!0),fr=null),hr&&(document.removeEventListener("pointerup",hr,!0),hr=null),yt){try{yt.disconnect()}catch{}yt=null}if(vt){try{vt.disconnect()}catch{}vt=null}let l=Zt();l&&(qr&&(l.removeEventListener("timeupdate",qr),qr=null),Zr&&(l.removeEventListener("pause",Zr),Zr=null),Wr&&(l.removeEventListener("play",Wr),Wr=null),Yr&&(l.removeEventListener("seeking",Yr),Yr=null))}function qo(){ja(),on.forEach(d=>clearTimeout(d)),on.clear(),mr&&(clearTimeout(mr),mr=null),tt&&(clearInterval(tt),tt=null),gt&&(clearTimeout(gt),gt=null),Go();try{_t.close()}catch{}if(H&&H.parentNode===document.body&&document.body.removeChild(H),H=null,Fr=null,Nn=!1,Ae=null,yt){try{yt.disconnect()}catch{}yt=null}if(vt){try{vt.disconnect()}catch{}vt=null}i&&i.parentNode&&i.remove();let l=document.getElementById("ytls-header-button");l&&l.parentNode&&l.remove(),Wt=null,jr=!1,Y(null),$n(),i=null,o=null,s=null,p=null,u=null,m=null,k=null,_=null,sn=null}async function Zo(){let l=zi();if(!l)return sn=null,{ok:!1,message:"Timekeeper cannot determine the current video ID. Please refresh the page or open a standard YouTube watch URL."};let d=await Po();if(!Ii(d)){let h=Bo(d),y=h.length?` Missing methods: ${h.join(", ")}.`:"",S=d?"Timekeeper cannot access the YouTube player API.":"Timekeeper cannot find the YouTube player on this page.";return sn=null,{ok:!1,message:`${S}${y} Try refreshing once playback is ready.`}}return sn=d,{ok:!0,player:d,videoId:l}}async function Ua(){if(!i||!s)return;let l=s.scrollTop,d=!0,h=()=>{if(!s||!d)return;let y=Math.max(0,s.scrollHeight-s.clientHeight);s.scrollTop=Math.min(l,y)};try{let y=await Zo();if(!y.ok){$i(y.message),$n(),ze();return}let{videoId:S}=y,E=[];try{let x=await Xo(S);x?(E=x.map(b=>({...b,guid:b.guid||crypto.randomUUID()})),c(`Loaded ${E.length} timestamps from IndexedDB for ${S}`)):c(`No timestamps found in IndexedDB for ${S}`)}catch(x){c(`Failed to load timestamps from IndexedDB for ${S}:`,x,"error"),$i("Failed to load timestamps from IndexedDB. Try refreshing the page."),ze();return}if(E.length>0){E.sort((I,R)=>I.start-R.start),$n(),Pi();let x=document.createDocumentFragment();E.forEach(I=>{let P=xr(I.start,I.comment,!0,I.guid,!1).__ytls_li;P&&x.appendChild(P)}),i&&i.classList.contains("ytls-zoom-in")&&Se!=null?(c("Deferring timestamp DOM append until show animation completes"),ln=x,Bt||(Bt=new Promise(I=>{rt=I})),await Bt):s&&(s.appendChild(x),xt(),ze(),typeof window.recalculateTimestampsArea=="function"&&requestAnimationFrame(()=>window.recalculateTimestampsArea())),Ce(E),bt(!0),d=!1}else $n(),Pa("No timestamps for this video"),ze(),Ce([]),typeof window.recalculateTimestampsArea=="function"&&requestAnimationFrame(()=>window.recalculateTimestampsArea())}catch(y){c("Unexpected error while loading timestamps:",y,"error"),$i("Timekeeper encountered an unexpected error while loading timestamps. Check the console for details.")}finally{Bt&&await Bt,requestAnimationFrame(h),typeof window.recalculateTimestampsArea=="function"&&requestAnimationFrame(()=>window.recalculateTimestampsArea()),s&&!s.querySelector(".ytls-error-message")&&vr()}}function zi(){let d=new URLSearchParams(location.search).get("v");if(d)return d;let h=document.querySelector('meta[itemprop="identifier"]');return h?.content?h.content:null}function Wo(l=null,d=null){if(!u)return;let h=Zt(),y=d||de();if(!h&&!y)return;let S=l!==null?l:y?y.getCurrentTime():0,E=Number.isFinite(S)?Math.max(0,Math.floor(S)):Math.max(0,Pt()),x=Math.floor(E/3600),b=Math.floor(E/60)%60,I=E%60,{isLive:R}=y?y.getVideoData()||{isLive:!1}:{isLive:!1},P=y?Oa(y):!1,F=s?me().map(ae=>{let Z=ae.querySelector("a[data-time]");return Z?parseFloat(Z.getAttribute("data-time")??"0"):0}):[],ee="";if(F.length>0)if(R){let ae=Math.max(1,E/60),Z=F.filter(se=>se<=E);if(Z.length>0){let se=(Z.length/ae).toFixed(2);parseFloat(se)>0&&(ee=` (${se}/min)`)}}else{let ae=y?y.getDuration():0,Z=Number.isFinite(ae)&&ae>0?ae:h&&Number.isFinite(h.duration)&&h.duration>0?h.duration:0,se=Math.max(1,Z/60),At=(F.length/se).toFixed(1);parseFloat(At)>0&&(ee=` (${At}/min)`)}u.textContent=`\u23F3${x?x+":"+String(b).padStart(2,"0"):b}:${String(I).padStart(2,"0")}${ee}`,u.style.color=P?"#ff4d4f":""}function Yo(){let l=Zt();if(!l)return;let d=()=>{if(!s)return;let x=de(),b=x?Math.floor(x.getCurrentTime()):0;if(Number.isFinite(b)){u&&!ue&&!Yt&&Wo(b,x);try{if(m){let I=x&&Number(x.getPlaybackRate())||1,P=(Math.round(I*100)/100).toFixed(2).replace(/\.0+?$|(?<=\.[0-9])0+$/g,"");m.textContent=`${P}x`}}catch{}bt(!1,b)}},h=x=>{try{let b=new URL(window.location.href);x!==null&&Number.isFinite(x)?b.searchParams.set("t",`${Math.floor(x)}s`):b.searchParams.delete("t"),window.history.replaceState({},"",b.toString())}catch{}},y=()=>{let x=de(),b=x?x.getCurrentTime():NaN,I=Number.isFinite(b)?Math.max(0,Math.floor(b)):Math.max(0,Pt());if(Number.isFinite(I)){h(I);try{bt(!0)}catch(R){c("Failed to highlight nearest timestamp on pause:",R,"warn")}}},S=()=>{h(null);try{let x=de(),b=x?x.getCurrentTime():NaN,I=Number.isFinite(b)?Math.max(0,Math.floor(b)):Math.max(0,Pt());Number.isFinite(I)&&bt(!0)}catch(x){c("Failed to highlight nearest timestamp on play:",x,"warn")}},E=()=>{let x=Zt();if(!x)return;let b=de(),I=b?Math.floor(b.getCurrentTime()):0;Number.isFinite(I)&&(x.paused&&h(I),bt(!0,I))};qr=d,Zr=y,Wr=S,Yr=E,l.addEventListener("timeupdate",d),l.addEventListener("pause",y),l.addEventListener("play",S),l.addEventListener("seeking",E)}let{saveToIndexedDB:Va,saveSingleTimestampToIndexedDB:Jo,deleteSingleTimestampFromIndexedDB:Ko,loadFromIndexedDB:Xo,removeFromIndexedDB:Qo,saveGlobalSettings:ri,loadGlobalSettings:Hi,buildExportPayload:el,exportAllTimestamps:tl,buildExportCsvPayload:xu,exportAllTimestampsCsv:nl}=sa;function Ga(){if(!i)return;let l=i.style.display!=="none";ri("uiVisible",l)}function Ot(l){let d=typeof l=="boolean"?l:!!i&&i.style.display!=="none",h=document.getElementById("ytls-header-button");h instanceof HTMLButtonElement&&h.setAttribute("aria-pressed",String(d)),Wt&&!jr&&Wt.src!==an&&(Wt.src=an)}function rl(){i&&Hi("uiVisible").then(l=>{let d=z.boolean().safeParse(l),h=d.success?d.data:void 0;typeof h=="boolean"?(h?(i.style.display="flex",i.classList.remove("ytls-zoom-out"),i.classList.add("ytls-zoom-in")):i.style.display="none",Ot(h)):(!d.success&&l!==void 0&&c("UI visibility state failed validation, defaulting to visible",d.error.format(),"warn"),i.style.display="flex",i.classList.remove("ytls-zoom-out"),i.classList.add("ytls-zoom-in"),Ot(!0))}).catch(l=>{c("Failed to load UI visibility state:",l,"error"),i.style.display="flex",i.classList.remove("ytls-zoom-out"),i.classList.add("ytls-zoom-in"),Ot(!0)})}function Fi(l){if(!i){c("ERROR: togglePaneVisibility called but pane is null");return}document.body.contains(i)||(c("Pane not in DOM during toggle, appending it"),document.querySelectorAll("#ytls-pane").forEach(S=>{S!==i&&S.remove()}),document.body.appendChild(i));let d=document.querySelectorAll("#ytls-pane");d.length>1&&(c(`ERROR: Multiple panes detected in togglePaneVisibility (${d.length}), cleaning up`),d.forEach(S=>{S!==i&&S.remove()})),gt&&(clearTimeout(gt),gt=null);let h=i.style.display==="none";(typeof l=="boolean"?l:h)?(i.style.display="flex",i.classList.remove("ytls-fade-out"),i.classList.remove("ytls-zoom-out"),i.classList.add("ytls-zoom-in"),Ot(!0),Ga(),Rn(),Se&&(clearTimeout(Se),Se=null),Se=setTimeout(()=>{Et(),typeof window.recalculateTimestampsArea=="function"&&window.recalculateTimestampsArea(),Ue(),Ie(!0);try{bt(!0)}catch(S){c("Failed to scroll to nearest timestamp after toggle:",S,"warn")}Se=null},450)):(i.classList.remove("ytls-fade-in"),i.classList.remove("ytls-zoom-in"),i.classList.add("ytls-zoom-out"),Ot(!1),ut())}function qa(l){if(!s){c("UI is not initialized; cannot import timestamps.","warn");return}let d=!1;try{let h=JSON.parse(l),y=null;if(Array.isArray(h))y=h;else if(typeof h=="object"&&h!==null){let S=Ae;if(S){let E=`timekeeper-${S}`;h[E]&&Array.isArray(h[E].timestamps)&&(y=h[E].timestamps,c(`Found timestamps for current video (${S}) in export format`,"info"))}if(!y){let E=Object.keys(h).filter(x=>x.startsWith("ytls-"));if(E.length===1&&Array.isArray(h[E[0]].timestamps)){y=h[E[0]].timestamps;let x=h[E[0]].video_id;c(`Found timestamps for video ${x} in export format`,"info")}}}y&&Array.isArray(y)?y.every(E=>typeof E.start=="number"&&typeof E.comment=="string")?(y.forEach(E=>{if(E.guid){let x=me().find(b=>b.dataset.guid===E.guid);if(x){let b=x.querySelector("input");b&&(b.value=E.comment)}else xr(E.start,E.comment,!1,E.guid)}else xr(E.start,E.comment,!1,crypto.randomUUID())}),d=!0):c("Parsed JSON array, but items are not in the expected timestamp format. Trying as plain text.","warn"):c("Parsed JSON, but couldn't find valid timestamps. Trying as plain text.","warn")}catch{}if(!d){let h=l.split(`
`).map(y=>y.trim()).filter(y=>y);if(h.length>0){let y=!1;h.forEach(S=>{let E=S.match(/^(?:(\d{1,2}):)?(\d{1,2}):(\d{2})\s*(.*)$/);if(E){y=!0;let x=parseInt(E[1])||0,b=parseInt(E[2]),I=parseInt(E[3]),R=x*3600+b*60+I,P=E[4]?E[4].trim():"",F=null,ee=P,ae=P.match(/<!--\s*guid:([^>]+?)\s*-->/);ae&&(F=ae[1].trim(),ee=P.replace(/<!--\s*guid:[^>]+?\s*-->/,"").trim());let Z;if(F&&(Z=me().find(se=>se.dataset.guid===F)),!Z&&!F&&(Z=me().find(se=>{if(se.dataset.guid)return!1;let Nt=se.querySelector("a[data-time]")?.dataset.time;if(!Nt)return!1;let un=Number.parseInt(Nt,10);return Number.isFinite(un)&&un===R})),Z){let se=Z.querySelector("input");se&&(se.value=ee)}else xr(R,ee,!1,F||crypto.randomUUID())}}),y&&(d=!0)}}d?(c("Timestamps changed: Imported timestamps from file/clipboard"),xt(),ni(Ae),ze(),ti()):alert("Failed to parse content. Please ensure it is in the correct JSON or plain text format.")}async function il(){if(Ri){c("Pane initialization already in progress, skipping duplicate call");return}if(!(i&&document.body.contains(i))){Ri=!0;try{let E=function(){if(!m)return;let f=de(),g=f&&Number(f.getPlaybackRate())||1,v=x(g);m.textContent=`${v}x`,m.setAttribute("aria-label",`Playback speed ${v}x`)},x=function(f){return(Math.round(f*100)/100).toFixed(2).replace(/\.0+?$|(?<=\.[0-9])0+$/g,"")},b=function(f=null,g=null){if(!u)return;let v=Zt(),w=g||de();if(!v&&!w)return;let D=f!==null?f:w?w.getCurrentTime():0,$=Number.isFinite(D)?Math.max(0,Math.floor(D)):Math.max(0,Pt()),N=Math.floor($/3600),W=Math.floor($/60)%60,V=$%60,{isLive:oe}=w?w.getVideoData()||{isLive:!1}:{isLive:!1},it=w?Oa(w):!1,le=s?me().map(Me=>{let Ze=Me.querySelector("a[data-time]");return Ze?parseFloat(Ze.getAttribute("data-time")??"0"):0}):[],qe="";if(le.length>0)if(oe){let Me=Math.max(1,$/60),Ze=le.filter(We=>We<=$);if(Ze.length>0){let We=(Ze.length/Me).toFixed(2);parseFloat(We)>0&&(qe=` (${We}/min)`)}}else{let Me=w?w.getDuration():0,Ze=Number.isFinite(Me)&&Me>0?Me:v&&Number.isFinite(v.duration)&&v.duration>0?v.duration:0,We=Math.max(1,Ze/60),Pe=(le.length/We).toFixed(1);parseFloat(Pe)>0&&(qe=` (${Pe}/min)`)}u.textContent=`\u23F3${N?N+":"+String(W).padStart(2,"0"):W}:${String(V).padStart(2,"0")}${qe}`,u.style.color=it?"#ff4d4f":"",S();try{E()}catch{}},I=function(){if(ue||Yt)return;let f=de();if(!f)return;let g=f.getCurrentTime(),v=Number.isFinite(g)?Math.max(0,Math.floor(g)):Math.max(0,Pt());b(v,f),(s?me():[]).length>0&&bt(!1,v)},Ve=function(f,g,v){let w=document.createElement("button");return w.textContent=f,at(w,g),w.classList.add("ytls-settings-modal-button"),w.onclick=v,w},xe=function(f="general"){if(H&&H.parentNode===document.body){let Oe=document.getElementById("ytls-save-modal"),Jt=document.getElementById("ytls-load-modal"),$t=document.getElementById("ytls-delete-all-modal");Oe&&document.body.contains(Oe)&&document.body.removeChild(Oe),Jt&&document.body.contains(Jt)&&document.body.removeChild(Jt),$t&&document.body.contains($t)&&document.body.removeChild($t),H.classList.remove("ytls-fade-in"),H.classList.add("ytls-fade-out"),setTimeout(()=>{document.body.contains(H)&&document.body.removeChild(H),H=null,document.removeEventListener("click",he,!0),document.removeEventListener("keydown",X)},300);return}H=document.createElement("div"),H.id="ytls-settings-modal",H.classList.remove("ytls-fade-out"),H.classList.add("ytls-fade-in");let g=document.createElement("div");g.className="ytls-modal-header";let v=document.createElement("div");v.id="ytls-settings-nav";let w=document.createElement("button");w.className="ytls-modal-close-button",w.textContent="\u2715",w.onclick=()=>{if(H&&H.parentNode===document.body){let Oe=document.getElementById("ytls-save-modal"),Jt=document.getElementById("ytls-load-modal"),$t=document.getElementById("ytls-delete-all-modal");Oe&&document.body.contains(Oe)&&document.body.removeChild(Oe),Jt&&document.body.contains(Jt)&&document.body.removeChild(Jt),$t&&document.body.contains($t)&&document.body.removeChild($t),H.classList.remove("ytls-fade-in"),H.classList.add("ytls-fade-out"),setTimeout(()=>{document.body.contains(H)&&document.body.removeChild(H),H=null,document.removeEventListener("click",he,!0),document.removeEventListener("keydown",X)},300)}};let D=document.createElement("div");D.id="ytls-settings-content";let $=document.createElement("h3");$.className="ytls-section-heading",$.textContent="General",$.style.display="none";let N=document.createElement("div"),W=document.createElement("div");W.className="ytls-button-grid";function V(Oe){N.style.display=Oe==="general"?"block":"none",W.style.display=Oe==="drive"?"block":"none",oe.classList.toggle("active",Oe==="general"),le.classList.toggle("active",Oe==="drive"),$.textContent=Oe==="general"?"General":"Google Drive"}let oe=document.createElement("button");oe.textContent="\u{1F6E0}\uFE0F";let it=document.createElement("span");it.className="ytls-tab-text",it.textContent=" General",oe.appendChild(it),at(oe,"General settings"),oe.classList.add("ytls-settings-modal-button"),oe.onclick=()=>V("general");let le=document.createElement("button");le.textContent="\u2601\uFE0F";let qe=document.createElement("span");qe.className="ytls-tab-text",qe.textContent=" Backup",le.appendChild(qe),at(le,"Google Drive sign-in and backup"),le.classList.add("ytls-settings-modal-button"),le.onclick=async()=>{Fe.isSignedIn&&await Lo(),V("drive")},v.appendChild(oe),v.appendChild(le),g.appendChild(v),g.appendChild(w),H.appendChild(g),N.className="ytls-button-grid",N.appendChild(Ve("\u{1F4BE} Save","Save As...",be.onclick)),N.appendChild(Ve("\u{1F4C2} Load","Load",ge.onclick)),N.appendChild(Ve("\u{1F4E4} Export All","Export All Data",Ee.onclick)),N.appendChild(Ve("\u{1F4E5} Import All","Import All Data",Ge.onclick)),N.appendChild(Ve("\u{1F4C4} Export All (CSV)","Export All Timestamps to CSV",async()=>{try{await nl()}catch{alert("Failed to export CSV: Could not read from database.")}}));let Me=Ve(Fe.isSignedIn?"\u{1F513} Sign Out":"\u{1F510} Sign In",Fe.isSignedIn?"Sign out from Google Drive":"Sign in to Google Drive",async()=>{Fe.isSignedIn?await Ao():await Eo(),Me.textContent=Fe.isSignedIn?"\u{1F513} Sign Out":"\u{1F510} Sign In",at(Me,Fe.isSignedIn?"Sign out from Google Drive":"Sign in to Google Drive"),typeof ve=="function"&&ve()});W.appendChild(Me);let Ze=Ve(Rt()?"\u{1F501} Auto Backup: On":"\u{1F501} Auto Backup: Off","Toggle Auto Backup",async()=>{await Do(),Ze.textContent=Rt()?"\u{1F501} Auto Backup: On":"\u{1F501} Auto Backup: Off",typeof ve=="function"&&ve()});W.appendChild(Ze);let We=Ve(`\u23F1\uFE0F Backup Interval: ${ht()}min`,"Set periodic backup interval (minutes)",async()=>{await Ro(),We.textContent=`\u23F1\uFE0F Backup Interval: ${ht()}min`,typeof ve=="function"&&ve()});W.appendChild(We),W.appendChild(Ve("\u{1F5C4}\uFE0F Backup Now","Run a backup immediately",async()=>{await Nr(!1),typeof ve=="function"&&ve()}));let Pe=document.createElement("div");Pe.style.marginTop="15px",Pe.style.paddingTop="10px",Pe.style.borderTop="1px solid #555",Pe.style.fontSize="12px",Pe.style.color="#aaa";let fn=document.createElement("div");fn.style.marginBottom="8px",fn.style.fontWeight="bold",Pe.appendChild(fn),To(fn);let Zi=document.createElement("div");Zi.style.marginBottom="8px",bo(Zi),Pe.appendChild(Zi);let Ka=document.createElement("div");wo(Ka),Pe.appendChild(Ka),W.appendChild(Pe),Qe(),$r(),ve(),D.appendChild($),D.appendChild(N),D.appendChild(W),V(f),H.appendChild(D),document.body.appendChild(H),requestAnimationFrame(()=>{let Oe=H.getBoundingClientRect(),$t=(window.innerHeight-Oe.height)/2;H.style.top=`${Math.max(20,$t)}px`,H.style.transform="translateX(-50%)"}),setTimeout(()=>{document.addEventListener("click",he,!0),document.addEventListener("keydown",X)},0)},X=function(f){if(f.key==="Escape"&&H&&H.parentNode===document.body){let g=document.getElementById("ytls-save-modal"),v=document.getElementById("ytls-load-modal"),w=document.getElementById("ytls-delete-all-modal");if(g||v||w)return;f.preventDefault(),g&&document.body.contains(g)&&document.body.removeChild(g),v&&document.body.contains(v)&&document.body.removeChild(v),w&&document.body.contains(w)&&document.body.removeChild(w),H.classList.remove("ytls-fade-in"),H.classList.add("ytls-fade-out"),setTimeout(()=>{document.body.contains(H)&&document.body.removeChild(H),H=null,document.removeEventListener("click",he,!0),document.removeEventListener("keydown",X)},300)}},he=function(f){if(Fr&&Fr.contains(f.target))return;let g=document.getElementById("ytls-save-modal"),v=document.getElementById("ytls-load-modal"),w=document.getElementById("ytls-delete-all-modal");g&&g.contains(f.target)||v&&v.contains(f.target)||w&&w.contains(f.target)||H&&H.contains(f.target)||(g&&document.body.contains(g)&&document.body.removeChild(g),v&&document.body.contains(v)&&document.body.removeChild(v),w&&document.body.contains(w)&&document.body.removeChild(w),H&&H.parentNode===document.body&&(H.classList.remove("ytls-fade-in"),H.classList.add("ytls-fade-out"),setTimeout(()=>{document.body.contains(H)&&document.body.removeChild(H),H=null,document.removeEventListener("click",he,!0),document.removeEventListener("keydown",X)},300)))},dn=function(){i&&(c("Loading window position from IndexedDB"),Hi("windowPosition").then(f=>{let g=fs.safeParse(f);if(g.success){let w=g.data;i.style.left=`${w.x}px`,i.style.top=`${w.y}px`,i.style.right="auto",i.style.bottom="auto",typeof w.width=="number"&&w.width>0?i.style.width=`${w.width}px`:(i.style.width=`${Mi}px`,c(`No stored window width found, using default width ${Mi}px`)),typeof w.height=="number"&&w.height>0?i.style.height=`${w.height}px`:(i.style.height=`${Di}px`,c(`No stored window height found, using default height ${Di}px`));let D=ct();$e(D,w.x,w.y),c("Restored window position from IndexedDB:",ye())}else g.success?c("No window position found in IndexedDB, applying default size and leaving default position"):c("Window position in IndexedDB failed validation:",g.error.format(),"warn"),i.style.width=`${Mi}px`,i.style.height=`${Di}px`,Y(null);Hn();let v=ct();v&&(v.width||v.height)&&$e(v),typeof window.recalculateTimestampsArea=="function"&&window.recalculateTimestampsArea()}).catch(f=>{c("failed to load pane position from IndexedDB:",f,"warn"),Hn();let g=ct();g&&(g.width||g.height)&&Y({x:Math.max(0,Math.round(g.left)),y:0,width:Math.round(g.width),height:Math.round(g.height)}),typeof window.recalculateTimestampsArea=="function"&&window.recalculateTimestampsArea()}))},wr=function(){if(!i)return;let f=ct();if(!f)return;let g={x:Math.max(0,Math.round(f.left)),y:Math.max(0,Math.round(f.top)),width:Math.round(f.width),height:Math.round(f.height)},v=ye();if(v&&v.x===g.x&&v.y===g.y&&v.width===g.width&&v.height===g.height){c("Skipping window position save; position and size unchanged");return}Y({...g}),c(`Saving window position and size to IndexedDB: x=${g.x}, y=${g.y}, width=${g.width}, height=${g.height}`),ri("windowPosition",g),ur({type:"window_position_updated",position:g,timestamp:Date.now()})},li=function(f,g){f.addEventListener("dblclick",v=>{v.preventDefault(),v.stopPropagation(),i&&(i.style.width="300px",i.style.height="300px",wr(),Sr())}),f.addEventListener("mousedown",v=>{v.preventDefault(),v.stopPropagation(),Fn=!0,pn=g,Ya=v.clientX,Ja=v.clientY;let w=i.getBoundingClientRect();jn=w.width,Un=w.height,si=w.left,oi=w.top,g==="top-left"||g==="bottom-right"?document.body.style.cursor="nwse-resize":document.body.style.cursor="nesw-resize"})},Sr=function(){if(i&&o&&p&&s){let f=i.getBoundingClientRect(),g=o.getBoundingClientRect(),v=p.getBoundingClientRect(),w=f.height-(g.height+v.height);s.style.maxHeight=w>0?w+"px":"0px",s.style.overflowY=w>0?"auto":"hidden"}};document.querySelectorAll("#ytls-pane").forEach(f=>f.remove()),i=document.createElement("div"),o=document.createElement("div"),s=document.createElement("ul"),p=document.createElement("div"),u=document.createElement("span"),k=document.createElement("style"),_=document.createElement("span"),L=document.createElement("span"),L.classList.add("ytls-backup-indicator"),L.style.cursor="pointer",L.style.backgroundColor="#666",L.onclick=f=>{f.stopPropagation(),xe("drive")},s.addEventListener("mouseenter",()=>{Nn=!0,Mr(!0),gr=!1}),s.addEventListener("mouseleave",()=>{Nn=!1,Mr(!1);try{Ki()}catch{}if(gr)return;bt(!1);let f=null;if(document.activeElement instanceof HTMLInputElement&&s.contains(document.activeElement)&&(f=document.activeElement.closest("li")?.dataset.guid??null),Ha(),f){let v=me().find(w=>w.dataset.guid===f)?.querySelector("input");if(v)try{v.focus({preventScroll:!0})}catch{}}}),i.id="ytls-pane",o.id="ytls-pane-header",o.addEventListener("dblclick",f=>{let g=f.target instanceof HTMLElement?f.target:null;g&&(g.closest("a")||g.closest("button")||g.closest("#ytls-current-time")||g.closest("#ytls-playback-speed")||g.closest(".ytls-version-display")||g.closest(".ytls-backup-indicator"))||(f.preventDefault(),Fi(!1))});let l=f=>{try{f.stopPropagation()}catch{}};["click","dblclick","mousedown","pointerdown","touchstart","wheel"].forEach(f=>{i.addEventListener(f,l)}),i.addEventListener("keydown",f=>{try{f.stopPropagation()}catch{}}),i.addEventListener("keyup",f=>{try{f.stopPropagation()}catch{}}),i.addEventListener("focus",f=>{try{f.stopPropagation()}catch{}},!0),i.addEventListener("blur",f=>{try{f.stopPropagation()}catch{}},!0);let d=GM_info.script.version;_.textContent=`v${d}`,_.classList.add("ytls-version-display");let h=document.createElement("span");h.style.display="inline-flex",h.style.alignItems="center",h.style.gap="6px",h.appendChild(_),h.appendChild(L),u.id="ytls-current-time",u.textContent="\u23F3",u.style.cursor="default",at(u,()=>{let f=de(),{isLive:g}=f?f.getVideoData()||{isLive:!1}:{isLive:!1};return g?"Skip to live":""}),m=document.createElement("span"),m.id="ytls-playback-speed",m.textContent="1x",m.style.cursor="pointer",m.style.userSelect="none",at(m,()=>"Current playback speed. Click to toggle between 1x and 2x."),m.onclick=()=>{let f=de();if(f)try{let v=(Number(f.getPlaybackRate())||1)===1?2:1;f.setPlaybackRate(v),E()}catch{}},m.addEventListener("mousedown",f=>{f.stopPropagation()}),m.addEventListener("dblclick",f=>{f.stopPropagation()}),m.addEventListener("click",f=>{f.stopPropagation()}),u.onclick=()=>{let f=de();if(!f)return;let{isLive:g}=f.getVideoData()||{isLive:!1};g&&(Yt=!0,f.seekToLiveHead(),setTimeout(()=>{Yt=!1},500))};let S=()=>{let f=de();if(!f){u.style.cursor="default";return}let{isLive:g}=f.getVideoData()||{isLive:!1};u.style.cursor=g?"pointer":"default"};I(),tt&&clearInterval(tt),tt=setInterval(I,1e3),p.id="ytls-buttons";let R=(f,g)=>()=>{f.classList.remove("ytls-fade-in"),f.classList.add("ytls-fade-out"),setTimeout(()=>{document.body.contains(f)&&document.body.removeChild(f),g&&g()},300)},P=f=>g=>{g.key==="Escape"&&(g.preventDefault(),g.stopPropagation(),f())},F=f=>{setTimeout(()=>{document.addEventListener("keydown",f)},0)},ee=(f,g)=>v=>{f.contains(v.target)||g()},ae=f=>{setTimeout(()=>{document.addEventListener("click",f,!0)},0)},un=[{label:"\u{1F423}",title:"Add timestamp",action:()=>{if(!s||s.querySelector(".ytls-error-message")||ue)return;let f=typeof On<"u"?On:0,g=de(),v=g?Math.floor(g.getCurrentTime()+f):0;if(!Number.isFinite(v))return;let w=xr(v,"");w&&w.focus()}},{label:"\u2699\uFE0F",title:"Settings",action:()=>xe()},{label:"\u{1F4CB}",title:"Copy timestamps to clipboard",action:function(f){if(!s||s.querySelector(".ytls-error-message")||ue){this.textContent="\u274C",setTimeout(()=>{this.textContent="\u{1F4CB}"},2e3);return}let g=Bi(),v=Math.max(Pt(),0);if(g.length===0){this.textContent="\u274C",setTimeout(()=>{this.textContent="\u{1F4CB}"},2e3);return}let w=f.ctrlKey,D=g.map($=>{let N=Ut($.start,v);return w?`${N} ${$.comment} <!-- guid:${$.guid} -->`.trimStart():`${N} ${$.comment}`}).join(`
`);navigator.clipboard.writeText(D).then(()=>{this.textContent="\u2705",setTimeout(()=>{this.textContent="\u{1F4CB}"},2e3)}).catch($=>{c("Failed to copy timestamps: ",$,"error"),this.textContent="\u274C",setTimeout(()=>{this.textContent="\u{1F4CB}"},2e3)})}},{label:"\u23F1\uFE0F",title:"Offset all timestamps",action:()=>{if(!s||s.querySelector(".ytls-error-message")||ue)return;if(me().length===0){alert("No timestamps available to offset.");return}let g=prompt("Enter the number of seconds to offset all timestamps (positive or negative integer):","0");if(g===null)return;let v=g.trim();if(v.length===0)return;let w=Number.parseInt(v,10);if(!Number.isFinite(w)){alert("Please enter a valid integer number of seconds.");return}w!==0&&$a(w,{alertOnNoChange:!0,failureMessage:"Offset had no effect because timestamps are already at the requested bounds.",logLabel:"bulk offset"})}},{label:"\u{1F5D1}\uFE0F",title:"Delete all timestamps for current video",action:async()=>{let f=zi();if(!f){alert("Unable to determine current video ID.");return}let g=document.createElement("div");g.id="ytls-delete-all-modal",g.classList.remove("ytls-fade-out"),g.classList.add("ytls-fade-in");let v=document.createElement("p");v.textContent="Hold the button to delete all timestamps for:",v.style.marginBottom="10px";let w=document.createElement("p");w.textContent=f,w.style.fontFamily="monospace",w.style.fontSize="12px",w.style.marginBottom="15px",w.style.color="#aaa";let D=document.createElement("button");D.classList.add("ytls-save-modal-button"),D.style.background="#d32f2f",D.style.position="relative",D.style.overflow="hidden";let $=null,N=0,W=null,V=document.createElement("div");V.style.position="absolute",V.style.left="0",V.style.top="0",V.style.height="100%",V.style.width="0%",V.style.background="#ff6b6b",V.style.transition="none",V.style.pointerEvents="none",D.appendChild(V);let oe=document.createElement("span");oe.textContent="Hold to Delete All",oe.style.position="relative",oe.style.zIndex="1",D.appendChild(oe);let it=()=>{if(!N)return;let Pe=Date.now()-N,fn=Math.min(Pe/5e3*100,100);V.style.width=`${fn}%`,fn<100&&(W=requestAnimationFrame(it))},le=()=>{$&&(clearTimeout($),$=null),W&&(cancelAnimationFrame(W),W=null),N=0,V.style.width="0%",oe.textContent="Hold to Delete All"};D.onmousedown=()=>{N=Date.now(),oe.textContent="Deleting...",W=requestAnimationFrame(it),$=setTimeout(async()=>{le(),g.classList.remove("ytls-fade-in"),g.classList.add("ytls-fade-out"),setTimeout(async()=>{document.body.contains(g)&&document.body.removeChild(g);try{await Qo(f),ji()}catch(Pe){c("Failed to delete all timestamps:",Pe,"error"),alert("Failed to delete timestamps. Check console for details.")}},300)},5e3)},D.onmouseup=le,D.onmouseleave=le;let qe=null,Me=null,Ze=R(g,()=>{le(),qe&&document.removeEventListener("keydown",qe),Me&&document.removeEventListener("click",Me,!0)});qe=P(Ze),Me=ee(g,Ze);let We=document.createElement("button");We.textContent="Cancel",We.classList.add("ytls-save-modal-cancel-button"),We.onclick=Ze,g.appendChild(v),g.appendChild(w),g.appendChild(D),g.appendChild(We),document.body.appendChild(g),F(qe),ae(Me)}}],ii=us();un.forEach(f=>{let g=document.createElement("button");if(g.textContent=f.label,at(g,f.title),g.classList.add("ytls-main-button"),f.label==="\u{1F423}"&&ii){let v=document.createElement("span");v.textContent=ii,v.classList.add("ytls-holiday-emoji"),g.appendChild(v)}f.label==="\u{1F4CB}"?g.onclick=function(v){f.action.call(this,v)}:g.onclick=f.action,f.label==="\u2699\uFE0F"&&(Fr=g),p.appendChild(g)});let be=document.createElement("button");be.textContent="\u{1F4BE} Save",be.classList.add("ytls-file-operation-button"),be.onclick=()=>{let f=document.createElement("div");f.id="ytls-save-modal",f.classList.remove("ytls-fade-out"),f.classList.add("ytls-fade-in");let g=document.createElement("p");g.textContent="Save as:";let v=null,w=null,D=R(f,()=>{v&&document.removeEventListener("keydown",v),w&&document.removeEventListener("click",w,!0)});v=P(D),w=ee(f,D);let $=document.createElement("button");$.textContent="JSON",$.classList.add("ytls-save-modal-button"),$.onclick=()=>{v&&document.removeEventListener("keydown",v),w&&document.removeEventListener("click",w,!0),R(f,()=>Fa("json"))()};let N=document.createElement("button");N.textContent="Plain Text",N.classList.add("ytls-save-modal-button"),N.onclick=()=>{v&&document.removeEventListener("keydown",v),w&&document.removeEventListener("click",w,!0),R(f,()=>Fa("text"))()};let W=document.createElement("button");W.textContent="Cancel",W.classList.add("ytls-save-modal-cancel-button"),W.onclick=D,f.appendChild(g),f.appendChild($),f.appendChild(N),f.appendChild(W),document.body.appendChild(f),F(v),ae(w)};let ge=document.createElement("button");ge.textContent="\u{1F4C2} Load",ge.classList.add("ytls-file-operation-button"),ge.onclick=()=>{let f=document.createElement("div");f.id="ytls-load-modal",f.classList.remove("ytls-fade-out"),f.classList.add("ytls-fade-in");let g=document.createElement("p");g.textContent="Load from:";let v=null,w=null,D=R(f,()=>{v&&document.removeEventListener("keydown",v),w&&document.removeEventListener("click",w,!0)});v=P(D),w=ee(f,D);let $=document.createElement("button");$.textContent="File",$.classList.add("ytls-save-modal-button"),$.onclick=()=>{let V=document.createElement("input");V.type="file",V.accept=".json,.txt",V.classList.add("ytls-hidden-file-input"),V.onchange=oe=>{let it=oe.target.files?.[0];if(!it)return;v&&document.removeEventListener("keydown",v),w&&document.removeEventListener("click",w,!0),D();let le=new FileReader;le.onload=()=>{let qe=String(le.result).trim();qa(qe)},le.readAsText(it)},V.click()};let N=document.createElement("button");N.textContent="Clipboard",N.classList.add("ytls-save-modal-button"),N.onclick=async()=>{v&&document.removeEventListener("keydown",v),w&&document.removeEventListener("click",w,!0),R(f,async()=>{try{let V=await navigator.clipboard.readText();V?qa(V.trim()):alert("Clipboard is empty.")}catch(V){c("Failed to read from clipboard: ",V,"error"),alert("Failed to read from clipboard. Ensure you have granted permission.")}})()};let W=document.createElement("button");W.textContent="Cancel",W.classList.add("ytls-save-modal-cancel-button"),W.onclick=D,f.appendChild(g),f.appendChild($),f.appendChild(N),f.appendChild(W),document.body.appendChild(f),F(v),ae(w)};let Ee=document.createElement("button");Ee.textContent="\u{1F4E4} Export",Ee.classList.add("ytls-file-operation-button"),Ee.onclick=async()=>{try{await tl()}catch{alert("Failed to export data: Could not read from database.")}};let Ge=document.createElement("button");Ge.textContent="\u{1F4E5} Import",Ge.classList.add("ytls-file-operation-button"),Ge.onclick=()=>{let f=document.createElement("input");f.type="file",f.accept=".json",f.classList.add("ytls-hidden-file-input"),f.onchange=g=>{let v=g.target.files?.[0];if(!v)return;let w=new FileReader;w.onload=()=>{try{let D=JSON.parse(String(w.result)),$=[];for(let N in D)if(Object.prototype.hasOwnProperty.call(D,N)&&N.startsWith("ytls-")){let W=N.substring(5),V=D[N];if(V&&typeof V.video_id=="string"&&Array.isArray(V.timestamps)){let oe=V.timestamps.map(le=>({...le,guid:le.guid||crypto.randomUUID()})),it=Va(W,oe).then(()=>c(`Imported ${W} to IndexedDB`)).catch(le=>c(`Failed to import ${W} to IndexedDB:`,le,"error"));$.push(it)}else c(`Skipping key ${N} during import due to unexpected data format.`,"warn")}Promise.all($).then(()=>{ji()}).catch(N=>{alert("An error occurred during import to IndexedDB. Check console for details."),c("Overall import error:",N,"error")})}catch(D){alert(`Failed to import data. Please ensure the file is in the correct format.
`+D.message),c("Import error:",D,"error")}},w.readAsText(v)},f.click()},k.textContent=ca,s.onclick=f=>{za(f)},s.ontouchstart=f=>{za(f)},i.style.position="fixed",i.style.bottom="0",i.style.right="0",i.style.transition="none",dn(),setTimeout(()=>Hn(),10);let mn=!1,Tr,kr,ai=!1;i.addEventListener("mousedown",f=>{let g=f.target;g instanceof Element&&(g instanceof HTMLInputElement||g instanceof HTMLTextAreaElement||g instanceof Element&&(g.closest("#ytls-playback-speed-group")||g.closest("#ytls-playback-speed"))||g!==o&&!o.contains(g)&&window.getComputedStyle(g).cursor==="pointer"||(mn=!0,ai=!1,Tr=f.clientX-i.getBoundingClientRect().left,kr=f.clientY-i.getBoundingClientRect().top,i.style.transition="none"))}),document.addEventListener("mousemove",Ur=f=>{if(!mn)return;ai=!0;let g=f.clientX-Tr,v=f.clientY-kr,w=i.getBoundingClientRect(),D=w.width,$=w.height,N=document.documentElement.clientWidth,W=document.documentElement.clientHeight;g=Math.max(0,Math.min(g,N-D)),v=Math.max(0,Math.min(v,W-$)),i.style.left=`${g}px`,i.style.top=`${v}px`,i.style.right="auto",i.style.bottom="auto"}),document.addEventListener("mouseup",Vr=()=>{if(!mn)return;mn=!1;let f=ai;setTimeout(()=>{ai=!1},50),Hn(),setTimeout(()=>{f&&wr()},200)}),i.addEventListener("dragstart",f=>f.preventDefault());let Ui=document.createElement("div"),Vi=document.createElement("div"),Gi=document.createElement("div"),qi=document.createElement("div");Ui.id="ytls-resize-tl",Vi.id="ytls-resize-tr",Gi.id="ytls-resize-bl",qi.id="ytls-resize-br";let Fn=!1,Ya=0,Ja=0,jn=0,Un=0,si=0,oi=0,pn=null;li(Ui,"top-left"),li(Vi,"top-right"),li(Gi,"bottom-left"),li(qi,"bottom-right"),document.addEventListener("mousemove",f=>{if(!Fn||!i||!pn)return;let g=f.clientX-Ya,v=f.clientY-Ja,w=jn,D=Un,$=si,N=oi,W=document.documentElement.clientWidth,V=document.documentElement.clientHeight;pn==="bottom-right"?(w=Math.max(200,Math.min(800,jn+g)),D=Math.max(250,Math.min(V,Un+v))):pn==="top-left"?(w=Math.max(200,Math.min(800,jn-g)),$=si+g,D=Math.max(250,Math.min(V,Un-v)),N=oi+v):pn==="top-right"?(w=Math.max(200,Math.min(800,jn+g)),D=Math.max(250,Math.min(V,Un-v)),N=oi+v):pn==="bottom-left"&&(w=Math.max(200,Math.min(800,jn-g)),$=si+g,D=Math.max(250,Math.min(V,Un+v))),$=Math.max(0,Math.min($,W-w)),N=Math.max(0,Math.min(N,V-D)),i.style.width=`${w}px`,i.style.height=`${D}px`,i.style.left=`${$}px`,i.style.top=`${N}px`,i.style.right="auto",i.style.bottom="auto"}),document.addEventListener("mouseup",()=>{Fn&&(Fn=!1,pn=null,document.body.style.cursor="",Ie(!0))});let ci=null;window.addEventListener("resize",Gr=()=>{ci&&clearTimeout(ci),ci=setTimeout(()=>{Ie(!0),ci=null},200)}),o.appendChild(u);let Vn=document.createElement("span");Vn.id="ytls-playback-speed-group",Vn.style.display="inline-flex",Vn.style.alignItems="center",Vn.style.marginLeft="4px",m&&Vn.appendChild(m),o.appendChild(Vn),o.appendChild(h);let ui=document.createElement("div");if(ui.id="ytls-content",ui.append(s),ui.append(p),i.append(o,ui,k,Ui,Vi,Gi,qi),i.addEventListener("mousemove",f=>{try{if(mn||Fn)return;let g=i.getBoundingClientRect(),v=20,w=f.clientX,D=f.clientY,$=w-g.left<=v,N=g.right-w<=v,W=D-g.top<=v,V=g.bottom-D<=v,oe="";W&&$||V&&N?oe="nwse-resize":W&&N||V&&$?oe="nesw-resize":oe="",document.body.style.cursor=oe}catch{}}),i.addEventListener("mouseenter",()=>{Nn=!0,Mr(!0)}),i.addEventListener("mouseleave",()=>{!Fn&&!mn&&(document.body.style.cursor=""),Nn=!1,Mr(!1);try{Ki()}catch{}try{bt(!1)}catch{}}),window.recalculateTimestampsArea=Sr,setTimeout(()=>{if(Sr(),i&&o&&p&&s){let f=40,g=me();if(g.length>0)f=g[0].offsetHeight;else{let v=document.createElement("li");v.style.visibility="hidden",v.style.position="absolute",v.textContent="00:00 Example",s.appendChild(v),f=v.offsetHeight,s.removeChild(v)}pe(o.offsetHeight+p.offsetHeight+f),i.style.minHeight=ce()+"px"}},0),window.addEventListener("resize",Sr),vt){try{vt.disconnect()}catch{}vt=null}vt=new ResizeObserver(Sr),vt.observe(i),fr||document.addEventListener("pointerdown",fr=()=>{Ia=Date.now()},!0),hr||document.addEventListener("pointerup",hr=()=>{},!0)}finally{Ri=!1}}}async function al(){if(!i)return;if(document.querySelectorAll("#ytls-pane").forEach(h=>{h!==i&&(c("Removing duplicate pane element from DOM"),h.remove())}),document.body.contains(i)){c("Pane already in DOM, skipping append");return}await rl(),typeof wa=="function"&&wa(el),typeof _i=="function"&&_i(ri),typeof Ai=="function"&&Ai(Hi),typeof ba=="function"&&ba(L),await Ta(),await Io(),await or(),typeof nn=="function"&&nn();let d=document.querySelectorAll("#ytls-pane");if(d.length>0&&(c(`WARNING: Found ${d.length} existing pane(s) in DOM, removing all`),d.forEach(h=>h.remove())),document.body.contains(i)){c("ERROR: Pane already in body, aborting append");return}if(document.body.appendChild(i),c("Pane successfully appended to DOM"),Rn(),Se&&(clearTimeout(Se),Se=null),Se=setTimeout(()=>{Et(),typeof window.recalculateTimestampsArea=="function"&&window.recalculateTimestampsArea(),Ue(),Ie(!0),Se=null},450),yt){try{yt.disconnect()}catch{}yt=null}yt=new MutationObserver(()=>{let h=document.querySelectorAll("#ytls-pane");h.length>1&&(c(`CRITICAL: Multiple panes detected (${h.length}), removing duplicates`),h.forEach((y,S)=>{(S>0||i&&y!==i)&&y.remove()}))}),yt.observe(document.body,{childList:!0,subtree:!0})}function Za(l=0){if(document.getElementById("ytls-header-button")){Ot();return}let d=document.querySelector("#logo");if(!d||!d.parentElement){l<10&&setTimeout(()=>Za(l+1),300);return}let h=document.createElement("button");h.id="ytls-header-button",h.type="button",h.className="ytls-header-button",at(h,"Toggle Timekeeper UI"),h.setAttribute("aria-label","Toggle Timekeeper UI");let y=document.createElement("img");y.src=an,y.alt="",y.decoding="async",h.appendChild(y),Wt=y,h.addEventListener("mouseenter",()=>{Wt&&(jr=!0,Wt.src=Bn)}),h.addEventListener("mouseleave",()=>{Wt&&(jr=!1,Ot())}),h.addEventListener("click",()=>{i&&!document.body.contains(i)&&(c("Pane not in DOM, re-appending before toggle"),document.body.appendChild(i)),Fi()}),d.insertAdjacentElement("afterend",h),Ot(),c("Timekeeper header button added next to YouTube logo")}function Wa(){if(Te())return;Le(!0);let l=history.pushState,d=history.replaceState;function h(){try{let y=new Event("locationchange");window.dispatchEvent(y)}catch{}}history.pushState=function(){let y=l.apply(this,arguments);return h(),y},history.replaceState=function(){let y=d.apply(this,arguments);return h(),y},window.addEventListener("popstate",h),window.addEventListener("locationchange",()=>{window.location.href!==U&&c("Location changed (locationchange event) \u2014 deferring UI update until navigation finish")})}async function ji(){if(!a()){qo();return}ie(window.location.href),document.querySelectorAll("#ytls-pane").forEach((d,h)=>{(h>0||i&&d!==i)&&d.remove()}),await zr(),await il(),Ae=zi();let l=document.title;c("Page Title:",l),c("Video ID:",Ae),c("Current URL:",window.location.href),Oi(!0),$n(),ze(),await Ua(),ze(),Oi(!1),c("Timestamps loaded and UI unlocked for video:",Ae),await al();try{bt(!0)}catch{}Za(),Yo()}Wa(),window.addEventListener("yt-navigate-start",()=>{c("Navigation started (yt-navigate-start event fired)"),a()&&i&&s&&(c("Locking UI and showing loading state for navigation"),Oi(!0))}),pr=l=>{l.ctrlKey&&l.altKey&&l.shiftKey&&(l.key==="T"||l.key==="t")&&(l.preventDefault(),Fi(),c("Timekeeper UI toggled via keyboard shortcut (Ctrl+Alt+Shift+T)"))},document.addEventListener("keydown",pr),window.addEventListener("yt-navigate-finish",()=>{c("Navigation finished (yt-navigate-finish event fired)"),window.location.href!==U?ji():c("Navigation finished but URL already handled, skipping.")}),Wa(),c("Timekeeper initialized and waiting for navigation events")})();})();


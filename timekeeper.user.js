// ==UserScript==
// @name         Timekeeper
// @namespace    https://violentmonkey.github.io/
// @version      4.4.41
// @description  Enhanced timestamp tool for YouTube videos
// @author       Silent Shout
// @match        https://www.youtube.com/*
// @run-at       document-idle
// @noframes
// @icon         https://raw.githubusercontent.com/KamoTimestamps/timekeeper/refs/heads/main/assets/Kamo_64px_Indexed.png
// @grant        GM.getValue
// @grant        GM.setValue
// @grant        GM.setClipboard
// @homepageURL  https://github.com/KamoTimestamps/timekeeper
// @supportURL   https://github.com/KamoTimestamps/timekeeper/issues
// @downloadURL  https://raw.githubusercontent.com/KamoTimestamps/timekeeper/main/timekeeper.user.js
// @updateURL    https://raw.githubusercontent.com/KamoTimestamps/timekeeper/main/timekeeper.user.js
// @license MIT
// ==/UserScript==

(()=>{var Os=Object.defineProperty;var Ps=(t,e)=>{for(var n in e)Os(t,n,{get:e[n],enumerable:!0})};var se={};Ps(se,{BRAND:()=>lo,DIRTY:()=>sn,EMPTY_PATH:()=>Fs,INVALID:()=>O,NEVER:()=>Zo,OK:()=>Ne,ParseStatus:()=>Be,Schema:()=>G,ZodAny:()=>qt,ZodArray:()=>zt,ZodBigInt:()=>ln,ZodBoolean:()=>cn,ZodBranded:()=>yr,ZodCatch:()=>bn,ZodDate:()=>un,ZodDefault:()=>xn,ZodDiscriminatedUnion:()=>ri,ZodEffects:()=>ut,ZodEnum:()=>yn,ZodError:()=>Ze,ZodFirstPartyTypeKind:()=>z,ZodFunction:()=>ai,ZodIntersection:()=>pn,ZodIssueCode:()=>_,ZodLazy:()=>hn,ZodLiteral:()=>gn,ZodMap:()=>Zn,ZodNaN:()=>Yn,ZodNativeEnum:()=>vn,ZodNever:()=>xt,ZodNull:()=>fn,ZodNullable:()=>Et,ZodNumber:()=>on,ZodObject:()=>We,ZodOptional:()=>lt,ZodParsedType:()=>L,ZodPipeline:()=>vr,ZodPromise:()=>Zt,ZodReadonly:()=>wn,ZodRecord:()=>ii,ZodSchema:()=>G,ZodSet:()=>Wn,ZodString:()=>Vt,ZodSymbol:()=>Vn,ZodTransformer:()=>ut,ZodTuple:()=>_t,ZodType:()=>G,ZodUndefined:()=>dn,ZodUnion:()=>mn,ZodUnknown:()=>Pt,ZodVoid:()=>qn,addIssueToContext:()=>C,any:()=>vo,array:()=>ko,bigint:()=>mo,boolean:()=>_a,coerce:()=>qo,custom:()=>wa,date:()=>po,datetimeRegex:()=>xa,defaultErrorMap:()=>Rt,discriminatedUnion:()=>So,effect:()=>No,enum:()=>Oo,function:()=>Do,getErrorMap:()=>Hn,getParsedType:()=>Tt,instanceof:()=>uo,intersection:()=>Co,isAborted:()=>ti,isAsync:()=>Un,isDirty:()=>ni,isValid:()=>Gt,late:()=>co,lazy:()=>Bo,literal:()=>Ro,makeIssue:()=>gr,map:()=>Ao,nan:()=>fo,nativeEnum:()=>Po,never:()=>bo,null:()=>yo,nullable:()=>Fo,number:()=>Ta,object:()=>To,objectUtil:()=>Ii,oboolean:()=>Vo,onumber:()=>Go,optional:()=>$o,ostring:()=>Uo,pipeline:()=>Ho,preprocess:()=>jo,promise:()=>zo,quotelessJson:()=>zs,record:()=>Io,set:()=>Mo,setErrorMap:()=>$s,strictObject:()=>_o,string:()=>ka,symbol:()=>ho,transformer:()=>No,tuple:()=>Lo,undefined:()=>go,union:()=>Eo,unknown:()=>xo,util:()=>K,void:()=>wo});var K;(function(t){t.assertEqual=a=>{};function e(a){}t.assertIs=e;function n(a){throw new Error}t.assertNever=n,t.arrayToEnum=a=>{let r={};for(let l of a)r[l]=l;return r},t.getValidEnumValues=a=>{let r=t.objectKeys(a).filter(s=>typeof a[a[s]]!="number"),l={};for(let s of r)l[s]=a[s];return t.objectValues(l)},t.objectValues=a=>t.objectKeys(a).map(function(r){return a[r]}),t.objectKeys=typeof Object.keys=="function"?a=>Object.keys(a):a=>{let r=[];for(let l in a)Object.prototype.hasOwnProperty.call(a,l)&&r.push(l);return r},t.find=(a,r)=>{for(let l of a)if(r(l))return l},t.isInteger=typeof Number.isInteger=="function"?a=>Number.isInteger(a):a=>typeof a=="number"&&Number.isFinite(a)&&Math.floor(a)===a;function i(a,r=" | "){return a.map(l=>typeof l=="string"?`'${l}'`:l).join(r)}t.joinValues=i,t.jsonStringifyReplacer=(a,r)=>typeof r=="bigint"?r.toString():r})(K||(K={}));var Ii;(function(t){t.mergeShapes=(e,n)=>({...e,...n})})(Ii||(Ii={}));var L=K.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Tt=t=>{switch(typeof t){case"undefined":return L.undefined;case"string":return L.string;case"number":return Number.isNaN(t)?L.nan:L.number;case"boolean":return L.boolean;case"function":return L.function;case"bigint":return L.bigint;case"symbol":return L.symbol;case"object":return Array.isArray(t)?L.array:t===null?L.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?L.promise:typeof Map<"u"&&t instanceof Map?L.map:typeof Set<"u"&&t instanceof Set?L.set:typeof Date<"u"&&t instanceof Date?L.date:L.object;default:return L.unknown}};var _=K.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),zs=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:"),Ze=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=i=>{this.issues=[...this.issues,i]},this.addIssues=(i=[])=>{this.issues=[...this.issues,...i]};let n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=e}format(e){let n=e||function(r){return r.message},i={_errors:[]},a=r=>{for(let l of r.issues)if(l.code==="invalid_union")l.unionErrors.map(a);else if(l.code==="invalid_return_type")a(l.returnTypeError);else if(l.code==="invalid_arguments")a(l.argumentsError);else if(l.path.length===0)i._errors.push(n(l));else{let s=i,v=0;for(;v<l.path.length;){let p=l.path[v];v===l.path.length-1?(s[p]=s[p]||{_errors:[]},s[p]._errors.push(n(l))):s[p]=s[p]||{_errors:[]},s=s[p],v++}}};return a(this),i}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,K.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=n=>n.message){let n={},i=[];for(let a of this.issues)if(a.path.length>0){let r=a.path[0];n[r]=n[r]||[],n[r].push(e(a))}else i.push(e(a));return{formErrors:i,fieldErrors:n}}get formErrors(){return this.flatten()}};Ze.create=t=>new Ze(t);var Ns=(t,e)=>{let n;switch(t.code){case _.invalid_type:t.received===L.undefined?n="Required":n=`Expected ${t.expected}, received ${t.received}`;break;case _.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(t.expected,K.jsonStringifyReplacer)}`;break;case _.unrecognized_keys:n=`Unrecognized key(s) in object: ${K.joinValues(t.keys,", ")}`;break;case _.invalid_union:n="Invalid input";break;case _.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${K.joinValues(t.options)}`;break;case _.invalid_enum_value:n=`Invalid enum value. Expected ${K.joinValues(t.options)}, received '${t.received}'`;break;case _.invalid_arguments:n="Invalid function arguments";break;case _.invalid_return_type:n="Invalid function return type";break;case _.invalid_date:n="Invalid date";break;case _.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(n=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(n=`${n} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?n=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?n=`Invalid input: must end with "${t.validation.endsWith}"`:K.assertNever(t.validation):t.validation!=="regex"?n=`Invalid ${t.validation}`:n="Invalid";break;case _.too_small:t.type==="array"?n=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?n=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?n=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="bigint"?n=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?n=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:n="Invalid input";break;case _.too_big:t.type==="array"?n=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?n=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?n=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?n=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?n=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:n="Invalid input";break;case _.custom:n="Invalid input";break;case _.invalid_intersection_types:n="Intersection results could not be merged";break;case _.not_multiple_of:n=`Number must be a multiple of ${t.multipleOf}`;break;case _.not_finite:n="Number must be finite";break;default:n=e.defaultError,K.assertNever(t)}return{message:n}},Rt=Ns;var pa=Rt;function $s(t){pa=t}function Hn(){return pa}var gr=t=>{let{data:e,path:n,errorMaps:i,issueData:a}=t,r=[...n,...a.path||[]],l={...a,path:r};if(a.message!==void 0)return{...a,path:r,message:a.message};let s="",v=i.filter(p=>!!p).slice().reverse();for(let p of v)s=p(l,{data:e,defaultError:s}).message;return{...a,path:r,message:s}},Fs=[];function C(t,e){let n=Hn(),i=gr({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,n,n===Rt?void 0:Rt].filter(a=>!!a)});t.common.issues.push(i)}var Be=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,n){let i=[];for(let a of n){if(a.status==="aborted")return O;a.status==="dirty"&&e.dirty(),i.push(a.value)}return{status:e.value,value:i}}static async mergeObjectAsync(e,n){let i=[];for(let a of n){let r=await a.key,l=await a.value;i.push({key:r,value:l})}return t.mergeObjectSync(e,i)}static mergeObjectSync(e,n){let i={};for(let a of n){let{key:r,value:l}=a;if(r.status==="aborted"||l.status==="aborted")return O;r.status==="dirty"&&e.dirty(),l.status==="dirty"&&e.dirty(),r.value!=="__proto__"&&(typeof l.value<"u"||a.alwaysSet)&&(i[r.value]=l.value)}return{status:e.value,value:i}}},O=Object.freeze({status:"aborted"}),sn=t=>({status:"dirty",value:t}),Ne=t=>({status:"valid",value:t}),ti=t=>t.status==="aborted",ni=t=>t.status==="dirty",Gt=t=>t.status==="valid",Un=t=>typeof Promise<"u"&&t instanceof Promise;var D;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(D||(D={}));var ct=class{constructor(e,n,i,a){this._cachedPath=[],this.parent=e,this.data=n,this._path=i,this._key=a}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},ha=(t,e)=>{if(Gt(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let n=new Ze(t.common.issues);return this._error=n,this._error}}};function U(t){if(!t)return{};let{errorMap:e,invalid_type_error:n,required_error:i,description:a}=t;if(e&&(n||i))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:a}:{errorMap:(l,s)=>{let{message:v}=t;return l.code==="invalid_enum_value"?{message:v??s.defaultError}:typeof s.data>"u"?{message:v??i??s.defaultError}:l.code!=="invalid_type"?{message:s.defaultError}:{message:v??n??s.defaultError}},description:a}}var G=class{get description(){return this._def.description}_getType(e){return Tt(e.data)}_getOrReturnCtx(e,n){return n||{common:e.parent.common,data:e.data,parsedType:Tt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Be,ctx:{common:e.parent.common,data:e.data,parsedType:Tt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let n=this._parse(e);if(Un(n))throw new Error("Synchronous parse encountered promise.");return n}_parseAsync(e){let n=this._parse(e);return Promise.resolve(n)}parse(e,n){let i=this.safeParse(e,n);if(i.success)return i.data;throw i.error}safeParse(e,n){let i={common:{issues:[],async:n?.async??!1,contextualErrorMap:n?.errorMap},path:n?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Tt(e)},a=this._parseSync({data:e,path:i.path,parent:i});return ha(i,a)}"~validate"(e){let n={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Tt(e)};if(!this["~standard"].async)try{let i=this._parseSync({data:e,path:[],parent:n});return Gt(i)?{value:i.value}:{issues:n.common.issues}}catch(i){i?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),n.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:n}).then(i=>Gt(i)?{value:i.value}:{issues:n.common.issues})}async parseAsync(e,n){let i=await this.safeParseAsync(e,n);if(i.success)return i.data;throw i.error}async safeParseAsync(e,n){let i={common:{issues:[],contextualErrorMap:n?.errorMap,async:!0},path:n?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Tt(e)},a=this._parse({data:e,path:i.path,parent:i}),r=await(Un(a)?a:Promise.resolve(a));return ha(i,r)}refine(e,n){let i=a=>typeof n=="string"||typeof n>"u"?{message:n}:typeof n=="function"?n(a):n;return this._refinement((a,r)=>{let l=e(a),s=()=>r.addIssue({code:_.custom,...i(a)});return typeof Promise<"u"&&l instanceof Promise?l.then(v=>v?!0:(s(),!1)):l?!0:(s(),!1)})}refinement(e,n){return this._refinement((i,a)=>e(i)?!0:(a.addIssue(typeof n=="function"?n(i,a):n),!1))}_refinement(e){return new ut({schema:this,typeName:z.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:n=>this["~validate"](n)}}optional(){return lt.create(this,this._def)}nullable(){return Et.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return zt.create(this)}promise(){return Zt.create(this,this._def)}or(e){return mn.create([this,e],this._def)}and(e){return pn.create(this,e,this._def)}transform(e){return new ut({...U(this._def),schema:this,typeName:z.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let n=typeof e=="function"?e:()=>e;return new xn({...U(this._def),innerType:this,defaultValue:n,typeName:z.ZodDefault})}brand(){return new yr({typeName:z.ZodBranded,type:this,...U(this._def)})}catch(e){let n=typeof e=="function"?e:()=>e;return new bn({...U(this._def),innerType:this,catchValue:n,typeName:z.ZodCatch})}describe(e){let n=this.constructor;return new n({...this._def,description:e})}pipe(e){return vr.create(this,e)}readonly(){return wn.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},js=/^c[^\s-]{8,}$/i,Hs=/^[0-9a-z]+$/,Us=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Gs=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Vs=/^[a-z0-9_-]{21}$/i,qs=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Zs=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Ws=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Ys="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",Ai,Ks=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Js=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Xs=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Qs=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,eo=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,to=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,ya="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",no=new RegExp(`^${ya}$`);function va(t){let e="[0-5]\\d";t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`);let n=t.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${n}`}function ro(t){return new RegExp(`^${va(t)}$`)}function xa(t){let e=`${ya}T${va(t)}`,n=[];return n.push(t.local?"Z?":"Z"),t.offset&&n.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${n.join("|")})`,new RegExp(`^${e}$`)}function io(t,e){return!!((e==="v4"||!e)&&Ks.test(t)||(e==="v6"||!e)&&Xs.test(t))}function ao(t,e){if(!qs.test(t))return!1;try{let[n]=t.split(".");if(!n)return!1;let i=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(n.length+(4-n.length%4)%4,"="),a=JSON.parse(atob(i));return!(typeof a!="object"||a===null||"typ"in a&&a?.typ!=="JWT"||!a.alg||e&&a.alg!==e)}catch{return!1}}function so(t,e){return!!((e==="v4"||!e)&&Js.test(t)||(e==="v6"||!e)&&Qs.test(t))}var Vt=class t extends G{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==L.string){let r=this._getOrReturnCtx(e);return C(r,{code:_.invalid_type,expected:L.string,received:r.parsedType}),O}let i=new Be,a;for(let r of this._def.checks)if(r.kind==="min")e.data.length<r.value&&(a=this._getOrReturnCtx(e,a),C(a,{code:_.too_small,minimum:r.value,type:"string",inclusive:!0,exact:!1,message:r.message}),i.dirty());else if(r.kind==="max")e.data.length>r.value&&(a=this._getOrReturnCtx(e,a),C(a,{code:_.too_big,maximum:r.value,type:"string",inclusive:!0,exact:!1,message:r.message}),i.dirty());else if(r.kind==="length"){let l=e.data.length>r.value,s=e.data.length<r.value;(l||s)&&(a=this._getOrReturnCtx(e,a),l?C(a,{code:_.too_big,maximum:r.value,type:"string",inclusive:!0,exact:!0,message:r.message}):s&&C(a,{code:_.too_small,minimum:r.value,type:"string",inclusive:!0,exact:!0,message:r.message}),i.dirty())}else if(r.kind==="email")Ws.test(e.data)||(a=this._getOrReturnCtx(e,a),C(a,{validation:"email",code:_.invalid_string,message:r.message}),i.dirty());else if(r.kind==="emoji")Ai||(Ai=new RegExp(Ys,"u")),Ai.test(e.data)||(a=this._getOrReturnCtx(e,a),C(a,{validation:"emoji",code:_.invalid_string,message:r.message}),i.dirty());else if(r.kind==="uuid")Gs.test(e.data)||(a=this._getOrReturnCtx(e,a),C(a,{validation:"uuid",code:_.invalid_string,message:r.message}),i.dirty());else if(r.kind==="nanoid")Vs.test(e.data)||(a=this._getOrReturnCtx(e,a),C(a,{validation:"nanoid",code:_.invalid_string,message:r.message}),i.dirty());else if(r.kind==="cuid")js.test(e.data)||(a=this._getOrReturnCtx(e,a),C(a,{validation:"cuid",code:_.invalid_string,message:r.message}),i.dirty());else if(r.kind==="cuid2")Hs.test(e.data)||(a=this._getOrReturnCtx(e,a),C(a,{validation:"cuid2",code:_.invalid_string,message:r.message}),i.dirty());else if(r.kind==="ulid")Us.test(e.data)||(a=this._getOrReturnCtx(e,a),C(a,{validation:"ulid",code:_.invalid_string,message:r.message}),i.dirty());else if(r.kind==="url")try{new URL(e.data)}catch{a=this._getOrReturnCtx(e,a),C(a,{validation:"url",code:_.invalid_string,message:r.message}),i.dirty()}else r.kind==="regex"?(r.regex.lastIndex=0,r.regex.test(e.data)||(a=this._getOrReturnCtx(e,a),C(a,{validation:"regex",code:_.invalid_string,message:r.message}),i.dirty())):r.kind==="trim"?e.data=e.data.trim():r.kind==="includes"?e.data.includes(r.value,r.position)||(a=this._getOrReturnCtx(e,a),C(a,{code:_.invalid_string,validation:{includes:r.value,position:r.position},message:r.message}),i.dirty()):r.kind==="toLowerCase"?e.data=e.data.toLowerCase():r.kind==="toUpperCase"?e.data=e.data.toUpperCase():r.kind==="startsWith"?e.data.startsWith(r.value)||(a=this._getOrReturnCtx(e,a),C(a,{code:_.invalid_string,validation:{startsWith:r.value},message:r.message}),i.dirty()):r.kind==="endsWith"?e.data.endsWith(r.value)||(a=this._getOrReturnCtx(e,a),C(a,{code:_.invalid_string,validation:{endsWith:r.value},message:r.message}),i.dirty()):r.kind==="datetime"?xa(r).test(e.data)||(a=this._getOrReturnCtx(e,a),C(a,{code:_.invalid_string,validation:"datetime",message:r.message}),i.dirty()):r.kind==="date"?no.test(e.data)||(a=this._getOrReturnCtx(e,a),C(a,{code:_.invalid_string,validation:"date",message:r.message}),i.dirty()):r.kind==="time"?ro(r).test(e.data)||(a=this._getOrReturnCtx(e,a),C(a,{code:_.invalid_string,validation:"time",message:r.message}),i.dirty()):r.kind==="duration"?Zs.test(e.data)||(a=this._getOrReturnCtx(e,a),C(a,{validation:"duration",code:_.invalid_string,message:r.message}),i.dirty()):r.kind==="ip"?io(e.data,r.version)||(a=this._getOrReturnCtx(e,a),C(a,{validation:"ip",code:_.invalid_string,message:r.message}),i.dirty()):r.kind==="jwt"?ao(e.data,r.alg)||(a=this._getOrReturnCtx(e,a),C(a,{validation:"jwt",code:_.invalid_string,message:r.message}),i.dirty()):r.kind==="cidr"?so(e.data,r.version)||(a=this._getOrReturnCtx(e,a),C(a,{validation:"cidr",code:_.invalid_string,message:r.message}),i.dirty()):r.kind==="base64"?eo.test(e.data)||(a=this._getOrReturnCtx(e,a),C(a,{validation:"base64",code:_.invalid_string,message:r.message}),i.dirty()):r.kind==="base64url"?to.test(e.data)||(a=this._getOrReturnCtx(e,a),C(a,{validation:"base64url",code:_.invalid_string,message:r.message}),i.dirty()):K.assertNever(r);return{status:i.value,value:e.data}}_regex(e,n,i){return this.refinement(a=>e.test(a),{validation:n,code:_.invalid_string,...D.errToObj(i)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...D.errToObj(e)})}url(e){return this._addCheck({kind:"url",...D.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...D.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...D.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...D.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...D.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...D.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...D.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...D.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...D.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...D.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...D.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...D.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...D.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...D.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...D.errToObj(e)})}regex(e,n){return this._addCheck({kind:"regex",regex:e,...D.errToObj(n)})}includes(e,n){return this._addCheck({kind:"includes",value:e,position:n?.position,...D.errToObj(n?.message)})}startsWith(e,n){return this._addCheck({kind:"startsWith",value:e,...D.errToObj(n)})}endsWith(e,n){return this._addCheck({kind:"endsWith",value:e,...D.errToObj(n)})}min(e,n){return this._addCheck({kind:"min",value:e,...D.errToObj(n)})}max(e,n){return this._addCheck({kind:"max",value:e,...D.errToObj(n)})}length(e,n){return this._addCheck({kind:"length",value:e,...D.errToObj(n)})}nonempty(e){return this.min(1,D.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxLength(){let e=null;for(let n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}};Vt.create=t=>new Vt({checks:[],typeName:z.ZodString,coerce:t?.coerce??!1,...U(t)});function oo(t,e){let n=(t.toString().split(".")[1]||"").length,i=(e.toString().split(".")[1]||"").length,a=n>i?n:i,r=Number.parseInt(t.toFixed(a).replace(".","")),l=Number.parseInt(e.toFixed(a).replace(".",""));return r%l/10**a}var on=class t extends G{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==L.number){let r=this._getOrReturnCtx(e);return C(r,{code:_.invalid_type,expected:L.number,received:r.parsedType}),O}let i,a=new Be;for(let r of this._def.checks)r.kind==="int"?K.isInteger(e.data)||(i=this._getOrReturnCtx(e,i),C(i,{code:_.invalid_type,expected:"integer",received:"float",message:r.message}),a.dirty()):r.kind==="min"?(r.inclusive?e.data<r.value:e.data<=r.value)&&(i=this._getOrReturnCtx(e,i),C(i,{code:_.too_small,minimum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),a.dirty()):r.kind==="max"?(r.inclusive?e.data>r.value:e.data>=r.value)&&(i=this._getOrReturnCtx(e,i),C(i,{code:_.too_big,maximum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),a.dirty()):r.kind==="multipleOf"?oo(e.data,r.value)!==0&&(i=this._getOrReturnCtx(e,i),C(i,{code:_.not_multiple_of,multipleOf:r.value,message:r.message}),a.dirty()):r.kind==="finite"?Number.isFinite(e.data)||(i=this._getOrReturnCtx(e,i),C(i,{code:_.not_finite,message:r.message}),a.dirty()):K.assertNever(r);return{status:a.value,value:e.data}}gte(e,n){return this.setLimit("min",e,!0,D.toString(n))}gt(e,n){return this.setLimit("min",e,!1,D.toString(n))}lte(e,n){return this.setLimit("max",e,!0,D.toString(n))}lt(e,n){return this.setLimit("max",e,!1,D.toString(n))}setLimit(e,n,i,a){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:i,message:D.toString(a)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:D.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:D.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:D.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:D.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:D.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:D.toString(n)})}finite(e){return this._addCheck({kind:"finite",message:D.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:D.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:D.toString(e)})}get minValue(){let e=null;for(let n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(let n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&K.isInteger(e.value))}get isFinite(){let e=null,n=null;for(let i of this._def.checks){if(i.kind==="finite"||i.kind==="int"||i.kind==="multipleOf")return!0;i.kind==="min"?(n===null||i.value>n)&&(n=i.value):i.kind==="max"&&(e===null||i.value<e)&&(e=i.value)}return Number.isFinite(n)&&Number.isFinite(e)}};on.create=t=>new on({checks:[],typeName:z.ZodNumber,coerce:t?.coerce||!1,...U(t)});var ln=class t extends G{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==L.bigint)return this._getInvalidInput(e);let i,a=new Be;for(let r of this._def.checks)r.kind==="min"?(r.inclusive?e.data<r.value:e.data<=r.value)&&(i=this._getOrReturnCtx(e,i),C(i,{code:_.too_small,type:"bigint",minimum:r.value,inclusive:r.inclusive,message:r.message}),a.dirty()):r.kind==="max"?(r.inclusive?e.data>r.value:e.data>=r.value)&&(i=this._getOrReturnCtx(e,i),C(i,{code:_.too_big,type:"bigint",maximum:r.value,inclusive:r.inclusive,message:r.message}),a.dirty()):r.kind==="multipleOf"?e.data%r.value!==BigInt(0)&&(i=this._getOrReturnCtx(e,i),C(i,{code:_.not_multiple_of,multipleOf:r.value,message:r.message}),a.dirty()):K.assertNever(r);return{status:a.value,value:e.data}}_getInvalidInput(e){let n=this._getOrReturnCtx(e);return C(n,{code:_.invalid_type,expected:L.bigint,received:n.parsedType}),O}gte(e,n){return this.setLimit("min",e,!0,D.toString(n))}gt(e,n){return this.setLimit("min",e,!1,D.toString(n))}lte(e,n){return this.setLimit("max",e,!0,D.toString(n))}lt(e,n){return this.setLimit("max",e,!1,D.toString(n))}setLimit(e,n,i,a){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:i,message:D.toString(a)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:D.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:D.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:D.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:D.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:D.toString(n)})}get minValue(){let e=null;for(let n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(let n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}};ln.create=t=>new ln({checks:[],typeName:z.ZodBigInt,coerce:t?.coerce??!1,...U(t)});var cn=class extends G{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==L.boolean){let i=this._getOrReturnCtx(e);return C(i,{code:_.invalid_type,expected:L.boolean,received:i.parsedType}),O}return Ne(e.data)}};cn.create=t=>new cn({typeName:z.ZodBoolean,coerce:t?.coerce||!1,...U(t)});var un=class t extends G{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==L.date){let r=this._getOrReturnCtx(e);return C(r,{code:_.invalid_type,expected:L.date,received:r.parsedType}),O}if(Number.isNaN(e.data.getTime())){let r=this._getOrReturnCtx(e);return C(r,{code:_.invalid_date}),O}let i=new Be,a;for(let r of this._def.checks)r.kind==="min"?e.data.getTime()<r.value&&(a=this._getOrReturnCtx(e,a),C(a,{code:_.too_small,message:r.message,inclusive:!0,exact:!1,minimum:r.value,type:"date"}),i.dirty()):r.kind==="max"?e.data.getTime()>r.value&&(a=this._getOrReturnCtx(e,a),C(a,{code:_.too_big,message:r.message,inclusive:!0,exact:!1,maximum:r.value,type:"date"}),i.dirty()):K.assertNever(r);return{status:i.value,value:new Date(e.data.getTime())}}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}min(e,n){return this._addCheck({kind:"min",value:e.getTime(),message:D.toString(n)})}max(e,n){return this._addCheck({kind:"max",value:e.getTime(),message:D.toString(n)})}get minDate(){let e=null;for(let n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e!=null?new Date(e):null}};un.create=t=>new un({checks:[],coerce:t?.coerce||!1,typeName:z.ZodDate,...U(t)});var Vn=class extends G{_parse(e){if(this._getType(e)!==L.symbol){let i=this._getOrReturnCtx(e);return C(i,{code:_.invalid_type,expected:L.symbol,received:i.parsedType}),O}return Ne(e.data)}};Vn.create=t=>new Vn({typeName:z.ZodSymbol,...U(t)});var dn=class extends G{_parse(e){if(this._getType(e)!==L.undefined){let i=this._getOrReturnCtx(e);return C(i,{code:_.invalid_type,expected:L.undefined,received:i.parsedType}),O}return Ne(e.data)}};dn.create=t=>new dn({typeName:z.ZodUndefined,...U(t)});var fn=class extends G{_parse(e){if(this._getType(e)!==L.null){let i=this._getOrReturnCtx(e);return C(i,{code:_.invalid_type,expected:L.null,received:i.parsedType}),O}return Ne(e.data)}};fn.create=t=>new fn({typeName:z.ZodNull,...U(t)});var qt=class extends G{constructor(){super(...arguments),this._any=!0}_parse(e){return Ne(e.data)}};qt.create=t=>new qt({typeName:z.ZodAny,...U(t)});var Pt=class extends G{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Ne(e.data)}};Pt.create=t=>new Pt({typeName:z.ZodUnknown,...U(t)});var xt=class extends G{_parse(e){let n=this._getOrReturnCtx(e);return C(n,{code:_.invalid_type,expected:L.never,received:n.parsedType}),O}};xt.create=t=>new xt({typeName:z.ZodNever,...U(t)});var qn=class extends G{_parse(e){if(this._getType(e)!==L.undefined){let i=this._getOrReturnCtx(e);return C(i,{code:_.invalid_type,expected:L.void,received:i.parsedType}),O}return Ne(e.data)}};qn.create=t=>new qn({typeName:z.ZodVoid,...U(t)});var zt=class t extends G{_parse(e){let{ctx:n,status:i}=this._processInputParams(e),a=this._def;if(n.parsedType!==L.array)return C(n,{code:_.invalid_type,expected:L.array,received:n.parsedType}),O;if(a.exactLength!==null){let l=n.data.length>a.exactLength.value,s=n.data.length<a.exactLength.value;(l||s)&&(C(n,{code:l?_.too_big:_.too_small,minimum:s?a.exactLength.value:void 0,maximum:l?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),i.dirty())}if(a.minLength!==null&&n.data.length<a.minLength.value&&(C(n,{code:_.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),i.dirty()),a.maxLength!==null&&n.data.length>a.maxLength.value&&(C(n,{code:_.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),i.dirty()),n.common.async)return Promise.all([...n.data].map((l,s)=>a.type._parseAsync(new ct(n,l,n.path,s)))).then(l=>Be.mergeArray(i,l));let r=[...n.data].map((l,s)=>a.type._parseSync(new ct(n,l,n.path,s)));return Be.mergeArray(i,r)}get element(){return this._def.type}min(e,n){return new t({...this._def,minLength:{value:e,message:D.toString(n)}})}max(e,n){return new t({...this._def,maxLength:{value:e,message:D.toString(n)}})}length(e,n){return new t({...this._def,exactLength:{value:e,message:D.toString(n)}})}nonempty(e){return this.min(1,e)}};zt.create=(t,e)=>new zt({type:t,minLength:null,maxLength:null,exactLength:null,typeName:z.ZodArray,...U(e)});function Gn(t){if(t instanceof We){let e={};for(let n in t.shape){let i=t.shape[n];e[n]=lt.create(Gn(i))}return new We({...t._def,shape:()=>e})}else return t instanceof zt?new zt({...t._def,type:Gn(t.element)}):t instanceof lt?lt.create(Gn(t.unwrap())):t instanceof Et?Et.create(Gn(t.unwrap())):t instanceof _t?_t.create(t.items.map(e=>Gn(e))):t}var We=class t extends G{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),n=K.objectKeys(e);return this._cached={shape:e,keys:n},this._cached}_parse(e){if(this._getType(e)!==L.object){let p=this._getOrReturnCtx(e);return C(p,{code:_.invalid_type,expected:L.object,received:p.parsedType}),O}let{status:i,ctx:a}=this._processInputParams(e),{shape:r,keys:l}=this._getCached(),s=[];if(!(this._def.catchall instanceof xt&&this._def.unknownKeys==="strip"))for(let p in a.data)l.includes(p)||s.push(p);let v=[];for(let p of l){let b=r[p],M=a.data[p];v.push({key:{status:"valid",value:p},value:b._parse(new ct(a,M,a.path,p)),alwaysSet:p in a.data})}if(this._def.catchall instanceof xt){let p=this._def.unknownKeys;if(p==="passthrough")for(let b of s)v.push({key:{status:"valid",value:b},value:{status:"valid",value:a.data[b]}});else if(p==="strict")s.length>0&&(C(a,{code:_.unrecognized_keys,keys:s}),i.dirty());else if(p!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let p=this._def.catchall;for(let b of s){let M=a.data[b];v.push({key:{status:"valid",value:b},value:p._parse(new ct(a,M,a.path,b)),alwaysSet:b in a.data})}}return a.common.async?Promise.resolve().then(async()=>{let p=[];for(let b of v){let M=await b.key,R=await b.value;p.push({key:M,value:R,alwaysSet:b.alwaysSet})}return p}).then(p=>Be.mergeObjectSync(i,p)):Be.mergeObjectSync(i,v)}get shape(){return this._def.shape()}strict(e){return D.errToObj,new t({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(n,i)=>{let a=this._def.errorMap?.(n,i).message??i.defaultError;return n.code==="unrecognized_keys"?{message:D.errToObj(e).message??a}:{message:a}}}:{}})}strip(){return new t({...this._def,unknownKeys:"strip"})}passthrough(){return new t({...this._def,unknownKeys:"passthrough"})}extend(e){return new t({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new t({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:z.ZodObject})}setKey(e,n){return this.augment({[e]:n})}catchall(e){return new t({...this._def,catchall:e})}pick(e){let n={};for(let i of K.objectKeys(e))e[i]&&this.shape[i]&&(n[i]=this.shape[i]);return new t({...this._def,shape:()=>n})}omit(e){let n={};for(let i of K.objectKeys(this.shape))e[i]||(n[i]=this.shape[i]);return new t({...this._def,shape:()=>n})}deepPartial(){return Gn(this)}partial(e){let n={};for(let i of K.objectKeys(this.shape)){let a=this.shape[i];e&&!e[i]?n[i]=a:n[i]=a.optional()}return new t({...this._def,shape:()=>n})}required(e){let n={};for(let i of K.objectKeys(this.shape))if(e&&!e[i])n[i]=this.shape[i];else{let r=this.shape[i];for(;r instanceof lt;)r=r._def.innerType;n[i]=r}return new t({...this._def,shape:()=>n})}keyof(){return ba(K.objectKeys(this.shape))}};We.create=(t,e)=>new We({shape:()=>t,unknownKeys:"strip",catchall:xt.create(),typeName:z.ZodObject,...U(e)});We.strictCreate=(t,e)=>new We({shape:()=>t,unknownKeys:"strict",catchall:xt.create(),typeName:z.ZodObject,...U(e)});We.lazycreate=(t,e)=>new We({shape:t,unknownKeys:"strip",catchall:xt.create(),typeName:z.ZodObject,...U(e)});var mn=class extends G{_parse(e){let{ctx:n}=this._processInputParams(e),i=this._def.options;function a(r){for(let s of r)if(s.result.status==="valid")return s.result;for(let s of r)if(s.result.status==="dirty")return n.common.issues.push(...s.ctx.common.issues),s.result;let l=r.map(s=>new Ze(s.ctx.common.issues));return C(n,{code:_.invalid_union,unionErrors:l}),O}if(n.common.async)return Promise.all(i.map(async r=>{let l={...n,common:{...n.common,issues:[]},parent:null};return{result:await r._parseAsync({data:n.data,path:n.path,parent:l}),ctx:l}})).then(a);{let r,l=[];for(let v of i){let p={...n,common:{...n.common,issues:[]},parent:null},b=v._parseSync({data:n.data,path:n.path,parent:p});if(b.status==="valid")return b;b.status==="dirty"&&!r&&(r={result:b,ctx:p}),p.common.issues.length&&l.push(p.common.issues)}if(r)return n.common.issues.push(...r.ctx.common.issues),r.result;let s=l.map(v=>new Ze(v));return C(n,{code:_.invalid_union,unionErrors:s}),O}}get options(){return this._def.options}};mn.create=(t,e)=>new mn({options:t,typeName:z.ZodUnion,...U(e)});var Ot=t=>t instanceof hn?Ot(t.schema):t instanceof ut?Ot(t.innerType()):t instanceof gn?[t.value]:t instanceof yn?t.options:t instanceof vn?K.objectValues(t.enum):t instanceof xn?Ot(t._def.innerType):t instanceof dn?[void 0]:t instanceof fn?[null]:t instanceof lt?[void 0,...Ot(t.unwrap())]:t instanceof Et?[null,...Ot(t.unwrap())]:t instanceof yr||t instanceof wn?Ot(t.unwrap()):t instanceof bn?Ot(t._def.innerType):[],ri=class t extends G{_parse(e){let{ctx:n}=this._processInputParams(e);if(n.parsedType!==L.object)return C(n,{code:_.invalid_type,expected:L.object,received:n.parsedType}),O;let i=this.discriminator,a=n.data[i],r=this.optionsMap.get(a);return r?n.common.async?r._parseAsync({data:n.data,path:n.path,parent:n}):r._parseSync({data:n.data,path:n.path,parent:n}):(C(n,{code:_.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[i]}),O)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,n,i){let a=new Map;for(let r of n){let l=Ot(r.shape[e]);if(!l.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let s of l){if(a.has(s))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(s)}`);a.set(s,r)}}return new t({typeName:z.ZodDiscriminatedUnion,discriminator:e,options:n,optionsMap:a,...U(i)})}};function Mi(t,e){let n=Tt(t),i=Tt(e);if(t===e)return{valid:!0,data:t};if(n===L.object&&i===L.object){let a=K.objectKeys(e),r=K.objectKeys(t).filter(s=>a.indexOf(s)!==-1),l={...t,...e};for(let s of r){let v=Mi(t[s],e[s]);if(!v.valid)return{valid:!1};l[s]=v.data}return{valid:!0,data:l}}else if(n===L.array&&i===L.array){if(t.length!==e.length)return{valid:!1};let a=[];for(let r=0;r<t.length;r++){let l=t[r],s=e[r],v=Mi(l,s);if(!v.valid)return{valid:!1};a.push(v.data)}return{valid:!0,data:a}}else return n===L.date&&i===L.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}var pn=class extends G{_parse(e){let{status:n,ctx:i}=this._processInputParams(e),a=(r,l)=>{if(ti(r)||ti(l))return O;let s=Mi(r.value,l.value);return s.valid?((ni(r)||ni(l))&&n.dirty(),{status:n.value,value:s.data}):(C(i,{code:_.invalid_intersection_types}),O)};return i.common.async?Promise.all([this._def.left._parseAsync({data:i.data,path:i.path,parent:i}),this._def.right._parseAsync({data:i.data,path:i.path,parent:i})]).then(([r,l])=>a(r,l)):a(this._def.left._parseSync({data:i.data,path:i.path,parent:i}),this._def.right._parseSync({data:i.data,path:i.path,parent:i}))}};pn.create=(t,e,n)=>new pn({left:t,right:e,typeName:z.ZodIntersection,...U(n)});var _t=class t extends G{_parse(e){let{status:n,ctx:i}=this._processInputParams(e);if(i.parsedType!==L.array)return C(i,{code:_.invalid_type,expected:L.array,received:i.parsedType}),O;if(i.data.length<this._def.items.length)return C(i,{code:_.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),O;!this._def.rest&&i.data.length>this._def.items.length&&(C(i,{code:_.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),n.dirty());let r=[...i.data].map((l,s)=>{let v=this._def.items[s]||this._def.rest;return v?v._parse(new ct(i,l,i.path,s)):null}).filter(l=>!!l);return i.common.async?Promise.all(r).then(l=>Be.mergeArray(n,l)):Be.mergeArray(n,r)}get items(){return this._def.items}rest(e){return new t({...this._def,rest:e})}};_t.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new _t({items:t,typeName:z.ZodTuple,rest:null,...U(e)})};var ii=class t extends G{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:n,ctx:i}=this._processInputParams(e);if(i.parsedType!==L.object)return C(i,{code:_.invalid_type,expected:L.object,received:i.parsedType}),O;let a=[],r=this._def.keyType,l=this._def.valueType;for(let s in i.data)a.push({key:r._parse(new ct(i,s,i.path,s)),value:l._parse(new ct(i,i.data[s],i.path,s)),alwaysSet:s in i.data});return i.common.async?Be.mergeObjectAsync(n,a):Be.mergeObjectSync(n,a)}get element(){return this._def.valueType}static create(e,n,i){return n instanceof G?new t({keyType:e,valueType:n,typeName:z.ZodRecord,...U(i)}):new t({keyType:Vt.create(),valueType:e,typeName:z.ZodRecord,...U(n)})}},Zn=class extends G{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:n,ctx:i}=this._processInputParams(e);if(i.parsedType!==L.map)return C(i,{code:_.invalid_type,expected:L.map,received:i.parsedType}),O;let a=this._def.keyType,r=this._def.valueType,l=[...i.data.entries()].map(([s,v],p)=>({key:a._parse(new ct(i,s,i.path,[p,"key"])),value:r._parse(new ct(i,v,i.path,[p,"value"]))}));if(i.common.async){let s=new Map;return Promise.resolve().then(async()=>{for(let v of l){let p=await v.key,b=await v.value;if(p.status==="aborted"||b.status==="aborted")return O;(p.status==="dirty"||b.status==="dirty")&&n.dirty(),s.set(p.value,b.value)}return{status:n.value,value:s}})}else{let s=new Map;for(let v of l){let p=v.key,b=v.value;if(p.status==="aborted"||b.status==="aborted")return O;(p.status==="dirty"||b.status==="dirty")&&n.dirty(),s.set(p.value,b.value)}return{status:n.value,value:s}}}};Zn.create=(t,e,n)=>new Zn({valueType:e,keyType:t,typeName:z.ZodMap,...U(n)});var Wn=class t extends G{_parse(e){let{status:n,ctx:i}=this._processInputParams(e);if(i.parsedType!==L.set)return C(i,{code:_.invalid_type,expected:L.set,received:i.parsedType}),O;let a=this._def;a.minSize!==null&&i.data.size<a.minSize.value&&(C(i,{code:_.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),n.dirty()),a.maxSize!==null&&i.data.size>a.maxSize.value&&(C(i,{code:_.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),n.dirty());let r=this._def.valueType;function l(v){let p=new Set;for(let b of v){if(b.status==="aborted")return O;b.status==="dirty"&&n.dirty(),p.add(b.value)}return{status:n.value,value:p}}let s=[...i.data.values()].map((v,p)=>r._parse(new ct(i,v,i.path,p)));return i.common.async?Promise.all(s).then(v=>l(v)):l(s)}min(e,n){return new t({...this._def,minSize:{value:e,message:D.toString(n)}})}max(e,n){return new t({...this._def,maxSize:{value:e,message:D.toString(n)}})}size(e,n){return this.min(e,n).max(e,n)}nonempty(e){return this.min(1,e)}};Wn.create=(t,e)=>new Wn({valueType:t,minSize:null,maxSize:null,typeName:z.ZodSet,...U(e)});var ai=class t extends G{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:n}=this._processInputParams(e);if(n.parsedType!==L.function)return C(n,{code:_.invalid_type,expected:L.function,received:n.parsedType}),O;function i(s,v){return gr({data:s,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,Hn(),Rt].filter(p=>!!p),issueData:{code:_.invalid_arguments,argumentsError:v}})}function a(s,v){return gr({data:s,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,Hn(),Rt].filter(p=>!!p),issueData:{code:_.invalid_return_type,returnTypeError:v}})}let r={errorMap:n.common.contextualErrorMap},l=n.data;if(this._def.returns instanceof Zt){let s=this;return Ne(async function(...v){let p=new Ze([]),b=await s._def.args.parseAsync(v,r).catch(j=>{throw p.addIssue(i(v,j)),p}),M=await Reflect.apply(l,this,b);return await s._def.returns._def.type.parseAsync(M,r).catch(j=>{throw p.addIssue(a(M,j)),p})})}else{let s=this;return Ne(function(...v){let p=s._def.args.safeParse(v,r);if(!p.success)throw new Ze([i(v,p.error)]);let b=Reflect.apply(l,this,p.data),M=s._def.returns.safeParse(b,r);if(!M.success)throw new Ze([a(b,M.error)]);return M.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new t({...this._def,args:_t.create(e).rest(Pt.create())})}returns(e){return new t({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,n,i){return new t({args:e||_t.create([]).rest(Pt.create()),returns:n||Pt.create(),typeName:z.ZodFunction,...U(i)})}},hn=class extends G{get schema(){return this._def.getter()}_parse(e){let{ctx:n}=this._processInputParams(e);return this._def.getter()._parse({data:n.data,path:n.path,parent:n})}};hn.create=(t,e)=>new hn({getter:t,typeName:z.ZodLazy,...U(e)});var gn=class extends G{_parse(e){if(e.data!==this._def.value){let n=this._getOrReturnCtx(e);return C(n,{received:n.data,code:_.invalid_literal,expected:this._def.value}),O}return{status:"valid",value:e.data}}get value(){return this._def.value}};gn.create=(t,e)=>new gn({value:t,typeName:z.ZodLiteral,...U(e)});function ba(t,e){return new yn({values:t,typeName:z.ZodEnum,...U(e)})}var yn=class t extends G{_parse(e){if(typeof e.data!="string"){let n=this._getOrReturnCtx(e),i=this._def.values;return C(n,{expected:K.joinValues(i),received:n.parsedType,code:_.invalid_type}),O}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let n=this._getOrReturnCtx(e),i=this._def.values;return C(n,{received:n.data,code:_.invalid_enum_value,options:i}),O}return Ne(e.data)}get options(){return this._def.values}get enum(){let e={};for(let n of this._def.values)e[n]=n;return e}get Values(){let e={};for(let n of this._def.values)e[n]=n;return e}get Enum(){let e={};for(let n of this._def.values)e[n]=n;return e}extract(e,n=this._def){return t.create(e,{...this._def,...n})}exclude(e,n=this._def){return t.create(this.options.filter(i=>!e.includes(i)),{...this._def,...n})}};yn.create=ba;var vn=class extends G{_parse(e){let n=K.getValidEnumValues(this._def.values),i=this._getOrReturnCtx(e);if(i.parsedType!==L.string&&i.parsedType!==L.number){let a=K.objectValues(n);return C(i,{expected:K.joinValues(a),received:i.parsedType,code:_.invalid_type}),O}if(this._cache||(this._cache=new Set(K.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let a=K.objectValues(n);return C(i,{received:i.data,code:_.invalid_enum_value,options:a}),O}return Ne(e.data)}get enum(){return this._def.values}};vn.create=(t,e)=>new vn({values:t,typeName:z.ZodNativeEnum,...U(e)});var Zt=class extends G{unwrap(){return this._def.type}_parse(e){let{ctx:n}=this._processInputParams(e);if(n.parsedType!==L.promise&&n.common.async===!1)return C(n,{code:_.invalid_type,expected:L.promise,received:n.parsedType}),O;let i=n.parsedType===L.promise?n.data:Promise.resolve(n.data);return Ne(i.then(a=>this._def.type.parseAsync(a,{path:n.path,errorMap:n.common.contextualErrorMap})))}};Zt.create=(t,e)=>new Zt({type:t,typeName:z.ZodPromise,...U(e)});var ut=class extends G{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===z.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:n,ctx:i}=this._processInputParams(e),a=this._def.effect||null,r={addIssue:l=>{C(i,l),l.fatal?n.abort():n.dirty()},get path(){return i.path}};if(r.addIssue=r.addIssue.bind(r),a.type==="preprocess"){let l=a.transform(i.data,r);if(i.common.async)return Promise.resolve(l).then(async s=>{if(n.value==="aborted")return O;let v=await this._def.schema._parseAsync({data:s,path:i.path,parent:i});return v.status==="aborted"?O:v.status==="dirty"?sn(v.value):n.value==="dirty"?sn(v.value):v});{if(n.value==="aborted")return O;let s=this._def.schema._parseSync({data:l,path:i.path,parent:i});return s.status==="aborted"?O:s.status==="dirty"?sn(s.value):n.value==="dirty"?sn(s.value):s}}if(a.type==="refinement"){let l=s=>{let v=a.refinement(s,r);if(i.common.async)return Promise.resolve(v);if(v instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return s};if(i.common.async===!1){let s=this._def.schema._parseSync({data:i.data,path:i.path,parent:i});return s.status==="aborted"?O:(s.status==="dirty"&&n.dirty(),l(s.value),{status:n.value,value:s.value})}else return this._def.schema._parseAsync({data:i.data,path:i.path,parent:i}).then(s=>s.status==="aborted"?O:(s.status==="dirty"&&n.dirty(),l(s.value).then(()=>({status:n.value,value:s.value}))))}if(a.type==="transform")if(i.common.async===!1){let l=this._def.schema._parseSync({data:i.data,path:i.path,parent:i});if(!Gt(l))return O;let s=a.transform(l.value,r);if(s instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:n.value,value:s}}else return this._def.schema._parseAsync({data:i.data,path:i.path,parent:i}).then(l=>Gt(l)?Promise.resolve(a.transform(l.value,r)).then(s=>({status:n.value,value:s})):O);K.assertNever(a)}};ut.create=(t,e,n)=>new ut({schema:t,typeName:z.ZodEffects,effect:e,...U(n)});ut.createWithPreprocess=(t,e,n)=>new ut({schema:e,effect:{type:"preprocess",transform:t},typeName:z.ZodEffects,...U(n)});var lt=class extends G{_parse(e){return this._getType(e)===L.undefined?Ne(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};lt.create=(t,e)=>new lt({innerType:t,typeName:z.ZodOptional,...U(e)});var Et=class extends G{_parse(e){return this._getType(e)===L.null?Ne(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Et.create=(t,e)=>new Et({innerType:t,typeName:z.ZodNullable,...U(e)});var xn=class extends G{_parse(e){let{ctx:n}=this._processInputParams(e),i=n.data;return n.parsedType===L.undefined&&(i=this._def.defaultValue()),this._def.innerType._parse({data:i,path:n.path,parent:n})}removeDefault(){return this._def.innerType}};xn.create=(t,e)=>new xn({innerType:t,typeName:z.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...U(e)});var bn=class extends G{_parse(e){let{ctx:n}=this._processInputParams(e),i={...n,common:{...n.common,issues:[]}},a=this._def.innerType._parse({data:i.data,path:i.path,parent:{...i}});return Un(a)?a.then(r=>({status:"valid",value:r.status==="valid"?r.value:this._def.catchValue({get error(){return new Ze(i.common.issues)},input:i.data})})):{status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new Ze(i.common.issues)},input:i.data})}}removeCatch(){return this._def.innerType}};bn.create=(t,e)=>new bn({innerType:t,typeName:z.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...U(e)});var Yn=class extends G{_parse(e){if(this._getType(e)!==L.nan){let i=this._getOrReturnCtx(e);return C(i,{code:_.invalid_type,expected:L.nan,received:i.parsedType}),O}return{status:"valid",value:e.data}}};Yn.create=t=>new Yn({typeName:z.ZodNaN,...U(t)});var lo=Symbol("zod_brand"),yr=class extends G{_parse(e){let{ctx:n}=this._processInputParams(e),i=n.data;return this._def.type._parse({data:i,path:n.path,parent:n})}unwrap(){return this._def.type}},vr=class t extends G{_parse(e){let{status:n,ctx:i}=this._processInputParams(e);if(i.common.async)return(async()=>{let r=await this._def.in._parseAsync({data:i.data,path:i.path,parent:i});return r.status==="aborted"?O:r.status==="dirty"?(n.dirty(),sn(r.value)):this._def.out._parseAsync({data:r.value,path:i.path,parent:i})})();{let a=this._def.in._parseSync({data:i.data,path:i.path,parent:i});return a.status==="aborted"?O:a.status==="dirty"?(n.dirty(),{status:"dirty",value:a.value}):this._def.out._parseSync({data:a.value,path:i.path,parent:i})}}static create(e,n){return new t({in:e,out:n,typeName:z.ZodPipeline})}},wn=class extends G{_parse(e){let n=this._def.innerType._parse(e),i=a=>(Gt(a)&&(a.value=Object.freeze(a.value)),a);return Un(n)?n.then(a=>i(a)):i(n)}unwrap(){return this._def.innerType}};wn.create=(t,e)=>new wn({innerType:t,typeName:z.ZodReadonly,...U(e)});function ga(t,e){let n=typeof t=="function"?t(e):typeof t=="string"?{message:t}:t;return typeof n=="string"?{message:n}:n}function wa(t,e={},n){return t?qt.create().superRefine((i,a)=>{let r=t(i);if(r instanceof Promise)return r.then(l=>{if(!l){let s=ga(e,i),v=s.fatal??n??!0;a.addIssue({code:"custom",...s,fatal:v})}});if(!r){let l=ga(e,i),s=l.fatal??n??!0;a.addIssue({code:"custom",...l,fatal:s})}}):qt.create()}var co={object:We.lazycreate},z;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(z||(z={}));var uo=(t,e={message:`Input not instance of ${t.name}`})=>wa(n=>n instanceof t,e),ka=Vt.create,Ta=on.create,fo=Yn.create,mo=ln.create,_a=cn.create,po=un.create,ho=Vn.create,go=dn.create,yo=fn.create,vo=qt.create,xo=Pt.create,bo=xt.create,wo=qn.create,ko=zt.create,To=We.create,_o=We.strictCreate,Eo=mn.create,So=ri.create,Co=pn.create,Lo=_t.create,Io=ii.create,Ao=Zn.create,Mo=Wn.create,Do=ai.create,Bo=hn.create,Ro=gn.create,Oo=yn.create,Po=vn.create,zo=Zt.create,No=ut.create,$o=lt.create,Fo=Et.create,jo=ut.createWithPreprocess,Ho=vr.create,Uo=()=>ka().optional(),Go=()=>Ta().optional(),Vo=()=>_a().optional(),qo={string:(t=>Vt.create({...t,coerce:!0})),number:(t=>on.create({...t,coerce:!0})),boolean:(t=>cn.create({...t,coerce:!0})),bigint:(t=>ln.create({...t,coerce:!0})),date:(t=>un.create({...t,coerce:!0}))};var Zo=O;function d(t,...e){let n="debug",i=[...e];e.length>0&&typeof e[e.length-1]=="string"&&["debug","info","warn","error"].includes(e[e.length-1])&&(n=i.pop());let r=`[Timekeeper v${GM_info.script.version}]`;({debug:console.log,info:console.info,warn:console.warn,error:console.error})[n](`${r} ${t}`,...i)}function Wt(t,e=t){let n=Math.floor(t/3600),i=Math.floor(t%3600/60),a=String(t%60).padStart(2,"0");return e<3600?`${i<10?i:String(i).padStart(2,"0")}:${a}`:`${e>=36e3?String(n).padStart(2,"0"):n}:${String(i).padStart(2,"0")}:${a}`}function Di(t,e=window.location.href){try{let n=new URL(e);return n.searchParams.set("t",`${t}s`),n.toString()}catch{return`https://www.youtube.com/watch?v=${e.search(/[?&]v=/)>=0?e.split(/[?&]v=/)[1].split(/&/)[0]:e.split(/\/live\/|\/shorts\/|\?|&/)[1]}&t=${t}s`}}function xr(){let t=new Date;return t.getUTCFullYear()+"-"+String(t.getUTCMonth()+1).padStart(2,"0")+"-"+String(t.getUTCDate()).padStart(2,"0")+"--"+String(t.getUTCHours()).padStart(2,"0")+"-"+String(t.getUTCMinutes()).padStart(2,"0")+"-"+String(t.getUTCSeconds()).padStart(2,"0")}var Wo=[{emoji:"\u{1F942}",month:1,day:1,name:"New Year's Day"},{emoji:"\u{1F49D}",month:2,day:14,name:"Valentine's Day"},{emoji:"\u{1F986}",month:5,day:25,name:"Kanna's Debut Anniversary"},{emoji:"\u{1F383}",month:10,day:31,name:"Halloween"},{emoji:"\u{1F382}",month:9,day:15,name:"Kanna's Birthday"},{emoji:"\u{1F332}",month:12,day:25,name:"Christmas"}];function Ea(){let t=new Date,e=t.getFullYear(),n=t.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});for(let i of Wo){let a=new Date(e,i.month-1,i.day),r=a.getTime()-t.getTime(),l=r/(1e3*60*60*24);if(l<=5&&l>=-2)return d(`Current date: ${n}, Selected emoji: ${i.emoji} (${i.name}), Days until holiday: ${Math.ceil(l)}`),i.emoji;if(l<-2&&(a=new Date(e+1,i.month-1,i.day),r=a.getTime()-t.getTime(),l=r/(1e3*60*60*24),l<=5&&l>=-2))return d(`Current date: ${n}, Selected emoji: ${i.emoji} (${i.name}), Days until holiday: ${Math.ceil(l)}`),i.emoji;if(l>5&&(a=new Date(e-1,i.month-1,i.day),r=a.getTime()-t.getTime(),l=r/(1e3*60*60*24),l<=5&&l>=-2))return d(`Current date: ${n}, Selected emoji: ${i.emoji} (${i.name}), Days until holiday: ${Math.ceil(l)}`),i.emoji}return d(`Current date: ${n}, No holiday emoji (not within range)`),null}var dt=null,Kn=null,Yo=500,kn=null,br=!1,Yt=null;function Ko(){return(!dt||!document.body.contains(dt))&&(dt=document.createElement("div"),dt.className="ytls-tooltip",dt.style.pointerEvents="none",document.body.appendChild(dt),window.addEventListener("scroll",Sa,!0),window.addEventListener("resize",Sa,!0)),dt}function Jo(t,e,n){let a=window.innerWidth,r=window.innerHeight,l=t.getBoundingClientRect(),s=l.width,v=l.height,p=e+10,b=n+10;p+s>a-10&&(p=e-s-10),b+v>r-10&&(b=n-v-10),p=Math.max(10,Math.min(p,a-s-10)),b=Math.max(10,Math.min(b,r-v-10)),t.style.left=`${p}px`,t.style.top=`${b}px`}function Ca(t,e){let i=window.innerWidth,a=window.innerHeight,r=e.getBoundingClientRect(),l=t.getBoundingClientRect(),s=l.width,v=l.height,p=Math.round(r.right+8),b=Math.round(r.top);p+s>i-8&&(p=Math.round(r.left-s-8)),p=Math.max(8,Math.min(p,i-s-8)),b+v>a-8&&(b=Math.round(r.bottom-v)),b=Math.max(8,Math.min(b,a-v-8)),t.style.left=`${p}px`,t.style.top=`${b}px`}function Sa(){if(!(!dt||!kn)&&dt.classList.contains("ytls-tooltip-visible"))try{Ca(dt,kn)}catch{}}function Xo(t=50){Yt&&(clearTimeout(Yt),Yt=null),!br&&(Yt=setTimeout(()=>{Bi(),Yt=null},t))}function Qo(t,e,n,i){Kn&&clearTimeout(Kn),i&&(kn=i,br=!0),Kn=setTimeout(()=>{let a=Ko();a.textContent=t,a.classList.remove("ytls-tooltip-visible"),i?requestAnimationFrame(()=>{Ca(a,i),requestAnimationFrame(()=>{a.classList.add("ytls-tooltip-visible")})}):(Jo(a,e,n),requestAnimationFrame(()=>{a.classList.add("ytls-tooltip-visible")}))},Yo)}function Bi(){Kn&&(clearTimeout(Kn),Kn=null),Yt&&(clearTimeout(Yt),Yt=null),dt&&dt.classList.remove("ytls-tooltip-visible"),kn=null,br=!1}function bt(t,e){let n=0,i=0,a=v=>{n=v.clientX,i=v.clientY,br=!0,kn=t;let p=typeof e=="function"?e():e;p&&Qo(p,n,i,t)},r=v=>{n=v.clientX,i=v.clientY},l=()=>{br=!1,Xo()};t.addEventListener("mouseenter",a),t.addEventListener("mousemove",r),t.addEventListener("mouseleave",l);let s=new MutationObserver(()=>{try{if(!document.body.contains(t))kn===t&&Bi();else{let v=window.getComputedStyle(t);(v.display==="none"||v.visibility==="hidden"||v.opacity==="0")&&kn===t&&Bi()}}catch{}});try{s.observe(t,{attributes:!0,attributeFilter:["class","style"]}),s.observe(document.body,{childList:!0,subtree:!0})}catch{}t.__tooltipCleanup=()=>{t.removeEventListener("mouseenter",a),t.removeEventListener("mousemove",r),t.removeEventListener("mouseleave",l);try{s.disconnect()}catch{}delete t.__tooltipObserver},t.__tooltipObserver=s}var La=`
  #ytls-pane {
    background: rgba(19, 19, 19, 0.8);
    text-align: left;
    position: fixed;
    bottom: 0;
    right: 0;
    padding: 0;
    margin: 0;
    border-radius: 12px; /* Add rounded corners */
    border: 1px solid rgba(85, 85, 85, 0.8); /* Add a thin grey border */
    opacity: 0.9;
    z-index: 5000;
    font-family: Arial, sans-serif;
    width: 300px;
    height: 90vh;
    min-width: 300px;
    max-width: 800px;
    min-height: 400px;
    max-height: 90vh;
    user-select: none; /* Prevent text selection in pane */
    display: flex;
    flex-direction: column;
    will-change: width, height;
    transform: translateZ(0);
    backface-visibility: hidden;
    contain: layout style paint;
    overflow: hidden;
  }
  #ytls-pane:hover {
    opacity: 1;
  }
  /* Legacy corner handle: keep element for resize behavior but hide visual indicator */
  /* Legacy corner handle kept for compatibility but hidden visually */
  #ytls-resize-handle {
    position: absolute;
    bottom: 0;
    right: 0;
    width: 20px;
    height: 20px;
    cursor: auto; /* no visible corner cursor */
    z-index: 10;
    pointer-events: none; /* legacy handle inactive, corners handle events */
    background: transparent;
    margin: 0;
    padding: 0;
  }
  #ytls-resize-handle::before {
    display: none; /* remove the triangular corner indicator */
    content: none;
  }

  /* Corner handles for diagonal resize */
  #ytls-resize-tl,
  #ytls-resize-tr,
  #ytls-resize-bl,
  #ytls-resize-br {
    position: absolute;
    /* Use 16px click areas for corner resize handlers to match touch targets and reduce accidental drags */
    width: 16px;
    height: 16px;
    z-index: 11;
    background: transparent;
    pointer-events: auto;
  }
  #ytls-resize-tl { top: 0; left: 0; cursor: nwse-resize; }
  #ytls-resize-tr { top: 0; right: 0; cursor: nesw-resize; }
  #ytls-resize-bl { bottom: 0; left: 0; cursor: nesw-resize; }
  #ytls-resize-br { bottom: 0; right: 0; cursor: nwse-resize; }
  #ytls-content {
    display: flex;
    flex-direction: column;
    width: 100%;
    height: 100%;
    min-height: 0;
    box-sizing: border-box;
    position: relative;
  }
  #ytls-content ul {
    flex: 1 1 auto;
    overflow-y: auto;
    margin: 0 !important;
    padding: 0 !important;
    border: none !important;
    box-sizing: border-box;
    width: 100%;
    max-width: 100%;
    min-height: 0;
    z-index: 1;
  }

  /* Placeholder message shown centered in the list area while loading or when empty */
  #ytls-content ul li.ytls-placeholder {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
    width: 100%;
    color: #bfbfbf;
    font-size: 14px;
    font-style: italic;
    padding: 12px;
    text-align: center;
    box-sizing: border-box;
  }
  #ytls-pane-header {
    position: relative;
    z-index: 2;
  }
  #ytls-buttons {
    position: relative;
    z-index: 2;
    flex-shrink: 0;
    display: flex;
    gap: 8px;
    justify-content: flex-end;
    padding: 10px 18px 10px 16px;
    background: linear-gradient(0deg, #23272b 0%, #212121 100%);
    border-radius: 0 0 12px 12px;
    border-top: 1px solid #23272b;
    margin-top: auto;
  }
  #ytls-pane li {
    display: flex;
    flex-direction: column;
    padding: 8px 12px;
    margin: 0 !important;
    border: none;
    border-top: 1px solid rgba(85, 85, 85, 0.8);
    user-select: none; /* Prevent text selection in timestamp items */
    box-sizing: border-box;
    width: 100%;
    max-width: 100%;
  }
  #ytls-pane li:first-child {
    border-top: none;
  }
  #ytls-pane li.ytls-timestamp-highlight {
    background: rgb(31, 37, 29);
  }
  #ytls-pane li.ytls-timestamp-pending-delete {
    background: rgba(128, 0, 0, 0.8);
  }
  #ytls-pane .time-row {
    display: flex;
    gap: 5px;
    align-items: center;
  }
  #ytls-pane .time-row a {
    flex-grow: 1; /* Allow the timestamp text to take up available space */
    max-width: 100%; /* Constrain the width to the parent container */
    text-align: left; /* Align the text to the left */
    overflow: hidden; /* Prevent overflow */
    text-overflow: ellipsis; /* Add ellipsis for long text */
    white-space: nowrap; /* Prevent wrapping */
  }
  #ytls-pane .ytls-marker {
    position: absolute;
    height: 100%;
    width: 2px;
    background-color: #ff0000;
    cursor: pointer;
  }
  #ytls-pane span,
  #ytls-pane a,
  #ytls-pane input {
    background: none;
    color: white;
    font-family: inherit;
    font-size: 14px;
    text-decoration: none;
    border: none;
    outline: none;
  }
  /* Ensure editing controls behave like editable fields despite parent user-select:none */
  #ytls-pane input,
  #ytls-pane textarea {
    -webkit-user-select: text;
    -moz-user-select: text;
    -ms-user-select: text;
    user-select: text;
    caret-color: white;
  }
  #ytls-buttons {
    flex-shrink: 0;
    display: flex;
    gap: 5px;
    justify-content: space-between;
    padding: 8px 12px;
    background: rgb(33, 33, 33);
    border-radius: 0 0 12px 12px;
    border-top: 1px solid rgba(85, 85, 85, 0.8);
    z-index: 2;
    /* Ensure it stays at the bottom */
  }
  #ytls-buttons button:hover {
    background: rgba(255, 255, 255, 0.2);
  }

  /* Styles for main control buttons */
  .ytls-main-button {
    background: rgb(39, 39, 39);
    color: white;
    font-size: 24px;
    border: none;
    border-radius: 5px;
    padding: 5px;
    cursor: pointer;
    position: relative;
  }
  .ytls-main-button:hover {
    background: rgb(63, 63, 63);
  }
  .ytls-holiday-emoji {
    position: absolute;
    bottom: 0;
    right: 0;
    font-size: 0.25em;
    pointer-events: none;
  }

  /* Pane header and utility styles */
  #ytls-pane-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 18px 10px 16px;
    white-space: nowrap;
    cursor: default;
    border-radius: 12px 12px 0 0;
    border: none;
    background: linear-gradient(180deg, #23272b 0%, #212121 100%);
    box-shadow: 0 1px 0 0 #23272b;
    flex-shrink: 0;
    color: #fafafa;
  }
  #ytls-pane .ytls-version-display {
    font-size:14px;
    color:#666;
    margin-left:auto;
    padding-right:5px;
    cursor:default;
  }
  #ytls-pane .ytls-google-user-display {
    font-size:12px;
    color:#4285f4;
    margin-left:8px;
    padding:2px 6px;
    cursor:default;
    background:rgba(66, 133, 244, 0.1);
    border-radius:4px;
  }
  #ytls-pane .ytls-backup-status-display {
    font-size:12px;
    color:#9acd32; /* yellowgreen */
    margin-left:8px;
    padding:2px 6px;
    cursor:default;
    background:rgba(154, 205, 50, 0.12);
    border-radius:4px;
  }
  #ytls-current-time {
    color:white;
    font-size:14px;
    cursor:pointer;
    position:relative;
  }

  /* Backup status indicator (colored dot) */
  .ytls-backup-indicator {
    display:inline-block;
    width:8px;
    height:8px;
    border-radius:50%;
    background-color:#666;
    cursor:help;
    flex-shrink:0;
  }

  /* Shared modal container styles */
  #ytls-settings-modal {
    position:fixed;
    top:50%;
    left:50%;
    transform:translate(-50%, -50%);
    background:#1a1a1a;
    padding:8px;
    border-radius:10px;
    z-index:10000;
    color:white;
    text-align:center;
    width:200px;
    box-shadow:0 0 10px rgba(0,0,0,0.5);
  }
  #ytls-save-modal,
  #ytls-load-modal,
  #ytls-delete-all-modal {
    position:fixed;
    top:50%;
    left:50%;
    transform:translate(-50%, -50%);
    background:#333;
    padding:8px;
    border-radius:10px;
    z-index:10000;
    color:white;
    text-align:center;
    width:fit-content;
    max-width:90vw;
    box-shadow:0 0 10px rgba(0,0,0,0.5);
  }

  /* Modal header with tabs and close button */
  .ytls-modal-header {
    display:flex;
    align-items:flex-end;
    margin-bottom:0;
    gap:10px;
  }

  /* Modal close button (X in header) */
  .ytls-modal-close-button {
    position:absolute;
    top:8px;
    right:8px;
    width:16px;
    height:16px;
    background:#ff4444;
    color:white;
    border:none;
    border-radius:3px;
    font-size:14px;
    font-weight:bold;
    cursor:pointer;
    display:flex;
    align-items:center;
    justify-content:center;
    line-height:1;
    padding:0;
    flex-shrink:0;
    z-index:1;
  }
  .ytls-modal-close-button:hover {
    background:#ff6666;
  }

  /* Styles for settings modal */
  #ytls-settings-content {
    display:flex;
    flex-direction:column;
    gap:10px;
    align-items:center;
    background:#2a2a2a;
    border:2px solid #3a3a3a;
    border-radius:0 4px 4px 4px;
    padding:10px;
    margin-top:-2px;
    position:relative;
    z-index:1;
  }

  /* Section heading */
  .ytls-section-heading {
    margin:0 0 10px 0;
    padding:0;
    font-size:16px;
    font-weight:bold;
    color:#fff;
    text-align:center;
  }

  /* Settings nav (tabs) */
  #ytls-settings-nav {
    display:flex;
    gap:6px;
    flex:0;
  }
  #ytls-settings-nav .ytls-settings-modal-button {
    flex:0;
    width:auto;
    height:24px;
    margin-bottom:0;
    background: #2a2a2a;
    font-size:13px;
    padding:0 8px;
    display:flex;
    align-items:center;
    justify-content:center;
    line-height:1;
    border:2px solid transparent;
    border-radius:4px 4px 0 0;
    border-bottom:2px solid transparent;
    white-space:nowrap;
    position:relative;
  }
  #ytls-settings-nav .ytls-settings-modal-button .ytls-tab-text {
    display:none;
  }
  #ytls-settings-nav .ytls-settings-modal-button.active .ytls-tab-text {
    display:inline;
  }
  #ytls-settings-nav .ytls-settings-modal-button:hover {
    background: #3a3a3a;
  }
  #ytls-settings-nav .ytls-settings-modal-button.active {
    background:#2a2a2a;
    border:2px solid #3a3a3a;
    border-bottom:2px solid #2a2a2a;
    z-index:2;
  }

  /* Button grid container */
  .ytls-button-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 5px;
    width: 100%;
  }

  /* Styles for buttons in the settings modal */
  .ytls-settings-modal-button {
    width: 100%;
    height: 32px;
    background: #555;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 13px;
    display: flex;
    justify-content: center;
    align-items: center;
    margin-bottom: 5px;
    padding: 0 8px;
  }
  .ytls-settings-modal-button:hover {
    background: #777; /* Example hover effect */
  }

  /* Shared styles for modal copy */
  #ytls-save-modal p,
  #ytls-load-modal p,
  #ytls-delete-all-modal p {
    margin-bottom:15px;
    font-size:16px;
  }
  .ytls-save-modal-button {
    background:#555;
    color:white;
    padding:10px 20px;
    border:none;
    border-radius:5px;
    cursor:pointer;
    margin-right:10px; /* Applied to both JSON and Text buttons, last one will have extra margin if not overridden */
  }
  .ytls-save-modal-button:last-of-type { /* Remove margin from the last button of this type in the modal */
    margin-right:0;
  }
  .ytls-save-modal-cancel-button {
    background:#444;
    color:white;
    padding:10px 20px;
    border:none;
    border-radius:5px;
    cursor:pointer;
    margin-top:15px;
    display:block;
    width:100%;
  }

  /* Styles for file operation buttons (Save, Load, Export, Import) if they were to be displayed directly */
  /* Note: These buttons (saveBtn, loadBtn, etc.) are not directly added to the UI with these styles. */
  /* Their onclick handlers are used by the settings modal buttons which use .ytls-settings-modal-button. */
  .ytls-file-operation-button {
    background: #555;
    color: white;
    font-size: 12px;
    padding: 5px 10px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
  }
  .ytls-file-operation-button:hover {
    background: #777; /* Example hover effect */
  }

  .ytls-hidden-file-input {
    display:none;
  }

  #ytls-header-button {
    align-items:center;
    background:transparent;
    border:none;
    color:var(--yt-spec-text-primary, currentColor);
    cursor:pointer;
    display:inline-flex;
    font-size:20px;
    height:40px;
    margin-left:6px;
    padding:0 6px;
    text-decoration:none;
  }
  #ytls-header-button:hover {
    color:var(--yt-spec-call-to-action, #3ea6ff);
  }
  #ytls-header-button:focus-visible {
    outline:2px solid var(--yt-spec-call-to-action, #3ea6ff);
    outline-offset:2px;
  }
  #ytls-header-button img {
    display:block;
    height:32px;
    max-width:48px;
    pointer-events:none;
    width:auto;
  }

  /* Shared fade animations for pane and modals */
  .ytls-fade-in {
    animation: fadeIn 0.3s ease-in-out forwards;
  }

  .ytls-fade-out {
    animation: fadeOut 0.3s ease-in-out forwards;
  }

  /* Zoom animations for pane expand/collapse */
  .ytls-zoom-in {
    animation: zoomIn 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards;
    transform-origin: center center;
  }

  .ytls-zoom-out {
    animation: zoomOut 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards;
    transform-origin: center center;
  }

  /* Fade-in animation for modals */
  @keyframes fadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  /* Fade-out animation for modals */
  @keyframes fadeOut {
    from {
      opacity: 1;
    }
    to {
      opacity: 0;
    }
  }

  /* Zoom-in animation - expand from point */
  @keyframes zoomIn {
    from {
      opacity: 0;
      transform: scale(0.1);
    }
    to {
      opacity: 1;
      transform: scale(1);
    }
  }

  /* Zoom-out animation - collapse to point */
  @keyframes zoomOut {
    from {
      opacity: 1;
      transform: scale(1);
    }
    to {
      opacity: 0;
      transform: scale(0.1);
    }
  }

  /* Custom tooltip styles */
  .ytls-tooltip {
    position: fixed;
    background: rgba(97, 97, 97, 0.92);
    color: #fff;
    padding: 8px 10px;
    border-radius: 2px;
    font-size: 12px;
    font-family: "Roboto", "Arial", sans-serif;
    font-weight: normal;
    line-height: 1.4;
    letter-spacing: 0.2px;
    z-index: 10001;
    pointer-events: none;
    white-space: pre-line;
    max-width: 300px;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
    opacity: 0;
    transition: opacity 0.2s cubic-bezier(0.0, 0.0, 0.2, 1);
  }
  .ytls-tooltip.ytls-tooltip-visible {
    opacity: 1;
  }

`;var Oe=Uint8Array,nt=Uint16Array,$i=Int32Array,Fi=new Oe([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ji=new Oe([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Ia=new Oe([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Oa=function(t,e){for(var n=new nt(31),i=0;i<31;++i)n[i]=e+=1<<t[i-1];for(var a=new $i(n[30]),i=1;i<30;++i)for(var r=n[i];r<n[i+1];++r)a[r]=r-n[i]<<5|i;return{b:n,r:a}},Pa=Oa(Fi,2),el=Pa.b,Oi=Pa.r;el[28]=258,Oi[258]=28;var za=Oa(ji,0),ac=za.b,Aa=za.r,Pi=new nt(32768);for(te=0;te<32768;++te)Nt=(te&43690)>>1|(te&21845)<<1,Nt=(Nt&52428)>>2|(Nt&13107)<<2,Nt=(Nt&61680)>>4|(Nt&3855)<<4,Pi[te]=((Nt&65280)>>8|(Nt&255)<<8)>>1;var Nt,te,Tr=(function(t,e,n){for(var i=t.length,a=0,r=new nt(e);a<i;++a)t[a]&&++r[t[a]-1];var l=new nt(e);for(a=1;a<e;++a)l[a]=l[a-1]+r[a-1]<<1;var s;if(n){s=new nt(1<<e);var v=15-e;for(a=0;a<i;++a)if(t[a])for(var p=a<<4|t[a],b=e-t[a],M=l[t[a]-1]++<<b,R=M|(1<<b)-1;M<=R;++M)s[Pi[M]>>v]=p}else for(s=new nt(i),a=0;a<i;++a)t[a]&&(s[a]=Pi[l[t[a]-1]++]>>15-t[a]);return s}),Tn=new Oe(288);for(te=0;te<144;++te)Tn[te]=8;var te;for(te=144;te<256;++te)Tn[te]=9;var te;for(te=256;te<280;++te)Tn[te]=7;var te;for(te=280;te<288;++te)Tn[te]=8;var te,si=new Oe(32);for(te=0;te<32;++te)si[te]=5;var te,tl=Tr(Tn,9,0);var nl=Tr(si,5,0);var Na=function(t){return(t+7)/8|0},$a=function(t,e,n){return(e==null||e<0)&&(e=0),(n==null||n>t.length)&&(n=t.length),new Oe(t.subarray(e,n))};var rl=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],li=function(t,e,n){var i=new Error(e||rl[t]);if(i.code=t,Error.captureStackTrace&&Error.captureStackTrace(i,li),!n)throw i;return i};var $t=function(t,e,n){n<<=e&7;var i=e/8|0;t[i]|=n,t[i+1]|=n>>8},wr=function(t,e,n){n<<=e&7;var i=e/8|0;t[i]|=n,t[i+1]|=n>>8,t[i+2]|=n>>16},Ri=function(t,e){for(var n=[],i=0;i<t.length;++i)t[i]&&n.push({s:i,f:t[i]});var a=n.length,r=n.slice();if(!a)return{t:ja,l:0};if(a==1){var l=new Oe(n[0].s+1);return l[n[0].s]=1,{t:l,l:1}}n.sort(function(_e,$e){return _e.f-$e.f}),n.push({s:-1,f:25001});var s=n[0],v=n[1],p=0,b=1,M=2;for(n[0]={s:-1,f:s.f+v.f,l:s,r:v};b!=a-1;)s=n[n[p].f<n[M].f?p++:M++],v=n[p!=b&&n[p].f<n[M].f?p++:M++],n[b++]={s:-1,f:s.f+v.f,l:s,r:v};for(var R=r[0].s,i=1;i<a;++i)r[i].s>R&&(R=r[i].s);var j=new nt(R+1),oe=zi(n[b-1],j,0);if(oe>e){var i=0,ie=0,de=oe-e,pe=1<<de;for(r.sort(function($e,ge){return j[ge.s]-j[$e.s]||$e.f-ge.f});i<a;++i){var J=r[i].s;if(j[J]>e)ie+=pe-(1<<oe-j[J]),j[J]=e;else break}for(ie>>=de;ie>0;){var xe=r[i].s;j[xe]<e?ie-=1<<e-j[xe]++-1:++i}for(;i>=0&&ie;--i){var le=r[i].s;j[le]==e&&(--j[le],++ie)}oe=e}return{t:new Oe(j),l:oe}},zi=function(t,e,n){return t.s==-1?Math.max(zi(t.l,e,n+1),zi(t.r,e,n+1)):e[t.s]=n},Ma=function(t){for(var e=t.length;e&&!t[--e];);for(var n=new nt(++e),i=0,a=t[0],r=1,l=function(v){n[i++]=v},s=1;s<=e;++s)if(t[s]==a&&s!=e)++r;else{if(!a&&r>2){for(;r>138;r-=138)l(32754);r>2&&(l(r>10?r-11<<5|28690:r-3<<5|12305),r=0)}else if(r>3){for(l(a),--r;r>6;r-=6)l(8304);r>2&&(l(r-3<<5|8208),r=0)}for(;r--;)l(a);r=1,a=t[s]}return{c:n.subarray(0,i),n:e}},kr=function(t,e){for(var n=0,i=0;i<e.length;++i)n+=t[i]*e[i];return n},Fa=function(t,e,n){var i=n.length,a=Na(e+2);t[a]=i&255,t[a+1]=i>>8,t[a+2]=t[a]^255,t[a+3]=t[a+1]^255;for(var r=0;r<i;++r)t[a+r+4]=n[r];return(a+4+i)*8},Da=function(t,e,n,i,a,r,l,s,v,p,b){$t(e,b++,n),++a[256];for(var M=Ri(a,15),R=M.t,j=M.l,oe=Ri(r,15),ie=oe.t,de=oe.l,pe=Ma(R),J=pe.c,xe=pe.n,le=Ma(ie),_e=le.c,$e=le.n,ge=new nt(19),Q=0;Q<J.length;++Q)++ge[J[Q]&31];for(var Q=0;Q<_e.length;++Q)++ge[_e[Q]&31];for(var V=Ri(ge,7),ye=V.t,be=V.l,ve=19;ve>4&&!ye[Ia[ve-1]];--ve);var Ke=p+5<<3,Pe=kr(a,Tn)+kr(r,si)+l,Ue=kr(a,R)+kr(r,ie)+l+14+3*ve+kr(ge,ye)+2*ge[16]+3*ge[17]+7*ge[18];if(v>=0&&Ke<=Pe&&Ke<=Ue)return Fa(e,b,t.subarray(v,v+p));var at,we,Ge,kt;if($t(e,b,1+(Ue<Pe)),b+=2,Ue<Pe){at=Tr(R,j,0),we=R,Ge=Tr(ie,de,0),kt=ie;var St=Tr(ye,be,0);$t(e,b,xe-257),$t(e,b+5,$e-1),$t(e,b+10,ve-4),b+=14;for(var Q=0;Q<ve;++Q)$t(e,b+3*Q,ye[Ia[Q]]);b+=3*ve;for(var Ee=[J,_e],ce=0;ce<2;++ce)for(var Ct=Ee[ce],Q=0;Q<Ct.length;++Q){var st=Ct[Q]&31;$t(e,b,St[st]),b+=ye[st],st>15&&($t(e,b,Ct[Q]>>5&127),b+=Ct[Q]>>12)}}else at=tl,we=Tn,Ge=nl,kt=si;for(var Q=0;Q<s;++Q){var Se=i[Q];if(Se>255){var st=Se>>18&31;wr(e,b,at[st+257]),b+=we[st+257],st>7&&($t(e,b,Se>>23&31),b+=Fi[st]);var Lt=Se&31;wr(e,b,Ge[Lt]),b+=kt[Lt],Lt>3&&(wr(e,b,Se>>5&8191),b+=ji[Lt])}else wr(e,b,at[Se]),b+=we[Se]}return wr(e,b,at[256]),b+we[256]},il=new $i([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),ja=new Oe(0),al=function(t,e,n,i,a,r){var l=r.z||t.length,s=new Oe(i+l+5*(1+Math.ceil(l/7e3))+a),v=s.subarray(i,s.length-a),p=r.l,b=(r.r||0)&7;if(e){b&&(v[0]=r.r>>3);for(var M=il[e-1],R=M>>13,j=M&8191,oe=(1<<n)-1,ie=r.p||new nt(32768),de=r.h||new nt(oe+1),pe=Math.ceil(n/3),J=2*pe,xe=function(Ln){return(t[Ln]^t[Ln+1]<<pe^t[Ln+2]<<J)&oe},le=new $i(25e3),_e=new nt(288),$e=new nt(32),ge=0,Q=0,V=r.i||0,ye=0,be=r.w||0,ve=0;V+2<l;++V){var Ke=xe(V),Pe=V&32767,Ue=de[Ke];if(ie[Pe]=Ue,de[Ke]=Pe,be<=V){var at=l-V;if((ge>7e3||ye>24576)&&(at>423||!p)){b=Da(t,v,0,le,_e,$e,Q,ye,ve,V-ve,b),ye=ge=Q=0,ve=V;for(var we=0;we<286;++we)_e[we]=0;for(var we=0;we<30;++we)$e[we]=0}var Ge=2,kt=0,St=j,Ee=Pe-Ue&32767;if(at>2&&Ke==xe(V-Ee))for(var ce=Math.min(R,at)-1,Ct=Math.min(32767,V),st=Math.min(258,at);Ee<=Ct&&--St&&Pe!=Ue;){if(t[V+Ge]==t[V+Ge-Ee]){for(var Se=0;Se<st&&t[V+Se]==t[V+Se-Ee];++Se);if(Se>Ge){if(Ge=Se,kt=Ee,Se>ce)break;for(var Lt=Math.min(Ee,Se-2),Ir=0,we=0;we<Lt;++we){var _n=V-Ee+we&32767,gi=ie[_n],En=_n-gi&32767;En>Ir&&(Ir=En,Ue=_n)}}}Pe=Ue,Ue=ie[Pe],Ee+=Pe-Ue&32767}if(kt){le[ye++]=268435456|Oi[Ge]<<18|Aa[kt];var Sn=Oi[Ge]&31,Je=Aa[kt]&31;Q+=Fi[Sn]+ji[Je],++_e[257+Sn],++$e[Je],be=V+Ge,++ge}else le[ye++]=t[V],++_e[t[V]]}}for(V=Math.max(V,be);V<l;++V)le[ye++]=t[V],++_e[t[V]];b=Da(t,v,p,le,_e,$e,Q,ye,ve,V-ve,b),p||(r.r=b&7|v[b/8|0]<<3,b-=7,r.h=de,r.p=ie,r.i=V,r.w=be)}else{for(var V=r.w||0;V<l+p;V+=65535){var Cn=V+65535;Cn>=l&&(v[b/8|0]=p,Cn=l),b=Fa(v,b+1,t.subarray(V,Cn))}r.i=l}return $a(s,0,i+Na(b)+a)},sl=(function(){for(var t=new Int32Array(256),e=0;e<256;++e){for(var n=e,i=9;--i;)n=(n&1&&-306674912)^n>>>1;t[e]=n}return t})(),ol=function(){var t=-1;return{p:function(e){for(var n=t,i=0;i<e.length;++i)n=sl[n&255^e[i]]^n>>>8;t=n},d:function(){return~t}}};var ll=function(t,e,n,i,a){if(!a&&(a={l:1},e.dictionary)){var r=e.dictionary.subarray(-32768),l=new Oe(r.length+t.length);l.set(r),l.set(t,r.length),t=l,a.w=r.length}return al(t,e.level==null?6:e.level,e.mem==null?a.l?Math.ceil(Math.max(8,Math.min(13,Math.log(t.length)))*1.5):20:12+e.mem,n,i,a)},Ha=function(t,e){var n={};for(var i in t)n[i]=t[i];for(var i in e)n[i]=e[i];return n};var Re=function(t,e,n){for(;n;++e)t[e]=n,n>>>=8};function cl(t,e){return ll(t,e||{},0,0)}var Ua=function(t,e,n,i){for(var a in t){var r=t[a],l=e+a,s=i;Array.isArray(r)&&(s=Ha(i,r[1]),r=r[0]),r instanceof Oe?n[l]=[r,s]:(n[l+="/"]=[new Oe(0),s],Ua(r,l,n,i))}},Ba=typeof TextEncoder<"u"&&new TextEncoder,ul=typeof TextDecoder<"u"&&new TextDecoder,dl=0;try{ul.decode(ja,{stream:!0}),dl=1}catch{}function oi(t,e){if(e){for(var n=new Oe(t.length),i=0;i<t.length;++i)n[i]=t.charCodeAt(i);return n}if(Ba)return Ba.encode(t);for(var a=t.length,r=new Oe(t.length+(t.length>>1)),l=0,s=function(b){r[l++]=b},i=0;i<a;++i){if(l+5>r.length){var v=new Oe(l+8+(a-i<<1));v.set(r),r=v}var p=t.charCodeAt(i);p<128||e?s(p):p<2048?(s(192|p>>6),s(128|p&63)):p>55295&&p<57344?(p=65536+(p&1047552)|t.charCodeAt(++i)&1023,s(240|p>>18),s(128|p>>12&63),s(128|p>>6&63),s(128|p&63)):(s(224|p>>12),s(128|p>>6&63),s(128|p&63))}return $a(r,0,l)}var Ni=function(t){var e=0;if(t)for(var n in t){var i=t[n].length;i>65535&&li(9),e+=i+4}return e},Ra=function(t,e,n,i,a,r,l,s){var v=i.length,p=n.extra,b=s&&s.length,M=Ni(p);Re(t,e,l!=null?33639248:67324752),e+=4,l!=null&&(t[e++]=20,t[e++]=n.os),t[e]=20,e+=2,t[e++]=n.flag<<1|(r<0&&8),t[e++]=a&&8,t[e++]=n.compression&255,t[e++]=n.compression>>8;var R=new Date(n.mtime==null?Date.now():n.mtime),j=R.getFullYear()-1980;if((j<0||j>119)&&li(10),Re(t,e,j<<25|R.getMonth()+1<<21|R.getDate()<<16|R.getHours()<<11|R.getMinutes()<<5|R.getSeconds()>>1),e+=4,r!=-1&&(Re(t,e,n.crc),Re(t,e+4,r<0?-r-2:r),Re(t,e+8,n.size)),Re(t,e+12,v),Re(t,e+14,M),e+=16,l!=null&&(Re(t,e,b),Re(t,e+6,n.attrs),Re(t,e+10,l),e+=14),t.set(i,e),e+=v,M)for(var oe in p){var ie=p[oe],de=ie.length;Re(t,e,+oe),Re(t,e+2,de),t.set(ie,e+4),e+=4+de}return b&&(t.set(s,e),e+=b),e},fl=function(t,e,n,i,a){Re(t,e,101010256),Re(t,e+8,n),Re(t,e+10,n),Re(t,e+12,i),Re(t,e+16,a)};function Ga(t,e){e||(e={});var n={},i=[];Ua(t,"",n,e);var a=0,r=0;for(var l in n){var s=n[l],v=s[0],p=s[1],b=p.level==0?0:8,M=oi(l),R=M.length,j=p.comment,oe=j&&oi(j),ie=oe&&oe.length,de=Ni(p.extra);R>65535&&li(11);var pe=b?cl(v,p):v,J=pe.length,xe=ol();xe.p(v),i.push(Ha(p,{size:v.length,crc:xe.d(),c:pe,f:M,m:oe,u:R!=l.length||oe&&j.length!=ie,o:a,compression:b})),a+=30+R+de+J,r+=76+2*(R+de)+(ie||0)+J}for(var le=new Oe(r+22),_e=a,$e=r-a,ge=0;ge<i.length;++ge){var M=i[ge];Ra(le,M.o,M,M.f,M.u,M.c.length);var Q=30+M.f.length+Ni(M.extra);le.set(M.c,M.o+Q),Ra(le,a,M,M.f,M.u,M.c.length,M.o,M.m),a+=16+Q+(M.m?M.m.length:0)}return fl(le,a,i.length,$e,_e),le}var ml=se.preprocess(t=>typeof t=="string"&&t.trim().length>0?t:crypto.randomUUID(),se.string()),Jn=se.object({guid:ml,start:se.number().finite().nonnegative(),comment:se.string()}),_r=Jn.array(),Hi=Jn.extend({video_id:se.string()}),Va=se.object({x:se.number().finite(),y:se.number().finite(),width:se.number().finite().positive().optional(),height:se.number().finite().positive().optional()}),ci=se.object({video_id:se.string(),timestamps:_r}),lc=se.record(ci),qa=se.object({isSignedIn:se.boolean(),accessToken:se.string().nullable(),userName:se.string().nullable(),email:se.string().nullable()}),Za=se.object({autoBackupEnabled:se.boolean(),autoBackupIntervalMinutes:se.number().positive(),lastAutoBackupAt:se.number().int().positive().nullable().optional()});var q={isSignedIn:!1,accessToken:null,userName:null,email:null},wt=!0,it=30,mt=null,Qn=!1,Xn=0,ft=null,Ui=null,Te=null,ne=null,ui=null;function Ja(t){Ui=t}function Xa(t){Te=t}function Qa(t){ne=t}function Gi(t){ui=t}var Wa=!1;function es(){if(!Wa)try{let t=document.createElement("style");t.textContent=`
@keyframes tk-spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
@keyframes tk-blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.2; } }
.tk-auth-spinner { display:inline-block; width:12px; height:12px; border:2px solid rgba(255,165,0,0.3); border-top-color:#ffa500; border-radius:50%; margin-right:6px; vertical-align:-2px; animation: tk-spin 0.9s linear infinite; }
.tk-auth-blink { animation: tk-blink 0.4s ease-in-out 3; }
`,document.head.appendChild(t),Wa=!0}catch{}}var ts=null,Er=null,Sr=null;function Vi(t){ts=t}function fi(t){Er=t}function mi(t){Sr=t}var Ya="1023528652072-45cu3dr7o5j79vsdn8643bhle9ee8kds.apps.googleusercontent.com",pl="https://www.googleapis.com/auth/drive.file https://www.googleapis.com/auth/userinfo.profile",hl="https://www.youtube.com/",gl=30*1e3,yl=1800*1e3,Ka=5,di=null,rt=null;async function qi(){try{let t=await Sr("googleAuthState"),e=qa.safeParse(t);e.success?(q={...q,...e.data},Lr(),q.isSignedIn&&q.accessToken&&await tr(!0)):t!==void 0&&d("Google auth state failed validation, ignoring stored value",e.error.format(),"warn")}catch(t){d("Failed to load Google auth state:",t,"error")}}async function pi(){try{await Er("googleAuthState",q)}catch(t){d("Failed to save Google auth state:",t,"error")}}function Lr(){Ui&&(Ui.style.display="none")}function Ye(t,e){if(ne){if(ne.style.fontWeight="bold",t==="authenticating"){for(es(),ne.style.color="#ffa500";ne.firstChild;)ne.removeChild(ne.firstChild);let n=document.createElement("span");n.className="tk-auth-spinner";let i=document.createTextNode(` ${e||"Authorizing with Google\u2026"}`);ne.appendChild(n),ne.appendChild(i);return}if(t==="error"){ne.textContent=`\u274C ${e||"Authorization failed"}`,ne.style.color="#ff4d4f",he();return}q.isSignedIn?(ne.textContent="\u2705 Signed in",ne.style.color="#52c41a",ne.removeAttribute("title"),q.userName?(ne.onmouseenter=()=>{ne.textContent=`\u2705 Signed in as ${q.userName}`},ne.onmouseleave=()=>{ne.textContent="\u2705 Signed in"}):(ne.onmouseenter=null,ne.onmouseleave=null)):(ne.textContent="\u274C Not signed in",ne.style.color="#ff4d4f",ne.removeAttribute("title"),ne.onmouseenter=null,ne.onmouseleave=null),he()}}function vl(){ne&&(es(),ne.classList.remove("tk-auth-blink"),ne.offsetWidth,ne.classList.add("tk-auth-blink"),setTimeout(()=>{ne.classList.remove("tk-auth-blink")},1200))}function xl(t){return new Promise((e,n)=>{if(!t){d&&d("OAuth monitor: popup is null",null,"error"),n(new Error("Failed to open popup"));return}d&&d("OAuth monitor: starting to monitor popup for token");let i=Date.now(),a=300*1e3,r="timekeeper_oauth",l=null,s=null,v=null,p=()=>{if(l){try{l.close()}catch{}l=null}s&&(clearInterval(s),s=null),v&&(clearInterval(v),v=null)};try{l=new BroadcastChannel(r),d&&d("OAuth monitor: BroadcastChannel created successfully"),l.onmessage=R=>{if(d&&d("OAuth monitor: received BroadcastChannel message",R.data),R.data?.type==="timekeeper_oauth_token"&&R.data?.token){d&&d("OAuth monitor: token received via BroadcastChannel"),p();try{t.close()}catch{}e(R.data.token)}else if(R.data?.type==="timekeeper_oauth_error"){d&&d("OAuth monitor: error received via BroadcastChannel",R.data.error,"error"),p();try{t.close()}catch{}n(new Error(R.data.error||"OAuth failed"))}}}catch(R){d&&d("OAuth monitor: BroadcastChannel not supported, using IndexedDB fallback",R)}d&&d("OAuth monitor: setting up IndexedDB polling");let b=Date.now();s=setInterval(async()=>{try{let R=indexedDB.open("ytls-timestamps-db",3);R.onsuccess=()=>{let j=R.result,de=j.transaction("settings","readonly").objectStore("settings").get("oauth_message");de.onsuccess=()=>{let pe=de.result;if(pe&&pe.value){let J=pe.value;if(J.timestamp&&J.timestamp>b){if(d&&d("OAuth monitor: received IndexedDB message",J),J.type==="timekeeper_oauth_token"&&J.token){d&&d("OAuth monitor: token received via IndexedDB"),p();try{t.close()}catch{}j.transaction("settings","readwrite").objectStore("settings").delete("oauth_message"),e(J.token)}else if(J.type==="timekeeper_oauth_error"){d&&d("OAuth monitor: error received via IndexedDB",J.error,"error"),p();try{t.close()}catch{}j.transaction("settings","readwrite").objectStore("settings").delete("oauth_message"),n(new Error(J.error||"OAuth failed"))}b=J.timestamp}}j.close()}}}catch(R){d&&d("OAuth monitor: IndexedDB polling error",R,"error")}},500),v=setInterval(()=>{if(Date.now()-i>a){d&&d("OAuth monitor: popup timed out after 5 minutes",null,"error"),p();try{t.close()}catch{}n(new Error("OAuth popup timed out"));return}},1e3)})}async function ns(){if(!Ya){Ye("error","Google Client ID not configured");return}try{d&&d("OAuth signin: starting OAuth flow"),Ye("authenticating","Opening authentication window...");let t=new URL("https://accounts.google.com/o/oauth2/v2/auth");t.searchParams.set("client_id",Ya),t.searchParams.set("redirect_uri",hl),t.searchParams.set("response_type","token"),t.searchParams.set("scope",pl),t.searchParams.set("include_granted_scopes","true"),t.searchParams.set("state","timekeeper_auth"),d&&d("OAuth signin: opening popup");let e=window.open(t.toString(),"TimekeeperGoogleAuth","width=500,height=600,menubar=no,toolbar=no,location=no");if(!e){d&&d("OAuth signin: popup blocked by browser",null,"error"),Ye("error","Popup blocked. Please enable popups for YouTube.");return}d&&d("OAuth signin: popup opened successfully"),Ye("authenticating","Waiting for authentication...");try{let n=await xl(e),i=await fetch("https://www.googleapis.com/oauth2/v2/userinfo",{headers:{Authorization:`Bearer ${n}`}});if(i.ok){let a=await i.json();q.accessToken=n,q.isSignedIn=!0,q.userName=a.name,q.email=a.email,await pi(),Lr(),Ye(),he(),await tr(),d?d(`Successfully authenticated as ${a.name}`):console.log(`[Timekeeper] Successfully authenticated as ${a.name}`)}else throw new Error("Failed to fetch user info")}catch(n){let i=n instanceof Error?n.message:"Authentication failed";d?d("OAuth failed:",n,"error"):console.error("[Timekeeper] OAuth failed:",n),Ye("error",i);return}}catch(t){let e=t instanceof Error?t.message:"Sign in failed";d?d("Failed to sign in to Google:",t,"error"):console.error("[Timekeeper] Failed to sign in to Google:",t),Ye("error",`Failed to sign in: ${e}`)}}async function rs(){if(!window.opener||window.opener===window)return!1;d&&d("OAuth popup: detected popup window, checking for OAuth response");let t=window.location.hash;if(!t||t.length<=1)return d&&d("OAuth popup: no hash params found"),!1;let e=t.startsWith("#")?t.substring(1):t,n=new URLSearchParams(e),i=n.get("state");if(d&&d("OAuth popup: hash params found, state="+i),i!=="timekeeper_auth")return d&&d("OAuth popup: not our OAuth flow (wrong state)"),!1;let a=n.get("error"),r=n.get("access_token"),l="timekeeper_oauth";if(a){try{let s=new BroadcastChannel(l);s.postMessage({type:"timekeeper_oauth_error",error:n.get("error_description")||a}),s.close()}catch{let v={type:"timekeeper_oauth_error",error:n.get("error_description")||a,timestamp:Date.now()},p=indexedDB.open("ytls-timestamps-db",3);p.onsuccess=()=>{let b=p.result;b.transaction("settings","readwrite").objectStore("settings").put({key:"oauth_message",value:v}),b.close()}}return setTimeout(()=>{try{window.close()}catch{}},500),!0}if(r){d&&d("OAuth popup: access token found, broadcasting to opener");try{let s=new BroadcastChannel(l);s.postMessage({type:"timekeeper_oauth_token",token:r}),s.close(),d&&d("OAuth popup: token broadcast via BroadcastChannel")}catch(s){d&&d("OAuth popup: BroadcastChannel failed, using IndexedDB",s);let v={type:"timekeeper_oauth_token",token:r,timestamp:Date.now()},p=indexedDB.open("ytls-timestamps-db",3);p.onsuccess=()=>{let b=p.result;b.transaction("settings","readwrite").objectStore("settings").put({key:"oauth_message",value:v}),b.close()},d&&d("OAuth popup: token broadcast via IndexedDB")}return setTimeout(()=>{try{window.close()}catch{}},500),!0}return!1}async function is(){q={isSignedIn:!1,accessToken:null,userName:null,email:null},await pi(),Lr(),Ye(),he()}async function as(){if(!q.isSignedIn||!q.accessToken)return!1;try{let t=await fetch("https://www.googleapis.com/oauth2/v2/userinfo",{headers:{Authorization:`Bearer ${q.accessToken}`}});return t.status===401?(await ss({silent:!0}),!1):t.ok}catch(t){return d("Failed to verify auth state:",t,"error"),!1}}async function bl(t){let e={Authorization:`Bearer ${t}`},i=`https://www.googleapis.com/drive/v3/files?q=${encodeURIComponent("name = 'Timekeeper' and mimeType = 'application/vnd.google-apps.folder' and trashed = false")}&fields=files(id,name)&pageSize=10`,a=await fetch(i,{headers:e});if(a.status===401)throw new Error("unauthorized");if(!a.ok)throw new Error("drive search failed");let r=await a.json();if(Array.isArray(r.files)&&r.files.length>0)return r.files[0].id;let l=await fetch("https://www.googleapis.com/drive/v3/files",{method:"POST",headers:{...e,"Content-Type":"application/json"},body:JSON.stringify({name:"Timekeeper",mimeType:"application/vnd.google-apps.folder"})});if(l.status===401)throw new Error("unauthorized");if(!l.ok)throw new Error("drive folder create failed");return(await l.json()).id}async function wl(t,e,n){let i=`name='${t}' and '${e}' in parents and trashed=false`,a=encodeURIComponent(i),r=await fetch(`https://www.googleapis.com/drive/v3/files?q=${a}&fields=files(id,name)`,{method:"GET",headers:{Authorization:`Bearer ${n}`}});if(r.status===401)throw new Error("unauthorized");if(!r.ok)return null;let l=await r.json();return l.files&&l.files.length>0?l.files[0].id:null}function kl(t,e){let n=oi(t),i=e.replace(/\\/g,"/").replace(/^\/+/,"");return i.endsWith(".json")||(i+=".json"),Ga({[i]:[n,{level:6,mtime:new Date,os:0}]})}async function Tl(t,e,n,i){let a=t.replace(/\.json$/,".zip"),r=await wl(a,n,i),l=new TextEncoder().encode(e).length,s=kl(e,t),v=s.length;d(`Compressing data: ${l} bytes -> ${v} bytes (${Math.round(100-v/l*100)}% reduction)`);let p="-------314159265358979",b=`\r
--${p}\r
`,M=`\r
--${p}--`,R=r?{name:a,mimeType:"application/zip"}:{name:a,mimeType:"application/zip",parents:[n]},j=8192,oe="";for(let le=0;le<s.length;le+=j){let _e=s.subarray(le,Math.min(le+j,s.length));oe+=String.fromCharCode.apply(null,Array.from(_e))}let ie=btoa(oe),de=b+`Content-Type: application/json; charset=UTF-8\r
\r
`+JSON.stringify(R)+b+`Content-Type: application/zip\r
Content-Transfer-Encoding: base64\r
\r
`+ie+M,pe,J;r?(pe=`https://www.googleapis.com/upload/drive/v3/files/${r}?uploadType=multipart&fields=id,name`,J="PATCH"):(pe="https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart&fields=id,name",J="POST");let xe=await fetch(pe,{method:J,headers:{Authorization:`Bearer ${i}`,"Content-Type":`multipart/related; boundary=${p}`},body:de});if(xe.status===401)throw new Error("unauthorized");if(!xe.ok)throw new Error("drive upload failed")}async function ss(t){d("Auth expired, clearing token",null,"warn"),q.isSignedIn=!1,q.accessToken=null,await pi(),Ye("error","Authorization expired. Please sign in again."),he()}async function _l(t){if(!q.isSignedIn||!q.accessToken){t?.silent||Ye("error","Please sign in to Google Drive first");return}try{let{json:e,filename:n,totalVideos:i,totalTimestamps:a}=await ts();if(a===0){t?.silent||d("Skipping export: no timestamps to back up");return}let r=await bl(q.accessToken);await Tl(n,e,r,q.accessToken),d(`Exported to Google Drive (${n}) with ${i} videos / ${a} timestamps.`)}catch(e){throw e.message==="unauthorized"?(await ss({silent:t?.silent}),e):(d("Drive export failed:",e,"error"),t?.silent||Ye("error","Failed to export to Google Drive."),e)}}async function os(){try{let t=Za.partial().safeParse({autoBackupEnabled:await Sr("autoBackupEnabled"),autoBackupIntervalMinutes:await Sr("autoBackupIntervalMinutes"),lastAutoBackupAt:await Sr("lastAutoBackupAt")});t.success?(typeof t.data.autoBackupEnabled=="boolean"&&(wt=t.data.autoBackupEnabled),typeof t.data.autoBackupIntervalMinutes=="number"&&(it=t.data.autoBackupIntervalMinutes),typeof t.data.lastAutoBackupAt=="number"&&(mt=t.data.lastAutoBackupAt)):d("Failed to validate auto backup settings:",t.error.format(),"warn")}catch(t){d("Failed to load auto backup settings:",t,"error")}}async function Zi(){try{await Er("autoBackupEnabled",wt),await Er("autoBackupIntervalMinutes",it),await Er("lastAutoBackupAt",mt??0)}catch(t){d("Failed to save auto backup settings:",t,"error")}}function El(){di&&(clearInterval(di),di=null),rt&&(clearTimeout(rt),rt=null)}function er(t){try{let e=new Date(t),n=new Date,i=e.toDateString()===n.toDateString(),a=e.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"});return i?a:`${e.toLocaleDateString()} ${a}`}catch{return""}}function ls(){return wt?Qn?"#4285f4":ft&&ft>0?"#ffa500":q.isSignedIn&&mt?"#52c41a":q.isSignedIn?"#ffa500":"#ff4d4f":"#ff4d4f"}function he(){if(!Te)return;let t="",e="";if(!wt)t="\u{1F501} Backup: Off",Te.onmouseenter=null,Te.onmouseleave=null;else if(Qn)t="\u{1F501} Backing up\u2026",Te.onmouseenter=null,Te.onmouseleave=null;else if(ft&&ft>0)t=`\u26A0\uFE0F Retry in ${Math.ceil(ft/6e4)}m`,Te.onmouseenter=null,Te.onmouseleave=null;else if(mt){t=`\u{1F5C4}\uFE0F Last backup: ${er(mt)}`;let n=mt+Math.max(1,it)*60*1e3;e=`\u{1F5C4}\uFE0F Next backup: ${er(n)}`,Te.onmouseenter=()=>{Te.textContent=e},Te.onmouseleave=()=>{Te.textContent=t}}else{t="\u{1F5C4}\uFE0F Last backup: never";let n=Date.now()+Math.max(1,it)*60*1e3;e=`\u{1F5C4}\uFE0F Next backup: ${er(n)}`,Te.onmouseenter=()=>{Te.textContent=e},Te.onmouseleave=()=>{Te.textContent=t}}Te.textContent=t,Te.style.display=t?"inline":"none";try{let n=ls();Te.style.color=n}catch{}hi()}function hi(){if(!ui)return;let t=ls();ui.style.backgroundColor=t,bt(ui,()=>{let e="";if(!wt)e="Auto backup is disabled";else if(Qn)e="Backup in progress";else if(ft&&ft>0)e=`Retrying backup in ${Math.ceil(ft/6e4)}m`;else if(q.isSignedIn&&mt){let n=mt+Math.max(1,it)*60*1e3,i=er(n);e=`Last backup: ${er(mt)}
Next backup: ${i}`}else if(q.isSignedIn){let n=Date.now()+Math.max(1,it)*60*1e3;e=`No backup yet
Next backup: ${er(n)}`}else e="Not signed in to Google Drive";return e})}async function Cr(t=!0){if(!q.isSignedIn||!q.accessToken){t||vl();return}if(rt){d("Auto backup: backoff in progress, skipping scheduled run");return}if(!Qn){Qn=!0,he();try{await _l({silent:t}),mt=Date.now(),Xn=0,ft=null,rt&&(clearTimeout(rt),rt=null),await Zi()}catch(e){if(d("Auto backup failed:",e,"error"),e.message==="unauthorized")d("Auth error detected, clearing token and stopping retries",null,"warn"),q.isSignedIn=!1,q.accessToken=null,await pi(),Ye("error","Authorization expired. Please sign in again."),he(),Xn=0,ft=null,rt&&(clearTimeout(rt),rt=null);else if(Xn<Ka){Xn+=1;let a=Math.min(gl*Math.pow(2,Xn-1),yl);ft=a,rt&&clearTimeout(rt),rt=setTimeout(()=>{Cr(!0)},a),d(`Scheduling backup retry ${Xn}/${Ka} in ${Math.round(a/1e3)}s`),he()}else ft=null}finally{Qn=!1,he()}}}async function tr(t=!1){if(El(),!!wt&&!(!q.isSignedIn||!q.accessToken)){if(di=setInterval(()=>{Cr(!0)},Math.max(1,it)*60*1e3),!t){let e=Date.now(),n=Math.max(1,it)*60*1e3;(!mt||e-mt>=n)&&Cr(!0)}he()}}async function cs(){wt=!wt,await Zi(),await tr(),he()}async function us(){let t=prompt("Set Auto Backup interval (minutes):",String(it));if(t===null)return;let e=Math.floor(Number(t));if(!Number.isFinite(e)||e<5||e>1440){alert("Please enter a number between 5 and 1440 minutes.");return}it=e,await Zi(),await tr(),he()}var Wi=window.location.hash;if(Wi&&Wi.length>1){let t=new URLSearchParams(Wi.substring(1));if(t.get("state")==="timekeeper_auth"){let n=t.get("access_token");if(n){console.log("[Timekeeper] Auth token detected in URL, broadcasting token"),console.log("[Timekeeper] Token length:",n.length,"characters");try{let i=new BroadcastChannel("timekeeper_oauth"),a={type:"timekeeper_oauth_token",token:n};console.log("[Timekeeper] Sending auth message via BroadcastChannel:",{type:a.type,tokenLength:n.length}),i.postMessage(a),i.close(),console.log("[Timekeeper] Token broadcast via BroadcastChannel completed")}catch(i){console.log("[Timekeeper] BroadcastChannel failed, using IndexedDB fallback:",i);let a={type:"timekeeper_oauth_token",token:n,timestamp:Date.now()},r=indexedDB.open("ytls-timestamps-db",3);r.onsuccess=()=>{let l=r.result,s=l.transaction("settings","readwrite");s.objectStore("settings").put({key:"oauth_message",value:a}),s.oncomplete=()=>{console.log("[Timekeeper] Token broadcast via IndexedDB completed, timestamp:",a.timestamp),l.close()}}}if(history.replaceState){let i=window.location.pathname+window.location.search;history.replaceState(null,"",i)}throw console.log("[Timekeeper] Closing window after broadcasting auth token"),window.close(),new Error("OAuth window closed")}}}(async function(){"use strict";if(window.top!==window.self)return;function t(o){return GM.getValue(`timekeeper_${o}`,void 0)}function e(o,c){return GM.setValue(`timekeeper_${o}`,JSON.stringify(c))}if(mi(t),fi(e),await rs()){d("OAuth popup detected, broadcasting token and closing");return}await qi();let i=["/watch","/live"];function a(o=window.location.href){try{let c=new URL(o);return c.origin!=="https://www.youtube.com"?!1:i.some(u=>c.pathname===u||c.pathname.startsWith(`${u}/`))}catch(c){return d("Timekeeper failed to parse URL for support check:",c,"error"),!1}}let r=null,l=null,s=null,v=null,p=null,b=null,M=null,R=null,j=250,oe=null,ie=!1;function de(){return r?r.getBoundingClientRect():null}function pe(o,c,u){o&&(Ve={x:Math.round(typeof c=="number"?c:o.left),y:Math.round(typeof u=="number"?u:o.top),width:Math.round(o.width),height:Math.round(o.height)})}function J(o=!0){if(!r)return;Mn();let c=de();c&&(c.width||c.height)&&(pe(c),o&&(Wr("windowPosition",Ve),nr({type:"window_position_updated",position:Ve,timestamp:Date.now()})))}function xe(){if(!r||!l||!v||!s)return;let o=40,c=me();if(c.length>0)o=c[0].offsetHeight;else{let u=document.createElement("li");u.style.visibility="hidden",u.style.position="absolute",u.textContent="00:00 Example",s.appendChild(u),o=u.offsetHeight,s.removeChild(u)}j=l.offsetHeight+v.offsetHeight+o,r.style.minHeight=j+"px"}function le(){requestAnimationFrame(()=>{typeof window.recalculateTimestampsArea=="function"&&window.recalculateTimestampsArea(),xe(),J(!0)})}function _e(o=450){ke&&(clearTimeout(ke),ke=null),ke=setTimeout(()=>{V(),le(),ke=null},o)}function $e(){ke&&(clearTimeout(ke),ke=null)}function ge(){s&&(s.style.visibility="hidden",d("Hiding timestamps during show animation")),le(),_e()}function Q(){V(),$e(),pt&&(clearTimeout(pt),pt=null),pt=setTimeout(()=>{r&&(r.style.display="none",oa(),pt=null)},400)}function V(){if(!s){Xe&&(Xe(),Xe=null,It=null,Ft=null);return}if(!Ft){s.style.visibility==="hidden"&&(s.style.visibility="",d("Restoring timestamp visibility (no deferred fragment)")),Xe&&(Xe(),Xe=null,It=null);return}d("Appending deferred timestamps after animation"),s.appendChild(Ft),Ft=null,s.style.visibility==="hidden"&&(s.style.visibility="",d("Restoring timestamp visibility after append")),Xe&&(Xe(),Xe=null,It=null),yt(),Fe(),typeof window.recalculateTimestampsArea=="function"&&requestAnimationFrame(()=>window.recalculateTimestampsArea());let o=ce(),c=o?Math.floor(o.getCurrentTime()):Xt();Number.isFinite(c)&&tn(c,!1)}let ye=null,be=!1,ve="ytls-timestamp-pending-delete",Ke="ytls-timestamp-highlight",Pe="https://raw.githubusercontent.com/KamoTimestamps/timekeeper/refs/heads/main/assets/Kamo_64px_Indexed.png",Ue="https://raw.githubusercontent.com/KamoTimestamps/timekeeper/refs/heads/main/assets/Kamo_Eyebrow_64px_Indexed.png";function at(){let o=c=>{let u=new Image;u.src=c};o(Pe),o(Ue)}at();async function we(){for(;!document.querySelector("video")||!document.querySelector("#movie_player");)await new Promise(o=>setTimeout(o,100));for(;!document.querySelector(".ytp-progress-bar");)await new Promise(o=>setTimeout(o,100));await new Promise(o=>setTimeout(o,200))}let Ge=["getCurrentTime","seekTo","getPlayerState","seekToLiveHead","getVideoData","getDuration"],kt=5e3;function St(){return document.querySelector("video")}let Ee=null;function ce(){if(Ee&&document.contains(Ee))return Ee;let o=document.getElementById("movie_player");return o&&document.contains(o)?o:null}function Ct(o){return Ge.every(c=>typeof o?.[c]=="function")}function st(o){return Ge.filter(c=>typeof o?.[c]!="function")}async function Se(o=kt){let c=Date.now();for(;Date.now()-c<o;){let u=ce();if(Ct(u))return u;await new Promise(m=>setTimeout(m,100))}return ce()}let Lt="timestampOffsetSeconds",Ir=-5,_n="shiftClickTimeSkipSeconds",gi=10,En=300,Sn=300,Je=null;function Cn(){try{return new URL(window.location.href).origin==="https://www.youtube.com"}catch{return!1}}function Ln(){if(Cn()&&!Je)try{Je=new BroadcastChannel("ytls_timestamp_channel"),Je.onmessage=Yi}catch(o){d("Failed to create BroadcastChannel:",o,"warn"),Je=null}}function nr(o){if(!Cn()){d("Skipping BroadcastChannel message: not on https://www.youtube.com","warn");return}if(Ln(),!Je){d("No BroadcastChannel available to post message","warn");return}try{Je.postMessage(o)}catch(c){d("BroadcastChannel error, reopening:",c,"warn");try{Je=new BroadcastChannel("ytls_timestamp_channel"),Je.onmessage=Yi,Je.postMessage(o)}catch(u){d("Failed to reopen BroadcastChannel:",u,"error")}}}function Yi(o){if(d("Received message from another tab:",o.data),!(!a()||!s||!r)&&o.data){if(o.data.type==="timestamps_updated"&&o.data.videoId===Ce)d("Debouncing timestamp load due to external update for video:",o.data.videoId),clearTimeout(ir),ir=setTimeout(()=>{d("Reloading timestamps due to external update for video:",o.data.videoId),ra()},500);else if(o.data.type==="window_position_updated"&&r){let c=o.data.position;if(c&&typeof c.x=="number"&&typeof c.y=="number"){r.style.left=`${c.x}px`,r.style.top=`${c.y}px`,r.style.right="auto",r.style.bottom="auto",typeof c.width=="number"&&c.width>0&&(r.style.width=`${c.width}px`),typeof c.height=="number"&&c.height>0&&(r.style.height=`${c.height}px`);let u=r.getBoundingClientRect();Ve={x:Math.round(c.x),y:Math.round(c.y),width:Math.round(u.width),height:Math.round(u.height)};let m=document.documentElement.clientWidth,x=document.documentElement.clientHeight;(u.left<0||u.top<0||u.right>m||u.bottom>x)&&Mn()}}}}Ln();let In=await GM.getValue(Lt);(typeof In!="number"||Number.isNaN(In))&&(In=Ir,await GM.setValue(Lt,In));let rr=await GM.getValue(_n);(typeof rr!="number"||Number.isNaN(rr))&&(rr=gi,await GM.setValue(_n,rr));let ir=null,Kt=new Map,Ar=!1,F=null,Mr=null,Ce=null,pt=null,ke=null,Ft=null,It=null,Xe=null,jt=null,Dr=!1,Ve=null,yi=!1,Br=null,Rr=null,Or=null,Pr=null,zr=null,Nr=null,$r=null,ar=null,sr=null,or=null,ht=null,gt=null,Ki=0,lr=!1,Jt=null,cr=null;function me(){return s?Array.from(s.querySelectorAll("li")).filter(o=>!!o.querySelector("a[data-time]")):[]}function vi(){return me().map(o=>{let c=o.querySelector("a[data-time]"),u=c?.dataset.time;if(!c||!u)return null;let m=Number.parseInt(u,10);if(!Number.isFinite(m))return null;let w=o.querySelector("input")?.value??"",f=o.dataset.guid??crypto.randomUUID();o.dataset.guid||(o.dataset.guid=f);let h=Jn.safeParse({start:m,comment:w,guid:f});return h.success?h.data:(d(`Skipping invalid timestamp in UI: ${h.error.message}`,"warn"),null)}).filter(o=>o!==null)}function Xt(){if(cr!==null)return cr;let o=me();return cr=o.length>0?Math.max(...o.map(c=>{let u=c.querySelector("a[data-time]")?.getAttribute("data-time");return u?Number.parseInt(u,10):0})):0,cr}function Fr(){cr=null}function ds(o){let c=o.querySelector(".time-diff");return c?(c.textContent?.trim()||"").startsWith("-"):!1}function fs(o,c){return o?c?"\u2514\u2500 ":"\u251C\u2500 ":""}function ur(o){return o.startsWith("\u251C\u2500 ")||o.startsWith("\u2514\u2500 ")?1:0}function Ji(o){return o.replace(/^[]\s/,"")}function ms(o){let c=me();if(o>=c.length-1)return"\u2514\u2500 ";let u=c[o+1].querySelector("input");return u&&ur(u.value)===1?"\u251C\u2500 ":"\u2514\u2500 "}function yt(){if(!s)return;let o=me(),c=!0,u=0,m=o.length;for(;c&&u<m;)c=!1,u++,o.forEach((x,w)=>{let f=x.querySelector("input");if(!f||!(ur(f.value)===1))return;let S=!1;if(w<o.length-1){let P=o[w+1].querySelector("input");P&&(S=!(ur(P.value)===1))}else S=!0;let A=Ji(f.value),I=`${fs(!0,S)}${A}`;f.value!==I&&(f.value=I,c=!0)})}function Qt(){if(s){for(;s.firstChild;)s.removeChild(s.firstChild);Ft&&(Ft=null),Xe&&(Xe(),Xe=null,It=null)}}function dr(){if(!s||be||Ft)return;Array.from(s.children).some(c=>!c.classList.contains("ytls-placeholder")&&!c.classList.contains("ytls-error-message"))||xi("No timestamps for this video")}function xi(o){if(!s)return;Qt();let c=document.createElement("li");c.className="ytls-placeholder",c.textContent=o,s.appendChild(c),s.style.overflowY="hidden"}function bi(){if(!s)return;let o=s.querySelector(".ytls-placeholder");o&&o.remove(),s.style.overflowY=""}function wi(o){if(!(!r||!s)){if(be=o,o)r.style.display="",r.classList.remove("ytls-fade-out"),r.classList.add("ytls-fade-in"),xi("Loading timestamps...");else if(bi(),r.style.display="",r.classList.remove("ytls-fade-out"),r.classList.add("ytls-fade-in"),p){let c=ce();if(c){let u=c.getCurrentTime(),m=Number.isFinite(u)?Math.max(0,Math.floor(u)):Math.max(0,Xt()),x=Math.floor(m/3600),w=Math.floor(m/60)%60,f=m%60,{isLive:h}=c.getVideoData()||{isLive:!1},S=s?me().map(E=>{let I=E.querySelector("a[data-time]");return I?parseFloat(I.getAttribute("data-time")??"0"):0}):[],A="";if(S.length>0)if(h){let E=Math.max(1,m/60),I=S.filter(P=>P<=m);if(I.length>0){let P=(I.length/E).toFixed(2);parseFloat(P)>0&&(A=` (${P}/min)`)}}else{let E=c.getDuration(),I=Number.isFinite(E)&&E>0?E:0,P=Math.max(1,I/60),Z=(S.length/P).toFixed(1);parseFloat(Z)>0&&(A=` (${Z}/min)`)}p.textContent=`\u23F3${x?x+":"+String(w).padStart(2,"0"):w}:${String(f).padStart(2,"0")}${A}`}}!be&&s&&!s.querySelector(".ytls-error-message")&&dr(),At()}}function ps(o){return o?Jn.safeParse(o).success:!1}function jr(o,c){o.textContent=Wt(c),o.dataset.time=String(c),o.href=Di(c,window.location.href)}let Hr=null,Ur=null,en=!1;function hs(o){if(!o||typeof o.getVideoData!="function"||!o.getVideoData()?.isLive)return!1;if(typeof o.getProgressState=="function"){let u=o.getProgressState(),m=Number(u?.seekableEnd??u?.liveHead??u?.head??u?.duration),x=Number(u?.current??o.getCurrentTime?.());if(Number.isFinite(m)&&Number.isFinite(x))return m-x>2}return!1}function tn(o,c){if(!Number.isFinite(o))return;let u=Gr(o);fr(u,c)}function Gr(o){if(!Number.isFinite(o))return null;let c=me();if(c.length===0)return null;let u=null,m=-1/0;for(let x of c){let f=x.querySelector("a[data-time]")?.dataset.time;if(!f)continue;let h=Number.parseInt(f,10);Number.isFinite(h)&&h<=o&&h>m&&(m=h,u=x)}return u}function fr(o,c=!1){if(!o)return;if(me().forEach(m=>{m.classList.contains(ve)||m.classList.remove(Ke)}),!o.classList.contains(ve)&&(o.classList.add(Ke),c&&!Ar))try{if(s instanceof HTMLElement){let m=o.getBoundingClientRect(),x=s.getBoundingClientRect();!(m.bottom<x.top||m.top>x.bottom)||o.scrollIntoView({behavior:"smooth",block:"center"})}else o.scrollIntoView({behavior:"smooth",block:"center"})}catch{try{o.scrollIntoView({behavior:"smooth",block:"center"})}catch{}}}function gs(o){if(!s||s.querySelector(".ytls-error-message")||!Number.isFinite(o)||o===0)return!1;let c=me();if(c.length===0)return!1;let u=!1;return c.forEach(m=>{let x=m.querySelector("a[data-time]"),w=x?.dataset.time;if(!x||!w)return;let f=Number.parseInt(w,10);if(!Number.isFinite(f))return;let h=Math.max(0,f+o);h!==f&&(jr(x,h),u=!0)}),u?(pr(),yt(),Fe(),qr(Ce),Jt=null,!0):!1}function Xi(o,c={}){if(!Number.isFinite(o)||o===0)return!1;if(!gs(o)){if(c.alertOnNoChange){let f=c.failureMessage??"Offset did not change any timestamps.";alert(f)}return!1}let m=c.logLabel??"bulk offset";d(`Timestamps changed: Offset all timestamps by ${o>0?"+":""}${o} seconds (${m})`);let x=ce(),w=x?Math.floor(x.getCurrentTime()):0;if(Number.isFinite(w)){let f=Gr(w);fr(f,!1)}return!0}function Qi(o){if(!s||be)return;let c=o.target instanceof HTMLElement?o.target:null;if(c)if(c.dataset.time){o.preventDefault();let u=Number(c.dataset.time);if(Number.isFinite(u)){en=!0;let x=ce();x&&x.seekTo(u),setTimeout(()=>{en=!1},500)}let m=c.closest("li");m&&(me().forEach(x=>{x.classList.contains(ve)||x.classList.remove(Ke)}),m.classList.contains(ve)||(m.classList.add(Ke),m.scrollIntoView({behavior:"smooth",block:"center"})))}else if(c.dataset.increment){o.preventDefault();let m=c.parentElement?.querySelector("a[data-time]");if(!m||!m.dataset.time)return;let x=parseInt(m.dataset.time,10),w=parseInt(c.dataset.increment,10);if("shiftKey"in o&&o.shiftKey&&(w*=rr),"altKey"in o?o.altKey:!1){Xi(w,{logLabel:"Alt adjust"});return}let S=Math.max(0,x+w);d(`Timestamps changed: Timestamp time incremented from ${x} to ${S}`),jr(m,S),Fr();let A=c.closest("li");if(Ur=S,Hr&&clearTimeout(Hr),en=!0,Hr=setTimeout(()=>{if(Ur!==null){let E=ce();E&&E.seekTo(Ur)}Hr=null,Ur=null,setTimeout(()=>{en=!1},500)},500),pr(),yt(),Fe(),A){let E=A.querySelector("input"),I=A.dataset.guid;E&&I&&(An(Ce,I,S,E.value),Jt=I)}}else c.dataset.action==="clear"&&(o.preventDefault(),d("Timestamps changed: All timestamps cleared from UI"),s.textContent="",Fr(),Fe(),Vr(),qr(Ce,{allowEmpty:!0}),Jt=null,dr())}function mr(o,c="",u=!1,m=null,x=!0){if(!s)return null;let w=Math.max(0,o),f=m??crypto.randomUUID(),h=document.createElement("li"),S=document.createElement("div"),A=document.createElement("span"),E=document.createElement("span"),I=document.createElement("span"),P=document.createElement("a"),Z=document.createElement("span"),W=document.createElement("input"),X=document.createElement("button");h.dataset.guid=f,S.className="time-row";let qe=document.createElement("div");qe.style.cssText="position:absolute;left:0;top:0;width:20px;height:100%;display:flex;align-items:center;justify-content:center;cursor:pointer;",bt(qe,"Click to toggle indent");let Me=document.createElement("span");Me.style.cssText="color:#999;font-size:12px;pointer-events:none;display:none;";let et=()=>{let fe=ur(W.value);Me.textContent=fe===1?"\u25C0":"\u25B6"},Ht=fe=>{fe.stopPropagation();let ee=ur(W.value),Le=Ji(W.value),De=ee===0?1:0,ue="";if(De===1){let ot=me().indexOf(h);ue=ms(ot)}W.value=`${ue}${Le}`,et(),yt();let Ie=Number.parseInt(P.dataset.time??"0",10);An(Ce,f,Ie,W.value)};qe.onclick=Ht,qe.append(Me),h.style.cssText="position:relative;padding-left:20px;",h.addEventListener("mouseenter",()=>{et(),Me.style.display="inline"}),h.addEventListener("mouseleave",()=>{Me.style.display="none"}),h.addEventListener("mouseleave",()=>{h.dataset.guid===Jt&&ds(h)&&ea()}),W.value=c||"",W.style.cssText="width:100%;margin-top:5px;display:block;",W.type="text",W.setAttribute("inputmode","text"),W.autocapitalize="off",W.autocomplete="off",W.spellcheck=!1,W.addEventListener("focusin",()=>{lr=!1}),W.addEventListener("focusout",fe=>{let ee=fe.relatedTarget,Le=Date.now()-Ki<250,De=!!ee&&!!r&&r.contains(ee);!Le&&!De&&(lr=!0,setTimeout(()=>{(document.activeElement===document.body||document.activeElement==null)&&(W.focus({preventScroll:!0}),lr=!1)},0))}),W.addEventListener("input",fe=>{let ee=fe;if(ee&&(ee.isComposing||ee.inputType==="insertCompositionText"))return;let Le=Kt.get(f);Le&&clearTimeout(Le);let De=setTimeout(()=>{let ue=Number.parseInt(P.dataset.time??"0",10);An(Ce,f,ue,W.value),Kt.delete(f)},500);Kt.set(f,De)}),W.addEventListener("compositionend",()=>{let fe=Number.parseInt(P.dataset.time??"0",10);setTimeout(()=>{An(Ce,f,fe,W.value)},50)}),A.textContent="\u2796",A.dataset.increment="-1",A.style.cursor="pointer",A.style.margin="0px",A.addEventListener("mouseenter",()=>{A.style.textShadow="0 0 8px rgba(255, 255, 255, 0.8), 0 0 12px rgba(100, 200, 255, 0.6)"}),A.addEventListener("mouseleave",()=>{A.style.textShadow="none"}),I.textContent="\u2795",I.dataset.increment="1",I.style.cursor="pointer",I.style.margin="0px",I.addEventListener("mouseenter",()=>{I.style.textShadow="0 0 8px rgba(255, 255, 255, 0.8), 0 0 12px rgba(100, 200, 255, 0.6)"}),I.addEventListener("mouseleave",()=>{I.style.textShadow="none"}),E.textContent="\u23FA\uFE0F",E.style.cursor="pointer",E.style.margin="0px",bt(E,"Set to current playback time"),E.addEventListener("mouseenter",()=>{E.style.textShadow="0 0 8px rgba(255, 255, 255, 0.8), 0 0 12px rgba(100, 200, 255, 0.6)"}),E.addEventListener("mouseleave",()=>{E.style.textShadow="none"}),E.onclick=()=>{let fe=ce(),ee=fe?Math.floor(fe.getCurrentTime()):0;Number.isFinite(ee)&&(d(`Timestamps changedset to current playback time ${ee}`),jr(P,ee),pr(),yt(),An(Ce,f,ee,W.value),Jt=f)},jr(P,w),Fr(),X.textContent="\u{1F5D1}\uFE0F",X.style.cssText="background:transparent;border:none;color:white;cursor:pointer;margin-left:5px;",X.addEventListener("mouseenter",()=>{X.style.textShadow="0 0 8px rgba(255, 255, 255, 0.8), 0 0 12px rgba(255, 100, 100, 0.6)"}),X.addEventListener("mouseleave",()=>{X.style.textShadow="none"}),X.onclick=()=>{let fe=null,ee=null,Le=null,De=()=>{try{h.removeEventListener("click",ee,!0)}catch{}try{document.removeEventListener("click",ee,!0)}catch{}if(s)try{s.removeEventListener("mouseleave",Le)}catch{}fe&&(clearTimeout(fe),fe=null)};if(h.dataset.deleteConfirmed==="true"){d("Timestamps changed: Timestamp deleted");let ue=h.dataset.guid??"",Ie=Kt.get(ue);Ie&&(clearTimeout(Ie),Kt.delete(ue)),De(),h.remove(),Fr(),pr(),yt(),Fe(),Vr(),ys(Ce,ue),Jt=null,dr()}else{h.dataset.deleteConfirmed="true",h.classList.add(ve),h.classList.remove(Ke);let ue=()=>{h.dataset.deleteConfirmed="false",h.classList.remove(ve);let Ie=ce(),vt=Ie?Ie.getCurrentTime():0,ot=Number.parseInt(h.querySelector("a[data-time]")?.dataset.time??"0",10);Number.isFinite(vt)&&Number.isFinite(ot)&&vt>=ot&&h.classList.add(Ke),De()};ee=Ie=>{Ie.target!==X&&ue()},Le=()=>{h.dataset.deleteConfirmed==="true"&&ue()},h.addEventListener("click",ee,!0),document.addEventListener("click",ee,!0),s&&s.addEventListener("mouseleave",Le),fe=setTimeout(()=>{h.dataset.deleteConfirmed==="true"&&ue(),De()},5e3)}},Z.className="time-diff",Z.style.color="#888",Z.style.marginLeft="5px",S.append(A,E,I,P,Z,X),h.append(qe,S,W);let Mt=Number.parseInt(P.dataset.time??"0",10);if(x){bi();let fe=!1,ee=me();for(let Le=0;Le<ee.length;Le++){let De=ee[Le],Ie=De.querySelector("a[data-time]")?.dataset.time;if(!Ie)continue;let vt=Number.parseInt(Ie,10);if(Number.isFinite(vt)&&Mt<vt){s.insertBefore(h,De),fe=!0;let ot=ee[Le-1];if(ot){let zn=ot.querySelector("a[data-time]")?.dataset.time;if(zn){let Nn=Number.parseInt(zn,10);Number.isFinite(Nn)&&(Z.textContent=Wt(Mt-Nn))}}else Z.textContent="";let Pn=De.querySelector(".time-diff");Pn&&(Pn.textContent=Wt(vt-Mt));break}}if(!fe&&(s.appendChild(h),ee.length>0)){let ue=ee[ee.length-1].querySelector("a[data-time]")?.dataset.time;if(ue){let Ie=Number.parseInt(ue,10);Number.isFinite(Ie)&&(Z.textContent=Wt(Mt-Ie))}}h.scrollIntoView({behavior:"smooth",block:"center"}),Vr(),yt(),Fe(),u||(An(Ce,f,w,c),Jt=f,fr(h,!1))}else W.__ytls_li=h;return W}function pr(){if(!s||s.querySelector(".ytls-error-message"))return;let o=me();o.forEach((c,u)=>{let m=c.querySelector(".time-diff");if(!m)return;let w=c.querySelector("a[data-time]")?.dataset.time;if(!w){m.textContent="";return}let f=Number.parseInt(w,10);if(!Number.isFinite(f)){m.textContent="";return}if(u===0){m.textContent="";return}let A=o[u-1].querySelector("a[data-time]")?.dataset.time;if(!A){m.textContent="";return}let E=Number.parseInt(A,10);if(!Number.isFinite(E)){m.textContent="";return}let I=f-E,P=I<0?"-":"";m.textContent=` ${P}${Wt(Math.abs(I))}`})}function ea(){if(!s||s.querySelector(".ytls-error-message")||be)return;let o=null;if(document.activeElement instanceof HTMLInputElement&&s.contains(document.activeElement)){let f=document.activeElement,S=f.closest("li")?.dataset.guid;if(S){let A=f.selectionStart??f.value.length,E=f.selectionEnd??A,I=f.scrollLeft;o={guid:S,start:A,end:E,scroll:I}}}let c=me();if(c.length===0)return;let u=c.map(f=>f.dataset.guid),m=c.map(f=>{let h=f.querySelector("a[data-time]"),S=h?.dataset.time;if(!h||!S)return null;let A=Number.parseInt(S,10);if(!Number.isFinite(A))return null;let E=f.dataset.guid??"";return{time:A,guid:E,element:f}}).filter(f=>f!==null).sort((f,h)=>{let S=f.time-h.time;return S!==0?S:f.guid.localeCompare(h.guid)}),x=m.map(f=>f.guid),w=u.length!==x.length||u.some((f,h)=>f!==x[h]);for(;s.firstChild;)s.removeChild(s.firstChild);if(m.forEach(f=>{s.appendChild(f.element)}),pr(),yt(),Fe(),o){let h=me().find(S=>S.dataset.guid===o.guid)?.querySelector("input");if(h)try{h.focus({preventScroll:!0})}catch{}}w&&(d("Timestamps changed: Timestamps sorted"),qr(Ce))}function Vr(){if(!s||!r||!l||!v)return;let o=me().length;typeof window.recalculateTimestampsArea=="function"&&window.recalculateTimestampsArea();let c=r.getBoundingClientRect(),u=l.getBoundingClientRect(),m=v.getBoundingClientRect(),x=Math.max(0,c.height-(u.height+m.height));o===0?(dr(),s.style.overflowY="hidden"):s.style.overflowY=s.scrollHeight>x?"auto":"hidden"}function Fe(){if(!s)return;let o=St(),c=document.querySelector(".ytp-progress-bar"),u=ce(),m=u?u.getVideoData():null,x=!!m&&!!m.isLive;if(!o||!c||!isFinite(o.duration)||x)return;na(),me().map(f=>{let h=f.querySelector("a[data-time]"),S=h?.dataset.time;if(!h||!S)return null;let A=Number.parseInt(S,10);if(!Number.isFinite(A))return null;let I=f.querySelector("input")?.value??"",P=f.dataset.guid??crypto.randomUUID();return f.dataset.guid||(f.dataset.guid=P),{start:A,comment:I,guid:P}}).filter(ps).forEach(f=>{if(!Number.isFinite(f.start))return;let h=document.createElement("div");h.className="ytls-marker",h.style.position="absolute",h.style.height="100%",h.style.width="2px",h.style.backgroundColor="#ff0000",h.style.cursor="pointer",h.style.left=f.start/o.duration*100+"%",h.dataset.time=String(f.start),h.addEventListener("click",()=>{let S=ce();S&&S.seekTo(f.start)}),c.appendChild(h)})}function qr(o,c={}){if(!s||s.querySelector(".ytls-error-message")||!o)return;if(be){d("Save blocked: timestamps are currently loading");return}yt();let u=vi().sort((m,x)=>m.start-x.start);if(u.length===0&&!c.allowEmpty){d("Save skipped: no timestamps to save");return}aa(o,u).then(()=>d(`Successfully saved ${u.length} timestamps for ${o} to IndexedDB`)).catch(m=>d(`Failed to save timestamps for ${o} to IndexedDB:`,m,"error")),nr({type:"timestamps_updated",videoId:o,action:"saved"})}function An(o,c,u,m){if(!o||be)return;let x={guid:c,start:u,comment:m};d(`Saving timestamp: guid=${c}, start=${u}, comment="${m}"`),Ls(o,x).catch(w=>d(`Failed to save timestamp ${c}:`,w,"error")),nr({type:"timestamps_updated",videoId:o,action:"saved"})}function ys(o,c){!o||be||(d(`Deleting timestamp: guid=${c}`),Is(o,c).catch(u=>d(`Failed to delete timestamp ${c}:`,u,"error")),nr({type:"timestamps_updated",videoId:o,action:"saved"}))}async function ta(o){if(!s||s.querySelector(".ytls-error-message")){alert("Cannot export timestamps while displaying an error message.");return}let c=Ce;if(!c)return;d(`Exporting timestamps for video ID: ${c}`);let u=vi(),m=Math.max(Xt(),0),x=xr();if(o==="json"){let w=new Blob([JSON.stringify(u,null,2)],{type:"application/json"}),f=URL.createObjectURL(w),h=document.createElement("a");h.href=f,h.download=`timestamps-${c}-${x}.json`,h.click(),URL.revokeObjectURL(f)}else if(o==="text"){let w=u.map(A=>{let E=Wt(A.start,m),I=`${A.comment} <!-- guid:${A.guid} -->`.trimStart();return`${E} ${I}`}).join(`
`),f=new Blob([w],{type:"text/plain"}),h=URL.createObjectURL(f),S=document.createElement("a");S.href=h,S.download=`timestamps-${c}-${x}.txt`,S.click(),URL.revokeObjectURL(h)}}function ki(o){if(!r||!s){d("Timekeeper error:",o,"error");return}Qt();let c=document.createElement("li");c.textContent=o,c.classList.add("ytls-error-message"),c.style.color="#ff6b6b",c.style.fontWeight="bold",c.style.padding="8px",c.style.background="rgba(255, 0, 0, 0.1)",s.appendChild(c),Fe()}function na(){document.querySelectorAll(".ytls-marker").forEach(o=>o.remove())}function Mn(){if(!r||!document.body.contains(r))return;let o=r.getBoundingClientRect(),c=document.documentElement.clientWidth,u=document.documentElement.clientHeight,m=o.width,x=o.height;if(o.left<0&&(r.style.left="0",r.style.right="auto"),o.right>c){let w=Math.max(0,c-m);r.style.left=`${w}px`,r.style.right="auto"}if(o.top<0&&(r.style.top="0",r.style.bottom="auto"),o.bottom>u){let w=Math.max(0,u-x);r.style.top=`${w}px`,r.style.bottom="auto"}}function vs(){if(Br&&(document.removeEventListener("mousemove",Br),Br=null),Rr&&(document.removeEventListener("mouseup",Rr),Rr=null),ar&&(document.removeEventListener("keydown",ar),ar=null),Or&&(window.removeEventListener("resize",Or),Or=null),sr&&(document.removeEventListener("pointerdown",sr,!0),sr=null),or&&(document.removeEventListener("pointerup",or,!0),or=null),ht){try{ht.disconnect()}catch{}ht=null}if(gt){try{gt.disconnect()}catch{}gt=null}let o=St();o&&(Pr&&(o.removeEventListener("timeupdate",Pr),Pr=null),zr&&(o.removeEventListener("pause",zr),zr=null),Nr&&(o.removeEventListener("play",Nr),Nr=null),$r&&(o.removeEventListener("seeking",$r),$r=null))}function xs(){na(),Kt.forEach(c=>clearTimeout(c)),Kt.clear(),ir&&(clearTimeout(ir),ir=null),ye&&(clearInterval(ye),ye=null),pt&&(clearTimeout(pt),pt=null),vs();try{Je.close()}catch{}if(F&&F.parentNode===document.body&&document.body.removeChild(F),F=null,Mr=null,Ar=!1,Ce=null,ht){try{ht.disconnect()}catch{}ht=null}if(gt){try{gt.disconnect()}catch{}gt=null}r&&r.parentNode&&r.remove();let o=document.getElementById("ytls-header-button");o&&o.parentNode&&o.remove(),jt=null,Dr=!1,Ve=null,Qt(),r=null,l=null,s=null,v=null,p=null,b=null,M=null,Ee=null}async function bs(){let o=Ti();if(!o)return Ee=null,{ok:!1,message:"Timekeeper cannot determine the current video ID. Please refresh the page or open a standard YouTube watch URL."};let c=await Se();if(!Ct(c)){let u=st(c),m=u.length?` Missing methods: ${u.join(", ")}.`:"",x=c?"Timekeeper cannot access the YouTube player API.":"Timekeeper cannot find the YouTube player on this page.";return Ee=null,{ok:!1,message:`${x}${m} Try refreshing once playback is ready.`}}return Ee=c,{ok:!0,player:c,videoId:o}}async function ra(){if(!r||!s)return;let o=s.scrollTop,c=!0,u=()=>{if(!s||!c)return;let m=Math.max(0,s.scrollHeight-s.clientHeight);s.scrollTop=Math.min(o,m)};try{let m=await bs();if(!m.ok){ki(m.message),Qt(),Fe();return}let{videoId:x}=m,w=[];try{let f=await As(x);f?(w=f.map(h=>({...h,guid:h.guid||crypto.randomUUID()})),d(`Loaded ${w.length} timestamps from IndexedDB for ${x}`)):d(`No timestamps found in IndexedDB for ${x}`)}catch(f){d(`Failed to load timestamps from IndexedDB for ${x}:`,f,"error"),ki("Failed to load timestamps from IndexedDB. Try refreshing the page."),Fe();return}if(w.length>0){w.sort((E,I)=>E.start-I.start),Qt(),bi();let f=document.createDocumentFragment();w.forEach(E=>{let P=mr(E.start,E.comment,!0,E.guid,!1).__ytls_li;P&&f.appendChild(P)}),r&&r.classList.contains("ytls-zoom-in")&&ke!=null?(d("Deferring timestamp DOM append until show animation completes"),Ft=f,It||(It=new Promise(E=>{Xe=E})),await It):s&&(s.appendChild(f),yt(),Fe(),typeof window.recalculateTimestampsArea=="function"&&requestAnimationFrame(()=>window.recalculateTimestampsArea()));let S=ce(),A=S?Math.floor(S.getCurrentTime()):Xt();Number.isFinite(A)&&(tn(A,!1),c=!1)}else Qt(),xi("No timestamps for this video"),Fe(),typeof window.recalculateTimestampsArea=="function"&&requestAnimationFrame(()=>window.recalculateTimestampsArea())}catch(m){d("Unexpected error while loading timestamps:",m,"error"),ki("Timekeeper encountered an unexpected error while loading timestamps. Check the console for details.")}finally{It&&await It,requestAnimationFrame(u),typeof window.recalculateTimestampsArea=="function"&&requestAnimationFrame(()=>window.recalculateTimestampsArea()),s&&!s.querySelector(".ytls-error-message")&&dr()}}function Ti(){let c=new URLSearchParams(location.search).get("v");if(c)return c;let u=document.querySelector('meta[itemprop="identifier"]');return u?.content?u.content:null}function ws(){let o=St();if(!o)return;let c=()=>{if(!s)return;let f=ce(),h=f?Math.floor(f.getCurrentTime()):0;if(!Number.isFinite(h))return;let S=Gr(h);fr(S,!1)},u=f=>{try{let h=new URL(window.location.href);f!==null&&Number.isFinite(f)?h.searchParams.set("t",`${Math.floor(f)}s`):h.searchParams.delete("t"),window.history.replaceState({},"",h.toString())}catch{}},m=()=>{let f=ce(),h=f?Math.floor(f.getCurrentTime()):NaN;if(Number.isFinite(h)){u(h);try{tn(h,!0)}catch(S){d("Failed to highlight nearest timestamp on pause:",S,"warn")}}},x=()=>{u(null);try{let f=ce(),h=f?Math.floor(f.getCurrentTime()):NaN;Number.isFinite(h)&&tn(h,!0)}catch(f){d("Failed to highlight nearest timestamp on play:",f,"warn")}},w=()=>{let f=St();if(!f)return;let h=ce(),S=h?Math.floor(h.getCurrentTime()):0;if(!Number.isFinite(S))return;f.paused&&u(S);let A=Gr(S);fr(A,!0)};Pr=c,zr=m,Nr=x,$r=w,o.addEventListener("timeupdate",c),o.addEventListener("pause",m),o.addEventListener("play",x),o.addEventListener("seeking",w)}let ks="ytls-timestamps-db",Ts=3,Dn="timestamps",Qe="timestamps_v2",Zr="settings",Bn=null,Rn=null;function On(){if(Bn)try{if(Bn.objectStoreNames.length>=0)return Promise.resolve(Bn)}catch(o){d("IndexedDB connection is no longer usable:",o,"warn"),Bn=null}return Rn||(Rn=Cs().then(o=>(Bn=o,Rn=null,o.onclose=()=>{d("IndexedDB connection closed unexpectedly","warn"),Bn=null},o.onerror=c=>{d("IndexedDB connection error:",c,"error")},o)).catch(o=>{throw Rn=null,o}),Rn)}async function ia(){let o={},c=await sa(Qe),u=Hi.array().safeParse(c);if(!u.success)return d("Failed to parse timestamp rows for export:",u.error.format(),"warn"),{json:"{}",filename:"timekeeper-data.json",totalVideos:0,totalTimestamps:0};let m=new Map;for(let f of u.data)m.has(f.video_id)||m.set(f.video_id,[]),m.get(f.video_id).push({guid:f.guid,start:f.start,comment:f.comment});for(let[f,h]of m)o[`ytls-${f}`]={video_id:f,timestamps:h.sort((S,A)=>S.start-A.start)};return{json:JSON.stringify(o,null,2),filename:"timekeeper-data.json",totalVideos:m.size,totalTimestamps:u.data.length}}async function _s(){try{let{json:o,filename:c,totalVideos:u,totalTimestamps:m}=await ia(),x=new Blob([o],{type:"application/json"}),w=URL.createObjectURL(x),f=document.createElement("a");f.href=w,f.download=c,f.click(),URL.revokeObjectURL(w),d(`Exported ${u} videos with ${m} timestamps`)}catch(o){throw d("Failed to export data:",o,"error"),o}}async function Es(){let o=Hi.array().safeParse(await sa(Qe));if(!o.success||o.data.length===0){o.success||d("Failed to parse timestamp rows for CSV export:",o.error.format(),"warn");let E=`Tag,Timestamp,URL
`,I=`timestamps-${xr()}.csv`;return{csv:E,filename:I,totalVideos:0,totalTimestamps:0}}let c=o.data,u=new Map;for(let E of c)u.has(E.video_id)||u.set(E.video_id,[]),u.get(E.video_id).push({start:E.start,comment:E.comment});let m=[];m.push("Tag,Timestamp,URL");let x=0,w=E=>`"${String(E).replace(/"/g,'""')}"`,f=E=>{let I=Math.floor(E/3600),P=Math.floor(E%3600/60),Z=String(E%60).padStart(2,"0");return`${String(I).padStart(2,"0")}:${String(P).padStart(2,"0")}:${Z}`},h=Array.from(u.keys()).sort();for(let E of h){let I=u.get(E).sort((P,Z)=>P.start-Z.start);for(let P of I){let Z=P.comment,W=f(P.start),X=Di(P.start,`https://www.youtube.com/watch?v=${E}`);m.push([w(Z),w(W),w(X)].join(",")),x++}}let S=m.join(`
`),A=`timestamps-${xr()}.csv`;return{csv:S,filename:A,totalVideos:u.size,totalTimestamps:x}}async function Ss(){try{let{csv:o,filename:c,totalVideos:u,totalTimestamps:m}=await Es(),x=new Blob([o],{type:"text/csv;charset=utf-8;"}),w=URL.createObjectURL(x),f=document.createElement("a");f.href=w,f.download=c,f.click(),URL.revokeObjectURL(w),d(`Exported ${u} videos with ${m} timestamps (CSV)`)}catch(o){throw d("Failed to export CSV data:",o,"error"),o}}function Cs(){return new Promise((o,c)=>{let u=indexedDB.open(ks,Ts);u.onupgradeneeded=m=>{let x=m.target.result,w=m.oldVersion,f=m.target.transaction;if(w<1&&x.createObjectStore(Dn,{keyPath:"video_id"}),w<2&&!x.objectStoreNames.contains(Zr)&&x.createObjectStore(Zr,{keyPath:"key"}),w<3){if(x.objectStoreNames.contains(Dn)){d("Exporting backup before v2 migration...");let A=f.objectStore(Dn).getAll();A.onsuccess=()=>{let E=ci.array().safeParse(A.result);if(E.success&&E.data.length>0)try{let I={},P=0;E.data.forEach(qe=>{if(qe.timestamps.length>0){let Me=_r.parse(qe.timestamps);I[`ytls-${qe.video_id}`]={video_id:qe.video_id,timestamps:[...Me].sort((et,Ht)=>et.start-Ht.start)},P+=Me.length}});let Z=new Blob([JSON.stringify(I,null,2)],{type:"application/json"}),W=URL.createObjectURL(Z),X=document.createElement("a");X.href=W,X.download=`timekeeper-data-${xr()}.json`,X.click(),URL.revokeObjectURL(W),d(`Pre-migration backup exported: ${E.data.length} videos, ${P} timestamps`)}catch(I){d("Failed to export pre-migration backup:",I,"error")}else E.success||d("Skipping pre-migration backup: legacy data failed validation",E.error.format(),"warn")}}let h=x.createObjectStore(Qe,{keyPath:"guid"});if(h.createIndex("video_id","video_id",{unique:!1}),h.createIndex("video_start",["video_id","start"],{unique:!1}),x.objectStoreNames.contains(Dn)){let A=f.objectStore(Dn).getAll();A.onsuccess=()=>{let E=ci.array().safeParse(A.result);if(E.success&&E.data.length>0){let I=0;E.data.forEach(P=>{P.timestamps.length>0&&P.timestamps.forEach(Z=>{h.put({guid:Z.guid,video_id:P.video_id,start:Z.start,comment:Z.comment}),I++})}),d(`Migrated ${I} timestamps from ${E.data.length} videos to v2 store`)}else E.success||d("Skipping v1 \u2192 v2 migration: legacy data failed validation",E.error.format(),"warn")},x.deleteObjectStore(Dn),d("Deleted old timestamps store after migration to v2")}}},u.onsuccess=m=>{o(m.target.result)},u.onerror=m=>{let x=m.target.error;c(x??new Error("Failed to open IndexedDB"))}})}function _i(o,c,u){return On().then(m=>new Promise((x,w)=>{let f;try{f=m.transaction(o,c)}catch(A){w(new Error(`Failed to create transaction for ${o}: ${A}`));return}let h=f.objectStore(o),S;try{S=u(h)}catch(A){w(new Error(`Failed to execute operation on ${o}: ${A}`));return}S&&(S.onsuccess=()=>x(S.result),S.onerror=()=>w(S.error??new Error(`IndexedDB ${c} operation failed`))),f.oncomplete=()=>{S||x(void 0)},f.onerror=()=>w(f.error??new Error("IndexedDB transaction failed")),f.onabort=()=>w(f.error??new Error("IndexedDB transaction aborted"))}))}function aa(o,c){let u=_r.safeParse(c);if(!u.success)return Promise.reject(new Error(`Invalid timestamp payload for ${o}`));let m=u.data;return On().then(x=>new Promise((w,f)=>{let h;try{h=x.transaction([Qe],"readwrite")}catch(I){f(new Error(`Failed to create transaction: ${I}`));return}let S=h.objectStore(Qe),E=S.index("video_id").getAll(IDBKeyRange.only(o));E.onsuccess=()=>{try{let I=E.result,P=new Set(m.map(Z=>Z.guid));I.forEach(Z=>{P.has(Z.guid)||S.delete(Z.guid)}),m.forEach(Z=>{S.put({guid:Z.guid,video_id:o,start:Z.start,comment:Z.comment})})}catch(I){d("Error during save operation:",I,"error")}},E.onerror=()=>{f(E.error??new Error("Failed to get existing records"))},h.oncomplete=()=>w(),h.onerror=()=>f(h.error??new Error("Failed to save to IndexedDB")),h.onabort=()=>f(h.error??new Error("Transaction aborted during save"))}))}function Ls(o,c){let u=Jn.safeParse(c);if(!u.success)return Promise.reject(new Error(`Invalid timestamp: ${u.error.message}`));let m=u.data;return On().then(x=>new Promise((w,f)=>{let h;try{h=x.transaction([Qe],"readwrite")}catch(E){f(new Error(`Failed to create transaction: ${E}`));return}let A=h.objectStore(Qe).put({guid:m.guid,video_id:o,start:m.start,comment:m.comment});A.onerror=()=>{f(A.error??new Error("Failed to put timestamp"))},h.oncomplete=()=>w(),h.onerror=()=>f(h.error??new Error("Failed to save single timestamp to IndexedDB")),h.onabort=()=>f(h.error??new Error("Transaction aborted during single timestamp save"))}))}function Is(o,c){return d(`Deleting timestamp ${c} for video ${o}`),On().then(u=>new Promise((m,x)=>{let w;try{w=u.transaction([Qe],"readwrite")}catch(S){x(new Error(`Failed to create transaction: ${S}`));return}let h=w.objectStore(Qe).delete(c);h.onerror=()=>{x(h.error??new Error("Failed to delete timestamp"))},w.oncomplete=()=>m(),w.onerror=()=>x(w.error??new Error("Failed to delete single timestamp from IndexedDB")),w.onabort=()=>x(w.error??new Error("Transaction aborted during timestamp deletion"))}))}function As(o){return On().then(c=>new Promise(u=>{let m;try{m=c.transaction([Qe],"readonly")}catch(h){d("Failed to create read transaction:",h,"warn"),u(null);return}let f=m.objectStore(Qe).index("video_id").getAll(IDBKeyRange.only(o));f.onsuccess=()=>{let h=f.result;if(h.length===0){u(null);return}let S=h.map(I=>({guid:I.guid,start:I.start,comment:I.comment})),A=_r.safeParse(S);if(!A.success){d("Failed to parse timestamps from IndexedDB:",A.error.format(),"warn"),u(null);return}let E=[...A.data].sort((I,P)=>I.start-P.start);u(E)},f.onerror=()=>{d("Failed to load timestamps:",f.error,"warn"),u(null)},m.onabort=()=>{d("Transaction aborted during load:",m.error,"warn"),u(null)}}))}function Ms(o){return On().then(c=>new Promise((u,m)=>{let x;try{x=c.transaction([Qe],"readwrite")}catch(S){m(new Error(`Failed to create transaction: ${S}`));return}let w=x.objectStore(Qe),h=w.index("video_id").getAll(IDBKeyRange.only(o));h.onsuccess=()=>{try{h.result.forEach(A=>{w.delete(A.guid)})}catch(S){d("Error during remove operation:",S,"error")}},h.onerror=()=>{m(h.error??new Error("Failed to get records for removal"))},x.oncomplete=()=>u(),x.onerror=()=>m(x.error??new Error("Failed to remove timestamps")),x.onabort=()=>m(x.error??new Error("Transaction aborted during timestamp removal"))}))}function sa(o){return _i(o,"readonly",c=>c.getAll()).then(c=>Array.isArray(c)?c:[])}function Wr(o,c){_i(Zr,"readwrite",u=>{u.put({key:o,value:c})}).catch(u=>{d(`Failed to save setting '${o}' to IndexedDB:`,u,"error")})}function Ei(o){return _i(Zr,"readonly",c=>c.get(o)).then(c=>c?.value).catch(c=>{d(`Failed to load setting '${o}' from IndexedDB:`,c,"error")})}function oa(){if(!r)return;let o=r.style.display!=="none";Wr("uiVisible",o)}function At(o){let c=typeof o=="boolean"?o:!!r&&r.style.display!=="none",u=document.getElementById("ytls-header-button");u instanceof HTMLButtonElement&&u.setAttribute("aria-pressed",String(c)),jt&&!Dr&&jt.src!==Pe&&(jt.src=Pe)}function Ds(){r&&Ei("uiVisible").then(o=>{let c=se.boolean().safeParse(o),u=c.success?c.data:void 0;typeof u=="boolean"?(u?(r.style.display="flex",r.classList.remove("ytls-zoom-out"),r.classList.add("ytls-zoom-in")):r.style.display="none",At(u)):(!c.success&&o!==void 0&&d("UI visibility state failed validation, defaulting to visible",c.error.format(),"warn"),r.style.display="flex",r.classList.remove("ytls-zoom-out"),r.classList.add("ytls-zoom-in"),At(!0))}).catch(o=>{d("Failed to load UI visibility state:",o,"error"),r.style.display="flex",r.classList.remove("ytls-zoom-out"),r.classList.add("ytls-zoom-in"),At(!0)})}function Si(o){if(!r){d("ERROR: togglePaneVisibility called but pane is null");return}document.body.contains(r)||(d("Pane not in DOM during toggle, appending it"),document.querySelectorAll("#ytls-pane").forEach(x=>{x!==r&&x.remove()}),document.body.appendChild(r));let c=document.querySelectorAll("#ytls-pane");c.length>1&&(d(`ERROR: Multiple panes detected in togglePaneVisibility (${c.length}), cleaning up`),c.forEach(x=>{x!==r&&x.remove()})),pt&&(clearTimeout(pt),pt=null);let u=r.style.display==="none";(typeof o=="boolean"?o:u)?(r.style.display="flex",r.classList.remove("ytls-fade-out"),r.classList.remove("ytls-zoom-out"),r.classList.add("ytls-zoom-in"),At(!0),oa(),ge(),ke&&(clearTimeout(ke),ke=null),ke=setTimeout(()=>{V(),typeof window.recalculateTimestampsArea=="function"&&window.recalculateTimestampsArea(),xe(),J(!0);try{let x=ce(),w=x?Math.floor(x.getCurrentTime()):NaN;Number.isFinite(w)&&tn(w,!0)}catch(x){d("Failed to scroll to nearest timestamp after toggle:",x,"warn")}ke=null},450)):(r.classList.remove("ytls-fade-in"),r.classList.remove("ytls-zoom-in"),r.classList.add("ytls-zoom-out"),At(!1),Q())}function la(o){if(!s){d("UI is not initialized; cannot import timestamps.","warn");return}let c=!1;try{let u=JSON.parse(o),m=null;if(Array.isArray(u))m=u;else if(typeof u=="object"&&u!==null){let x=Ce;if(x){let w=`timekeeper-${x}`;u[w]&&Array.isArray(u[w].timestamps)&&(m=u[w].timestamps,d(`Found timestamps for current video (${x}) in export format`,"info"))}if(!m){let w=Object.keys(u).filter(f=>f.startsWith("ytls-"));if(w.length===1&&Array.isArray(u[w[0]].timestamps)){m=u[w[0]].timestamps;let f=u[w[0]].video_id;d(`Found timestamps for video ${f} in export format`,"info")}}}m&&Array.isArray(m)?m.every(w=>typeof w.start=="number"&&typeof w.comment=="string")?(m.forEach(w=>{if(w.guid){let f=me().find(h=>h.dataset.guid===w.guid);if(f){let h=f.querySelector("input");h&&(h.value=w.comment)}else mr(w.start,w.comment,!1,w.guid)}else mr(w.start,w.comment,!1,crypto.randomUUID())}),c=!0):d("Parsed JSON array, but items are not in the expected timestamp format. Trying as plain text.","warn"):d("Parsed JSON, but couldn't find valid timestamps. Trying as plain text.","warn")}catch{}if(!c){let u=o.split(`
`).map(m=>m.trim()).filter(m=>m);if(u.length>0){let m=!1;u.forEach(x=>{let w=x.match(/^(?:(\d{1,2}):)?(\d{1,2}):(\d{2})\s*(.*)$/);if(w){m=!0;let f=parseInt(w[1])||0,h=parseInt(w[2]),S=parseInt(w[3]),A=f*3600+h*60+S,E=w[4]?w[4].trim():"",I=null,P=E,Z=E.match(/<!--\s*guid:([^>]+?)\s*-->/);Z&&(I=Z[1].trim(),P=E.replace(/<!--\s*guid:[^>]+?\s*-->/,"").trim());let W;if(I&&(W=me().find(X=>X.dataset.guid===I)),!W&&!I&&(W=me().find(X=>{if(X.dataset.guid)return!1;let Me=X.querySelector("a[data-time]")?.dataset.time;if(!Me)return!1;let et=Number.parseInt(Me,10);return Number.isFinite(et)&&et===A})),W){let X=W.querySelector("input");X&&(X.value=P)}else mr(A,P,!1,I||crypto.randomUUID())}}),m&&(c=!0)}}c?(d("Timestamps changed: Imported timestamps from file/clipboard"),yt(),qr(Ce),Fe(),Vr()):alert("Failed to parse content. Please ensure it is in the correct JSON or plain text format.")}async function Bs(){if(yi){d("Pane initialization already in progress, skipping duplicate call");return}if(!(r&&document.body.contains(r))){yi=!0;try{let m=function(){if(be||en)return;let y=St(),g=ce();if(!y&&!g)return;let k=g?g.getCurrentTime():0,T=Number.isFinite(k)?Math.max(0,Math.floor(k)):Math.max(0,Xt()),B=Math.floor(T/3600),$=Math.floor(T/60)%60,N=T%60,{isLive:Y}=g?g.getVideoData()||{isLive:!1}:{isLive:!1},H=g?hs(g):!1,ae=s?me().map(re=>{let Ae=re.querySelector("a[data-time]");return Ae?parseFloat(Ae.getAttribute("data-time")??"0"):0}):[],je="";if(ae.length>0)if(Y){let re=Math.max(1,T/60),Ae=ae.filter(He=>He<=T);if(Ae.length>0){let He=(Ae.length/re).toFixed(2);parseFloat(He)>0&&(je=` (${He}/min)`)}}else{let re=g?g.getDuration():0,Ae=Number.isFinite(re)&&re>0?re:y&&Number.isFinite(y.duration)&&y.duration>0?y.duration:0,He=Math.max(1,Ae/60),Dt=(ae.length/He).toFixed(1);parseFloat(Dt)>0&&(je=` (${Dt}/min)`)}p.textContent=`\u23F3${B?B+":"+String($).padStart(2,"0"):$}:${String(N).padStart(2,"0")}${je}`,p.style.color=H?"#ff4d4f":"",ae.length>0&&tn(T,!1)},X=function(y,g,k){let T=document.createElement("button");return T.textContent=y,bt(T,g),T.classList.add("ytls-settings-modal-button"),T.onclick=k,T},qe=function(y="general"){if(F&&F.parentNode===document.body){let ze=document.getElementById("ytls-save-modal"),Ut=document.getElementById("ytls-load-modal"),Bt=document.getElementById("ytls-delete-all-modal");ze&&document.body.contains(ze)&&document.body.removeChild(ze),Ut&&document.body.contains(Ut)&&document.body.removeChild(Ut),Bt&&document.body.contains(Bt)&&document.body.removeChild(Bt),F.classList.remove("ytls-fade-in"),F.classList.add("ytls-fade-out"),setTimeout(()=>{document.body.contains(F)&&document.body.removeChild(F),F=null,document.removeEventListener("click",et,!0),document.removeEventListener("keydown",Me)},300);return}F=document.createElement("div"),F.id="ytls-settings-modal",F.classList.remove("ytls-fade-out"),F.classList.add("ytls-fade-in");let g=document.createElement("div");g.className="ytls-modal-header";let k=document.createElement("div");k.id="ytls-settings-nav";let T=document.createElement("button");T.className="ytls-modal-close-button",T.textContent="\u2715",T.onclick=()=>{if(F&&F.parentNode===document.body){let ze=document.getElementById("ytls-save-modal"),Ut=document.getElementById("ytls-load-modal"),Bt=document.getElementById("ytls-delete-all-modal");ze&&document.body.contains(ze)&&document.body.removeChild(ze),Ut&&document.body.contains(Ut)&&document.body.removeChild(Ut),Bt&&document.body.contains(Bt)&&document.body.removeChild(Bt),F.classList.remove("ytls-fade-in"),F.classList.add("ytls-fade-out"),setTimeout(()=>{document.body.contains(F)&&document.body.removeChild(F),F=null,document.removeEventListener("click",et,!0),document.removeEventListener("keydown",Me)},300)}};let B=document.createElement("div");B.id="ytls-settings-content";let $=document.createElement("h3");$.className="ytls-section-heading",$.textContent="General",$.style.display="none";let N=document.createElement("div"),Y=document.createElement("div");Y.className="ytls-button-grid";function H(ze){N.style.display=ze==="general"?"block":"none",Y.style.display=ze==="drive"?"block":"none",ae.classList.toggle("active",ze==="general"),re.classList.toggle("active",ze==="drive"),$.textContent=ze==="general"?"General":"Google Drive"}let ae=document.createElement("button");ae.textContent="\u{1F6E0}\uFE0F";let je=document.createElement("span");je.className="ytls-tab-text",je.textContent=" General",ae.appendChild(je),bt(ae,"General settings"),ae.classList.add("ytls-settings-modal-button"),ae.onclick=()=>H("general");let re=document.createElement("button");re.textContent="\u2601\uFE0F";let Ae=document.createElement("span");Ae.className="ytls-tab-text",Ae.textContent=" Backup",re.appendChild(Ae),bt(re,"Google Drive sign-in and backup"),re.classList.add("ytls-settings-modal-button"),re.onclick=async()=>{q.isSignedIn&&await as(),H("drive")},k.appendChild(ae),k.appendChild(re),g.appendChild(k),g.appendChild(T),F.appendChild(g),N.className="ytls-button-grid",N.appendChild(X("\u{1F4BE} Save","Save As...",Ht.onclick)),N.appendChild(X("\u{1F4C2} Load","Load",Mt.onclick)),N.appendChild(X("\u{1F4E4} Export All","Export All Data",fe.onclick)),N.appendChild(X("\u{1F4E5} Import All","Import All Data",ee.onclick)),N.appendChild(X("\u{1F4C4} Export All (CSV)","Export All Timestamps to CSV",async()=>{try{await Ss()}catch{alert("Failed to export CSV: Could not read from database.")}}));let He=X(q.isSignedIn?"\u{1F513} Sign Out":"\u{1F510} Sign In",q.isSignedIn?"Sign out from Google Drive":"Sign in to Google Drive",async()=>{q.isSignedIn?await is():await ns(),He.textContent=q.isSignedIn?"\u{1F513} Sign Out":"\u{1F510} Sign In",bt(He,q.isSignedIn?"Sign out from Google Drive":"Sign in to Google Drive"),typeof he=="function"&&he()});Y.appendChild(He);let Dt=X(wt?"\u{1F501} Auto Backup: On":"\u{1F501} Auto Backup: Off","Toggle Auto Backup",async()=>{await cs(),Dt.textContent=wt?"\u{1F501} Auto Backup: On":"\u{1F501} Auto Backup: Off",typeof he=="function"&&he()});Y.appendChild(Dt);let rn=X(`\u23F1\uFE0F Backup Interval: ${it}min`,"Set periodic backup interval (minutes)",async()=>{await us(),rn.textContent=`\u23F1\uFE0F Backup Interval: ${it}min`,typeof he=="function"&&he()});Y.appendChild(rn),Y.appendChild(X("\u{1F5C4}\uFE0F Backup Now","Run a backup immediately",async()=>{await Cr(!1),typeof he=="function"&&he()}));let tt=document.createElement("div");tt.style.marginTop="15px",tt.style.paddingTop="10px",tt.style.borderTop="1px solid #555",tt.style.fontSize="12px",tt.style.color="#aaa";let an=document.createElement("div");an.style.marginBottom="8px",an.style.fontWeight="bold",tt.appendChild(an),Qa(an);let Li=document.createElement("div");Li.style.marginBottom="8px",Ja(Li),tt.appendChild(Li);let ma=document.createElement("div");Xa(ma),tt.appendChild(ma),Y.appendChild(tt),Ye(),Lr(),he(),B.appendChild($),B.appendChild(N),B.appendChild(Y),H(y),F.appendChild(B),document.body.appendChild(F),requestAnimationFrame(()=>{let ze=F.getBoundingClientRect(),Bt=(window.innerHeight-ze.height)/2;F.style.top=`${Math.max(20,Bt)}px`,F.style.transform="translateX(-50%)"}),setTimeout(()=>{document.addEventListener("click",et,!0),document.addEventListener("keydown",Me)},0)},Me=function(y){if(y.key==="Escape"&&F&&F.parentNode===document.body){let g=document.getElementById("ytls-save-modal"),k=document.getElementById("ytls-load-modal"),T=document.getElementById("ytls-delete-all-modal");if(g||k||T)return;y.preventDefault(),g&&document.body.contains(g)&&document.body.removeChild(g),k&&document.body.contains(k)&&document.body.removeChild(k),T&&document.body.contains(T)&&document.body.removeChild(T),F.classList.remove("ytls-fade-in"),F.classList.add("ytls-fade-out"),setTimeout(()=>{document.body.contains(F)&&document.body.removeChild(F),F=null,document.removeEventListener("click",et,!0),document.removeEventListener("keydown",Me)},300)}},et=function(y){if(Mr&&Mr.contains(y.target))return;let g=document.getElementById("ytls-save-modal"),k=document.getElementById("ytls-load-modal"),T=document.getElementById("ytls-delete-all-modal");g&&g.contains(y.target)||k&&k.contains(y.target)||T&&T.contains(y.target)||F&&F.contains(y.target)||(g&&document.body.contains(g)&&document.body.removeChild(g),k&&document.body.contains(k)&&document.body.removeChild(k),T&&document.body.contains(T)&&document.body.removeChild(T),F&&F.parentNode===document.body&&(F.classList.remove("ytls-fade-in"),F.classList.add("ytls-fade-out"),setTimeout(()=>{document.body.contains(F)&&document.body.removeChild(F),F=null,document.removeEventListener("click",et,!0),document.removeEventListener("keydown",Me)},300)))},Le=function(){r&&(d("Loading window position from IndexedDB"),Ei("windowPosition").then(y=>{let g=Va.safeParse(y);if(g.success){let T=g.data;r.style.left=`${T.x}px`,r.style.top=`${T.y}px`,r.style.right="auto",r.style.bottom="auto",typeof T.width=="number"&&T.width>0?r.style.width=`${T.width}px`:(r.style.width=`${En}px`,d(`No stored window width found, using default width ${En}px`)),typeof T.height=="number"&&T.height>0?r.style.height=`${T.height}px`:(r.style.height=`${Sn}px`,d(`No stored window height found, using default height ${Sn}px`));let B=de();pe(B,T.x,T.y),d("Restored window position from IndexedDB:",Ve)}else g.success?d("No window position found in IndexedDB, applying default size and leaving default position"):d("Window position in IndexedDB failed validation:",g.error.format(),"warn"),r.style.width=`${En}px`,r.style.height=`${Sn}px`,Ve=null;Mn();let k=de();k&&(k.width||k.height)&&pe(k),typeof window.recalculateTimestampsArea=="function"&&window.recalculateTimestampsArea()}).catch(y=>{d("failed to load pane position from IndexedDB:",y,"warn"),Mn();let g=de();g&&(g.width||g.height)&&(Ve={x:Math.max(0,Math.round(g.left)),y:0,width:Math.round(g.width),height:Math.round(g.height)}),typeof window.recalculateTimestampsArea=="function"&&window.recalculateTimestampsArea()}))},De=function(){if(!r)return;let y=de();if(!y)return;let g={x:Math.max(0,Math.round(y.left)),y:Math.max(0,Math.round(y.top)),width:Math.round(y.width),height:Math.round(y.height)};if(Ve&&Ve.x===g.x&&Ve.y===g.y&&Ve.width===g.width&&Ve.height===g.height){d("Skipping window position save; position and size unchanged");return}Ve={...g},d(`Saving window position and size to IndexedDB: x=${g.x}, y=${g.y}, width=${g.width}, height=${g.height}`),Wr("windowPosition",g),nr({type:"window_position_updated",position:g,timestamp:Date.now()})},Xr=function(y,g){y.addEventListener("dblclick",k=>{k.preventDefault(),k.stopPropagation(),r&&(r.style.width="300px",r.style.height="300px",De(),hr())}),y.addEventListener("mousedown",k=>{k.preventDefault(),k.stopPropagation(),$n=!0,nn=g,da=k.clientX,fa=k.clientY;let T=r.getBoundingClientRect();Fn=T.width,jn=T.height,Kr=T.left,Jr=T.top,g==="top-left"||g==="bottom-right"?document.body.style.cursor="nwse-resize":document.body.style.cursor="nesw-resize"})},hr=function(){if(r&&l&&v&&s){let y=r.getBoundingClientRect(),g=l.getBoundingClientRect(),k=v.getBoundingClientRect(),T=y.height-(g.height+k.height);s.style.maxHeight=T>0?T+"px":"0px",s.style.overflowY=T>0?"auto":"hidden"}};document.querySelectorAll("#ytls-pane").forEach(y=>y.remove()),r=document.createElement("div"),l=document.createElement("div"),s=document.createElement("ul"),v=document.createElement("div"),p=document.createElement("span"),b=document.createElement("style"),M=document.createElement("span"),R=document.createElement("span"),R.classList.add("ytls-backup-indicator"),R.style.cursor="pointer",R.style.backgroundColor="#666",R.onclick=y=>{y.stopPropagation(),qe("drive")},s.addEventListener("mouseenter",()=>{Ar=!0,lr=!1}),s.addEventListener("mouseleave",()=>{if(Ar=!1,lr)return;let y=ce(),g=y?Math.floor(y.getCurrentTime()):Xt();tn(g,!1);let k=null;if(document.activeElement instanceof HTMLInputElement&&s.contains(document.activeElement)&&(k=document.activeElement.closest("li")?.dataset.guid??null),ea(),k){let B=me().find($=>$.dataset.guid===k)?.querySelector("input");if(B)try{B.focus({preventScroll:!0})}catch{}}}),r.id="ytls-pane",l.id="ytls-pane-header",l.addEventListener("dblclick",y=>{let g=y.target instanceof HTMLElement?y.target:null;g&&(g.closest("a")||g.closest("button")||g.closest("#ytls-current-time")||g.closest(".ytls-version-display")||g.closest(".ytls-backup-indicator"))||(y.preventDefault(),Si(!1))});let o=y=>{try{y.stopPropagation()}catch{}};["click","dblclick","mousedown","pointerdown","touchstart","wheel"].forEach(y=>{r.addEventListener(y,o)}),r.addEventListener("keydown",y=>{try{y.stopPropagation()}catch{}}),r.addEventListener("keyup",y=>{try{y.stopPropagation()}catch{}}),r.addEventListener("focus",y=>{try{y.stopPropagation()}catch{}},!0),r.addEventListener("blur",y=>{try{y.stopPropagation()}catch{}},!0);let c=GM_info.script.version;M.textContent=`v${c}`,M.classList.add("ytls-version-display");let u=document.createElement("span");u.style.display="inline-flex",u.style.alignItems="center",u.style.gap="6px",u.appendChild(M),u.appendChild(R),p.id="ytls-current-time",p.textContent="\u23F3",p.onclick=()=>{en=!0;let y=ce();y&&y.seekToLiveHead(),setTimeout(()=>{en=!1},500)},m(),ye&&clearInterval(ye),ye=setInterval(m,1e3),v.id="ytls-buttons";let x=(y,g)=>()=>{y.classList.remove("ytls-fade-in"),y.classList.add("ytls-fade-out"),setTimeout(()=>{document.body.contains(y)&&document.body.removeChild(y),g&&g()},300)},w=y=>g=>{g.key==="Escape"&&(g.preventDefault(),g.stopPropagation(),y())},f=y=>{setTimeout(()=>{document.addEventListener("keydown",y)},0)},h=(y,g)=>k=>{y.contains(k.target)||g()},S=y=>{setTimeout(()=>{document.addEventListener("click",y,!0)},0)},Z=[{label:"\u{1F423}",title:"Add timestamp",action:()=>{if(!s||s.querySelector(".ytls-error-message")||be)return;let y=typeof In<"u"?In:0,g=ce(),k=g?Math.floor(g.getCurrentTime()+y):0;if(!Number.isFinite(k))return;let T=mr(k,"");T&&T.focus()}},{label:"\u2699\uFE0F",title:"Settings",action:()=>qe()},{label:"\u{1F4CB}",title:"Copy timestamps to clipboard",action:function(y){if(!s||s.querySelector(".ytls-error-message")||be){this.textContent="\u274C",setTimeout(()=>{this.textContent="\u{1F4CB}"},2e3);return}let g=vi(),k=Math.max(Xt(),0);if(g.length===0){this.textContent="\u274C",setTimeout(()=>{this.textContent="\u{1F4CB}"},2e3);return}let T=y.ctrlKey,B=g.map($=>{let N=Wt($.start,k);return T?`${N} ${$.comment} <!-- guid:${$.guid} -->`.trimStart():`${N} ${$.comment}`}).join(`
`);navigator.clipboard.writeText(B).then(()=>{this.textContent="\u2705",setTimeout(()=>{this.textContent="\u{1F4CB}"},2e3)}).catch($=>{d("Failed to copy timestamps: ",$,"error"),this.textContent="\u274C",setTimeout(()=>{this.textContent="\u{1F4CB}"},2e3)})}},{label:"\u23F1\uFE0F",title:"Offset all timestamps",action:()=>{if(!s||s.querySelector(".ytls-error-message")||be)return;if(me().length===0){alert("No timestamps available to offset.");return}let g=prompt("Enter the number of seconds to offset all timestamps (positive or negative integer):","0");if(g===null)return;let k=g.trim();if(k.length===0)return;let T=Number.parseInt(k,10);if(!Number.isFinite(T)){alert("Please enter a valid integer number of seconds.");return}T!==0&&Xi(T,{alertOnNoChange:!0,failureMessage:"Offset had no effect because timestamps are already at the requested bounds.",logLabel:"bulk offset"})}},{label:"\u{1F5D1}\uFE0F",title:"Delete all timestamps for current video",action:async()=>{let y=Ti();if(!y){alert("Unable to determine current video ID.");return}let g=document.createElement("div");g.id="ytls-delete-all-modal",g.classList.remove("ytls-fade-out"),g.classList.add("ytls-fade-in");let k=document.createElement("p");k.textContent="Hold the button to delete all timestamps for:",k.style.marginBottom="10px";let T=document.createElement("p");T.textContent=y,T.style.fontFamily="monospace",T.style.fontSize="12px",T.style.marginBottom="15px",T.style.color="#aaa";let B=document.createElement("button");B.classList.add("ytls-save-modal-button"),B.style.background="#d32f2f",B.style.position="relative",B.style.overflow="hidden";let $=null,N=0,Y=null,H=document.createElement("div");H.style.position="absolute",H.style.left="0",H.style.top="0",H.style.height="100%",H.style.width="0%",H.style.background="#ff6b6b",H.style.transition="none",H.style.pointerEvents="none",B.appendChild(H);let ae=document.createElement("span");ae.textContent="Hold to Delete All",ae.style.position="relative",ae.style.zIndex="1",B.appendChild(ae);let je=()=>{if(!N)return;let tt=Date.now()-N,an=Math.min(tt/5e3*100,100);H.style.width=`${an}%`,an<100&&(Y=requestAnimationFrame(je))},re=()=>{$&&(clearTimeout($),$=null),Y&&(cancelAnimationFrame(Y),Y=null),N=0,H.style.width="0%",ae.textContent="Hold to Delete All"};B.onmousedown=()=>{N=Date.now(),ae.textContent="Deleting...",Y=requestAnimationFrame(je),$=setTimeout(async()=>{re(),g.classList.remove("ytls-fade-in"),g.classList.add("ytls-fade-out"),setTimeout(async()=>{document.body.contains(g)&&document.body.removeChild(g);try{await Ms(y),Ci()}catch(tt){d("Failed to delete all timestamps:",tt,"error"),alert("Failed to delete timestamps. Check console for details.")}},300)},5e3)},B.onmouseup=re,B.onmouseleave=re;let Ae=null,He=null,Dt=x(g,()=>{re(),Ae&&document.removeEventListener("keydown",Ae),He&&document.removeEventListener("click",He,!0)});Ae=w(Dt),He=h(g,Dt);let rn=document.createElement("button");rn.textContent="Cancel",rn.classList.add("ytls-save-modal-cancel-button"),rn.onclick=Dt,g.appendChild(k),g.appendChild(T),g.appendChild(B),g.appendChild(rn),document.body.appendChild(g),f(Ae),S(He)}}],W=Ea();Z.forEach(y=>{let g=document.createElement("button");if(g.textContent=y.label,bt(g,y.title),g.classList.add("ytls-main-button"),y.label==="\u{1F423}"&&W){let k=document.createElement("span");k.textContent=W,k.classList.add("ytls-holiday-emoji"),g.appendChild(k)}y.label==="\u{1F4CB}"?g.onclick=function(k){y.action.call(this,k)}:g.onclick=y.action,y.label==="\u2699\uFE0F"&&(Mr=g),v.appendChild(g)});let Ht=document.createElement("button");Ht.textContent="\u{1F4BE} Save",Ht.classList.add("ytls-file-operation-button"),Ht.onclick=()=>{let y=document.createElement("div");y.id="ytls-save-modal",y.classList.remove("ytls-fade-out"),y.classList.add("ytls-fade-in");let g=document.createElement("p");g.textContent="Save as:";let k=null,T=null,B=x(y,()=>{k&&document.removeEventListener("keydown",k),T&&document.removeEventListener("click",T,!0)});k=w(B),T=h(y,B);let $=document.createElement("button");$.textContent="JSON",$.classList.add("ytls-save-modal-button"),$.onclick=()=>{k&&document.removeEventListener("keydown",k),T&&document.removeEventListener("click",T,!0),x(y,()=>ta("json"))()};let N=document.createElement("button");N.textContent="Plain Text",N.classList.add("ytls-save-modal-button"),N.onclick=()=>{k&&document.removeEventListener("keydown",k),T&&document.removeEventListener("click",T,!0),x(y,()=>ta("text"))()};let Y=document.createElement("button");Y.textContent="Cancel",Y.classList.add("ytls-save-modal-cancel-button"),Y.onclick=B,y.appendChild(g),y.appendChild($),y.appendChild(N),y.appendChild(Y),document.body.appendChild(y),f(k),S(T)};let Mt=document.createElement("button");Mt.textContent="\u{1F4C2} Load",Mt.classList.add("ytls-file-operation-button"),Mt.onclick=()=>{let y=document.createElement("div");y.id="ytls-load-modal",y.classList.remove("ytls-fade-out"),y.classList.add("ytls-fade-in");let g=document.createElement("p");g.textContent="Load from:";let k=null,T=null,B=x(y,()=>{k&&document.removeEventListener("keydown",k),T&&document.removeEventListener("click",T,!0)});k=w(B),T=h(y,B);let $=document.createElement("button");$.textContent="File",$.classList.add("ytls-save-modal-button"),$.onclick=()=>{let H=document.createElement("input");H.type="file",H.accept=".json,.txt",H.classList.add("ytls-hidden-file-input"),H.onchange=ae=>{let je=ae.target.files?.[0];if(!je)return;k&&document.removeEventListener("keydown",k),T&&document.removeEventListener("click",T,!0),B();let re=new FileReader;re.onload=()=>{let Ae=String(re.result).trim();la(Ae)},re.readAsText(je)},H.click()};let N=document.createElement("button");N.textContent="Clipboard",N.classList.add("ytls-save-modal-button"),N.onclick=async()=>{k&&document.removeEventListener("keydown",k),T&&document.removeEventListener("click",T,!0),x(y,async()=>{try{let H=await navigator.clipboard.readText();H?la(H.trim()):alert("Clipboard is empty.")}catch(H){d("Failed to read from clipboard: ",H,"error"),alert("Failed to read from clipboard. Ensure you have granted permission.")}})()};let Y=document.createElement("button");Y.textContent="Cancel",Y.classList.add("ytls-save-modal-cancel-button"),Y.onclick=B,y.appendChild(g),y.appendChild($),y.appendChild(N),y.appendChild(Y),document.body.appendChild(y),f(k),S(T)};let fe=document.createElement("button");fe.textContent="\u{1F4E4} Export",fe.classList.add("ytls-file-operation-button"),fe.onclick=async()=>{try{await _s()}catch{alert("Failed to export data: Could not read from database.")}};let ee=document.createElement("button");ee.textContent="\u{1F4E5} Import",ee.classList.add("ytls-file-operation-button"),ee.onclick=()=>{let y=document.createElement("input");y.type="file",y.accept=".json",y.classList.add("ytls-hidden-file-input"),y.onchange=g=>{let k=g.target.files?.[0];if(!k)return;let T=new FileReader;T.onload=()=>{try{let B=JSON.parse(String(T.result)),$=[];for(let N in B)if(Object.prototype.hasOwnProperty.call(B,N)&&N.startsWith("ytls-")){let Y=N.substring(5),H=B[N];if(H&&typeof H.video_id=="string"&&Array.isArray(H.timestamps)){let ae=H.timestamps.map(re=>({...re,guid:re.guid||crypto.randomUUID()})),je=aa(Y,ae).then(()=>d(`Imported ${Y} to IndexedDB`)).catch(re=>d(`Failed to import ${Y} to IndexedDB:`,re,"error"));$.push(je)}else d(`Skipping key ${N} during import due to unexpected data format.`,"warn")}Promise.all($).then(()=>{Ci()}).catch(N=>{alert("An error occurred during import to IndexedDB. Check console for details."),d("Overall import error:",N,"error")})}catch(B){alert(`Failed to import data. Please ensure the file is in the correct format.
`+B.message),d("Import error:",B,"error")}},T.readAsText(k)},y.click()},b.textContent=La,s.onclick=y=>{Qi(y)},s.ontouchstart=y=>{Qi(y)},r.style.position="fixed",r.style.bottom="0",r.style.right="0",r.style.transition="none",Le(),setTimeout(()=>Mn(),10);let ue=!1,Ie,vt,ot=!1;r.addEventListener("mousedown",y=>{let g=y.target;g instanceof Element&&(g instanceof HTMLInputElement||g instanceof HTMLTextAreaElement||g!==l&&!l.contains(g)&&window.getComputedStyle(g).cursor==="pointer"||(ue=!0,ot=!1,Ie=y.clientX-r.getBoundingClientRect().left,vt=y.clientY-r.getBoundingClientRect().top,r.style.transition="none"))}),document.addEventListener("mousemove",Br=y=>{if(!ue)return;ot=!0;let g=y.clientX-Ie,k=y.clientY-vt,T=r.getBoundingClientRect(),B=T.width,$=T.height,N=document.documentElement.clientWidth,Y=document.documentElement.clientHeight;g=Math.max(0,Math.min(g,N-B)),k=Math.max(0,Math.min(k,Y-$)),r.style.left=`${g}px`,r.style.top=`${k}px`,r.style.right="auto",r.style.bottom="auto"}),document.addEventListener("mouseup",Rr=()=>{if(!ue)return;ue=!1;let y=ot;setTimeout(()=>{ot=!1},50),Mn(),setTimeout(()=>{y&&De()},200)}),r.addEventListener("dragstart",y=>y.preventDefault());let Pn=document.createElement("div"),Yr=document.createElement("div"),zn=document.createElement("div"),Nn=document.createElement("div");Pn.id="ytls-resize-tl",Yr.id="ytls-resize-tr",zn.id="ytls-resize-bl",Nn.id="ytls-resize-br";let $n=!1,da=0,fa=0,Fn=0,jn=0,Kr=0,Jr=0,nn=null;Xr(Pn,"top-left"),Xr(Yr,"top-right"),Xr(zn,"bottom-left"),Xr(Nn,"bottom-right"),document.addEventListener("mousemove",y=>{if(!$n||!r||!nn)return;let g=y.clientX-da,k=y.clientY-fa,T=Fn,B=jn,$=Kr,N=Jr,Y=document.documentElement.clientWidth,H=document.documentElement.clientHeight;nn==="bottom-right"?(T=Math.max(200,Math.min(800,Fn+g)),B=Math.max(250,Math.min(H,jn+k))):nn==="top-left"?(T=Math.max(200,Math.min(800,Fn-g)),$=Kr+g,B=Math.max(250,Math.min(H,jn-k)),N=Jr+k):nn==="top-right"?(T=Math.max(200,Math.min(800,Fn+g)),B=Math.max(250,Math.min(H,jn-k)),N=Jr+k):nn==="bottom-left"&&(T=Math.max(200,Math.min(800,Fn-g)),$=Kr+g,B=Math.max(250,Math.min(H,jn+k))),$=Math.max(0,Math.min($,Y-T)),N=Math.max(0,Math.min(N,H-B)),r.style.width=`${T}px`,r.style.height=`${B}px`,r.style.left=`${$}px`,r.style.top=`${N}px`,r.style.right="auto",r.style.bottom="auto"}),document.addEventListener("mouseup",()=>{$n&&($n=!1,nn=null,document.body.style.cursor="",J(!0))});let Qr=null;window.addEventListener("resize",Or=()=>{Qr&&clearTimeout(Qr),Qr=setTimeout(()=>{J(!0),Qr=null},200)}),l.appendChild(p),l.appendChild(u);let ei=document.createElement("div");if(ei.id="ytls-content",ei.append(s),ei.append(v),r.append(l,ei,b,Pn,Yr,zn,Nn),r.addEventListener("mousemove",y=>{try{if(ue||$n)return;let g=r.getBoundingClientRect(),k=20,T=y.clientX,B=y.clientY,$=T-g.left<=k,N=g.right-T<=k,Y=B-g.top<=k,H=g.bottom-B<=k,ae="";Y&&$||H&&N?ae="nwse-resize":Y&&N||H&&$?ae="nesw-resize":ae="",document.body.style.cursor=ae}catch{}}),r.addEventListener("mouseleave",()=>{!$n&&!ue&&(document.body.style.cursor="")}),window.recalculateTimestampsArea=hr,setTimeout(()=>{if(hr(),r&&l&&v&&s){let y=40,g=me();if(g.length>0)y=g[0].offsetHeight;else{let k=document.createElement("li");k.style.visibility="hidden",k.style.position="absolute",k.textContent="00:00 Example",s.appendChild(k),y=k.offsetHeight,s.removeChild(k)}j=l.offsetHeight+v.offsetHeight+y,r.style.minHeight=j+"px"}},0),window.addEventListener("resize",hr),gt){try{gt.disconnect()}catch{}gt=null}gt=new ResizeObserver(hr),gt.observe(r),sr||document.addEventListener("pointerdown",sr=()=>{Ki=Date.now()},!0),or||document.addEventListener("pointerup",or=()=>{},!0)}finally{yi=!1}}}async function Rs(){if(!r)return;if(document.querySelectorAll("#ytls-pane").forEach(u=>{u!==r&&(d("Removing duplicate pane element from DOM"),u.remove())}),document.body.contains(r)){d("Pane already in DOM, skipping append");return}await Ds(),typeof Vi=="function"&&Vi(ia),typeof fi=="function"&&fi(Wr),typeof mi=="function"&&mi(Ei),typeof Gi=="function"&&Gi(R),await qi(),await os(),await tr(),typeof hi=="function"&&hi();let c=document.querySelectorAll("#ytls-pane");if(c.length>0&&(d(`WARNING: Found ${c.length} existing pane(s) in DOM, removing all`),c.forEach(u=>u.remove())),document.body.contains(r)){d("ERROR: Pane already in body, aborting append");return}if(document.body.appendChild(r),d("Pane successfully appended to DOM"),ge(),ke&&(clearTimeout(ke),ke=null),ke=setTimeout(()=>{V(),typeof window.recalculateTimestampsArea=="function"&&window.recalculateTimestampsArea(),xe(),J(!0),ke=null},450),ht){try{ht.disconnect()}catch{}ht=null}ht=new MutationObserver(()=>{let u=document.querySelectorAll("#ytls-pane");u.length>1&&(d(`CRITICAL: Multiple panes detected (${u.length}), removing duplicates`),u.forEach((m,x)=>{(x>0||r&&m!==r)&&m.remove()}))}),ht.observe(document.body,{childList:!0,subtree:!0})}function ca(o=0){if(document.getElementById("ytls-header-button")){At();return}let c=document.querySelector("#logo");if(!c||!c.parentElement){o<10&&setTimeout(()=>ca(o+1),300);return}let u=document.createElement("button");u.id="ytls-header-button",u.type="button",u.className="ytls-header-button",bt(u,"Toggle Timekeeper UI"),u.setAttribute("aria-label","Toggle Timekeeper UI");let m=document.createElement("img");m.src=Pe,m.alt="",m.decoding="async",u.appendChild(m),jt=m,u.addEventListener("mouseenter",()=>{jt&&(Dr=!0,jt.src=Ue)}),u.addEventListener("mouseleave",()=>{jt&&(Dr=!1,At())}),u.addEventListener("click",()=>{r&&!document.body.contains(r)&&(d("Pane not in DOM, re-appending before toggle"),document.body.appendChild(r)),Si()}),c.insertAdjacentElement("afterend",u),At(),d("Timekeeper header button added next to YouTube logo")}function ua(){if(ie)return;ie=!0;let o=history.pushState,c=history.replaceState;function u(){try{let m=new Event("locationchange");window.dispatchEvent(m)}catch{}}history.pushState=function(){let m=o.apply(this,arguments);return u(),m},history.replaceState=function(){let m=c.apply(this,arguments);return u(),m},window.addEventListener("popstate",u),window.addEventListener("locationchange",()=>{window.location.href!==oe&&d("Location changed (locationchange event) \u2014 deferring UI update until navigation finish")})}async function Ci(){if(!a()){xs();return}oe=window.location.href,document.querySelectorAll("#ytls-pane").forEach((c,u)=>{(u>0||r&&c!==r)&&c.remove()}),await we(),await Bs(),Ce=Ti();let o=document.title;d("Page Title:",o),d("Video ID:",Ce),d("Current URL:",window.location.href),wi(!0),Qt(),Fe(),await ra(),Fe(),wi(!1),d("Timestamps loaded and UI unlocked for video:",Ce),await Rs(),ca(),ws()}ua(),window.addEventListener("yt-navigate-start",()=>{d("Navigation started (yt-navigate-start event fired)"),a()&&r&&s&&(d("Locking UI and showing loading state for navigation"),wi(!0))}),ar=o=>{o.ctrlKey&&o.altKey&&o.shiftKey&&(o.key==="T"||o.key==="t")&&(o.preventDefault(),Si(),d("Timekeeper UI toggled via keyboard shortcut (Ctrl+Alt+Shift+T)"))},document.addEventListener("keydown",ar),window.addEventListener("yt-navigate-finish",()=>{d("Navigation finished (yt-navigate-finish event fired)"),window.location.href!==oe?Ci():d("Navigation finished but URL already handled, skipping.")}),ua(),d("Timekeeper initialized and waiting for navigation events")})();})();


// ==UserScript==
// @name         Timekeeper
// @namespace    https://violentmonkey.github.io/
// @version      4.5.71
// @description  Enhanced timestamp tool for YouTube videos
// @author       Silent Shout
// @match        https://www.youtube.com/*
// @run-at       document-idle
// @noframes
// @icon         https://raw.githubusercontent.com/KamoTimestamps/timekeeper/refs/heads/main/assets/Kamo_64px_Indexed.png
// @grant        GM.getValue
// @grant        GM.setValue
// @grant        GM.setClipboard
// @homepageURL  https://github.com/KamoTimestamps/timekeeper
// @supportURL   https://github.com/KamoTimestamps/timekeeper/issues
// @downloadURL  https://raw.githubusercontent.com/KamoTimestamps/timekeeper/main/timekeeper.user.js
// @updateURL    https://raw.githubusercontent.com/KamoTimestamps/timekeeper/main/timekeeper.user.js
// @license MIT
// ==/UserScript==

(()=>{var zs=Object.defineProperty;var Ua=(t,e)=>{for(var n in e)zs(t,n,{get:e[n],enumerable:!0})};var M={};Ua(M,{BRAND:()=>dl,DIRTY:()=>pn,EMPTY_PATH:()=>Us,INVALID:()=>O,NEVER:()=>Yl,OK:()=>$e,ParseStatus:()=>Me,Schema:()=>V,ZodAny:()=>en,ZodArray:()=>jt,ZodBigInt:()=>hn,ZodBoolean:()=>gn,ZodBranded:()=>wr,ZodCatch:()=>An,ZodDate:()=>yn,ZodDefault:()=>_n,ZodDiscriminatedUnion:()=>ci,ZodEffects:()=>ft,ZodEnum:()=>Sn,ZodError:()=>Ye,ZodFirstPartyTypeKind:()=>N,ZodFunction:()=>di,ZodIntersection:()=>wn,ZodIssueCode:()=>T,ZodLazy:()=>Tn,ZodLiteral:()=>kn,ZodMap:()=>qn,ZodNaN:()=>Wn,ZodNativeEnum:()=>En,ZodNever:()=>St,ZodNull:()=>xn,ZodNullable:()=>Dt,ZodNumber:()=>fn,ZodObject:()=>Je,ZodOptional:()=>mt,ZodParsedType:()=>L,ZodPipeline:()=>Tr,ZodPromise:()=>tn,ZodReadonly:()=>Ln,ZodRecord:()=>ui,ZodSchema:()=>V,ZodSet:()=>Zn,ZodString:()=>Qt,ZodSymbol:()=>Gn,ZodTransformer:()=>ft,ZodTuple:()=>Mt,ZodType:()=>V,ZodUndefined:()=>vn,ZodUnion:()=>bn,ZodUnknown:()=>Ft,ZodVoid:()=>Vn,addIssueToContext:()=>_,any:()=>bl,array:()=>Sl,bigint:()=>hl,boolean:()=>eo,coerce:()=>Wl,custom:()=>Ka,date:()=>gl,datetimeRegex:()=>Ya,defaultErrorMap:()=>zt,discriminatedUnion:()=>Ll,effect:()=>Hl,enum:()=>Nl,function:()=>Rl,getErrorMap:()=>Fn,getParsedType:()=>Ct,instanceof:()=>pl,intersection:()=>Il,isAborted:()=>si,isAsync:()=>jn,isDirty:()=>li,isValid:()=>Xt,late:()=>ml,lazy:()=>Ol,literal:()=>Pl,makeIssue:()=>br,map:()=>Dl,nan:()=>fl,nativeEnum:()=>$l,never:()=>Tl,null:()=>xl,nullable:()=>jl,number:()=>Qa,object:()=>El,objectUtil:()=>Gi,oboolean:()=>Zl,onumber:()=>ql,optional:()=>Fl,ostring:()=>Vl,pipeline:()=>Gl,preprocess:()=>Ul,promise:()=>zl,quotelessJson:()=>Hs,record:()=>Ml,set:()=>Bl,setErrorMap:()=>js,strictObject:()=>_l,string:()=>Xa,symbol:()=>yl,transformer:()=>Hl,tuple:()=>Cl,undefined:()=>vl,union:()=>Al,unknown:()=>wl,util:()=>Y,void:()=>kl});var Y;(function(t){t.assertEqual=a=>{};function e(a){}t.assertIs=e;function n(a){throw new Error}t.assertNever=n,t.arrayToEnum=a=>{let i={};for(let s of a)i[s]=s;return i},t.getValidEnumValues=a=>{let i=t.objectKeys(a).filter(o=>typeof a[a[o]]!="number"),s={};for(let o of i)s[o]=a[o];return t.objectValues(s)},t.objectValues=a=>t.objectKeys(a).map(function(i){return a[i]}),t.objectKeys=typeof Object.keys=="function"?a=>Object.keys(a):a=>{let i=[];for(let s in a)Object.prototype.hasOwnProperty.call(a,s)&&i.push(s);return i},t.find=(a,i)=>{for(let s of a)if(i(s))return s},t.isInteger=typeof Number.isInteger=="function"?a=>Number.isInteger(a):a=>typeof a=="number"&&Number.isFinite(a)&&Math.floor(a)===a;function r(a,i=" | "){return a.map(s=>typeof s=="string"?`'${s}'`:s).join(i)}t.joinValues=r,t.jsonStringifyReplacer=(a,i)=>typeof i=="bigint"?i.toString():i})(Y||(Y={}));var Gi;(function(t){t.mergeShapes=(e,n)=>({...e,...n})})(Gi||(Gi={}));var L=Y.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Ct=t=>{switch(typeof t){case"undefined":return L.undefined;case"string":return L.string;case"number":return Number.isNaN(t)?L.nan:L.number;case"boolean":return L.boolean;case"function":return L.function;case"bigint":return L.bigint;case"symbol":return L.symbol;case"object":return Array.isArray(t)?L.array:t===null?L.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?L.promise:typeof Map<"u"&&t instanceof Map?L.map:typeof Set<"u"&&t instanceof Set?L.set:typeof Date<"u"&&t instanceof Date?L.date:L.object;default:return L.unknown}};var T=Y.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Hs=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:"),Ye=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};let n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=e}format(e){let n=e||function(i){return i.message},r={_errors:[]},a=i=>{for(let s of i.issues)if(s.code==="invalid_union")s.unionErrors.map(a);else if(s.code==="invalid_return_type")a(s.returnTypeError);else if(s.code==="invalid_arguments")a(s.argumentsError);else if(s.path.length===0)r._errors.push(n(s));else{let o=r,m=0;for(;m<s.path.length;){let u=s.path[m];m===s.path.length-1?(o[u]=o[u]||{_errors:[]},o[u]._errors.push(n(s))):o[u]=o[u]||{_errors:[]},o=o[u],m++}}};return a(this),r}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Y.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=n=>n.message){let n={},r=[];for(let a of this.issues)if(a.path.length>0){let i=a.path[0];n[i]=n[i]||[],n[i].push(e(a))}else r.push(e(a));return{formErrors:r,fieldErrors:n}}get formErrors(){return this.flatten()}};Ye.create=t=>new Ye(t);var Fs=(t,e)=>{let n;switch(t.code){case T.invalid_type:t.received===L.undefined?n="Required":n=`Expected ${t.expected}, received ${t.received}`;break;case T.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(t.expected,Y.jsonStringifyReplacer)}`;break;case T.unrecognized_keys:n=`Unrecognized key(s) in object: ${Y.joinValues(t.keys,", ")}`;break;case T.invalid_union:n="Invalid input";break;case T.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${Y.joinValues(t.options)}`;break;case T.invalid_enum_value:n=`Invalid enum value. Expected ${Y.joinValues(t.options)}, received '${t.received}'`;break;case T.invalid_arguments:n="Invalid function arguments";break;case T.invalid_return_type:n="Invalid function return type";break;case T.invalid_date:n="Invalid date";break;case T.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(n=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(n=`${n} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?n=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?n=`Invalid input: must end with "${t.validation.endsWith}"`:Y.assertNever(t.validation):t.validation!=="regex"?n=`Invalid ${t.validation}`:n="Invalid";break;case T.too_small:t.type==="array"?n=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?n=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?n=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="bigint"?n=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?n=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:n="Invalid input";break;case T.too_big:t.type==="array"?n=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?n=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?n=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?n=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?n=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:n="Invalid input";break;case T.custom:n="Invalid input";break;case T.invalid_intersection_types:n="Intersection results could not be merged";break;case T.not_multiple_of:n=`Number must be a multiple of ${t.multipleOf}`;break;case T.not_finite:n="Number must be finite";break;default:n=e.defaultError,Y.assertNever(t)}return{message:n}},zt=Fs;var Ga=zt;function js(t){Ga=t}function Fn(){return Ga}var br=t=>{let{data:e,path:n,errorMaps:r,issueData:a}=t,i=[...n,...a.path||[]],s={...a,path:i};if(a.message!==void 0)return{...a,path:i,message:a.message};let o="",m=r.filter(u=>!!u).slice().reverse();for(let u of m)o=u(s,{data:e,defaultError:o}).message;return{...a,path:i,message:o}},Us=[];function _(t,e){let n=Fn(),r=br({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,n,n===zt?void 0:zt].filter(a=>!!a)});t.common.issues.push(r)}var Me=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,n){let r=[];for(let a of n){if(a.status==="aborted")return O;a.status==="dirty"&&e.dirty(),r.push(a.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,n){let r=[];for(let a of n){let i=await a.key,s=await a.value;r.push({key:i,value:s})}return t.mergeObjectSync(e,r)}static mergeObjectSync(e,n){let r={};for(let a of n){let{key:i,value:s}=a;if(i.status==="aborted"||s.status==="aborted")return O;i.status==="dirty"&&e.dirty(),s.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof s.value<"u"||a.alwaysSet)&&(r[i.value]=s.value)}return{status:e.value,value:r}}},O=Object.freeze({status:"aborted"}),pn=t=>({status:"dirty",value:t}),$e=t=>({status:"valid",value:t}),si=t=>t.status==="aborted",li=t=>t.status==="dirty",Xt=t=>t.status==="valid",jn=t=>typeof Promise<"u"&&t instanceof Promise;var C;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(C||(C={}));var pt=class{constructor(e,n,r,a){this._cachedPath=[],this.parent=e,this.data=n,this._path=r,this._key=a}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},Va=(t,e)=>{if(Xt(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let n=new Ye(t.common.issues);return this._error=n,this._error}}};function U(t){if(!t)return{};let{errorMap:e,invalid_type_error:n,required_error:r,description:a}=t;if(e&&(n||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:a}:{errorMap:(s,o)=>{let{message:m}=t;return s.code==="invalid_enum_value"?{message:m??o.defaultError}:typeof o.data>"u"?{message:m??r??o.defaultError}:s.code!=="invalid_type"?{message:o.defaultError}:{message:m??n??o.defaultError}},description:a}}var V=class{get description(){return this._def.description}_getType(e){return Ct(e.data)}_getOrReturnCtx(e,n){return n||{common:e.parent.common,data:e.data,parsedType:Ct(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Me,ctx:{common:e.parent.common,data:e.data,parsedType:Ct(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let n=this._parse(e);if(jn(n))throw new Error("Synchronous parse encountered promise.");return n}_parseAsync(e){let n=this._parse(e);return Promise.resolve(n)}parse(e,n){let r=this.safeParse(e,n);if(r.success)return r.data;throw r.error}safeParse(e,n){let r={common:{issues:[],async:n?.async??!1,contextualErrorMap:n?.errorMap},path:n?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ct(e)},a=this._parseSync({data:e,path:r.path,parent:r});return Va(r,a)}"~validate"(e){let n={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ct(e)};if(!this["~standard"].async)try{let r=this._parseSync({data:e,path:[],parent:n});return Xt(r)?{value:r.value}:{issues:n.common.issues}}catch(r){r?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),n.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:n}).then(r=>Xt(r)?{value:r.value}:{issues:n.common.issues})}async parseAsync(e,n){let r=await this.safeParseAsync(e,n);if(r.success)return r.data;throw r.error}async safeParseAsync(e,n){let r={common:{issues:[],contextualErrorMap:n?.errorMap,async:!0},path:n?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ct(e)},a=this._parse({data:e,path:r.path,parent:r}),i=await(jn(a)?a:Promise.resolve(a));return Va(r,i)}refine(e,n){let r=a=>typeof n=="string"||typeof n>"u"?{message:n}:typeof n=="function"?n(a):n;return this._refinement((a,i)=>{let s=e(a),o=()=>i.addIssue({code:T.custom,...r(a)});return typeof Promise<"u"&&s instanceof Promise?s.then(m=>m?!0:(o(),!1)):s?!0:(o(),!1)})}refinement(e,n){return this._refinement((r,a)=>e(r)?!0:(a.addIssue(typeof n=="function"?n(r,a):n),!1))}_refinement(e){return new ft({schema:this,typeName:N.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:n=>this["~validate"](n)}}optional(){return mt.create(this,this._def)}nullable(){return Dt.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return jt.create(this)}promise(){return tn.create(this,this._def)}or(e){return bn.create([this,e],this._def)}and(e){return wn.create(this,e,this._def)}transform(e){return new ft({...U(this._def),schema:this,typeName:N.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let n=typeof e=="function"?e:()=>e;return new _n({...U(this._def),innerType:this,defaultValue:n,typeName:N.ZodDefault})}brand(){return new wr({typeName:N.ZodBranded,type:this,...U(this._def)})}catch(e){let n=typeof e=="function"?e:()=>e;return new An({...U(this._def),innerType:this,catchValue:n,typeName:N.ZodCatch})}describe(e){let n=this.constructor;return new n({...this._def,description:e})}pipe(e){return Tr.create(this,e)}readonly(){return Ln.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},Gs=/^c[^\s-]{8,}$/i,Vs=/^[0-9a-z]+$/,qs=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Zs=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Ws=/^[a-z0-9_-]{21}$/i,Ys=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Js=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Ks=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Xs="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",Vi,Qs=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,el=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,tl=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,nl=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,rl=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,il=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Za="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",al=new RegExp(`^${Za}$`);function Wa(t){let e="[0-5]\\d";t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`);let n=t.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${n}`}function ol(t){return new RegExp(`^${Wa(t)}$`)}function Ya(t){let e=`${Za}T${Wa(t)}`,n=[];return n.push(t.local?"Z?":"Z"),t.offset&&n.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${n.join("|")})`,new RegExp(`^${e}$`)}function sl(t,e){return!!((e==="v4"||!e)&&Qs.test(t)||(e==="v6"||!e)&&tl.test(t))}function ll(t,e){if(!Ys.test(t))return!1;try{let[n]=t.split(".");if(!n)return!1;let r=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(n.length+(4-n.length%4)%4,"="),a=JSON.parse(atob(r));return!(typeof a!="object"||a===null||"typ"in a&&a?.typ!=="JWT"||!a.alg||e&&a.alg!==e)}catch{return!1}}function cl(t,e){return!!((e==="v4"||!e)&&el.test(t)||(e==="v6"||!e)&&nl.test(t))}var Qt=class t extends V{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==L.string){let i=this._getOrReturnCtx(e);return _(i,{code:T.invalid_type,expected:L.string,received:i.parsedType}),O}let r=new Me,a;for(let i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(a=this._getOrReturnCtx(e,a),_(a,{code:T.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),r.dirty());else if(i.kind==="max")e.data.length>i.value&&(a=this._getOrReturnCtx(e,a),_(a,{code:T.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),r.dirty());else if(i.kind==="length"){let s=e.data.length>i.value,o=e.data.length<i.value;(s||o)&&(a=this._getOrReturnCtx(e,a),s?_(a,{code:T.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):o&&_(a,{code:T.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),r.dirty())}else if(i.kind==="email")Ks.test(e.data)||(a=this._getOrReturnCtx(e,a),_(a,{validation:"email",code:T.invalid_string,message:i.message}),r.dirty());else if(i.kind==="emoji")Vi||(Vi=new RegExp(Xs,"u")),Vi.test(e.data)||(a=this._getOrReturnCtx(e,a),_(a,{validation:"emoji",code:T.invalid_string,message:i.message}),r.dirty());else if(i.kind==="uuid")Zs.test(e.data)||(a=this._getOrReturnCtx(e,a),_(a,{validation:"uuid",code:T.invalid_string,message:i.message}),r.dirty());else if(i.kind==="nanoid")Ws.test(e.data)||(a=this._getOrReturnCtx(e,a),_(a,{validation:"nanoid",code:T.invalid_string,message:i.message}),r.dirty());else if(i.kind==="cuid")Gs.test(e.data)||(a=this._getOrReturnCtx(e,a),_(a,{validation:"cuid",code:T.invalid_string,message:i.message}),r.dirty());else if(i.kind==="cuid2")Vs.test(e.data)||(a=this._getOrReturnCtx(e,a),_(a,{validation:"cuid2",code:T.invalid_string,message:i.message}),r.dirty());else if(i.kind==="ulid")qs.test(e.data)||(a=this._getOrReturnCtx(e,a),_(a,{validation:"ulid",code:T.invalid_string,message:i.message}),r.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{a=this._getOrReturnCtx(e,a),_(a,{validation:"url",code:T.invalid_string,message:i.message}),r.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(a=this._getOrReturnCtx(e,a),_(a,{validation:"regex",code:T.invalid_string,message:i.message}),r.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(a=this._getOrReturnCtx(e,a),_(a,{code:T.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),r.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(a=this._getOrReturnCtx(e,a),_(a,{code:T.invalid_string,validation:{startsWith:i.value},message:i.message}),r.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(a=this._getOrReturnCtx(e,a),_(a,{code:T.invalid_string,validation:{endsWith:i.value},message:i.message}),r.dirty()):i.kind==="datetime"?Ya(i).test(e.data)||(a=this._getOrReturnCtx(e,a),_(a,{code:T.invalid_string,validation:"datetime",message:i.message}),r.dirty()):i.kind==="date"?al.test(e.data)||(a=this._getOrReturnCtx(e,a),_(a,{code:T.invalid_string,validation:"date",message:i.message}),r.dirty()):i.kind==="time"?ol(i).test(e.data)||(a=this._getOrReturnCtx(e,a),_(a,{code:T.invalid_string,validation:"time",message:i.message}),r.dirty()):i.kind==="duration"?Js.test(e.data)||(a=this._getOrReturnCtx(e,a),_(a,{validation:"duration",code:T.invalid_string,message:i.message}),r.dirty()):i.kind==="ip"?sl(e.data,i.version)||(a=this._getOrReturnCtx(e,a),_(a,{validation:"ip",code:T.invalid_string,message:i.message}),r.dirty()):i.kind==="jwt"?ll(e.data,i.alg)||(a=this._getOrReturnCtx(e,a),_(a,{validation:"jwt",code:T.invalid_string,message:i.message}),r.dirty()):i.kind==="cidr"?cl(e.data,i.version)||(a=this._getOrReturnCtx(e,a),_(a,{validation:"cidr",code:T.invalid_string,message:i.message}),r.dirty()):i.kind==="base64"?rl.test(e.data)||(a=this._getOrReturnCtx(e,a),_(a,{validation:"base64",code:T.invalid_string,message:i.message}),r.dirty()):i.kind==="base64url"?il.test(e.data)||(a=this._getOrReturnCtx(e,a),_(a,{validation:"base64url",code:T.invalid_string,message:i.message}),r.dirty()):Y.assertNever(i);return{status:r.value,value:e.data}}_regex(e,n,r){return this.refinement(a=>e.test(a),{validation:n,code:T.invalid_string,...C.errToObj(r)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...C.errToObj(e)})}url(e){return this._addCheck({kind:"url",...C.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...C.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...C.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...C.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...C.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...C.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...C.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...C.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...C.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...C.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...C.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...C.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...C.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...C.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...C.errToObj(e)})}regex(e,n){return this._addCheck({kind:"regex",regex:e,...C.errToObj(n)})}includes(e,n){return this._addCheck({kind:"includes",value:e,position:n?.position,...C.errToObj(n?.message)})}startsWith(e,n){return this._addCheck({kind:"startsWith",value:e,...C.errToObj(n)})}endsWith(e,n){return this._addCheck({kind:"endsWith",value:e,...C.errToObj(n)})}min(e,n){return this._addCheck({kind:"min",value:e,...C.errToObj(n)})}max(e,n){return this._addCheck({kind:"max",value:e,...C.errToObj(n)})}length(e,n){return this._addCheck({kind:"length",value:e,...C.errToObj(n)})}nonempty(e){return this.min(1,C.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxLength(){let e=null;for(let n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}};Qt.create=t=>new Qt({checks:[],typeName:N.ZodString,coerce:t?.coerce??!1,...U(t)});function ul(t,e){let n=(t.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,a=n>r?n:r,i=Number.parseInt(t.toFixed(a).replace(".","")),s=Number.parseInt(e.toFixed(a).replace(".",""));return i%s/10**a}var fn=class t extends V{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==L.number){let i=this._getOrReturnCtx(e);return _(i,{code:T.invalid_type,expected:L.number,received:i.parsedType}),O}let r,a=new Me;for(let i of this._def.checks)i.kind==="int"?Y.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),_(r,{code:T.invalid_type,expected:"integer",received:"float",message:i.message}),a.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(r=this._getOrReturnCtx(e,r),_(r,{code:T.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),a.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(r=this._getOrReturnCtx(e,r),_(r,{code:T.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),a.dirty()):i.kind==="multipleOf"?ul(e.data,i.value)!==0&&(r=this._getOrReturnCtx(e,r),_(r,{code:T.not_multiple_of,multipleOf:i.value,message:i.message}),a.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),_(r,{code:T.not_finite,message:i.message}),a.dirty()):Y.assertNever(i);return{status:a.value,value:e.data}}gte(e,n){return this.setLimit("min",e,!0,C.toString(n))}gt(e,n){return this.setLimit("min",e,!1,C.toString(n))}lte(e,n){return this.setLimit("max",e,!0,C.toString(n))}lt(e,n){return this.setLimit("max",e,!1,C.toString(n))}setLimit(e,n,r,a){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:r,message:C.toString(a)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:C.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:C.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:C.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:C.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:C.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:C.toString(n)})}finite(e){return this._addCheck({kind:"finite",message:C.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:C.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:C.toString(e)})}get minValue(){let e=null;for(let n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(let n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&Y.isInteger(e.value))}get isFinite(){let e=null,n=null;for(let r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(n===null||r.value>n)&&(n=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(n)&&Number.isFinite(e)}};fn.create=t=>new fn({checks:[],typeName:N.ZodNumber,coerce:t?.coerce||!1,...U(t)});var hn=class t extends V{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==L.bigint)return this._getInvalidInput(e);let r,a=new Me;for(let i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(r=this._getOrReturnCtx(e,r),_(r,{code:T.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),a.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(r=this._getOrReturnCtx(e,r),_(r,{code:T.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),a.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),_(r,{code:T.not_multiple_of,multipleOf:i.value,message:i.message}),a.dirty()):Y.assertNever(i);return{status:a.value,value:e.data}}_getInvalidInput(e){let n=this._getOrReturnCtx(e);return _(n,{code:T.invalid_type,expected:L.bigint,received:n.parsedType}),O}gte(e,n){return this.setLimit("min",e,!0,C.toString(n))}gt(e,n){return this.setLimit("min",e,!1,C.toString(n))}lte(e,n){return this.setLimit("max",e,!0,C.toString(n))}lt(e,n){return this.setLimit("max",e,!1,C.toString(n))}setLimit(e,n,r,a){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:r,message:C.toString(a)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:C.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:C.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:C.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:C.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:C.toString(n)})}get minValue(){let e=null;for(let n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(let n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}};hn.create=t=>new hn({checks:[],typeName:N.ZodBigInt,coerce:t?.coerce??!1,...U(t)});var gn=class extends V{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==L.boolean){let r=this._getOrReturnCtx(e);return _(r,{code:T.invalid_type,expected:L.boolean,received:r.parsedType}),O}return $e(e.data)}};gn.create=t=>new gn({typeName:N.ZodBoolean,coerce:t?.coerce||!1,...U(t)});var yn=class t extends V{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==L.date){let i=this._getOrReturnCtx(e);return _(i,{code:T.invalid_type,expected:L.date,received:i.parsedType}),O}if(Number.isNaN(e.data.getTime())){let i=this._getOrReturnCtx(e);return _(i,{code:T.invalid_date}),O}let r=new Me,a;for(let i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(a=this._getOrReturnCtx(e,a),_(a,{code:T.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),r.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(a=this._getOrReturnCtx(e,a),_(a,{code:T.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),r.dirty()):Y.assertNever(i);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}min(e,n){return this._addCheck({kind:"min",value:e.getTime(),message:C.toString(n)})}max(e,n){return this._addCheck({kind:"max",value:e.getTime(),message:C.toString(n)})}get minDate(){let e=null;for(let n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e!=null?new Date(e):null}};yn.create=t=>new yn({checks:[],coerce:t?.coerce||!1,typeName:N.ZodDate,...U(t)});var Gn=class extends V{_parse(e){if(this._getType(e)!==L.symbol){let r=this._getOrReturnCtx(e);return _(r,{code:T.invalid_type,expected:L.symbol,received:r.parsedType}),O}return $e(e.data)}};Gn.create=t=>new Gn({typeName:N.ZodSymbol,...U(t)});var vn=class extends V{_parse(e){if(this._getType(e)!==L.undefined){let r=this._getOrReturnCtx(e);return _(r,{code:T.invalid_type,expected:L.undefined,received:r.parsedType}),O}return $e(e.data)}};vn.create=t=>new vn({typeName:N.ZodUndefined,...U(t)});var xn=class extends V{_parse(e){if(this._getType(e)!==L.null){let r=this._getOrReturnCtx(e);return _(r,{code:T.invalid_type,expected:L.null,received:r.parsedType}),O}return $e(e.data)}};xn.create=t=>new xn({typeName:N.ZodNull,...U(t)});var en=class extends V{constructor(){super(...arguments),this._any=!0}_parse(e){return $e(e.data)}};en.create=t=>new en({typeName:N.ZodAny,...U(t)});var Ft=class extends V{constructor(){super(...arguments),this._unknown=!0}_parse(e){return $e(e.data)}};Ft.create=t=>new Ft({typeName:N.ZodUnknown,...U(t)});var St=class extends V{_parse(e){let n=this._getOrReturnCtx(e);return _(n,{code:T.invalid_type,expected:L.never,received:n.parsedType}),O}};St.create=t=>new St({typeName:N.ZodNever,...U(t)});var Vn=class extends V{_parse(e){if(this._getType(e)!==L.undefined){let r=this._getOrReturnCtx(e);return _(r,{code:T.invalid_type,expected:L.void,received:r.parsedType}),O}return $e(e.data)}};Vn.create=t=>new Vn({typeName:N.ZodVoid,...U(t)});var jt=class t extends V{_parse(e){let{ctx:n,status:r}=this._processInputParams(e),a=this._def;if(n.parsedType!==L.array)return _(n,{code:T.invalid_type,expected:L.array,received:n.parsedType}),O;if(a.exactLength!==null){let s=n.data.length>a.exactLength.value,o=n.data.length<a.exactLength.value;(s||o)&&(_(n,{code:s?T.too_big:T.too_small,minimum:o?a.exactLength.value:void 0,maximum:s?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),r.dirty())}if(a.minLength!==null&&n.data.length<a.minLength.value&&(_(n,{code:T.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),r.dirty()),a.maxLength!==null&&n.data.length>a.maxLength.value&&(_(n,{code:T.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),r.dirty()),n.common.async)return Promise.all([...n.data].map((s,o)=>a.type._parseAsync(new pt(n,s,n.path,o)))).then(s=>Me.mergeArray(r,s));let i=[...n.data].map((s,o)=>a.type._parseSync(new pt(n,s,n.path,o)));return Me.mergeArray(r,i)}get element(){return this._def.type}min(e,n){return new t({...this._def,minLength:{value:e,message:C.toString(n)}})}max(e,n){return new t({...this._def,maxLength:{value:e,message:C.toString(n)}})}length(e,n){return new t({...this._def,exactLength:{value:e,message:C.toString(n)}})}nonempty(e){return this.min(1,e)}};jt.create=(t,e)=>new jt({type:t,minLength:null,maxLength:null,exactLength:null,typeName:N.ZodArray,...U(e)});function Un(t){if(t instanceof Je){let e={};for(let n in t.shape){let r=t.shape[n];e[n]=mt.create(Un(r))}return new Je({...t._def,shape:()=>e})}else return t instanceof jt?new jt({...t._def,type:Un(t.element)}):t instanceof mt?mt.create(Un(t.unwrap())):t instanceof Dt?Dt.create(Un(t.unwrap())):t instanceof Mt?Mt.create(t.items.map(e=>Un(e))):t}var Je=class t extends V{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),n=Y.objectKeys(e);return this._cached={shape:e,keys:n},this._cached}_parse(e){if(this._getType(e)!==L.object){let u=this._getOrReturnCtx(e);return _(u,{code:T.invalid_type,expected:L.object,received:u.parsedType}),O}let{status:r,ctx:a}=this._processInputParams(e),{shape:i,keys:s}=this._getCached(),o=[];if(!(this._def.catchall instanceof St&&this._def.unknownKeys==="strip"))for(let u in a.data)s.includes(u)||o.push(u);let m=[];for(let u of s){let p=i[u],k=a.data[u];m.push({key:{status:"valid",value:u},value:p._parse(new pt(a,k,a.path,u)),alwaysSet:u in a.data})}if(this._def.catchall instanceof St){let u=this._def.unknownKeys;if(u==="passthrough")for(let p of o)m.push({key:{status:"valid",value:p},value:{status:"valid",value:a.data[p]}});else if(u==="strict")o.length>0&&(_(a,{code:T.unrecognized_keys,keys:o}),r.dirty());else if(u!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let u=this._def.catchall;for(let p of o){let k=a.data[p];m.push({key:{status:"valid",value:p},value:u._parse(new pt(a,k,a.path,p)),alwaysSet:p in a.data})}}return a.common.async?Promise.resolve().then(async()=>{let u=[];for(let p of m){let k=await p.key,A=await p.value;u.push({key:k,value:A,alwaysSet:p.alwaysSet})}return u}).then(u=>Me.mergeObjectSync(r,u)):Me.mergeObjectSync(r,m)}get shape(){return this._def.shape()}strict(e){return C.errToObj,new t({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(n,r)=>{let a=this._def.errorMap?.(n,r).message??r.defaultError;return n.code==="unrecognized_keys"?{message:C.errToObj(e).message??a}:{message:a}}}:{}})}strip(){return new t({...this._def,unknownKeys:"strip"})}passthrough(){return new t({...this._def,unknownKeys:"passthrough"})}extend(e){return new t({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new t({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:N.ZodObject})}setKey(e,n){return this.augment({[e]:n})}catchall(e){return new t({...this._def,catchall:e})}pick(e){let n={};for(let r of Y.objectKeys(e))e[r]&&this.shape[r]&&(n[r]=this.shape[r]);return new t({...this._def,shape:()=>n})}omit(e){let n={};for(let r of Y.objectKeys(this.shape))e[r]||(n[r]=this.shape[r]);return new t({...this._def,shape:()=>n})}deepPartial(){return Un(this)}partial(e){let n={};for(let r of Y.objectKeys(this.shape)){let a=this.shape[r];e&&!e[r]?n[r]=a:n[r]=a.optional()}return new t({...this._def,shape:()=>n})}required(e){let n={};for(let r of Y.objectKeys(this.shape))if(e&&!e[r])n[r]=this.shape[r];else{let i=this.shape[r];for(;i instanceof mt;)i=i._def.innerType;n[r]=i}return new t({...this._def,shape:()=>n})}keyof(){return Ja(Y.objectKeys(this.shape))}};Je.create=(t,e)=>new Je({shape:()=>t,unknownKeys:"strip",catchall:St.create(),typeName:N.ZodObject,...U(e)});Je.strictCreate=(t,e)=>new Je({shape:()=>t,unknownKeys:"strict",catchall:St.create(),typeName:N.ZodObject,...U(e)});Je.lazycreate=(t,e)=>new Je({shape:t,unknownKeys:"strip",catchall:St.create(),typeName:N.ZodObject,...U(e)});var bn=class extends V{_parse(e){let{ctx:n}=this._processInputParams(e),r=this._def.options;function a(i){for(let o of i)if(o.result.status==="valid")return o.result;for(let o of i)if(o.result.status==="dirty")return n.common.issues.push(...o.ctx.common.issues),o.result;let s=i.map(o=>new Ye(o.ctx.common.issues));return _(n,{code:T.invalid_union,unionErrors:s}),O}if(n.common.async)return Promise.all(r.map(async i=>{let s={...n,common:{...n.common,issues:[]},parent:null};return{result:await i._parseAsync({data:n.data,path:n.path,parent:s}),ctx:s}})).then(a);{let i,s=[];for(let m of r){let u={...n,common:{...n.common,issues:[]},parent:null},p=m._parseSync({data:n.data,path:n.path,parent:u});if(p.status==="valid")return p;p.status==="dirty"&&!i&&(i={result:p,ctx:u}),u.common.issues.length&&s.push(u.common.issues)}if(i)return n.common.issues.push(...i.ctx.common.issues),i.result;let o=s.map(m=>new Ye(m));return _(n,{code:T.invalid_union,unionErrors:o}),O}}get options(){return this._def.options}};bn.create=(t,e)=>new bn({options:t,typeName:N.ZodUnion,...U(e)});var Ht=t=>t instanceof Tn?Ht(t.schema):t instanceof ft?Ht(t.innerType()):t instanceof kn?[t.value]:t instanceof Sn?t.options:t instanceof En?Y.objectValues(t.enum):t instanceof _n?Ht(t._def.innerType):t instanceof vn?[void 0]:t instanceof xn?[null]:t instanceof mt?[void 0,...Ht(t.unwrap())]:t instanceof Dt?[null,...Ht(t.unwrap())]:t instanceof wr||t instanceof Ln?Ht(t.unwrap()):t instanceof An?Ht(t._def.innerType):[],ci=class t extends V{_parse(e){let{ctx:n}=this._processInputParams(e);if(n.parsedType!==L.object)return _(n,{code:T.invalid_type,expected:L.object,received:n.parsedType}),O;let r=this.discriminator,a=n.data[r],i=this.optionsMap.get(a);return i?n.common.async?i._parseAsync({data:n.data,path:n.path,parent:n}):i._parseSync({data:n.data,path:n.path,parent:n}):(_(n,{code:T.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),O)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,n,r){let a=new Map;for(let i of n){let s=Ht(i.shape[e]);if(!s.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let o of s){if(a.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);a.set(o,i)}}return new t({typeName:N.ZodDiscriminatedUnion,discriminator:e,options:n,optionsMap:a,...U(r)})}};function qi(t,e){let n=Ct(t),r=Ct(e);if(t===e)return{valid:!0,data:t};if(n===L.object&&r===L.object){let a=Y.objectKeys(e),i=Y.objectKeys(t).filter(o=>a.indexOf(o)!==-1),s={...t,...e};for(let o of i){let m=qi(t[o],e[o]);if(!m.valid)return{valid:!1};s[o]=m.data}return{valid:!0,data:s}}else if(n===L.array&&r===L.array){if(t.length!==e.length)return{valid:!1};let a=[];for(let i=0;i<t.length;i++){let s=t[i],o=e[i],m=qi(s,o);if(!m.valid)return{valid:!1};a.push(m.data)}return{valid:!0,data:a}}else return n===L.date&&r===L.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}var wn=class extends V{_parse(e){let{status:n,ctx:r}=this._processInputParams(e),a=(i,s)=>{if(si(i)||si(s))return O;let o=qi(i.value,s.value);return o.valid?((li(i)||li(s))&&n.dirty(),{status:n.value,value:o.data}):(_(r,{code:T.invalid_intersection_types}),O)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([i,s])=>a(i,s)):a(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}};wn.create=(t,e,n)=>new wn({left:t,right:e,typeName:N.ZodIntersection,...U(n)});var Mt=class t extends V{_parse(e){let{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==L.array)return _(r,{code:T.invalid_type,expected:L.array,received:r.parsedType}),O;if(r.data.length<this._def.items.length)return _(r,{code:T.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),O;!this._def.rest&&r.data.length>this._def.items.length&&(_(r,{code:T.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),n.dirty());let i=[...r.data].map((s,o)=>{let m=this._def.items[o]||this._def.rest;return m?m._parse(new pt(r,s,r.path,o)):null}).filter(s=>!!s);return r.common.async?Promise.all(i).then(s=>Me.mergeArray(n,s)):Me.mergeArray(n,i)}get items(){return this._def.items}rest(e){return new t({...this._def,rest:e})}};Mt.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Mt({items:t,typeName:N.ZodTuple,rest:null,...U(e)})};var ui=class t extends V{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==L.object)return _(r,{code:T.invalid_type,expected:L.object,received:r.parsedType}),O;let a=[],i=this._def.keyType,s=this._def.valueType;for(let o in r.data)a.push({key:i._parse(new pt(r,o,r.path,o)),value:s._parse(new pt(r,r.data[o],r.path,o)),alwaysSet:o in r.data});return r.common.async?Me.mergeObjectAsync(n,a):Me.mergeObjectSync(n,a)}get element(){return this._def.valueType}static create(e,n,r){return n instanceof V?new t({keyType:e,valueType:n,typeName:N.ZodRecord,...U(r)}):new t({keyType:Qt.create(),valueType:e,typeName:N.ZodRecord,...U(n)})}},qn=class extends V{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==L.map)return _(r,{code:T.invalid_type,expected:L.map,received:r.parsedType}),O;let a=this._def.keyType,i=this._def.valueType,s=[...r.data.entries()].map(([o,m],u)=>({key:a._parse(new pt(r,o,r.path,[u,"key"])),value:i._parse(new pt(r,m,r.path,[u,"value"]))}));if(r.common.async){let o=new Map;return Promise.resolve().then(async()=>{for(let m of s){let u=await m.key,p=await m.value;if(u.status==="aborted"||p.status==="aborted")return O;(u.status==="dirty"||p.status==="dirty")&&n.dirty(),o.set(u.value,p.value)}return{status:n.value,value:o}})}else{let o=new Map;for(let m of s){let u=m.key,p=m.value;if(u.status==="aborted"||p.status==="aborted")return O;(u.status==="dirty"||p.status==="dirty")&&n.dirty(),o.set(u.value,p.value)}return{status:n.value,value:o}}}};qn.create=(t,e,n)=>new qn({valueType:e,keyType:t,typeName:N.ZodMap,...U(n)});var Zn=class t extends V{_parse(e){let{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==L.set)return _(r,{code:T.invalid_type,expected:L.set,received:r.parsedType}),O;let a=this._def;a.minSize!==null&&r.data.size<a.minSize.value&&(_(r,{code:T.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),n.dirty()),a.maxSize!==null&&r.data.size>a.maxSize.value&&(_(r,{code:T.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),n.dirty());let i=this._def.valueType;function s(m){let u=new Set;for(let p of m){if(p.status==="aborted")return O;p.status==="dirty"&&n.dirty(),u.add(p.value)}return{status:n.value,value:u}}let o=[...r.data.values()].map((m,u)=>i._parse(new pt(r,m,r.path,u)));return r.common.async?Promise.all(o).then(m=>s(m)):s(o)}min(e,n){return new t({...this._def,minSize:{value:e,message:C.toString(n)}})}max(e,n){return new t({...this._def,maxSize:{value:e,message:C.toString(n)}})}size(e,n){return this.min(e,n).max(e,n)}nonempty(e){return this.min(1,e)}};Zn.create=(t,e)=>new Zn({valueType:t,minSize:null,maxSize:null,typeName:N.ZodSet,...U(e)});var di=class t extends V{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:n}=this._processInputParams(e);if(n.parsedType!==L.function)return _(n,{code:T.invalid_type,expected:L.function,received:n.parsedType}),O;function r(o,m){return br({data:o,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,Fn(),zt].filter(u=>!!u),issueData:{code:T.invalid_arguments,argumentsError:m}})}function a(o,m){return br({data:o,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,Fn(),zt].filter(u=>!!u),issueData:{code:T.invalid_return_type,returnTypeError:m}})}let i={errorMap:n.common.contextualErrorMap},s=n.data;if(this._def.returns instanceof tn){let o=this;return $e(async function(...m){let u=new Ye([]),p=await o._def.args.parseAsync(m,i).catch(I=>{throw u.addIssue(r(m,I)),u}),k=await Reflect.apply(s,this,p);return await o._def.returns._def.type.parseAsync(k,i).catch(I=>{throw u.addIssue(a(k,I)),u})})}else{let o=this;return $e(function(...m){let u=o._def.args.safeParse(m,i);if(!u.success)throw new Ye([r(m,u.error)]);let p=Reflect.apply(s,this,u.data),k=o._def.returns.safeParse(p,i);if(!k.success)throw new Ye([a(p,k.error)]);return k.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new t({...this._def,args:Mt.create(e).rest(Ft.create())})}returns(e){return new t({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,n,r){return new t({args:e||Mt.create([]).rest(Ft.create()),returns:n||Ft.create(),typeName:N.ZodFunction,...U(r)})}},Tn=class extends V{get schema(){return this._def.getter()}_parse(e){let{ctx:n}=this._processInputParams(e);return this._def.getter()._parse({data:n.data,path:n.path,parent:n})}};Tn.create=(t,e)=>new Tn({getter:t,typeName:N.ZodLazy,...U(e)});var kn=class extends V{_parse(e){if(e.data!==this._def.value){let n=this._getOrReturnCtx(e);return _(n,{received:n.data,code:T.invalid_literal,expected:this._def.value}),O}return{status:"valid",value:e.data}}get value(){return this._def.value}};kn.create=(t,e)=>new kn({value:t,typeName:N.ZodLiteral,...U(e)});function Ja(t,e){return new Sn({values:t,typeName:N.ZodEnum,...U(e)})}var Sn=class t extends V{_parse(e){if(typeof e.data!="string"){let n=this._getOrReturnCtx(e),r=this._def.values;return _(n,{expected:Y.joinValues(r),received:n.parsedType,code:T.invalid_type}),O}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let n=this._getOrReturnCtx(e),r=this._def.values;return _(n,{received:n.data,code:T.invalid_enum_value,options:r}),O}return $e(e.data)}get options(){return this._def.values}get enum(){let e={};for(let n of this._def.values)e[n]=n;return e}get Values(){let e={};for(let n of this._def.values)e[n]=n;return e}get Enum(){let e={};for(let n of this._def.values)e[n]=n;return e}extract(e,n=this._def){return t.create(e,{...this._def,...n})}exclude(e,n=this._def){return t.create(this.options.filter(r=>!e.includes(r)),{...this._def,...n})}};Sn.create=Ja;var En=class extends V{_parse(e){let n=Y.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==L.string&&r.parsedType!==L.number){let a=Y.objectValues(n);return _(r,{expected:Y.joinValues(a),received:r.parsedType,code:T.invalid_type}),O}if(this._cache||(this._cache=new Set(Y.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let a=Y.objectValues(n);return _(r,{received:r.data,code:T.invalid_enum_value,options:a}),O}return $e(e.data)}get enum(){return this._def.values}};En.create=(t,e)=>new En({values:t,typeName:N.ZodNativeEnum,...U(e)});var tn=class extends V{unwrap(){return this._def.type}_parse(e){let{ctx:n}=this._processInputParams(e);if(n.parsedType!==L.promise&&n.common.async===!1)return _(n,{code:T.invalid_type,expected:L.promise,received:n.parsedType}),O;let r=n.parsedType===L.promise?n.data:Promise.resolve(n.data);return $e(r.then(a=>this._def.type.parseAsync(a,{path:n.path,errorMap:n.common.contextualErrorMap})))}};tn.create=(t,e)=>new tn({type:t,typeName:N.ZodPromise,...U(e)});var ft=class extends V{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===N.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:n,ctx:r}=this._processInputParams(e),a=this._def.effect||null,i={addIssue:s=>{_(r,s),s.fatal?n.abort():n.dirty()},get path(){return r.path}};if(i.addIssue=i.addIssue.bind(i),a.type==="preprocess"){let s=a.transform(r.data,i);if(r.common.async)return Promise.resolve(s).then(async o=>{if(n.value==="aborted")return O;let m=await this._def.schema._parseAsync({data:o,path:r.path,parent:r});return m.status==="aborted"?O:m.status==="dirty"?pn(m.value):n.value==="dirty"?pn(m.value):m});{if(n.value==="aborted")return O;let o=this._def.schema._parseSync({data:s,path:r.path,parent:r});return o.status==="aborted"?O:o.status==="dirty"?pn(o.value):n.value==="dirty"?pn(o.value):o}}if(a.type==="refinement"){let s=o=>{let m=a.refinement(o,i);if(r.common.async)return Promise.resolve(m);if(m instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(r.common.async===!1){let o=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return o.status==="aborted"?O:(o.status==="dirty"&&n.dirty(),s(o.value),{status:n.value,value:o.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(o=>o.status==="aborted"?O:(o.status==="dirty"&&n.dirty(),s(o.value).then(()=>({status:n.value,value:o.value}))))}if(a.type==="transform")if(r.common.async===!1){let s=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!Xt(s))return O;let o=a.transform(s.value,i);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:n.value,value:o}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(s=>Xt(s)?Promise.resolve(a.transform(s.value,i)).then(o=>({status:n.value,value:o})):O);Y.assertNever(a)}};ft.create=(t,e,n)=>new ft({schema:t,typeName:N.ZodEffects,effect:e,...U(n)});ft.createWithPreprocess=(t,e,n)=>new ft({schema:e,effect:{type:"preprocess",transform:t},typeName:N.ZodEffects,...U(n)});var mt=class extends V{_parse(e){return this._getType(e)===L.undefined?$e(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};mt.create=(t,e)=>new mt({innerType:t,typeName:N.ZodOptional,...U(e)});var Dt=class extends V{_parse(e){return this._getType(e)===L.null?$e(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Dt.create=(t,e)=>new Dt({innerType:t,typeName:N.ZodNullable,...U(e)});var _n=class extends V{_parse(e){let{ctx:n}=this._processInputParams(e),r=n.data;return n.parsedType===L.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:n.path,parent:n})}removeDefault(){return this._def.innerType}};_n.create=(t,e)=>new _n({innerType:t,typeName:N.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...U(e)});var An=class extends V{_parse(e){let{ctx:n}=this._processInputParams(e),r={...n,common:{...n.common,issues:[]}},a=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return jn(a)?a.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new Ye(r.common.issues)},input:r.data})})):{status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new Ye(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}};An.create=(t,e)=>new An({innerType:t,typeName:N.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...U(e)});var Wn=class extends V{_parse(e){if(this._getType(e)!==L.nan){let r=this._getOrReturnCtx(e);return _(r,{code:T.invalid_type,expected:L.nan,received:r.parsedType}),O}return{status:"valid",value:e.data}}};Wn.create=t=>new Wn({typeName:N.ZodNaN,...U(t)});var dl=Symbol("zod_brand"),wr=class extends V{_parse(e){let{ctx:n}=this._processInputParams(e),r=n.data;return this._def.type._parse({data:r,path:n.path,parent:n})}unwrap(){return this._def.type}},Tr=class t extends V{_parse(e){let{status:n,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{let i=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return i.status==="aborted"?O:i.status==="dirty"?(n.dirty(),pn(i.value)):this._def.out._parseAsync({data:i.value,path:r.path,parent:r})})();{let a=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return a.status==="aborted"?O:a.status==="dirty"?(n.dirty(),{status:"dirty",value:a.value}):this._def.out._parseSync({data:a.value,path:r.path,parent:r})}}static create(e,n){return new t({in:e,out:n,typeName:N.ZodPipeline})}},Ln=class extends V{_parse(e){let n=this._def.innerType._parse(e),r=a=>(Xt(a)&&(a.value=Object.freeze(a.value)),a);return jn(n)?n.then(a=>r(a)):r(n)}unwrap(){return this._def.innerType}};Ln.create=(t,e)=>new Ln({innerType:t,typeName:N.ZodReadonly,...U(e)});function qa(t,e){let n=typeof t=="function"?t(e):typeof t=="string"?{message:t}:t;return typeof n=="string"?{message:n}:n}function Ka(t,e={},n){return t?en.create().superRefine((r,a)=>{let i=t(r);if(i instanceof Promise)return i.then(s=>{if(!s){let o=qa(e,r),m=o.fatal??n??!0;a.addIssue({code:"custom",...o,fatal:m})}});if(!i){let s=qa(e,r),o=s.fatal??n??!0;a.addIssue({code:"custom",...s,fatal:o})}}):en.create()}var ml={object:Je.lazycreate},N;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(N||(N={}));var pl=(t,e={message:`Input not instance of ${t.name}`})=>Ka(n=>n instanceof t,e),Xa=Qt.create,Qa=fn.create,fl=Wn.create,hl=hn.create,eo=gn.create,gl=yn.create,yl=Gn.create,vl=vn.create,xl=xn.create,bl=en.create,wl=Ft.create,Tl=St.create,kl=Vn.create,Sl=jt.create,El=Je.create,_l=Je.strictCreate,Al=bn.create,Ll=ci.create,Il=wn.create,Cl=Mt.create,Ml=ui.create,Dl=qn.create,Bl=Zn.create,Rl=di.create,Ol=Tn.create,Pl=kn.create,Nl=Sn.create,$l=En.create,zl=tn.create,Hl=ft.create,Fl=mt.create,jl=Dt.create,Ul=ft.createWithPreprocess,Gl=Tr.create,Vl=()=>Xa().optional(),ql=()=>Qa().optional(),Zl=()=>eo().optional(),Wl={string:(t=>Qt.create({...t,coerce:!0})),number:(t=>fn.create({...t,coerce:!0})),boolean:(t=>gn.create({...t,coerce:!0})),bigint:(t=>hn.create({...t,coerce:!0})),date:(t=>yn.create({...t,coerce:!0}))};var Yl=O;function c(t,...e){let n="debug",r=[...e];e.length>0&&typeof e[e.length-1]=="string"&&["debug","info","warn","error"].includes(e[e.length-1])&&(n=r.pop());let i=`[Timekeeper v${GM_info.script.version}]`;({debug:console.log,info:console.info,warn:console.warn,error:console.error})[n](`${i} ${t}`,...r)}function Ut(t,e=t){let n=Math.floor(t/3600),r=Math.floor(t%3600/60),a=String(t%60).padStart(2,"0");return e<3600?`${r<10?r:String(r).padStart(2,"0")}:${a}`:`${e>=36e3?String(n).padStart(2,"0"):n}:${String(r).padStart(2,"0")}:${a}`}function kr(t,e=window.location.href){try{let n=new URL(e);return n.searchParams.set("t",`${t}s`),n.toString()}catch{return`https://www.youtube.com/watch?v=${e.search(/[?&]v=/)>=0?e.split(/[?&]v=/)[1].split(/&/)[0]:e.split(/\/live\/|\/shorts\/|\?|&/)[1]}&t=${t}s`}}function Yn(){let t=new Date;return t.getUTCFullYear()+"-"+String(t.getUTCMonth()+1).padStart(2,"0")+"-"+String(t.getUTCDate()).padStart(2,"0")+"--"+String(t.getUTCHours()).padStart(2,"0")+"-"+String(t.getUTCMinutes()).padStart(2,"0")+"-"+String(t.getUTCSeconds()).padStart(2,"0")}var Jl=[{emoji:"\u{1F942}",month:1,day:1,name:"New Year's Day"},{emoji:"\u{1F49D}",month:2,day:14,name:"Valentine's Day"},{emoji:"\u{1F986}",month:5,day:25,name:"Kanna's Debut Anniversary"},{emoji:"\u{1F383}",month:10,day:31,name:"Halloween"},{emoji:"\u{1F382}",month:9,day:15,name:"Kanna's Birthday"},{emoji:"\u{1F332}",month:12,day:25,name:"Christmas"}];function to(){let t=new Date,e=t.getFullYear(),n=t.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});for(let r of Jl){let a=new Date(e,r.month-1,r.day),i=a.getTime()-t.getTime(),s=i/(1e3*60*60*24);if(s<=5&&s>=-2)return c(`Current date: ${n}, Selected emoji: ${r.emoji} (${r.name}), Days until holiday: ${Math.ceil(s)}`),r.emoji;if(s<-2&&(a=new Date(e+1,r.month-1,r.day),i=a.getTime()-t.getTime(),s=i/(1e3*60*60*24),s<=5&&s>=-2))return c(`Current date: ${n}, Selected emoji: ${r.emoji} (${r.name}), Days until holiday: ${Math.ceil(s)}`),r.emoji;if(s>5&&(a=new Date(e-1,r.month-1,r.day),i=a.getTime()-t.getTime(),s=i/(1e3*60*60*24),s<=5&&s>=-2))return c(`Current date: ${n}, Selected emoji: ${r.emoji} (${r.name}), Days until holiday: ${Math.ceil(s)}`),r.emoji}return c(`Current date: ${n}, No holiday emoji (not within range)`),null}var Ke=null,Jn=null,Kl=250,Bt=null,Sr=!1,Xe=null;function Xl(){return(!Ke||!document.body.contains(Ke))&&(Ke=document.createElement("div"),Ke.className="ytls-tooltip",Ke.style.pointerEvents="none",document.body.appendChild(Ke),window.addEventListener("scroll",no,!0),window.addEventListener("resize",no,!0)),Ke}function Ql(t,e,n){let a=window.innerWidth,i=window.innerHeight,s=t.getBoundingClientRect(),o=s.width,m=s.height,u=e+10,p=n+10;u+o>a-10&&(u=e-o-10),p+m>i-10&&(p=n-m-10),u=Math.max(10,Math.min(u,a-o-10)),p=Math.max(10,Math.min(p,i-m-10)),t.style.left=`${u}px`,t.style.top=`${p}px`}function ro(t,e){let r=window.innerWidth,a=window.innerHeight,i=e.getBoundingClientRect(),s=t.getBoundingClientRect(),o=s.width,m=s.height,u=Math.round(i.left+i.width/2-o/2),p=Math.round(i.top-m-8);p<8&&(p=Math.round(i.bottom+8)),u<8&&(u=Math.round(i.left)),u+o>r-8&&(u=Math.round(i.right-o)),u=Math.max(8,Math.min(u,r-o-8)),p=Math.max(8,Math.min(p,a-m-8)),t.style.left=`${u}px`,t.style.top=`${p}px`}function no(){if(!(!Ke||!Bt)&&Ke.classList.contains("ytls-tooltip-visible"))try{ro(Ke,Bt)}catch{}}function ec(t=50){Xe&&(clearTimeout(Xe),Xe=null),!Sr&&(Xe=setTimeout(()=>{Zi(),Xe=null},t))}function tc(t,e,n,r){Xe&&(clearTimeout(Xe),Xe=null),Bt&&r&&Bt!==r&&Ke?.classList.contains("ytls-tooltip-visible")&&Ke.classList.remove("ytls-tooltip-visible"),Jn&&clearTimeout(Jn),r&&(Bt=r,Sr=!0),Jn=setTimeout(()=>{let a=Xl();a.textContent=t,a.classList.remove("ytls-tooltip-visible"),r?requestAnimationFrame(()=>{ro(a,r),requestAnimationFrame(()=>{a.classList.add("ytls-tooltip-visible")})}):(Ql(a,e,n),requestAnimationFrame(()=>{a.classList.add("ytls-tooltip-visible")}))},Kl)}function Zi(){Jn&&(clearTimeout(Jn),Jn=null),Xe&&(clearTimeout(Xe),Xe=null),Ke&&Ke.classList.remove("ytls-tooltip-visible"),Bt=null,Sr=!1}function ht(t,e){let n=0,r=0,a=m=>{n=m.clientX,r=m.clientY,Xe&&(clearTimeout(Xe),Xe=null),Sr=!0,Bt=t;let u=typeof e=="function"?e():e;u&&tc(u,n,r,t)},i=m=>{n=m.clientX,r=m.clientY},s=()=>{Bt===t&&(Sr=!1,ec())};t.addEventListener("mouseenter",a),t.addEventListener("mousemove",i),t.addEventListener("mouseleave",s);let o=new MutationObserver(()=>{try{if(!document.body.contains(t))Bt===t&&Zi();else{let m=window.getComputedStyle(t);(m.display==="none"||m.visibility==="hidden"||m.opacity==="0")&&Bt===t&&Zi()}}catch{}});try{o.observe(t,{attributes:!0,attributeFilter:["class","style"]}),o.observe(document.body,{childList:!0,subtree:!0})}catch{}t.__tooltipCleanup=()=>{t.removeEventListener("mouseenter",a),t.removeEventListener("mousemove",i),t.removeEventListener("mouseleave",s);try{o.disconnect()}catch{}delete t.__tooltipObserver},t.__tooltipObserver=o}var Xi={};Ua(Xi,{DB_NAME:()=>oo,DB_VERSION:()=>so,SETTINGS_STORE_NAME:()=>_r,STORE_NAME:()=>In,STORE_NAME_V2:()=>Qe,buildExportCsvPayload:()=>co,buildExportPayload:()=>lo,deleteSingleTimestampFromIndexedDB:()=>lc,executeTransaction:()=>pi,exportAllTimestamps:()=>pc,exportAllTimestampsCsv:()=>fc,getAllFromIndexedDB:()=>Ki,getDB:()=>Cn,loadFromIndexedDB:()=>cc,loadGlobalSettings:()=>mc,removeFromIndexedDB:()=>uc,saveGlobalSettings:()=>dc,saveSingleTimestampToIndexedDB:()=>sc,saveToIndexedDB:()=>oc});var nc=M.preprocess(t=>typeof t=="string"&&t.trim().length>0?t:crypto.randomUUID(),M.string()),Kn=M.object({guid:nc,start:M.number().finite().nonnegative(),comment:M.string()}),Er=Kn.array(),Wi=Kn.extend({video_id:M.string()}),ao=M.object({x:M.number().finite(),y:M.number().finite(),width:M.number().finite().positive().optional(),height:M.number().finite().positive().optional()}),mi=M.object({video_id:M.string(),timestamps:Er}),Cu=M.record(mi),io=M.object({isSignedIn:M.boolean().catch(!1),accessToken:M.string().nullable().catch(null),userName:M.string().nullable().catch(null),email:M.string().nullable().catch(null)}),Yi=M.union([io,M.string().transform((t,e)=>{try{let n=JSON.parse(t);return io.parse(n)}catch{return e.addIssue({code:M.ZodIssueCode.custom,message:"Invalid JSON string for auth state"}),M.NEVER}})]).catch({isSignedIn:!1,accessToken:null,userName:null,email:null}),Ji=M.object({autoBackupEnabled:M.boolean(),autoBackupIntervalMinutes:M.number().int().min(5).max(1440),lastAutoBackupAt:M.number().int().positive().nullable().optional()}),rc=M.object({type:M.literal("timekeeper_oauth_token"),token:M.string().min(1),timestamp:M.number().optional()}),ic=M.object({type:M.literal("timekeeper_oauth_error"),error:M.string(),timestamp:M.number().optional()}),Mu=M.union([rc,ic]),Du=M.object({name:M.string().optional(),email:M.string().email().optional(),id:M.string().optional(),picture:M.string().url().optional()});var oo="ytls-timestamps-db",so=3,In="timestamps",Qe="timestamps_v2",_r="settings",Xn=null,Qn=null;function Cn(){if(Xn)try{if(Xn.objectStoreNames.length>=0)return Promise.resolve(Xn)}catch(t){c("IndexedDB connection is no longer usable:",t,"warn"),Xn=null}return Qn||(Qn=ac().then(t=>(Xn=t,Qn=null,t.onclose=()=>{c("IndexedDB connection closed unexpectedly","warn"),Xn=null},t.onerror=e=>{c("IndexedDB connection error:",e,"error")},t)).catch(t=>{throw Qn=null,t}),Qn)}function ac(){return new Promise((t,e)=>{let n=indexedDB.open(oo,so);n.onupgradeneeded=r=>{let a=r.target.result,i=r.oldVersion,s=r.target.transaction;if(i<1&&a.createObjectStore(In,{keyPath:"video_id"}),i<2&&!a.objectStoreNames.contains(_r)&&a.createObjectStore(_r,{keyPath:"key"}),i<3){if(a.objectStoreNames.contains(In)){c("Exporting backup before v2 migration...");let u=s.objectStore(In).getAll();u.onsuccess=()=>{let p=mi.array().safeParse(u.result);if(p.success&&p.data.length>0)try{let k={},A=0;p.data.forEach(re=>{if(re.timestamps.length>0){let ue=Er.parse(re.timestamps);k[`ytls-${re.video_id}`]={video_id:re.video_id,timestamps:[...ue].sort((ve,K)=>ve.start-K.start)},A+=ue.length}});let I=new Blob([JSON.stringify(k,null,2)],{type:"application/json"}),G=URL.createObjectURL(I),J=document.createElement("a");J.href=G,J.download=`timekeeper-data-${Yn()}.json`,J.click(),URL.revokeObjectURL(G),c(`Pre-migration backup exported: ${p.data.length} videos, ${A} timestamps`)}catch(k){c("Failed to export pre-migration backup:",k,"error")}else p.success||c("Skipping pre-migration backup: legacy data failed validation",p.error.format(),"warn")}}let o=a.createObjectStore(Qe,{keyPath:"guid"});if(o.createIndex("video_id","video_id",{unique:!1}),o.createIndex("video_start",["video_id","start"],{unique:!1}),a.objectStoreNames.contains(In)){let u=s.objectStore(In).getAll();u.onsuccess=()=>{let p=mi.array().safeParse(u.result);if(p.success&&p.data.length>0){let k=0;p.data.forEach(A=>{A.timestamps.length>0&&A.timestamps.forEach(I=>{o.put({guid:I.guid,video_id:A.video_id,start:I.start,comment:I.comment}),k++})}),c(`Migrated ${k} timestamps from ${p.data.length} videos to v2 store`)}else p.success||c("Skipping v1 \u2192 v2 migration: legacy data failed validation",p.error.format(),"warn")},a.deleteObjectStore(In),c("Deleted old timestamps store after migration to v2")}}},n.onsuccess=r=>{t(r.target.result)},n.onerror=r=>{let a=r.target.error;e(a??new Error("Failed to open IndexedDB"))}})}function pi(t,e,n){return Cn().then(r=>new Promise((a,i)=>{let s;try{s=r.transaction(t,e)}catch(u){i(new Error(`Failed to create transaction for ${t}: ${u}`));return}let o=s.objectStore(t),m;try{m=n(o)}catch(u){i(new Error(`Failed to execute operation on ${t}: ${u}`));return}m&&(m.onsuccess=()=>a(m.result),m.onerror=()=>i(m.error??new Error(`IndexedDB ${e} operation failed`))),s.oncomplete=()=>{m||a(void 0)},s.onerror=()=>i(s.error??new Error("IndexedDB transaction failed")),s.onabort=()=>i(s.error??new Error("IndexedDB transaction aborted"))}))}function oc(t,e){let n=Er.safeParse(e);if(!n.success)return Promise.reject(new Error(`Invalid timestamp payload for ${t}`));let r=n.data;return Cn().then(a=>new Promise((i,s)=>{let o;try{o=a.transaction([Qe],"readwrite")}catch(k){s(new Error(`Failed to create transaction: ${k}`));return}let m=o.objectStore(Qe),p=m.index("video_id").getAll(IDBKeyRange.only(t));p.onsuccess=()=>{try{let k=p.result,A=new Set(r.map(I=>I.guid));k.forEach(I=>{A.has(I.guid)||m.delete(I.guid)}),r.forEach(I=>{m.put({guid:I.guid,video_id:t,start:I.start,comment:I.comment})})}catch(k){c("Error during save operation:",k,"error")}},p.onerror=()=>{s(p.error??new Error("Failed to get existing records"))},o.oncomplete=()=>i(),o.onerror=()=>s(o.error??new Error("Failed to save to IndexedDB")),o.onabort=()=>s(o.error??new Error("Transaction aborted during save"))}))}function sc(t,e){let n=Kn.safeParse(e);if(!n.success)return Promise.reject(new Error(`Invalid timestamp: ${n.error.message}`));let r=n.data;return Cn().then(a=>new Promise((i,s)=>{let o;try{o=a.transaction([Qe],"readwrite")}catch(p){s(new Error(`Failed to create transaction: ${p}`));return}let u=o.objectStore(Qe).put({guid:r.guid,video_id:t,start:r.start,comment:r.comment});u.onerror=()=>{s(u.error??new Error("Failed to put timestamp"))},o.oncomplete=()=>i(),o.onerror=()=>s(o.error??new Error("Failed to save single timestamp to IndexedDB")),o.onabort=()=>s(o.error??new Error("Transaction aborted during single timestamp save"))}))}function lc(t,e){return c(`Deleting timestamp ${e} for video ${t}`),Cn().then(n=>new Promise((r,a)=>{let i;try{i=n.transaction([Qe],"readwrite")}catch(m){a(new Error(`Failed to create transaction: ${m}`));return}let o=i.objectStore(Qe).delete(e);o.onerror=()=>{a(o.error??new Error("Failed to delete timestamp"))},i.oncomplete=()=>r(),i.onerror=()=>a(i.error??new Error("Failed to delete single timestamp from IndexedDB")),i.onabort=()=>a(i.error??new Error("Transaction aborted during timestamp deletion"))}))}function cc(t){return Cn().then(e=>new Promise(n=>{let r;try{r=e.transaction([Qe],"readonly")}catch(o){c("Failed to create read transaction:",o,"warn"),n(null);return}let s=r.objectStore(Qe).index("video_id").getAll(IDBKeyRange.only(t));s.onsuccess=()=>{let o=s.result;if(o.length===0){n(null);return}let m=o.map(k=>({guid:k.guid,start:k.start,comment:k.comment})),u=Er.safeParse(m);if(!u.success){c("Failed to parse timestamps from IndexedDB:",u.error.format(),"warn"),n(null);return}let p=[...u.data].sort((k,A)=>k.start-A.start);n(p)},s.onerror=()=>{c("Failed to load timestamps:",s.error,"warn"),n(null)},r.onabort=()=>{c("Transaction aborted during load:",r.error,"warn"),n(null)}}))}function uc(t){return Cn().then(e=>new Promise((n,r)=>{let a;try{a=e.transaction([Qe],"readwrite")}catch(m){r(new Error(`Failed to create transaction: ${m}`));return}let i=a.objectStore(Qe),o=i.index("video_id").getAll(IDBKeyRange.only(t));o.onsuccess=()=>{try{o.result.forEach(u=>{i.delete(u.guid)})}catch(m){c("Error during remove operation:",m,"error")}},o.onerror=()=>{r(o.error??new Error("Failed to get records for removal"))},a.oncomplete=()=>n(),a.onerror=()=>r(a.error??new Error("Failed to remove timestamps")),a.onabort=()=>r(a.error??new Error("Transaction aborted during timestamp removal"))}))}function Ki(t){return pi(t,"readonly",e=>e.getAll()).then(e=>Array.isArray(e)?e:[])}function dc(t,e){pi(_r,"readwrite",n=>{n.put({key:t,value:e})}).catch(n=>{c(`Failed to save setting '${t}' to IndexedDB:`,n,"error")})}function mc(t){return pi(_r,"readonly",e=>e.get(t)).then(e=>e?.value).catch(e=>{c(`Failed to load setting '${t}' from IndexedDB:`,e,"error")})}async function lo(){let t={},e=await Ki(Qe),n=Wi.array().safeParse(e);if(!n.success)return c("Failed to parse timestamp rows for export:",n.error.format(),"warn"),{json:"{}",filename:"timekeeper-data.json",totalVideos:0,totalTimestamps:0};let r=new Map;for(let s of n.data)r.has(s.video_id)||r.set(s.video_id,[]),r.get(s.video_id).push({guid:s.guid,start:s.start,comment:s.comment});for(let[s,o]of r)t[`ytls-${s}`]={video_id:s,timestamps:o.sort((m,u)=>m.start-u.start)};return{json:JSON.stringify(t,null,2),filename:"timekeeper-data.json",totalVideos:r.size,totalTimestamps:n.data.length}}async function pc(){try{let{json:t,filename:e,totalVideos:n,totalTimestamps:r}=await lo(),a=new Blob([t],{type:"application/json"}),i=URL.createObjectURL(a),s=document.createElement("a");s.href=i,s.download=e,s.click(),URL.revokeObjectURL(i),c(`Exported ${n} videos with ${r} timestamps`)}catch(t){throw c("Failed to export data:",t,"error"),t}}async function co(){let t=Wi.array().safeParse(await Ki(Qe));if(!t.success||t.data.length===0){t.success||c("Failed to parse timestamp rows for CSV export:",t.error.format(),"warn");let p=`Tag,Timestamp,URL
`,k=`timestamps-${Yn()}.csv`;return{csv:p,filename:k,totalVideos:0,totalTimestamps:0}}let e=t.data,n=new Map;for(let p of e)n.has(p.video_id)||n.set(p.video_id,[]),n.get(p.video_id).push({start:p.start,comment:p.comment});let r=[];r.push("Tag,Timestamp,URL");let a=0,i=p=>`"${String(p).replace(/"/g,'""')}"`,s=p=>{let k=Math.floor(p/3600),A=Math.floor(p%3600/60),I=String(p%60).padStart(2,"0");return`${String(k).padStart(2,"0")}:${String(A).padStart(2,"0")}:${I}`},o=Array.from(n.keys()).sort();for(let p of o){let k=n.get(p).sort((A,I)=>A.start-I.start);for(let A of k){let I=A.comment,G=s(A.start),J=kr(A.start,`https://www.youtube.com/watch?v=${p}`);r.push([i(I),i(G),i(J)].join(",")),a++}}let m=r.join(`
`),u=`timestamps-${Yn()}.csv`;return{csv:m,filename:u,totalVideos:n.size,totalTimestamps:a}}async function fc(){try{let{csv:t,filename:e,totalVideos:n,totalTimestamps:r}=await co(),a=new Blob([t],{type:"text/csv;charset=utf-8;"}),i=URL.createObjectURL(a),s=document.createElement("a");s.href=i,s.download=e,s.click(),URL.revokeObjectURL(i),c(`Exported ${n} videos with ${r} timestamps (CSV)`)}catch(t){throw c("Failed to export CSV data:",t,"error"),t}}function fi(t){return t?Array.from(t.querySelectorAll("li:not(.ytls-placeholder):not(.ytls-error-message)")):[]}function Qi(t){if(t)for(;t.firstChild;)t.removeChild(t.firstChild)}function ea(t,e){if(!t)return;Qi(t);let n=document.createElement("li");n.className="ytls-placeholder",n.textContent=e,t.appendChild(n),t.style.overflowY="hidden"}function uo(t){if(!t)return;let e=t.querySelector(".ytls-placeholder");e&&e.remove(),t.style.overflowY=""}function mo(t,e){if(!t||e)return;Array.from(t.children).some(r=>!r.classList.contains("ytls-placeholder")&&!r.classList.contains("ytls-error-message"))||ea(t,"No timestamps for this video")}function po(t){if(!t)return[];let e=fi(t),n=[];return e.forEach(r=>{let a=r.querySelector("a[data-time]"),i=r.querySelector("input"),s=r.dataset.guid;if(!a||!i||!s)return;let o=a.dataset.time;if(!o)return;let m=Number.parseInt(o,10);Number.isFinite(m)&&n.push({guid:s,start:m,comment:i.value})}),n.sort((r,a)=>r.start-a.start)}function fo(t){if(!t)return 0;let e=fi(t),n=0;return e.forEach(r=>{let i=r.querySelector("a[data-time]")?.dataset.time;if(i){let s=Number.parseInt(i,10);Number.isFinite(s)&&(n=Math.max(n,s))}}),n}var gc={auth:{googleAuthState:{isSignedIn:!1,accessToken:null,userName:null,email:null},autoBackupEnabled:!0,autoBackupIntervalMinutes:30,autoBackupRetryAttempts:0,autoBackupBackoffMs:null,lastAutoBackupAt:null,isAutoBackupRunning:!1},ui:{panePosition:null,currentVideoId:"",minPaneHeight:250,lastHandledUrl:null,urlChangeHandlersSetup:!1},timestamps:{items:[],currentIndex:null}},be=JSON.parse(JSON.stringify(gc)),yc=new Set;function Ue(){return JSON.parse(JSON.stringify(be))}function at(t){let e=JSON.parse(JSON.stringify(be));be={...be,...t,auth:{...be.auth,...t.auth||{}},ui:{...be.ui,...t.ui||{}},timestamps:{...be.timestamps,...t.timestamps||{}}},vc(e)}function Rt(){return Ue().auth.googleAuthState}function Gt(t){at({auth:{...be.auth,googleAuthState:t}})}function ho(t){at({auth:{...be.auth,autoBackupEnabled:t}})}function go(t){at({auth:{...be.auth,autoBackupIntervalMinutes:t}})}function yo(t){at({auth:{...be.auth,isAutoBackupRunning:t}})}function vo(t){at({auth:{...be.auth,autoBackupRetryAttempts:t}})}function xo(t){at({auth:{...be.auth,autoBackupBackoffMs:t}})}function bo(t){at({auth:{...be.auth,lastAutoBackupAt:t}})}function wo(t){at({ui:{...be.ui,minPaneHeight:t}})}function To(t){at({ui:{...be.ui,panePosition:t}})}function ko(t){at({ui:{...be.ui,lastHandledUrl:t}})}function So(t){at({ui:{...be.ui,urlChangeHandlersSetup:t}})}function Eo(t){at({timestamps:{...be.timestamps,items:t}})}function _o(t){at({timestamps:{...be.timestamps,currentIndex:t}})}function vc(t){yc.forEach(e=>{try{e(be,t)}catch(n){console.error("Error in state listener:",n)}})}var ta="#ytls-pane{background:rgba(19,19,19,.8);text-align:left;position:fixed;bottom:0;right:0;padding:0;margin:0;border-radius:12px;border:1px solid rgba(85,85,85,.8);opacity:.9;z-index:5000;font-family:Arial,sans-serif;width:300px;height:90vh;min-width:300px;max-width:800px;min-height:400px;max-height:90vh;user-select:none;display:flex;flex-direction:column;will-change:width,height;transform:translateZ(0);backface-visibility:hidden;contain:layout style paint;overflow:hidden}#ytls-pane:hover{opacity:1}#ytls-resize-handle{position:absolute;bottom:0;right:0;width:20px;height:20px;cursor:auto;z-index:10;pointer-events:none;background:0 0;margin:0;padding:0}#ytls-resize-handle::before{display:none;content:none}#ytls-resize-bl,#ytls-resize-br,#ytls-resize-tl,#ytls-resize-tr{position:absolute;width:16px;height:16px;z-index:11;background:0 0;pointer-events:auto}#ytls-resize-tl{top:0;left:0;cursor:nwse-resize}#ytls-resize-tr{top:0;right:0;cursor:nesw-resize}#ytls-resize-bl{bottom:0;left:0;cursor:nesw-resize}#ytls-resize-br{bottom:0;right:0;cursor:nwse-resize}#ytls-content{display:flex;flex-direction:column;width:100%;height:100%;min-height:0;box-sizing:border-box;position:relative}#ytls-content ul{flex:1 1 auto;overflow-y:auto;margin:0!important;padding:0!important;border:none!important;box-sizing:border-box;width:100%;max-width:100%;min-height:0;z-index:1}#ytls-content ul li.ytls-placeholder{display:flex;align-items:center;justify-content:center;height:100%;width:100%;color:#bfbfbf;font-size:14px;font-style:italic;padding:12px;text-align:center;box-sizing:border-box}#ytls-pane-header{position:relative;z-index:2}#ytls-buttons{position:relative;z-index:2;flex-shrink:0;display:flex;gap:8px;justify-content:flex-end;padding:10px 18px 10px 16px;background:linear-gradient(0deg,#23272b 0,#212121 100%);border-radius:0 0 12px 12px;border-top:1px solid #23272b;margin-top:auto}#ytls-pane li{display:flex;flex-direction:column;padding:8px 12px;margin:0!important;border:none;border-top:1px solid rgba(85,85,85,.8);user-select:none;box-sizing:border-box;width:100%;max-width:100%}#ytls-pane li:first-child{border-top:none}#ytls-pane li.ytls-timestamp-highlight{background:#1f251d}#ytls-pane li.ytls-timestamp-pending-delete{background:rgba(128,0,0,.8)}#ytls-pane .time-row{display:flex;gap:5px;align-items:center}#ytls-pane .time-row a{flex-grow:0;flex-shrink:0;max-width:100%;text-align:left;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}#ytls-pane .time-row .time-diff{flex-grow:1;text-align:right}#ytls-pane .ytls-marker{position:absolute;height:100%;width:2px;background-color:red;cursor:pointer}#ytls-pane a,#ytls-pane input,#ytls-pane span{background:0 0;color:#fff;font-family:inherit;font-size:14px;text-decoration:none;border:none;outline:0}#ytls-pane input,#ytls-pane textarea{-webkit-user-select:text;-moz-user-select:text;-ms-user-select:text;user-select:text;caret-color:white}#ytls-buttons{flex-shrink:0;display:flex;gap:5px;justify-content:space-between;padding:8px 12px;background:#212121;border-radius:0 0 12px 12px;border-top:1px solid rgba(85,85,85,.8);z-index:2}#ytls-buttons button:hover{background:rgba(255,255,255,.2)}.ytls-main-button{background:#272727;color:#fff;font-size:24px;border:none;border-radius:5px;padding:5px;cursor:pointer;position:relative}.ytls-main-button:hover{background:#3f3f3f}.ytls-holiday-emoji{position:absolute;bottom:0;right:0;font-size:.25em;pointer-events:none}#ytls-pane-header{display:flex;justify-content:space-between;align-items:center;padding:10px 18px 10px 16px;white-space:nowrap;cursor:default;border-radius:12px 12px 0 0;border:none;background:linear-gradient(180deg,#23272b 0,#212121 100%);box-shadow:0 1px 0 0 #23272b;flex-shrink:0;color:#fafafa}#ytls-pane .ytls-version-display{font-size:14px;color:#666;margin-left:auto;padding-right:5px;cursor:default}#ytls-pane .ytls-google-user-display{font-size:12px;color:#4285f4;margin-left:8px;padding:2px 6px;cursor:default;background:rgba(66,133,244,.1);border-radius:4px}#ytls-pane .ytls-backup-status-display{font-size:12px;color:#9acd32;margin-left:8px;padding:2px 6px;cursor:default;background:rgba(154,205,50,.12);border-radius:4px}#ytls-current-time{color:#fff;font-size:14px;cursor:pointer;position:relative}.ytls-backup-indicator{display:inline-block;width:8px;height:8px;border-radius:50%;background-color:#666;cursor:help;flex-shrink:0}#ytls-settings-modal{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#1a1a1a;padding:8px;border-radius:10px;z-index:10000;color:#fff;text-align:center;width:200px;box-shadow:0 0 10px rgba(0,0,0,.5)}#ytls-delete-all-modal,#ytls-load-modal,#ytls-save-modal{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#333;padding:8px;border-radius:10px;z-index:10000;color:#fff;text-align:center;width:fit-content;max-width:90vw;box-shadow:0 0 10px rgba(0,0,0,.5)}.ytls-modal-header{display:flex;align-items:flex-end;margin-bottom:0;gap:10px}.ytls-modal-close-button{position:absolute;top:8px;right:8px;width:16px;height:16px;background:#f44;color:#fff;border:none;border-radius:3px;font-size:14px;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;line-height:1;padding:0;flex-shrink:0;z-index:1}.ytls-modal-close-button:hover{background:#f66}#ytls-settings-content{display:flex;flex-direction:column;gap:10px;align-items:center;background:#2a2a2a;border:2px solid #3a3a3a;border-radius:0 4px 4px 4px;padding:10px;margin-top:-2px;position:relative;z-index:1}.ytls-section-heading{margin:0 0 10px 0;padding:0;font-size:16px;font-weight:700;color:#fff;text-align:center}#ytls-settings-nav{display:flex;gap:6px;flex:0}#ytls-settings-nav .ytls-settings-modal-button{flex:0;width:auto;height:24px;margin-bottom:0;background:#2a2a2a;font-size:13px;padding:0 8px;display:flex;align-items:center;justify-content:center;line-height:1;border:2px solid transparent;border-radius:4px 4px 0 0;border-bottom:2px solid transparent;white-space:nowrap;position:relative}#ytls-settings-nav .ytls-settings-modal-button .ytls-tab-text{display:none}#ytls-settings-nav .ytls-settings-modal-button.active .ytls-tab-text{display:inline}#ytls-settings-nav .ytls-settings-modal-button:hover{background:#3a3a3a}#ytls-settings-nav .ytls-settings-modal-button.active{background:#2a2a2a;border:2px solid #3a3a3a;border-bottom:2px solid #2a2a2a;z-index:2}.ytls-button-grid{display:grid;grid-template-columns:1fr;gap:5px;width:100%}.ytls-settings-modal-button{width:100%;height:32px;background:#555;color:#fff;border:none;border-radius:5px;cursor:pointer;font-size:13px;display:flex;justify-content:center;align-items:center;margin-bottom:5px;padding:0 8px}.ytls-settings-modal-button:hover{background:#777}#ytls-delete-all-modal p,#ytls-load-modal p,#ytls-save-modal p{margin-bottom:15px;font-size:16px}.ytls-save-modal-button{background:#555;color:#fff;padding:10px 20px;border:none;border-radius:5px;cursor:pointer;margin-right:10px}.ytls-save-modal-button:last-of-type{margin-right:0}.ytls-save-modal-cancel-button{background:#444;color:#fff;padding:10px 20px;border:none;border-radius:5px;cursor:pointer;margin-top:15px;display:block;width:100%}.ytls-file-operation-button{background:#555;color:#fff;font-size:12px;padding:5px 10px;border:none;border-radius:5px;cursor:pointer}.ytls-file-operation-button:hover{background:#777}.ytls-hidden-file-input{display:none}#ytls-header-button{align-items:center;background:0 0;border:none;color:var(--yt-spec-text-primary,currentColor);cursor:pointer;display:inline-flex;font-size:20px;height:40px;margin-left:6px;padding:0 6px;text-decoration:none}#ytls-header-button:hover{color:var(--yt-spec-call-to-action,#3ea6ff)}#ytls-header-button:focus-visible{outline:2px solid var(--yt-spec-call-to-action,#3ea6ff);outline-offset:2px}#ytls-header-button img{display:block;height:32px;max-width:48px;pointer-events:none;width:auto}.ytls-fade-in{animation:fadeIn .3s ease-in-out forwards}.ytls-fade-out{animation:fadeOut .3s ease-in-out forwards}.ytls-zoom-in{animation:zoomIn .4s cubic-bezier(.68,-.55,.265,1.55) forwards;transform-origin:center center}.ytls-zoom-out{animation:zoomOut .4s cubic-bezier(.68,-.55,.265,1.55) forwards;transform-origin:center center}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes fadeOut{from{opacity:1}to{opacity:0}}@keyframes zoomIn{from{opacity:0;transform:scale(.1)}to{opacity:1;transform:scale(1)}}@keyframes zoomOut{from{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.1)}}.ytls-tooltip{position:fixed;background:rgba(97,97,97,.92);color:#fff;padding:8px 10px;border-radius:2px;font-size:12px;font-family:Roboto,Arial,sans-serif;font-weight:400;line-height:1.4;letter-spacing:.2px;z-index:10001;pointer-events:none;white-space:pre-line;max-width:300px;box-shadow:0 1px 2px rgba(0,0,0,.1);opacity:0;transition:opacity .2s cubic-bezier(0, 0, .2, 1)}.ytls-tooltip.ytls-tooltip-visible{opacity:1}";var Be=Uint8Array,ot=Uint16Array,sa=Int32Array,la=new Be([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ca=new Be([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Lo=new Be([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ro=function(t,e){for(var n=new ot(31),r=0;r<31;++r)n[r]=e+=1<<t[r-1];for(var a=new sa(n[30]),r=1;r<30;++r)for(var i=n[r];i<n[r+1];++i)a[i]=i-n[r]<<5|r;return{b:n,r:a}},Oo=Ro(la,2),xc=Oo.b,ra=Oo.r;xc[28]=258,ra[258]=28;var Po=Ro(ca,0),Uu=Po.b,Io=Po.r,ia=new ot(32768);for(te=0;te<32768;++te)Vt=(te&43690)>>1|(te&21845)<<1,Vt=(Vt&52428)>>2|(Vt&13107)<<2,Vt=(Vt&61680)>>4|(Vt&3855)<<4,ia[te]=((Vt&65280)>>8|(Vt&255)<<8)>>1;var Vt,te,Ir=(function(t,e,n){for(var r=t.length,a=0,i=new ot(e);a<r;++a)t[a]&&++i[t[a]-1];var s=new ot(e);for(a=1;a<e;++a)s[a]=s[a-1]+i[a-1]<<1;var o;if(n){o=new ot(1<<e);var m=15-e;for(a=0;a<r;++a)if(t[a])for(var u=a<<4|t[a],p=e-t[a],k=s[t[a]-1]++<<p,A=k|(1<<p)-1;k<=A;++k)o[ia[k]>>m]=u}else for(o=new ot(r),a=0;a<r;++a)t[a]&&(o[a]=ia[s[t[a]-1]++]>>15-t[a]);return o}),Mn=new Be(288);for(te=0;te<144;++te)Mn[te]=8;var te;for(te=144;te<256;++te)Mn[te]=9;var te;for(te=256;te<280;++te)Mn[te]=7;var te;for(te=280;te<288;++te)Mn[te]=8;var te,hi=new Be(32);for(te=0;te<32;++te)hi[te]=5;var te,bc=Ir(Mn,9,0);var wc=Ir(hi,5,0);var No=function(t){return(t+7)/8|0},$o=function(t,e,n){return(e==null||e<0)&&(e=0),(n==null||n>t.length)&&(n=t.length),new Be(t.subarray(e,n))};var Tc=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],yi=function(t,e,n){var r=new Error(e||Tc[t]);if(r.code=t,Error.captureStackTrace&&Error.captureStackTrace(r,yi),!n)throw r;return r};var qt=function(t,e,n){n<<=e&7;var r=e/8|0;t[r]|=n,t[r+1]|=n>>8},Ar=function(t,e,n){n<<=e&7;var r=e/8|0;t[r]|=n,t[r+1]|=n>>8,t[r+2]|=n>>16},na=function(t,e){for(var n=[],r=0;r<t.length;++r)t[r]&&n.push({s:r,f:t[r]});var a=n.length,i=n.slice();if(!a)return{t:Ho,l:0};if(a==1){var s=new Be(n[0].s+1);return s[n[0].s]=1,{t:s,l:1}}n.sort(function(we,ke){return we.f-ke.f}),n.push({s:-1,f:25001});var o=n[0],m=n[1],u=0,p=1,k=2;for(n[0]={s:-1,f:o.f+m.f,l:o,r:m};p!=a-1;)o=n[n[u].f<n[k].f?u++:k++],m=n[u!=p&&n[u].f<n[k].f?u++:k++],n[p++]={s:-1,f:o.f+m.f,l:o,r:m};for(var A=i[0].s,r=1;r<a;++r)i[r].s>A&&(A=i[r].s);var I=new ot(A+1),G=aa(n[p-1],I,0);if(G>e){var r=0,J=0,re=G-e,ue=1<<re;for(i.sort(function(ke,ae){return I[ae.s]-I[ke.s]||ke.f-ae.f});r<a;++r){var ve=i[r].s;if(I[ve]>e)J+=ue-(1<<G-I[ve]),I[ve]=e;else break}for(J>>=re;J>0;){var K=i[r].s;I[K]<e?J-=1<<e-I[K]++-1:++r}for(;r>=0&&J;--r){var ie=i[r].s;I[ie]==e&&(--I[ie],++J)}G=e}return{t:new Be(I),l:G}},aa=function(t,e,n){return t.s==-1?Math.max(aa(t.l,e,n+1),aa(t.r,e,n+1)):e[t.s]=n},Co=function(t){for(var e=t.length;e&&!t[--e];);for(var n=new ot(++e),r=0,a=t[0],i=1,s=function(m){n[r++]=m},o=1;o<=e;++o)if(t[o]==a&&o!=e)++i;else{if(!a&&i>2){for(;i>138;i-=138)s(32754);i>2&&(s(i>10?i-11<<5|28690:i-3<<5|12305),i=0)}else if(i>3){for(s(a),--i;i>6;i-=6)s(8304);i>2&&(s(i-3<<5|8208),i=0)}for(;i--;)s(a);i=1,a=t[o]}return{c:n.subarray(0,r),n:e}},Lr=function(t,e){for(var n=0,r=0;r<e.length;++r)n+=t[r]*e[r];return n},zo=function(t,e,n){var r=n.length,a=No(e+2);t[a]=r&255,t[a+1]=r>>8,t[a+2]=t[a]^255,t[a+3]=t[a+1]^255;for(var i=0;i<r;++i)t[a+i+4]=n[i];return(a+4+r)*8},Mo=function(t,e,n,r,a,i,s,o,m,u,p){qt(e,p++,n),++a[256];for(var k=na(a,15),A=k.t,I=k.l,G=na(i,15),J=G.t,re=G.l,ue=Co(A),ve=ue.c,K=ue.n,ie=Co(J),we=ie.c,ke=ie.n,ae=new ot(19),X=0;X<ve.length;++X)++ae[ve[X]&31];for(var X=0;X<we.length;++X)++ae[we[X]&31];for(var q=na(ae,7),Ve=q.t,rn=q.l,Se=19;Se>4&&!Ve[Lo[Se-1]];--Se);var At=u+5<<3,Ie=Lr(a,Mn)+Lr(i,hi)+s,ze=Lr(a,A)+Lr(i,J)+s+14+3*Se+Lr(ae,Ve)+2*ae[16]+3*ae[17]+7*ae[18];if(m>=0&&At<=Ie&&At<=ze)return zo(e,p,t.subarray(m,m+u));var tt,Ee,nt,gt;if(qt(e,p,1+(ze<Ie)),p+=2,ze<Ie){tt=Ir(A,I,0),Ee=A,nt=Ir(J,re,0),gt=J;var nr=Ir(Ve,rn,0);qt(e,p,K-257),qt(e,p+5,ke-1),qt(e,p+10,Se-4),p+=14;for(var X=0;X<Se;++X)qt(e,p+3*X,Ve[Lo[X]]);p+=3*Se;for(var He=[ve,we],lt=0;lt<2;++lt)for(var Te=He[lt],X=0;X<Te.length;++X){var Ce=Te[X]&31;qt(e,p,nr[Ce]),p+=Ve[Ce],Ce>15&&(qt(e,p,Te[X]>>5&127),p+=Te[X]>>12)}}else tt=bc,Ee=Mn,nt=wc,gt=hi;for(var X=0;X<o;++X){var pe=r[X];if(pe>255){var Ce=pe>>18&31;Ar(e,p,tt[Ce+257]),p+=Ee[Ce+257],Ce>7&&(qt(e,p,pe>>23&31),p+=la[Ce]);var yt=pe&31;Ar(e,p,nt[yt]),p+=gt[yt],yt>3&&(Ar(e,p,pe>>5&8191),p+=ca[yt])}else Ar(e,p,tt[pe]),p+=Ee[pe]}return Ar(e,p,tt[256]),p+Ee[256]},kc=new sa([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Ho=new Be(0),Sc=function(t,e,n,r,a,i){var s=i.z||t.length,o=new Be(r+s+5*(1+Math.ceil(s/7e3))+a),m=o.subarray(r,o.length-a),u=i.l,p=(i.r||0)&7;if(e){p&&(m[0]=i.r>>3);for(var k=kc[e-1],A=k>>13,I=k&8191,G=(1<<n)-1,J=i.p||new ot(32768),re=i.h||new ot(G+1),ue=Math.ceil(n/3),ve=2*ue,K=function(ct){return(t[ct]^t[ct+1]<<ue^t[ct+2]<<ve)&G},ie=new sa(25e3),we=new ot(288),ke=new ot(32),ae=0,X=0,q=i.i||0,Ve=0,rn=i.w||0,Se=0;q+2<s;++q){var At=K(q),Ie=q&32767,ze=re[At];if(J[Ie]=ze,re[At]=Ie,rn<=q){var tt=s-q;if((ae>7e3||Ve>24576)&&(tt>423||!u)){p=Mo(t,m,0,ie,we,ke,X,Ve,Se,q-Se,p),Ve=ae=X=0,Se=q;for(var Ee=0;Ee<286;++Ee)we[Ee]=0;for(var Ee=0;Ee<30;++Ee)ke[Ee]=0}var nt=2,gt=0,nr=I,He=Ie-ze&32767;if(tt>2&&At==K(q-He))for(var lt=Math.min(A,tt)-1,Te=Math.min(32767,q),Ce=Math.min(258,tt);He<=Te&&--nr&&Ie!=ze;){if(t[q+nt]==t[q+nt-He]){for(var pe=0;pe<Ce&&t[q+pe]==t[q+pe-He];++pe);if(pe>nt){if(nt=pe,gt=He,pe>lt)break;for(var yt=Math.min(He,pe-2),rr=0,Ee=0;Ee<yt;++Ee){var ir=q-He+Ee&32767,_i=J[ir],ar=ir-_i&32767;ar>rr&&(rr=ar,ze=ir)}}}Ie=ze,ze=J[Ie],He+=Ie-ze&32767}if(gt){ie[Ve++]=268435456|ra[nt]<<18|Io[gt];var Rr=ra[nt]&31,Or=Io[gt]&31;X+=la[Rr]+ca[Or],++we[257+Rr],++ke[Or],rn=q+nt,++ae}else ie[Ve++]=t[q],++we[t[q]]}}for(q=Math.max(q,rn);q<s;++q)ie[Ve++]=t[q],++we[t[q]];p=Mo(t,m,u,ie,we,ke,X,Ve,Se,q-Se,p),u||(i.r=p&7|m[p/8|0]<<3,p-=7,i.h=re,i.p=J,i.i=q,i.w=rn)}else{for(var q=i.w||0;q<s+u;q+=65535){var Dn=q+65535;Dn>=s&&(m[p/8|0]=u,Dn=s),p=zo(m,p+1,t.subarray(q,Dn))}i.i=s}return $o(o,0,r+No(p)+a)},Ec=(function(){for(var t=new Int32Array(256),e=0;e<256;++e){for(var n=e,r=9;--r;)n=(n&1&&-306674912)^n>>>1;t[e]=n}return t})(),_c=function(){var t=-1;return{p:function(e){for(var n=t,r=0;r<e.length;++r)n=Ec[n&255^e[r]]^n>>>8;t=n},d:function(){return~t}}};var Ac=function(t,e,n,r,a){if(!a&&(a={l:1},e.dictionary)){var i=e.dictionary.subarray(-32768),s=new Be(i.length+t.length);s.set(i),s.set(t,i.length),t=s,a.w=i.length}return Sc(t,e.level==null?6:e.level,e.mem==null?a.l?Math.ceil(Math.max(8,Math.min(13,Math.log(t.length)))*1.5):20:12+e.mem,n,r,a)},Fo=function(t,e){var n={};for(var r in t)n[r]=t[r];for(var r in e)n[r]=e[r];return n};var De=function(t,e,n){for(;n;++e)t[e]=n,n>>>=8};function Lc(t,e){return Ac(t,e||{},0,0)}var jo=function(t,e,n,r){for(var a in t){var i=t[a],s=e+a,o=r;Array.isArray(i)&&(o=Fo(r,i[1]),i=i[0]),i instanceof Be?n[s]=[i,o]:(n[s+="/"]=[new Be(0),o],jo(i,s,n,r))}},Do=typeof TextEncoder<"u"&&new TextEncoder,Ic=typeof TextDecoder<"u"&&new TextDecoder,Cc=0;try{Ic.decode(Ho,{stream:!0}),Cc=1}catch{}function gi(t,e){if(e){for(var n=new Be(t.length),r=0;r<t.length;++r)n[r]=t.charCodeAt(r);return n}if(Do)return Do.encode(t);for(var a=t.length,i=new Be(t.length+(t.length>>1)),s=0,o=function(p){i[s++]=p},r=0;r<a;++r){if(s+5>i.length){var m=new Be(s+8+(a-r<<1));m.set(i),i=m}var u=t.charCodeAt(r);u<128||e?o(u):u<2048?(o(192|u>>6),o(128|u&63)):u>55295&&u<57344?(u=65536+(u&1047552)|t.charCodeAt(++r)&1023,o(240|u>>18),o(128|u>>12&63),o(128|u>>6&63),o(128|u&63)):(o(224|u>>12),o(128|u>>6&63),o(128|u&63))}return $o(i,0,s)}var oa=function(t){var e=0;if(t)for(var n in t){var r=t[n].length;r>65535&&yi(9),e+=r+4}return e},Bo=function(t,e,n,r,a,i,s,o){var m=r.length,u=n.extra,p=o&&o.length,k=oa(u);De(t,e,s!=null?33639248:67324752),e+=4,s!=null&&(t[e++]=20,t[e++]=n.os),t[e]=20,e+=2,t[e++]=n.flag<<1|(i<0&&8),t[e++]=a&&8,t[e++]=n.compression&255,t[e++]=n.compression>>8;var A=new Date(n.mtime==null?Date.now():n.mtime),I=A.getFullYear()-1980;if((I<0||I>119)&&yi(10),De(t,e,I<<25|A.getMonth()+1<<21|A.getDate()<<16|A.getHours()<<11|A.getMinutes()<<5|A.getSeconds()>>1),e+=4,i!=-1&&(De(t,e,n.crc),De(t,e+4,i<0?-i-2:i),De(t,e+8,n.size)),De(t,e+12,m),De(t,e+14,k),e+=16,s!=null&&(De(t,e,p),De(t,e+6,n.attrs),De(t,e+10,s),e+=14),t.set(r,e),e+=m,k)for(var G in u){var J=u[G],re=J.length;De(t,e,+G),De(t,e+2,re),t.set(J,e+4),e+=4+re}return p&&(t.set(o,e),e+=p),e},Mc=function(t,e,n,r,a){De(t,e,101010256),De(t,e+8,n),De(t,e+10,n),De(t,e+12,r),De(t,e+16,a)};function Uo(t,e){e||(e={});var n={},r=[];jo(t,"",n,e);var a=0,i=0;for(var s in n){var o=n[s],m=o[0],u=o[1],p=u.level==0?0:8,k=gi(s),A=k.length,I=u.comment,G=I&&gi(I),J=G&&G.length,re=oa(u.extra);A>65535&&yi(11);var ue=p?Lc(m,u):m,ve=ue.length,K=_c();K.p(m),r.push(Fo(u,{size:m.length,crc:K.d(),c:ue,f:k,m:G,u:A!=s.length||G&&I.length!=J,o:a,compression:p})),a+=30+A+re+ve,i+=76+2*(A+re)+(J||0)+ve}for(var ie=new Be(i+22),we=a,ke=i-a,ae=0;ae<r.length;++ae){var k=r[ae];Bo(ie,k.o,k,k.f,k.u,k.c.length);var X=30+k.f.length+oa(k.extra);ie.set(k.c,k.o+X),Bo(ie,a,k,k.f,k.u,k.c.length,k.o,k.m),a+=16+X+(k.m?k.m.length:0)}return Mc(ie,a,r.length,ke,we),ie}function Et(){return Rt()}function Jo(t){Gt(t)}var Ge={get isSignedIn(){return Rt().isSignedIn},get accessToken(){return Rt().accessToken},get userName(){return Rt().userName},get email(){return Rt().email},set isSignedIn(t){let e=Rt();Gt({...e,isSignedIn:t})},set accessToken(t){let e=Rt();Gt({...e,accessToken:t})},set userName(t){let e=Rt();Gt({...e,userName:t})},set email(t){let e=Rt();Gt({...e,email:t})}};function Wt(){return Ue().auth.autoBackupEnabled}function Ko(t){ho(t)}var Dc=void 0;function _t(){return Ue().auth.autoBackupIntervalMinutes}function Xo(t){go(t)}var Bc=void 0;function Zt(){return Ue().auth.lastAutoBackupAt}function Qo(t){bo(t)}var Go=void 0;function wi(){return Ue().auth.isAutoBackupRunning}function Vo(t){yo(t)}function qo(){return Ue().auth.autoBackupRetryAttempts}function ua(t){vo(t)}function nn(){return Ue().auth.autoBackupBackoffMs}function vi(t){xo(t)}var da=null,Ae=null,ne=null,xi=null;function es(t){da=t}function ts(t){Ae=t}function ns(t){ne=t}function ma(t){xi=t}var Zo=!1;function rs(){if(!Zo)try{let t=document.createElement("style");t.textContent=`
@keyframes tk-spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
@keyframes tk-blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.2; } }
.tk-auth-spinner { display:inline-block; width:12px; height:12px; border:2px solid rgba(255,165,0,0.3); border-top-color:#ffa500; border-radius:50%; margin-right:6px; vertical-align:-2px; animation: tk-spin 0.9s linear infinite; }
.tk-auth-blink { animation: tk-blink 0.4s ease-in-out 3; }
`,document.head.appendChild(t),Zo=!0}catch{}}var is=null,Cr=null,Mr=null;function pa(t){is=t}function Ti(t){Cr=t}function ki(t){Mr=t}var Wo="1023528652072-45cu3dr7o5j79vsdn8643bhle9ee8kds.apps.googleusercontent.com",Rc="https://www.googleapis.com/auth/drive.file https://www.googleapis.com/auth/userinfo.profile",Oc="https://www.youtube.com/",Pc=30*1e3,Nc=1800*1e3,Yo=5,bi=null,st=null;async function fa(){try{let t=await Mr("googleAuthState"),e=t&&typeof t=="object"?{...t,accessToken:t.accessToken?"[REDACTED]":null}:t;c("Loading Google auth state from IndexedDB:",e);let n=Yi.safeParse(t);if(n.success){let r=Et();Jo({...r,...n.data});let a=Et();a.isSignedIn&&a.accessToken&&c(`Reusing stored Google auth token for ${a.userName||a.email||"user"}`),Br();let i=Et();i.isSignedIn&&i.accessToken&&await tr(!0)}else if(t!==void 0){let r=t&&typeof t=="object"?{...t,accessToken:t.accessToken?"[REDACTED]":null}:t;c("Google auth state failed validation:",{stored:r,errors:n.error.format()},"warn")}}catch(t){c("Failed to load Google auth state:",t,"error")}}async function Si(){try{let t=Et(),e=Yi.safeParse(t);if(!e.success){let n={...t,accessToken:t.accessToken?"[REDACTED]":null};c("Invalid auth state, cannot save",{state:n,errors:e.error.format()},"error");return}await Cr("googleAuthState",t),t.isSignedIn&&t.accessToken?c(`Saved Google auth state to IndexedDB for ${t.userName||t.email||"user"}`):c("Cleared Google auth state in IndexedDB (signed out)")}catch(t){c("Failed to save Google auth state:",t,"error")}}function Br(){da&&(da.style.display="none")}function et(t,e){if(!ne)return;if(ne.style.fontWeight="bold",t==="authenticating"){for(rs(),ne.style.color="#ffa500";ne.firstChild;)ne.removeChild(ne.firstChild);let r=document.createElement("span");r.className="tk-auth-spinner";let a=document.createTextNode(` ${e||"Authorizing with Google\u2026"}`);ne.appendChild(r),ne.appendChild(a);return}if(t==="error"){ne.textContent=`\u274C ${e||"Authorization failed"}`,ne.style.color="#ff4d4f",ye();return}let n=Et();n.isSignedIn?(ne.textContent="\u2705 Signed in",ne.style.color="#52c41a",ne.removeAttribute("title"),n.userName?(ne.onmouseenter=()=>{ne.textContent=`\u2705 Signed in as ${n.userName}`},ne.onmouseleave=()=>{ne.textContent="\u2705 Signed in"}):(ne.onmouseenter=null,ne.onmouseleave=null)):(ne.textContent="\u274C Not signed in",ne.style.color="#ff4d4f",ne.removeAttribute("title"),ne.onmouseenter=null,ne.onmouseleave=null),ye()}function $c(){ne&&(rs(),ne.classList.remove("tk-auth-blink"),ne.offsetWidth,ne.classList.add("tk-auth-blink"),setTimeout(()=>{ne.classList.remove("tk-auth-blink")},1200))}function zc(t){return new Promise((e,n)=>{if(!t){c&&c("OAuth monitor: popup is null",null,"error"),n(new Error("Failed to open popup"));return}c&&c("OAuth monitor: starting to monitor popup for token");let r=Date.now(),a=300*1e3,i="timekeeper_oauth",s=null,o=null,m=null,u=()=>{if(s){try{s.close()}catch{}s=null}o&&(clearInterval(o),o=null),m&&(clearInterval(m),m=null)};try{s=new BroadcastChannel(i),c&&c("OAuth monitor: BroadcastChannel created successfully"),s.onmessage=A=>{let I=A.data?.token?{...A.data,token:"[REDACTED]"}:A.data;c&&c("OAuth monitor: received BroadcastChannel message",I);let G=M.object({type:M.string(),token:M.string().optional(),error:M.string().optional()}).safeParse(A.data);if(!G.success){c&&c("OAuth monitor: invalid message format",G.error,"warn");return}if(G.data.type==="timekeeper_oauth_token"&&G.data.token){c&&c("OAuth monitor: token received via BroadcastChannel"),u();try{t.close()}catch{}e(G.data.token)}else if(G.data.type==="timekeeper_oauth_error"){c&&c("OAuth monitor: error received via BroadcastChannel",G.data.error,"error"),u();try{t.close()}catch{}n(new Error(G.data.error||"OAuth failed"))}}}catch(A){c&&c("OAuth monitor: BroadcastChannel not supported, using IndexedDB fallback",A)}c&&c("OAuth monitor: setting up IndexedDB polling");let p=Date.now();o=setInterval(async()=>{try{let A=indexedDB.open("ytls-timestamps-db",3);A.onsuccess=()=>{let I=A.result,re=I.transaction("settings","readonly").objectStore("settings").get("oauth_message");re.onsuccess=()=>{let ue=re.result;if(ue&&ue.value){let ve=ue.value,K=M.object({type:M.string(),token:M.string().optional(),error:M.string().optional(),timestamp:M.number().optional()}).safeParse(ve);if(!K.success){c&&c("OAuth monitor: invalid IndexedDB message format",K.error,"warn");return}if(K.data.timestamp&&K.data.timestamp>p){let ie=K.data.token?{...K.data,token:"[REDACTED]"}:K.data;if(c&&c("OAuth monitor: received IndexedDB message",ie),K.data.type==="timekeeper_oauth_token"&&K.data.token){c&&c("OAuth monitor: token received via IndexedDB"),u();try{t.close()}catch{}I.transaction("settings","readwrite").objectStore("settings").delete("oauth_message"),e(K.data.token)}else if(K.data.type==="timekeeper_oauth_error"){c&&c("OAuth monitor: error received via IndexedDB",K.data.error,"error"),u();try{t.close()}catch{}I.transaction("settings","readwrite").objectStore("settings").delete("oauth_message"),n(new Error(K.data.error||"OAuth failed"))}p=K.data.timestamp||Date.now()}}I.close()}}}catch(A){c&&c("OAuth monitor: IndexedDB polling error",A,"error")}},500),m=setInterval(()=>{if(Date.now()-r>a){c&&c("OAuth monitor: popup timed out after 5 minutes",null,"error"),u();try{t.close()}catch{}n(new Error("OAuth popup timed out"));return}},1e3)})}async function as(){if(!Wo){et("error","Google Client ID not configured");return}try{c&&c("OAuth signin: starting OAuth flow"),et("authenticating","Opening authentication window...");let t=new URL("https://accounts.google.com/o/oauth2/v2/auth");t.searchParams.set("client_id",Wo),t.searchParams.set("redirect_uri",Oc),t.searchParams.set("response_type","token"),t.searchParams.set("scope",Rc),t.searchParams.set("include_granted_scopes","true"),t.searchParams.set("state","timekeeper_auth"),c&&c("OAuth signin: opening popup");let e=window.open(t.toString(),"TimekeeperGoogleAuth","width=500,height=600,menubar=no,toolbar=no,location=no");if(!e){c&&c("OAuth signin: popup blocked by browser",null,"error"),et("error","Popup blocked. Please enable popups for YouTube.");return}c&&c("OAuth signin: popup opened successfully"),et("authenticating","Waiting for authentication...");try{let n=await zc(e),r=await fetch("https://www.googleapis.com/oauth2/v2/userinfo",{headers:{Authorization:`Bearer ${n}`}});if(r.ok){let a=await r.json(),i=M.object({name:M.string().optional(),email:M.string().optional()}).safeParse(a);if(!i.success)throw c&&c("Failed to validate user info response",i.error,"error"),new Error("Invalid user info response");let s=i.data;Gt({isSignedIn:!0,accessToken:n,userName:s.name||null,email:s.email||null}),await Si(),Br(),et(),ye(),await tr(),c?c(`Successfully authenticated as ${s.name}`):console.log(`[Timekeeper] Successfully authenticated as ${s.name}`)}else throw new Error("Failed to fetch user info")}catch(n){let r=n instanceof Error?n.message:"Authentication failed";c?c("OAuth failed:",n,"error"):console.error("[Timekeeper] OAuth failed:",n),et("error",r);return}}catch(t){let e=t instanceof Error?t.message:"Sign in failed";c?c("Failed to sign in to Google:",t,"error"):console.error("[Timekeeper] Failed to sign in to Google:",t),et("error",`Failed to sign in: ${e}`)}}async function os(){if(!window.opener||window.opener===window)return!1;c&&c("OAuth popup: detected popup window, checking for OAuth response");let t=window.location.hash;if(!t||t.length<=1)return c&&c("OAuth popup: no hash params found"),!1;let e=t.startsWith("#")?t.substring(1):t,n=new URLSearchParams(e),r=n.get("state");if(c&&c("OAuth popup: hash params found, state="+r),r!=="timekeeper_auth")return c&&c("OAuth popup: not our OAuth flow (wrong state)"),!1;let a=n.get("error"),i=n.get("access_token"),s="timekeeper_oauth";if(a){try{let o=new BroadcastChannel(s);o.postMessage({type:"timekeeper_oauth_error",error:n.get("error_description")||a}),o.close(),c&&c("OAuth popup: error broadcast via BroadcastChannel")}catch{let m={type:"timekeeper_oauth_error",error:n.get("error_description")||a,timestamp:Date.now()};c&&c("OAuth popup: writing error to IndexedDB",m);let u=indexedDB.open("ytls-timestamps-db",3);u.onsuccess=()=>{let p=u.result,A=p.transaction("settings","readwrite").objectStore("settings").put({key:"oauth_message",value:m});A.onsuccess=()=>{c&&c("OAuth popup: error written to IndexedDB successfully")},A.onerror=()=>{c&&c("OAuth popup: failed to write error to IndexedDB",A.error,"error")},p.close()},u.onerror=()=>{c&&c("OAuth popup: failed to open IndexedDB",u.error,"error")}}return setTimeout(()=>{try{window.close()}catch{}},500),!0}if(i){c&&c("OAuth popup: access token found, broadcasting to opener");try{let o=new BroadcastChannel(s);o.postMessage({type:"timekeeper_oauth_token",token:i}),o.close(),c&&c("OAuth popup: token broadcast via BroadcastChannel")}catch(o){c&&c("OAuth popup: BroadcastChannel failed, using IndexedDB",o);let m={type:"timekeeper_oauth_token",token:i,timestamp:Date.now()},u={...m,token:"[REDACTED]"};c&&c("OAuth popup: writing token to IndexedDB",u);let p=indexedDB.open("ytls-timestamps-db",3);p.onsuccess=()=>{let k=p.result,I=k.transaction("settings","readwrite").objectStore("settings").put({key:"oauth_message",value:m});I.onsuccess=()=>{c&&c("OAuth popup: token written to IndexedDB successfully")},I.onerror=()=>{c&&c("OAuth popup: failed to write token to IndexedDB",I.error,"error")},k.close()},p.onerror=()=>{c&&c("OAuth popup: failed to open IndexedDB",p.error,"error")}}return setTimeout(()=>{try{window.close()}catch{}},500),!0}return!1}async function ss(){Jo({isSignedIn:!1,accessToken:null,userName:null,email:null}),await Si(),Br(),et(),ye()}async function ls(){let t=Et();if(!t.isSignedIn||!t.accessToken)return!1;try{let e=await fetch("https://www.googleapis.com/oauth2/v2/userinfo",{headers:{Authorization:`Bearer ${t.accessToken}`}});return e.status===401?(await cs({silent:!0}),!1):e.ok}catch(e){return c("Failed to verify auth state:",e,"error"),!1}}async function Hc(t){let e={Authorization:`Bearer ${t}`},r=`https://www.googleapis.com/drive/v3/files?q=${encodeURIComponent("name = 'Timekeeper' and mimeType = 'application/vnd.google-apps.folder' and trashed = false")}&fields=files(id,name)&pageSize=10`,a=await fetch(r,{headers:e});if(a.status===401)throw new Error("unauthorized");if(!a.ok)throw new Error("drive search failed");let i=await a.json();if(Array.isArray(i.files)&&i.files.length>0)return i.files[0].id;let s=await fetch("https://www.googleapis.com/drive/v3/files",{method:"POST",headers:{...e,"Content-Type":"application/json"},body:JSON.stringify({name:"Timekeeper",mimeType:"application/vnd.google-apps.folder"})});if(s.status===401)throw new Error("unauthorized");if(!s.ok)throw new Error("drive folder create failed");return(await s.json()).id}async function Fc(t,e,n){let r=`name='${t}' and '${e}' in parents and trashed=false`,a=encodeURIComponent(r),i=await fetch(`https://www.googleapis.com/drive/v3/files?q=${a}&fields=files(id,name)`,{method:"GET",headers:{Authorization:`Bearer ${n}`}});if(i.status===401)throw new Error("unauthorized");if(!i.ok)return null;let s=await i.json();return s.files&&s.files.length>0?s.files[0].id:null}function jc(t,e){let n=gi(t),r=e.replace(/\\/g,"/").replace(/^\/+/,"");return r.endsWith(".json")||(r+=".json"),Uo({[r]:[n,{level:6,mtime:new Date,os:0}]})}async function Uc(t,e,n,r){let a=t.replace(/\.json$/,".zip"),i=await Fc(a,n,r),s=new TextEncoder().encode(e).length,o=jc(e,t),m=o.length;c(`Compressing data: ${s} bytes -> ${m} bytes (${Math.round(100-m/s*100)}% reduction)`);let u="-------314159265358979",p=`\r
--${u}\r
`,k=`\r
--${u}--`,A=i?{name:a,mimeType:"application/zip"}:{name:a,mimeType:"application/zip",parents:[n]},I=8192,G="";for(let ie=0;ie<o.length;ie+=I){let we=o.subarray(ie,Math.min(ie+I,o.length));G+=String.fromCharCode.apply(null,Array.from(we))}let J=btoa(G),re=p+`Content-Type: application/json; charset=UTF-8\r
\r
`+JSON.stringify(A)+p+`Content-Type: application/zip\r
Content-Transfer-Encoding: base64\r
\r
`+J+k,ue,ve;i?(ue=`https://www.googleapis.com/upload/drive/v3/files/${i}?uploadType=multipart&fields=id,name`,ve="PATCH"):(ue="https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart&fields=id,name",ve="POST");let K=await fetch(ue,{method:ve,headers:{Authorization:`Bearer ${r}`,"Content-Type":`multipart/related; boundary=${u}`},body:re});if(K.status===401)throw new Error("unauthorized");if(!K.ok)throw new Error("drive upload failed")}async function cs(t){c("Auth expired, clearing token",null,"warn"),Gt({isSignedIn:!1,accessToken:null,userName:null,email:null}),await Si(),et("error","Authorization expired. Please sign in again."),ye()}async function Gc(t){if(!Ge.isSignedIn||!Ge.accessToken){t?.silent||et("error","Please sign in to Google Drive first");return}try{let{json:e,filename:n,totalVideos:r,totalTimestamps:a}=await is();if(a===0){t?.silent||c("Skipping export: no timestamps to back up");return}let i=await Hc(Ge.accessToken);await Uc(n,e,i,Ge.accessToken),c(`Exported to Google Drive (${n}) with ${r} videos / ${a} timestamps.`)}catch(e){throw e.message==="unauthorized"?(await cs({silent:t?.silent}),e):(c("Drive export failed:",e,"error"),t?.silent||et("error","Failed to export to Google Drive."),e)}}async function us(){try{let t=Ji.partial().safeParse({autoBackupEnabled:await Mr("autoBackupEnabled"),autoBackupIntervalMinutes:await Mr("autoBackupIntervalMinutes"),lastAutoBackupAt:await Mr("lastAutoBackupAt")});t.success?(typeof t.data.autoBackupEnabled=="boolean"&&Ko(t.data.autoBackupEnabled),typeof t.data.autoBackupIntervalMinutes=="number"&&Xo(t.data.autoBackupIntervalMinutes),typeof t.data.lastAutoBackupAt=="number"&&Qo(t.data.lastAutoBackupAt)):c("Failed to validate auto backup settings:",t.error.format(),"warn")}catch(t){c("Failed to load auto backup settings:",t,"error")}}async function ha(){try{let t={autoBackupEnabled:Wt(),autoBackupIntervalMinutes:_t(),lastAutoBackupAt:Zt()??0},e=Ji.safeParse(t);if(!e.success){c("Invalid auto backup settings, cannot save",{settings:t,errors:e.error.format()},"error");return}await Cr("autoBackupEnabled",Wt()),await Cr("autoBackupIntervalMinutes",_t()),await Cr("lastAutoBackupAt",Zt()??0)}catch(t){c("Failed to save auto backup settings:",t,"error")}}function Vc(){bi&&(clearInterval(bi),bi=null),st&&(clearTimeout(st),st=null)}function er(t){try{let e=new Date(t),n=new Date,r=e.toDateString()===n.toDateString(),a=e.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"});return r?a:`${e.toLocaleDateString()} ${a}`}catch{return""}}function ds(){return Wt()?wi()?"#4285f4":nn()&&nn()>0?"#ffa500":Et().isSignedIn&&Zt()?"#52c41a":Et().isSignedIn?"#ffa500":"#ff4d4f":"#ff4d4f"}function ye(){if(!Ae)return;let t="",e="";if(!Wt())t="\u{1F501} Backup: Off",Ae.onmouseenter=null,Ae.onmouseleave=null;else if(wi())t="\u{1F501} Backing up\u2026",Ae.onmouseenter=null,Ae.onmouseleave=null;else if(nn()&&nn()>0)t=`\u26A0\uFE0F Retry in ${Math.ceil(nn()/6e4)}m`,Ae.onmouseenter=null,Ae.onmouseleave=null;else if(Zt()){t=`\u{1F5C4}\uFE0F Last backup: ${er(Zt())}`;let n=Zt()+Math.max(1,_t())*60*1e3;e=`\u{1F5C4}\uFE0F Next backup: ${er(n)}`,Ae.onmouseenter=()=>{Ae.textContent=e},Ae.onmouseleave=()=>{Ae.textContent=t}}else{t="\u{1F5C4}\uFE0F Last backup: never";let n=Date.now()+Math.max(1,_t())*60*1e3;e=`\u{1F5C4}\uFE0F Next backup: ${er(n)}`,Ae.onmouseenter=()=>{Ae.textContent=e},Ae.onmouseleave=()=>{Ae.textContent=t}}Ae.textContent=t,Ae.style.display=t?"inline":"none";try{let n=ds();Ae.style.color=n}catch{}Ei()}function Ei(){if(!xi)return;let t=ds();xi.style.backgroundColor=t,ht(xi,()=>{let e="";if(!Wt())e="Auto backup is disabled";else if(wi())e="Backup in progress";else if(nn()&&nn()>0)e=`Retrying backup in ${Math.ceil(nn()/6e4)}m`;else if(Et().isSignedIn&&Zt()){let n=Zt()+Math.max(1,_t())*60*1e3,r=er(n);e=`Last backup: ${er(Zt())}
Next backup: ${r}`}else if(Et().isSignedIn){let n=Date.now()+Math.max(1,_t())*60*1e3;e=`No backup yet
Next backup: ${er(n)}`}else e="Not signed in to Google Drive";return e})}async function Dr(t=!0){if(!Ge.isSignedIn||!Ge.accessToken){t||$c();return}if(st){c("Auto backup: backoff in progress, skipping scheduled run");return}if(!wi()){Vo(!0),ye();try{await Gc({silent:t}),Qo(Date.now()),ua(0),vi(null),st&&(clearTimeout(st),st=null),await ha()}catch(e){if(c("Auto backup failed:",e,"error"),e.message==="unauthorized"){c("Auth error detected, clearing token and stopping retries",null,"warn");let r=Et();Gt({...r,accessToken:null,isSignedIn:!1}),await Si(),et("error","Authorization expired. Please sign in again."),ye(),ua(0),vi(null),st&&(clearTimeout(st),st=null)}else if(qo()<Yo){let r=qo()+1;ua(r);let i=Math.min(Pc*Math.pow(2,r-1),Nc);vi(i),st&&clearTimeout(st),st=setTimeout(()=>{Dr(!0)},i),c(`Scheduling backup retry ${r}/${Yo} in ${Math.round(i/1e3)}s`),ye()}else vi(null)}finally{Vo(!1),ye()}}}async function tr(t=!1){if(Vc(),!!Dc&&!(!Ge.isSignedIn||!Ge.accessToken)){if(bi=setInterval(()=>{Dr(!0)},Math.max(1,_t())*60*1e3),!t){let e=Date.now(),n=Math.max(1,Bc)*60*1e3;(!Go||e-Go>=n)&&Dr(!0)}ye()}}async function ms(){let t=Wt();Ko(!t),await ha(),await tr(),ye()}async function ps(){let t=_t(),e=prompt("Set Auto Backup interval (minutes):",String(t));if(e===null)return;let n=Math.floor(Number(e));if(!Number.isFinite(n)||n<5||n>1440){alert("Please enter a number between 5 and 1440 minutes.");return}Xo(n),await ha(),await tr(),ye()}var ga=window.location.hash;if(ga&&ga.length>1){let t=new URLSearchParams(ga.substring(1));if(t.get("state")==="timekeeper_auth"){let n=t.get("access_token");if(n){console.log("[Timekeeper] Auth token detected in URL, broadcasting token"),console.log("[Timekeeper] Token length:",n.length,"characters");try{let r=new BroadcastChannel("timekeeper_oauth"),a={type:"timekeeper_oauth_token",token:n};console.log("[Timekeeper] Sending auth message via BroadcastChannel:",{type:a.type,tokenLength:n.length}),r.postMessage(a),r.close(),console.log("[Timekeeper] Token broadcast via BroadcastChannel completed")}catch(r){console.log("[Timekeeper] BroadcastChannel failed, using IndexedDB fallback:",r);let a={type:"timekeeper_oauth_token",token:n,timestamp:Date.now()},i=indexedDB.open("ytls-timestamps-db",3);i.onsuccess=()=>{let s=i.result,o=s.transaction("settings","readwrite");o.objectStore("settings").put({key:"oauth_message",value:a}),o.oncomplete=()=>{console.log("[Timekeeper] Token broadcast via IndexedDB completed, timestamp:",a.timestamp),s.close()}}}if(history.replaceState){let r=window.location.pathname+window.location.search;history.replaceState(null,"",r)}throw console.log("[Timekeeper] Closing window after broadcasting auth token"),window.close(),new Error("OAuth window closed")}}}(async function(){"use strict";if(window.top!==window.self)return;function t(l){return GM.getValue(`timekeeper_${l}`,void 0)}function e(l,d){return GM.setValue(`timekeeper_${l}`,JSON.stringify(d))}if(ki(t),Ti(e),await os()){c("OAuth popup detected, broadcasting token and closing");return}await fa();let r=["/watch","/live"];function a(l=window.location.href){try{let d=new URL(l);return d.origin!=="https://www.youtube.com"?!1:r.some(f=>d.pathname===f||d.pathname.startsWith(`${f}/`))}catch(d){return c("Timekeeper failed to parse URL for support check:",d,"error"),!1}}let i=null,s=null,o=null,m=null,u=null,p=null,k=null,A=null,I=250,G=null,J=!1;function re(){return Ue().ui.minPaneHeight}function ue(l){wo(l)}function ve(){return Ue().ui.lastHandledUrl}function K(l){ko(l)}function ie(){return Ue().ui.urlChangeHandlersSetup}function we(l){So(l)}function ke(){return Ue().ui.panePosition}function ae(l){To(l)}function X(){return Ue().timestamps.items}function q(l){Eo(l)}function Ve(){return Ue().timestamps.currentIndex}function rn(l){_o(l)}function Se(){return i?i.getBoundingClientRect():null}function At(l,d,f){l&&ae({x:Math.round(typeof d=="number"?d:l.left),y:Math.round(typeof f=="number"?f:l.top),width:Math.round(l.width),height:Math.round(l.height)})}function Ie(l=!0){if(!i)return;Pn();let d=Se();if(d&&(d.width||d.height)&&(At(d),l)){let f=ke();ei("windowPosition",f),or({type:"window_position_updated",position:f,timestamp:Date.now()})}}function ze(){if(!i||!s||!m||!o)return;let l=40,d=de();if(d.length>0)l=d[0].offsetHeight;else{let f=document.createElement("li");f.style.visibility="hidden",f.style.position="absolute",f.textContent="00:00 Example",o.appendChild(f),l=f.offsetHeight,o.removeChild(f)}I=s.offsetHeight+m.offsetHeight+l,ue(I),i.style.minHeight=re()+"px"}function tt(){requestAnimationFrame(()=>{typeof window.recalculateTimestampsArea=="function"&&window.recalculateTimestampsArea(),ze(),Ie(!0)})}function Ee(l=450){_e&&(clearTimeout(_e),_e=null),_e=setTimeout(()=>{He(),tt(),_e=null},l)}function nt(){_e&&(clearTimeout(_e),_e=null)}function gt(){o&&(o.style.visibility="hidden",c("Hiding timestamps during show animation")),tt(),Ee()}function nr(){He(),nt(),vt&&(clearTimeout(vt),vt=null),vt=setTimeout(()=>{i&&(i.style.display="none",Pa(),vt=null)},400)}function He(){if(!o){rt&&(rt(),rt=null,Ot=null,sn=null);return}if(!sn){o.style.visibility==="hidden"&&(o.style.visibility="",c("Restoring timestamp visibility (no deferred fragment)")),rt&&(rt(),rt=null,Ot=null);return}c("Appending deferred timestamps after animation"),o.appendChild(sn),sn=null,o.style.visibility==="hidden"&&(o.style.visibility="",c("Restoring timestamp visibility after append")),rt&&(rt(),rt=null,Ot=null),wt(),Fe(),typeof window.recalculateTimestampsArea=="function"&&requestAnimationFrame(()=>window.recalculateTimestampsArea());let l=oe(),d=l?Math.floor(l.getCurrentTime()):Pt();Number.isFinite(d)&&cn(d,!1)}let lt=null,Te=!1,Ce="ytls-timestamp-pending-delete",pe="ytls-timestamp-highlight",yt="https://raw.githubusercontent.com/KamoTimestamps/timekeeper/refs/heads/main/assets/Kamo_64px_Indexed.png",rr="https://raw.githubusercontent.com/KamoTimestamps/timekeeper/refs/heads/main/assets/Kamo_Eyebrow_64px_Indexed.png";function ir(){let l=d=>{let f=new Image;f.src=d};l(yt),l(rr)}ir();async function _i(){for(;!document.querySelector("video")||!document.querySelector("#movie_player");)await new Promise(l=>setTimeout(l,100));for(;!document.querySelector(".ytp-progress-bar");)await new Promise(l=>setTimeout(l,100));await new Promise(l=>setTimeout(l,200))}let ar=["getCurrentTime","seekTo","getPlayerState","seekToLiveHead","getVideoData","getDuration"],Rr=5e3,Or=new Set(["getCurrentTime","seekTo","getPlayerState","seekToLiveHead","getVideoData","getDuration"]);function Dn(l){return Or.has(l)}function ct(){return document.querySelector("video")}let an=null;function oe(){if(an&&document.contains(an))return an;let l=document.getElementById("movie_player");return l&&document.contains(l)?l:null}function Ai(l){return ar.every(d=>typeof l?.[d]=="function"?!0:Dn(d)?!!ct():!1)}function fs(l){return ar.filter(d=>typeof l?.[d]=="function"?!1:Dn(d)?!ct():!0)}async function hs(l=Rr){let d=Date.now();for(;Date.now()-d<l;){let y=oe();if(Ai(y))return y;await new Promise(S=>setTimeout(S,100))}let f=oe();return Ai(f),f}let ya="timestampOffsetSeconds",gs=-5,va="shiftClickTimeSkipSeconds",ys=10,Li=300,Ii=300,Lt=null;function xa(){try{return new URL(window.location.href).origin==="https://www.youtube.com"}catch{return!1}}function ba(){if(xa()&&!Lt)try{Lt=new BroadcastChannel("ytls_timestamp_channel"),Lt.onmessage=wa}catch(l){c("Failed to create BroadcastChannel:",l,"warn"),Lt=null}}function or(l){if(!xa()){c("Skipping BroadcastChannel message: not on https://www.youtube.com","warn");return}if(ba(),!Lt){c("No BroadcastChannel available to post message","warn");return}try{Lt.postMessage(l)}catch(d){c("BroadcastChannel error, reopening:",d,"warn");try{Lt=new BroadcastChannel("ytls_timestamp_channel"),Lt.onmessage=wa,Lt.postMessage(l)}catch(f){c("Failed to reopen BroadcastChannel:",f,"error")}}}function wa(l){if(c("Received message from another tab:",l.data),!(!a()||!o||!i)&&l.data){if(l.data.type==="timestamps_updated"&&l.data.videoId===Le)c("Debouncing timestamp load due to external update for video:",l.data.videoId),clearTimeout(lr),lr=setTimeout(()=>{c("Reloading timestamps due to external update for video:",l.data.videoId),Ra()},500);else if(l.data.type==="window_position_updated"&&i){let d=l.data.position;if(d&&typeof d.x=="number"&&typeof d.y=="number"){i.style.left=`${d.x}px`,i.style.top=`${d.y}px`,i.style.right="auto",i.style.bottom="auto",typeof d.width=="number"&&d.width>0&&(i.style.width=`${d.width}px`),typeof d.height=="number"&&d.height>0&&(i.style.height=`${d.height}px`);let f=i.getBoundingClientRect();ae({x:Math.round(d.x),y:Math.round(d.y),width:Math.round(f.width),height:Math.round(f.height)});let y=document.documentElement.clientWidth,S=document.documentElement.clientHeight;(f.left<0||f.top<0||f.right>y||f.bottom>S)&&Pn()}}}}ba();let Bn=await GM.getValue(ya);(typeof Bn!="number"||Number.isNaN(Bn))&&(Bn=gs,await GM.setValue(ya,Bn));let sr=await GM.getValue(va);(typeof sr!="number"||Number.isNaN(sr))&&(sr=ys,await GM.setValue(va,sr));let lr=null,on=new Map,Pr=!1,F=null,Nr=null,Le=null,vt=null,_e=null,sn=null,Ot=null,rt=null,Yt=null,$r=!1,Zc=null,Ci=!1,zr=null,Hr=null,Fr=null,jr=null,Ur=null,Gr=null,Vr=null,cr=null,ur=null,dr=null,xt=null,bt=null,Ta=0,mr=!1,ln=null,pr=null;function de(){return fi(o)}function Mi(){return po(o)}function Pt(){return pr!==null||(pr=fo(o)),pr}function qr(){pr=null}function vs(l){let d=l.querySelector(".time-diff");return d?(d.textContent?.trim()||"").startsWith("-"):!1}let xs="\u251C\u2500 ",ka="\u2514\u2500 ",Sa=/^[]\s/;function Zr(l){return Sa.test(l)}function Ea(l){return l.replace(Sa,"")}function _a(l){let d=de();if(l>=d.length-1)return ka;let S=d[l+1].querySelector("input");return S&&Zr(S.value)?xs:ka}function bs(l,d){return`${_a(d)}${l}`}function wt(){if(!o)return;let l=de(),d=!0,f=0;for(;d&&f<l.length;)d=!1,f++,l.forEach((y,S)=>{let E=y.querySelector("input");if(!E||!Zr(E.value))return;let b=Ea(E.value),v=bs(b,S);E.value!==v&&(E.value=v,d=!0)})}function Rn(){Qi(o),sn&&(sn=null),rt&&(rt(),rt=null,Ot=null)}function fr(){mo(o,Te)}function Aa(l){ea(o,l)}function Di(){uo(o)}function Bi(l){if(!(!i||!o)){if(Te=l,l)i.style.display="",i.classList.remove("ytls-fade-out"),i.classList.add("ytls-fade-in"),Aa("Loading timestamps...");else if(Di(),i.style.display="",i.classList.remove("ytls-fade-out"),i.classList.add("ytls-fade-in"),u){let d=oe();if(d){let f=d.getCurrentTime(),y=Number.isFinite(f)?Math.max(0,Math.floor(f)):Math.max(0,Pt()),S=Math.floor(y/3600),E=Math.floor(y/60)%60,b=y%60,{isLive:v}=d.getVideoData()||{isLive:!1},B=o?de().map(R=>{let H=R.querySelector("a[data-time]");return H?parseFloat(H.getAttribute("data-time")??"0"):0}):[],z="";if(B.length>0)if(v){let R=Math.max(1,y/60),H=B.filter(Q=>Q<=y);if(H.length>0){let Q=(H.length/R).toFixed(2);parseFloat(Q)>0&&(z=` (${Q}/min)`)}}else{let R=d.getDuration(),H=Number.isFinite(R)&&R>0?R:0,Q=Math.max(1,H/60),he=(B.length/Q).toFixed(1);parseFloat(he)>0&&(z=` (${he}/min)`)}u.textContent=`\u23F3${S?S+":"+String(E).padStart(2,"0"):E}:${String(b).padStart(2,"0")}${z}`}}!Te&&o&&!o.querySelector(".ytls-error-message")&&fr(),Nt()}}function ws(l){return l?Kn.safeParse(l).success:!1}function Wr(l,d){l.textContent=Ut(d),l.dataset.time=String(d),l.href=kr(d,window.location.href)}let Yr=null,Jr=null,Jt=!1;function La(l){if(!l||typeof l.getVideoData!="function"||!l.getVideoData()?.isLive)return!1;if(typeof l.getProgressState=="function"){let f=l.getProgressState(),y=Number(f?.seekableEnd??f?.liveHead??f?.head??f?.duration),S=Number(f?.current??l.getCurrentTime?.());if(Number.isFinite(y)&&Number.isFinite(S))return y-S>2}return!1}function cn(l,d){if(!Number.isFinite(l))return;let f=Kr(l);hr(f,d)}function Kr(l){if(!Number.isFinite(l))return null;let d=de();if(d.length===0)return null;let f=null,y=-1/0;for(let S of d){let b=S.querySelector("a[data-time]")?.dataset.time;if(!b)continue;let v=Number.parseInt(b,10);Number.isFinite(v)&&v<=l&&v>y&&(y=v,f=S)}return f}function hr(l,d=!1){if(!l)return;if(de().forEach(y=>{y.classList.contains(Ce)||y.classList.remove(pe)}),!l.classList.contains(Ce)&&(l.classList.add(pe),d&&!Pr))try{if(o instanceof HTMLElement){let y=l.getBoundingClientRect(),S=o.getBoundingClientRect();!(y.bottom<S.top||y.top>S.bottom)||l.scrollIntoView({behavior:"smooth",block:"center"})}else l.scrollIntoView({behavior:"smooth",block:"center"})}catch{try{l.scrollIntoView({behavior:"smooth",block:"center"})}catch{}}}function Ts(l){if(!o||o.querySelector(".ytls-error-message")||!Number.isFinite(l)||l===0)return!1;let d=de();if(d.length===0)return!1;let f=!1;return d.forEach(y=>{let S=y.querySelector("a[data-time]"),E=S?.dataset.time;if(!S||!E)return;let b=Number.parseInt(E,10);if(!Number.isFinite(b))return;let v=Math.max(0,b+l);v!==b&&(Wr(S,v),f=!0)}),f?(yr(),wt(),Fe(),Qr(Le),ln=null,!0):!1}function Ia(l,d={}){if(!Number.isFinite(l)||l===0)return!1;if(!Ts(l)){if(d.alertOnNoChange){let b=d.failureMessage??"Offset did not change any timestamps.";alert(b)}return!1}let y=d.logLabel??"bulk offset";c(`Timestamps changed: Offset all timestamps by ${l>0?"+":""}${l} seconds (${y})`);let S=oe(),E=S?Math.floor(S.getCurrentTime()):0;if(Number.isFinite(E)){let b=Kr(E);hr(b,!1)}return!0}function Ca(l){if(!o||Te)return;let d=l.target instanceof HTMLElement?l.target:null;if(d)if(d.dataset.time){l.preventDefault();let f=Number(d.dataset.time);if(Number.isFinite(f)){Jt=!0;let S=oe();S&&S.seekTo(f),setTimeout(()=>{Jt=!1},500)}let y=d.closest("li");y&&(de().forEach(S=>{S.classList.contains(Ce)||S.classList.remove(pe)}),y.classList.contains(Ce)||(y.classList.add(pe),y.scrollIntoView({behavior:"smooth",block:"center"})))}else if(d.dataset.increment){l.preventDefault();let y=d.parentElement?.querySelector("a[data-time]");if(!y||!y.dataset.time)return;let S=parseInt(y.dataset.time,10),E=parseInt(d.dataset.increment,10);if("shiftKey"in l&&l.shiftKey&&(E*=sr),"altKey"in l?l.altKey:!1){Ia(E,{logLabel:"Alt adjust"});return}let B=Math.max(0,S+E);c(`Timestamps changed: Timestamp time incremented from ${S} to ${B}`),Wr(y,B),qr();let z=d.closest("li");if(Jr=B,Yr&&clearTimeout(Yr),Jt=!0,Yr=setTimeout(()=>{if(Jr!==null){let R=oe();R&&R.seekTo(Jr)}Yr=null,Jr=null,setTimeout(()=>{Jt=!1},500)},500),yr(),wt(),Fe(),z){let R=z.querySelector("input"),H=z.dataset.guid;R&&H&&(On(Le,H,B,R.value),ln=H)}}else d.dataset.action==="clear"&&(l.preventDefault(),c("Timestamps changed: All timestamps cleared from UI"),o.textContent="",qr(),Fe(),Xr(),Qr(Le,{allowEmpty:!0}),ln=null,fr())}function gr(l,d="",f=!1,y=null,S=!0){if(!o)return null;let E=Math.max(0,l),b=y??crypto.randomUUID(),v=document.createElement("li"),B=document.createElement("div"),z=document.createElement("span"),R=document.createElement("span"),H=document.createElement("span"),Q=document.createElement("a"),he=document.createElement("span"),Z=document.createElement("input"),se=document.createElement("button");v.dataset.guid=b,B.className="time-row";let Tt=document.createElement("div");Tt.style.cssText="position:absolute;left:0;top:0;width:20px;height:100%;display:flex;align-items:center;justify-content:center;cursor:pointer;",ht(Tt,"Click to toggle indent");let kt=document.createElement("span");kt.style.cssText="color:#999;font-size:12px;pointer-events:none;display:none;";let je=()=>{kt.textContent=Zr(Z.value)?"\u25C0":"\u25B6"},ti=me=>{me.stopPropagation();let ee=Zr(Z.value),ge=Ea(Z.value),xe="";if(!ee){let ut=de().indexOf(v);xe=_a(ut)}Z.value=xe?`${xe}${ge}`:ge,je(),wt();let fe=Number.parseInt(Q.dataset.time??"0",10);On(Le,b,fe,Z.value)};Tt.onclick=ti,Tt.append(kt),v.style.cssText="position:relative;padding-left:20px;",v.addEventListener("mouseenter",()=>{je(),kt.style.display="inline"}),v.addEventListener("mouseleave",()=>{kt.style.display="none"}),v.addEventListener("mouseleave",()=>{v.dataset.guid===ln&&vs(v)&&Ma()}),Z.value=d||"",Z.style.cssText="width:100%;margin-top:5px;display:block;",Z.type="text",Z.setAttribute("inputmode","text"),Z.autocapitalize="off",Z.autocomplete="off",Z.spellcheck=!1,Z.addEventListener("focusin",()=>{mr=!1}),Z.addEventListener("focusout",me=>{let ee=me.relatedTarget,ge=Date.now()-Ta<250,xe=!!ee&&!!i&&i.contains(ee);!ge&&!xe&&(mr=!0,setTimeout(()=>{(document.activeElement===document.body||document.activeElement==null)&&(Z.focus({preventScroll:!0}),mr=!1)},0))}),Z.addEventListener("input",me=>{let ee=me;if(ee&&(ee.isComposing||ee.inputType==="insertCompositionText"))return;let ge=on.get(b);ge&&clearTimeout(ge);let xe=setTimeout(()=>{let fe=Number.parseInt(Q.dataset.time??"0",10);On(Le,b,fe,Z.value),on.delete(b)},500);on.set(b,xe)}),Z.addEventListener("compositionend",()=>{let me=Number.parseInt(Q.dataset.time??"0",10);setTimeout(()=>{On(Le,b,me,Z.value)},50)}),z.textContent="\u2796",z.dataset.increment="-1",z.style.cursor="pointer",z.style.margin="0px",z.addEventListener("mouseenter",()=>{z.style.textShadow="0 0 8px rgba(255, 255, 255, 0.8), 0 0 12px rgba(100, 200, 255, 0.6)"}),z.addEventListener("mouseleave",()=>{z.style.textShadow="none"}),H.textContent="\u2795",H.dataset.increment="1",H.style.cursor="pointer",H.style.margin="0px",H.addEventListener("mouseenter",()=>{H.style.textShadow="0 0 8px rgba(255, 255, 255, 0.8), 0 0 12px rgba(100, 200, 255, 0.6)"}),H.addEventListener("mouseleave",()=>{H.style.textShadow="none"}),R.textContent="\u23FA\uFE0F",R.style.cursor="pointer",R.style.margin="0px",ht(R,"Set to current playback time"),R.addEventListener("mouseenter",()=>{R.style.textShadow="0 0 8px rgba(255, 255, 255, 0.8), 0 0 12px rgba(100, 200, 255, 0.6)"}),R.addEventListener("mouseleave",()=>{R.style.textShadow="none"}),R.onclick=()=>{let me=oe(),ee=me?Math.floor(me.getCurrentTime()):0;Number.isFinite(ee)&&(c(`Timestamps changedset to current playback time ${ee}`),Wr(Q,ee),yr(),wt(),On(Le,b,ee,Z.value),ln=b)},Wr(Q,E),qr(),se.textContent="\u{1F5D1}\uFE0F",se.style.cssText="background:transparent;border:none;color:white;cursor:pointer;margin-left:5px;",se.addEventListener("mouseenter",()=>{se.style.textShadow="0 0 8px rgba(255, 255, 255, 0.8), 0 0 12px rgba(255, 100, 100, 0.6)"}),se.addEventListener("mouseleave",()=>{se.style.textShadow="none"}),se.onclick=()=>{let me=null,ee=null,ge=null,xe=()=>{try{v.removeEventListener("click",ee,!0)}catch{}try{document.removeEventListener("click",ee,!0)}catch{}if(o)try{o.removeEventListener("mouseleave",ge)}catch{}me&&(clearTimeout(me),me=null)};if(v.dataset.deleteConfirmed==="true"){c("Timestamps changed: Timestamp deleted");let fe=v.dataset.guid??"",Re=on.get(fe);Re&&(clearTimeout(Re),on.delete(fe)),xe(),v.remove(),qr(),yr(),wt(),Fe(),Xr(),ks(Le,fe),ln=null,fr()}else{v.dataset.deleteConfirmed="true",v.classList.add(Ce),v.classList.remove(pe);let fe=()=>{v.dataset.deleteConfirmed="false",v.classList.remove(Ce);let Re=oe(),ut=Re?Re.getCurrentTime():0,dt=Number.parseInt(v.querySelector("a[data-time]")?.dataset.time??"0",10);Number.isFinite(ut)&&Number.isFinite(dt)&&ut>=dt&&v.classList.add(pe),xe()};ee=Re=>{Re.target!==se&&fe()},ge=()=>{v.dataset.deleteConfirmed==="true"&&fe()},v.addEventListener("click",ee,!0),document.addEventListener("click",ee,!0),o&&o.addEventListener("mouseleave",ge),me=setTimeout(()=>{v.dataset.deleteConfirmed==="true"&&fe(),xe()},5e3)}},he.className="time-diff",he.style.color="#888",he.style.marginLeft="5px",B.append(z,R,H,Q,he,se),v.append(Tt,B,Z);let It=Number.parseInt(Q.dataset.time??"0",10);if(S){Di();let me=!1,ee=de();for(let ge=0;ge<ee.length;ge++){let xe=ee[ge],Re=xe.querySelector("a[data-time]")?.dataset.time;if(!Re)continue;let ut=Number.parseInt(Re,10);if(Number.isFinite(ut)&&It<ut){o.insertBefore(v,xe),me=!0;let dt=ee[ge-1];if(dt){let un=dt.querySelector("a[data-time]")?.dataset.time;if(un){let Nn=Number.parseInt(un,10);Number.isFinite(Nn)&&(he.textContent=Ut(It-Nn))}}else he.textContent="";let vr=xe.querySelector(".time-diff");vr&&(vr.textContent=Ut(ut-It));break}}if(!me&&(o.appendChild(v),ee.length>0)){let fe=ee[ee.length-1].querySelector("a[data-time]")?.dataset.time;if(fe){let Re=Number.parseInt(fe,10);Number.isFinite(Re)&&(he.textContent=Ut(It-Re))}}v.scrollIntoView({behavior:"smooth",block:"center"}),Xr(),wt(),Fe(),f||(On(Le,b,E,d),ln=b,hr(v,!1))}else Z.__ytls_li=v;return Z}function yr(){if(!o||o.querySelector(".ytls-error-message"))return;let l=de();l.forEach((d,f)=>{let y=d.querySelector(".time-diff");if(!y)return;let E=d.querySelector("a[data-time]")?.dataset.time;if(!E){y.textContent="";return}let b=Number.parseInt(E,10);if(!Number.isFinite(b)){y.textContent="";return}if(f===0){y.textContent="";return}let z=l[f-1].querySelector("a[data-time]")?.dataset.time;if(!z){y.textContent="";return}let R=Number.parseInt(z,10);if(!Number.isFinite(R)){y.textContent="";return}let H=b-R,Q=H<0?"-":"";y.textContent=` ${Q}${Ut(Math.abs(H))}`})}function Ma(){if(!o||o.querySelector(".ytls-error-message")||Te)return;let l=null;if(document.activeElement instanceof HTMLInputElement&&o.contains(document.activeElement)){let b=document.activeElement,B=b.closest("li")?.dataset.guid;if(B){let z=b.selectionStart??b.value.length,R=b.selectionEnd??z,H=b.scrollLeft;l={guid:B,start:z,end:R,scroll:H}}}let d=de();if(d.length===0)return;let f=d.map(b=>b.dataset.guid),y=d.map(b=>{let v=b.querySelector("a[data-time]"),B=v?.dataset.time;if(!v||!B)return null;let z=Number.parseInt(B,10);if(!Number.isFinite(z))return null;let R=b.dataset.guid??"";return{time:z,guid:R,element:b}}).filter(b=>b!==null).sort((b,v)=>{let B=b.time-v.time;return B!==0?B:b.guid.localeCompare(v.guid)}),S=y.map(b=>b.guid),E=f.length!==S.length||f.some((b,v)=>b!==S[v]);for(;o.firstChild;)o.removeChild(o.firstChild);if(y.forEach(b=>{o.appendChild(b.element)}),yr(),wt(),Fe(),l){let v=de().find(B=>B.dataset.guid===l.guid)?.querySelector("input");if(v)try{v.focus({preventScroll:!0})}catch{}}E&&(c("Timestamps changed: Timestamps sorted"),Qr(Le))}function Xr(){if(!o||!i||!s||!m)return;let l=de().length;typeof window.recalculateTimestampsArea=="function"&&window.recalculateTimestampsArea();let d=i.getBoundingClientRect(),f=s.getBoundingClientRect(),y=m.getBoundingClientRect(),S=Math.max(0,d.height-(f.height+y.height));l===0?(fr(),o.style.overflowY="hidden"):o.style.overflowY=o.scrollHeight>S?"auto":"hidden"}function Fe(){if(!o)return;let l=ct(),d=document.querySelector(".ytp-progress-bar"),f=oe(),y=f?f.getVideoData():null,S=!!y&&!!y.isLive;if(!l||!d||!isFinite(l.duration)||S)return;Ba(),de().map(b=>{let v=b.querySelector("a[data-time]"),B=v?.dataset.time;if(!v||!B)return null;let z=Number.parseInt(B,10);if(!Number.isFinite(z))return null;let H=b.querySelector("input")?.value??"",Q=b.dataset.guid??crypto.randomUUID();return b.dataset.guid||(b.dataset.guid=Q),{start:z,comment:H,guid:Q}}).filter(ws).forEach(b=>{if(!Number.isFinite(b.start))return;let v=document.createElement("div");v.className="ytls-marker",v.style.position="absolute",v.style.height="100%",v.style.width="2px",v.style.backgroundColor="#ff0000",v.style.cursor="pointer",v.style.left=b.start/l.duration*100+"%",v.dataset.time=String(b.start),v.addEventListener("click",()=>{let B=oe();B&&B.seekTo(b.start)}),d.appendChild(v)})}function Qr(l,d={}){if(!o||o.querySelector(".ytls-error-message")||!l)return;if(Te){c("Save blocked: timestamps are currently loading");return}wt();let f=Mi().sort((y,S)=>y.start-S.start);if(f.length===0&&!d.allowEmpty){c("Save skipped: no timestamps to save");return}q(f),Oa(l,f).then(()=>c(`Successfully saved ${f.length} timestamps for ${l} to IndexedDB`)).catch(y=>c(`Failed to save timestamps for ${l} to IndexedDB:`,y,"error")),or({type:"timestamps_updated",videoId:l,action:"saved"})}function On(l,d,f,y){if(!l||Te)return;let S={guid:d,start:f,comment:y};c(`Saving timestamp: guid=${d}, start=${f}, comment="${y}"`),Is(l,S).catch(E=>c(`Failed to save timestamp ${d}:`,E,"error")),or({type:"timestamps_updated",videoId:l,action:"saved"})}function ks(l,d){!l||Te||(c(`Deleting timestamp: guid=${d}`),Cs(l,d).catch(f=>c(`Failed to delete timestamp ${d}:`,f,"error")),or({type:"timestamps_updated",videoId:l,action:"saved"}))}async function Da(l){if(!o||o.querySelector(".ytls-error-message")){alert("Cannot export timestamps while displaying an error message.");return}let d=Le;if(!d)return;c(`Exporting timestamps for video ID: ${d}`);let f=Mi(),y=Math.max(Pt(),0),S=Yn();if(l==="json"){let E=new Blob([JSON.stringify(f,null,2)],{type:"application/json"}),b=URL.createObjectURL(E),v=document.createElement("a");v.href=b,v.download=`timestamps-${d}-${S}.json`,v.click(),URL.revokeObjectURL(b)}else if(l==="text"){let E=f.map(z=>{let R=Ut(z.start,y),H=`${z.comment} <!-- guid:${z.guid} -->`.trimStart();return`${R} ${H}`}).join(`
`),b=new Blob([E],{type:"text/plain"}),v=URL.createObjectURL(b),B=document.createElement("a");B.href=v,B.download=`timestamps-${d}-${S}.txt`,B.click(),URL.revokeObjectURL(v)}}function Ri(l){if(!i||!o){c("Timekeeper error:",l,"error");return}Rn();let d=document.createElement("li");d.textContent=l,d.classList.add("ytls-error-message"),d.style.color="#ff6b6b",d.style.fontWeight="bold",d.style.padding="8px",d.style.background="rgba(255, 0, 0, 0.1)",o.appendChild(d),Fe()}function Ba(){document.querySelectorAll(".ytls-marker").forEach(l=>l.remove())}function Pn(){if(!i||!document.body.contains(i))return;let l=i.getBoundingClientRect(),d=document.documentElement.clientWidth,f=document.documentElement.clientHeight,y=l.width,S=l.height;if(l.left<0&&(i.style.left="0",i.style.right="auto"),l.right>d){let E=Math.max(0,d-y);i.style.left=`${E}px`,i.style.right="auto"}if(l.top<0&&(i.style.top="0",i.style.bottom="auto"),l.bottom>f){let E=Math.max(0,f-S);i.style.top=`${E}px`,i.style.bottom="auto"}}function Ss(){if(zr&&(document.removeEventListener("mousemove",zr),zr=null),Hr&&(document.removeEventListener("mouseup",Hr),Hr=null),cr&&(document.removeEventListener("keydown",cr),cr=null),Fr&&(window.removeEventListener("resize",Fr),Fr=null),ur&&(document.removeEventListener("pointerdown",ur,!0),ur=null),dr&&(document.removeEventListener("pointerup",dr,!0),dr=null),xt){try{xt.disconnect()}catch{}xt=null}if(bt){try{bt.disconnect()}catch{}bt=null}let l=ct();l&&(jr&&(l.removeEventListener("timeupdate",jr),jr=null),Ur&&(l.removeEventListener("pause",Ur),Ur=null),Gr&&(l.removeEventListener("play",Gr),Gr=null),Vr&&(l.removeEventListener("seeking",Vr),Vr=null))}function Es(){Ba(),on.forEach(d=>clearTimeout(d)),on.clear(),lr&&(clearTimeout(lr),lr=null),lt&&(clearInterval(lt),lt=null),vt&&(clearTimeout(vt),vt=null),Ss();try{Lt.close()}catch{}if(F&&F.parentNode===document.body&&document.body.removeChild(F),F=null,Nr=null,Pr=!1,Le=null,xt){try{xt.disconnect()}catch{}xt=null}if(bt){try{bt.disconnect()}catch{}bt=null}i&&i.parentNode&&i.remove();let l=document.getElementById("ytls-header-button");l&&l.parentNode&&l.remove(),Yt=null,$r=!1,ae(null),Rn(),i=null,s=null,o=null,m=null,u=null,p=null,k=null,an=null}async function _s(){let l=Oi();if(!l)return an=null,{ok:!1,message:"Timekeeper cannot determine the current video ID. Please refresh the page or open a standard YouTube watch URL."};let d=await hs();if(!Ai(d)){let f=fs(d),y=f.length?` Missing methods: ${f.join(", ")}.`:"",S=d?"Timekeeper cannot access the YouTube player API.":"Timekeeper cannot find the YouTube player on this page.";return an=null,{ok:!1,message:`${S}${y} Try refreshing once playback is ready.`}}return an=d,{ok:!0,player:d,videoId:l}}async function Ra(){if(!i||!o)return;let l=o.scrollTop,d=!0,f=()=>{if(!o||!d)return;let y=Math.max(0,o.scrollHeight-o.clientHeight);o.scrollTop=Math.min(l,y)};try{let y=await _s();if(!y.ok){Ri(y.message),Rn(),Fe();return}let{videoId:S}=y,E=[];try{let b=await Ms(S);b?(E=b.map(v=>({...v,guid:v.guid||crypto.randomUUID()})),c(`Loaded ${E.length} timestamps from IndexedDB for ${S}`)):c(`No timestamps found in IndexedDB for ${S}`)}catch(b){c(`Failed to load timestamps from IndexedDB for ${S}:`,b,"error"),Ri("Failed to load timestamps from IndexedDB. Try refreshing the page."),Fe();return}if(E.length>0){E.sort((R,H)=>R.start-H.start),Rn(),Di();let b=document.createDocumentFragment();E.forEach(R=>{let Q=gr(R.start,R.comment,!0,R.guid,!1).__ytls_li;Q&&b.appendChild(Q)}),i&&i.classList.contains("ytls-zoom-in")&&_e!=null?(c("Deferring timestamp DOM append until show animation completes"),sn=b,Ot||(Ot=new Promise(R=>{rt=R})),await Ot):o&&(o.appendChild(b),wt(),Fe(),typeof window.recalculateTimestampsArea=="function"&&requestAnimationFrame(()=>window.recalculateTimestampsArea())),q(E);let B=oe(),z=B?Math.floor(B.getCurrentTime()):Pt();Number.isFinite(z)&&(cn(z,!1),d=!1)}else Rn(),Aa("No timestamps for this video"),Fe(),q([]),typeof window.recalculateTimestampsArea=="function"&&requestAnimationFrame(()=>window.recalculateTimestampsArea())}catch(y){c("Unexpected error while loading timestamps:",y,"error"),Ri("Timekeeper encountered an unexpected error while loading timestamps. Check the console for details.")}finally{Ot&&await Ot,requestAnimationFrame(f),typeof window.recalculateTimestampsArea=="function"&&requestAnimationFrame(()=>window.recalculateTimestampsArea()),o&&!o.querySelector(".ytls-error-message")&&fr()}}function Oi(){let d=new URLSearchParams(location.search).get("v");if(d)return d;let f=document.querySelector('meta[itemprop="identifier"]');return f?.content?f.content:null}function As(l=null,d=null){if(!u)return;let f=ct(),y=d||oe();if(!f&&!y)return;let S=l!==null?l:y?y.getCurrentTime():0,E=Number.isFinite(S)?Math.max(0,Math.floor(S)):Math.max(0,Pt()),b=Math.floor(E/3600),v=Math.floor(E/60)%60,B=E%60,{isLive:z}=y?y.getVideoData()||{isLive:!1}:{isLive:!1},R=y?La(y):!1,H=o?de().map(he=>{let Z=he.querySelector("a[data-time]");return Z?parseFloat(Z.getAttribute("data-time")??"0"):0}):[],Q="";if(H.length>0)if(z){let he=Math.max(1,E/60),Z=H.filter(se=>se<=E);if(Z.length>0){let se=(Z.length/he).toFixed(2);parseFloat(se)>0&&(Q=` (${se}/min)`)}}else{let he=y?y.getDuration():0,Z=Number.isFinite(he)&&he>0?he:f&&Number.isFinite(f.duration)&&f.duration>0?f.duration:0,se=Math.max(1,Z/60),Tt=(H.length/se).toFixed(1);parseFloat(Tt)>0&&(Q=` (${Tt}/min)`)}u.textContent=`\u23F3${b?b+":"+String(v).padStart(2,"0"):v}:${String(B).padStart(2,"0")}${Q}`,u.style.color=R?"#ff4d4f":""}function Ls(){let l=ct();if(!l)return;let d=()=>{if(!o)return;let b=oe(),v=b?Math.floor(b.getCurrentTime()):0;if(!Number.isFinite(v))return;u&&!Te&&!Jt&&As(v,b);let B=Kr(v);hr(B,!1)},f=b=>{try{let v=new URL(window.location.href);b!==null&&Number.isFinite(b)?v.searchParams.set("t",`${Math.floor(b)}s`):v.searchParams.delete("t"),window.history.replaceState({},"",v.toString())}catch{}},y=()=>{let b=oe(),v=b?Math.floor(b.getCurrentTime()):NaN;if(Number.isFinite(v)){f(v);try{cn(v,!0)}catch(B){c("Failed to highlight nearest timestamp on pause:",B,"warn")}}},S=()=>{f(null);try{let b=oe(),v=b?Math.floor(b.getCurrentTime()):NaN;Number.isFinite(v)&&cn(v,!0)}catch(b){c("Failed to highlight nearest timestamp on play:",b,"warn")}},E=()=>{let b=ct();if(!b)return;let v=oe(),B=v?Math.floor(v.getCurrentTime()):0;if(!Number.isFinite(B))return;b.paused&&f(B);let z=Kr(B);hr(z,!0)};jr=d,Ur=y,Gr=S,Vr=E,l.addEventListener("timeupdate",d),l.addEventListener("pause",y),l.addEventListener("play",S),l.addEventListener("seeking",E)}let{saveToIndexedDB:Oa,saveSingleTimestampToIndexedDB:Is,deleteSingleTimestampFromIndexedDB:Cs,loadFromIndexedDB:Ms,removeFromIndexedDB:Ds,saveGlobalSettings:ei,loadGlobalSettings:Pi,buildExportPayload:Bs,exportAllTimestamps:Rs,buildExportCsvPayload:Wc,exportAllTimestampsCsv:Os,getAllFromIndexedDB:Yc,SETTINGS_STORE_NAME:Jc,STORE_NAME_V2:Kc}=Xi;function Pa(){if(!i)return;let l=i.style.display!=="none";ei("uiVisible",l)}function Nt(l){let d=typeof l=="boolean"?l:!!i&&i.style.display!=="none",f=document.getElementById("ytls-header-button");f instanceof HTMLButtonElement&&f.setAttribute("aria-pressed",String(d)),Yt&&!$r&&Yt.src!==yt&&(Yt.src=yt)}function Ps(){i&&Pi("uiVisible").then(l=>{let d=M.boolean().safeParse(l),f=d.success?d.data:void 0;typeof f=="boolean"?(f?(i.style.display="flex",i.classList.remove("ytls-zoom-out"),i.classList.add("ytls-zoom-in")):i.style.display="none",Nt(f)):(!d.success&&l!==void 0&&c("UI visibility state failed validation, defaulting to visible",d.error.format(),"warn"),i.style.display="flex",i.classList.remove("ytls-zoom-out"),i.classList.add("ytls-zoom-in"),Nt(!0))}).catch(l=>{c("Failed to load UI visibility state:",l,"error"),i.style.display="flex",i.classList.remove("ytls-zoom-out"),i.classList.add("ytls-zoom-in"),Nt(!0)})}function Ni(l){if(!i){c("ERROR: togglePaneVisibility called but pane is null");return}document.body.contains(i)||(c("Pane not in DOM during toggle, appending it"),document.querySelectorAll("#ytls-pane").forEach(S=>{S!==i&&S.remove()}),document.body.appendChild(i));let d=document.querySelectorAll("#ytls-pane");d.length>1&&(c(`ERROR: Multiple panes detected in togglePaneVisibility (${d.length}), cleaning up`),d.forEach(S=>{S!==i&&S.remove()})),vt&&(clearTimeout(vt),vt=null);let f=i.style.display==="none";(typeof l=="boolean"?l:f)?(i.style.display="flex",i.classList.remove("ytls-fade-out"),i.classList.remove("ytls-zoom-out"),i.classList.add("ytls-zoom-in"),Nt(!0),Pa(),gt(),_e&&(clearTimeout(_e),_e=null),_e=setTimeout(()=>{He(),typeof window.recalculateTimestampsArea=="function"&&window.recalculateTimestampsArea(),ze(),Ie(!0);try{let S=oe(),E=S?Math.floor(S.getCurrentTime()):NaN;Number.isFinite(E)&&cn(E,!0)}catch(S){c("Failed to scroll to nearest timestamp after toggle:",S,"warn")}_e=null},450)):(i.classList.remove("ytls-fade-in"),i.classList.remove("ytls-zoom-in"),i.classList.add("ytls-zoom-out"),Nt(!1),nr())}function Na(l){if(!o){c("UI is not initialized; cannot import timestamps.","warn");return}let d=!1;try{let f=JSON.parse(l),y=null;if(Array.isArray(f))y=f;else if(typeof f=="object"&&f!==null){let S=Le;if(S){let E=`timekeeper-${S}`;f[E]&&Array.isArray(f[E].timestamps)&&(y=f[E].timestamps,c(`Found timestamps for current video (${S}) in export format`,"info"))}if(!y){let E=Object.keys(f).filter(b=>b.startsWith("ytls-"));if(E.length===1&&Array.isArray(f[E[0]].timestamps)){y=f[E[0]].timestamps;let b=f[E[0]].video_id;c(`Found timestamps for video ${b} in export format`,"info")}}}y&&Array.isArray(y)?y.every(E=>typeof E.start=="number"&&typeof E.comment=="string")?(y.forEach(E=>{if(E.guid){let b=de().find(v=>v.dataset.guid===E.guid);if(b){let v=b.querySelector("input");v&&(v.value=E.comment)}else gr(E.start,E.comment,!1,E.guid)}else gr(E.start,E.comment,!1,crypto.randomUUID())}),d=!0):c("Parsed JSON array, but items are not in the expected timestamp format. Trying as plain text.","warn"):c("Parsed JSON, but couldn't find valid timestamps. Trying as plain text.","warn")}catch{}if(!d){let f=l.split(`
`).map(y=>y.trim()).filter(y=>y);if(f.length>0){let y=!1;f.forEach(S=>{let E=S.match(/^(?:(\d{1,2}):)?(\d{1,2}):(\d{2})\s*(.*)$/);if(E){y=!0;let b=parseInt(E[1])||0,v=parseInt(E[2]),B=parseInt(E[3]),z=b*3600+v*60+B,R=E[4]?E[4].trim():"",H=null,Q=R,he=R.match(/<!--\s*guid:([^>]+?)\s*-->/);he&&(H=he[1].trim(),Q=R.replace(/<!--\s*guid:[^>]+?\s*-->/,"").trim());let Z;if(H&&(Z=de().find(se=>se.dataset.guid===H)),!Z&&!H&&(Z=de().find(se=>{if(se.dataset.guid)return!1;let kt=se.querySelector("a[data-time]")?.dataset.time;if(!kt)return!1;let je=Number.parseInt(kt,10);return Number.isFinite(je)&&je===z})),Z){let se=Z.querySelector("input");se&&(se.value=Q)}else gr(z,Q,!1,H||crypto.randomUUID())}}),y&&(d=!0)}}d?(c("Timestamps changed: Imported timestamps from file/clipboard"),wt(),Qr(Le),Fe(),Xr()):alert("Failed to parse content. Please ensure it is in the correct JSON or plain text format.")}async function Ns(){if(Ci){c("Pane initialization already in progress, skipping duplicate call");return}if(!(i&&document.body.contains(i))){Ci=!0;try{let E=function(h=null,g=null){if(!u)return;let x=ct(),w=g||oe();if(!x&&!w)return;let D=h!==null?h:w?w.getCurrentTime():0,P=Number.isFinite(D)?Math.max(0,Math.floor(D)):Math.max(0,Pt()),$=Math.floor(P/3600),W=Math.floor(P/60)%60,j=P%60,{isLive:le}=w?w.getVideoData()||{isLive:!1}:{isLive:!1},it=w?La(w):!1,ce=o?de().map(Oe=>{let Ze=Oe.querySelector("a[data-time]");return Ze?parseFloat(Ze.getAttribute("data-time")??"0"):0}):[],qe="";if(ce.length>0)if(le){let Oe=Math.max(1,P/60),Ze=ce.filter(We=>We<=P);if(Ze.length>0){let We=(Ze.length/Oe).toFixed(2);parseFloat(We)>0&&(qe=` (${We}/min)`)}}else{let Oe=w?w.getDuration():0,Ze=Number.isFinite(Oe)&&Oe>0?Oe:x&&Number.isFinite(x.duration)&&x.duration>0?x.duration:0,We=Math.max(1,Ze/60),Pe=(ce.length/We).toFixed(1);parseFloat(Pe)>0&&(qe=` (${Pe}/min)`)}u.textContent=`\u23F3${$?$+":"+String(W).padStart(2,"0"):W}:${String(j).padStart(2,"0")}${qe}`,u.style.color=it?"#ff4d4f":"",S()},b=function(){if(Te||Jt)return;let h=oe();if(!h)return;let g=h.getCurrentTime(),x=Number.isFinite(g)?Math.max(0,Math.floor(g)):Math.max(0,Pt());E(x,h),(o?de():[]).length>0&&cn(x,!1)},je=function(h,g,x){let w=document.createElement("button");return w.textContent=h,ht(w,g),w.classList.add("ytls-settings-modal-button"),w.onclick=x,w},ti=function(h="general"){if(F&&F.parentNode===document.body){let Ne=document.getElementById("ytls-save-modal"),Kt=document.getElementById("ytls-load-modal"),$t=document.getElementById("ytls-delete-all-modal");Ne&&document.body.contains(Ne)&&document.body.removeChild(Ne),Kt&&document.body.contains(Kt)&&document.body.removeChild(Kt),$t&&document.body.contains($t)&&document.body.removeChild($t),F.classList.remove("ytls-fade-in"),F.classList.add("ytls-fade-out"),setTimeout(()=>{document.body.contains(F)&&document.body.removeChild(F),F=null,document.removeEventListener("click",me,!0),document.removeEventListener("keydown",It)},300);return}F=document.createElement("div"),F.id="ytls-settings-modal",F.classList.remove("ytls-fade-out"),F.classList.add("ytls-fade-in");let g=document.createElement("div");g.className="ytls-modal-header";let x=document.createElement("div");x.id="ytls-settings-nav";let w=document.createElement("button");w.className="ytls-modal-close-button",w.textContent="\u2715",w.onclick=()=>{if(F&&F.parentNode===document.body){let Ne=document.getElementById("ytls-save-modal"),Kt=document.getElementById("ytls-load-modal"),$t=document.getElementById("ytls-delete-all-modal");Ne&&document.body.contains(Ne)&&document.body.removeChild(Ne),Kt&&document.body.contains(Kt)&&document.body.removeChild(Kt),$t&&document.body.contains($t)&&document.body.removeChild($t),F.classList.remove("ytls-fade-in"),F.classList.add("ytls-fade-out"),setTimeout(()=>{document.body.contains(F)&&document.body.removeChild(F),F=null,document.removeEventListener("click",me,!0),document.removeEventListener("keydown",It)},300)}};let D=document.createElement("div");D.id="ytls-settings-content";let P=document.createElement("h3");P.className="ytls-section-heading",P.textContent="General",P.style.display="none";let $=document.createElement("div"),W=document.createElement("div");W.className="ytls-button-grid";function j(Ne){$.style.display=Ne==="general"?"block":"none",W.style.display=Ne==="drive"?"block":"none",le.classList.toggle("active",Ne==="general"),ce.classList.toggle("active",Ne==="drive"),P.textContent=Ne==="general"?"General":"Google Drive"}let le=document.createElement("button");le.textContent="\u{1F6E0}\uFE0F";let it=document.createElement("span");it.className="ytls-tab-text",it.textContent=" General",le.appendChild(it),ht(le,"General settings"),le.classList.add("ytls-settings-modal-button"),le.onclick=()=>j("general");let ce=document.createElement("button");ce.textContent="\u2601\uFE0F";let qe=document.createElement("span");qe.className="ytls-tab-text",qe.textContent=" Backup",ce.appendChild(qe),ht(ce,"Google Drive sign-in and backup"),ce.classList.add("ytls-settings-modal-button"),ce.onclick=async()=>{Ge.isSignedIn&&await ls(),j("drive")},x.appendChild(le),x.appendChild(ce),g.appendChild(x),g.appendChild(w),F.appendChild(g),$.className="ytls-button-grid",$.appendChild(je("\u{1F4BE} Save","Save As...",ee.onclick)),$.appendChild(je("\u{1F4C2} Load","Load",ge.onclick)),$.appendChild(je("\u{1F4E4} Export All","Export All Data",xe.onclick)),$.appendChild(je("\u{1F4E5} Import All","Import All Data",fe.onclick)),$.appendChild(je("\u{1F4C4} Export All (CSV)","Export All Timestamps to CSV",async()=>{try{await Os()}catch{alert("Failed to export CSV: Could not read from database.")}}));let Oe=je(Ge.isSignedIn?"\u{1F513} Sign Out":"\u{1F510} Sign In",Ge.isSignedIn?"Sign out from Google Drive":"Sign in to Google Drive",async()=>{Ge.isSignedIn?await ss():await as(),Oe.textContent=Ge.isSignedIn?"\u{1F513} Sign Out":"\u{1F510} Sign In",ht(Oe,Ge.isSignedIn?"Sign out from Google Drive":"Sign in to Google Drive"),typeof ye=="function"&&ye()});W.appendChild(Oe);let Ze=je(Wt()?"\u{1F501} Auto Backup: On":"\u{1F501} Auto Backup: Off","Toggle Auto Backup",async()=>{await ms(),Ze.textContent=Wt()?"\u{1F501} Auto Backup: On":"\u{1F501} Auto Backup: Off",typeof ye=="function"&&ye()});W.appendChild(Ze);let We=je(`\u23F1\uFE0F Backup Interval: ${_t()}min`,"Set periodic backup interval (minutes)",async()=>{await ps(),We.textContent=`\u23F1\uFE0F Backup Interval: ${_t()}min`,typeof ye=="function"&&ye()});W.appendChild(We),W.appendChild(je("\u{1F5C4}\uFE0F Backup Now","Run a backup immediately",async()=>{await Dr(!1),typeof ye=="function"&&ye()}));let Pe=document.createElement("div");Pe.style.marginTop="15px",Pe.style.paddingTop="10px",Pe.style.borderTop="1px solid #555",Pe.style.fontSize="12px",Pe.style.color="#aaa";let mn=document.createElement("div");mn.style.marginBottom="8px",mn.style.fontWeight="bold",Pe.appendChild(mn),ns(mn);let Ui=document.createElement("div");Ui.style.marginBottom="8px",es(Ui),Pe.appendChild(Ui);let ja=document.createElement("div");ts(ja),Pe.appendChild(ja),W.appendChild(Pe),et(),Br(),ye(),D.appendChild(P),D.appendChild($),D.appendChild(W),j(h),F.appendChild(D),document.body.appendChild(F),requestAnimationFrame(()=>{let Ne=F.getBoundingClientRect(),$t=(window.innerHeight-Ne.height)/2;F.style.top=`${Math.max(20,$t)}px`,F.style.transform="translateX(-50%)"}),setTimeout(()=>{document.addEventListener("click",me,!0),document.addEventListener("keydown",It)},0)},It=function(h){if(h.key==="Escape"&&F&&F.parentNode===document.body){let g=document.getElementById("ytls-save-modal"),x=document.getElementById("ytls-load-modal"),w=document.getElementById("ytls-delete-all-modal");if(g||x||w)return;h.preventDefault(),g&&document.body.contains(g)&&document.body.removeChild(g),x&&document.body.contains(x)&&document.body.removeChild(x),w&&document.body.contains(w)&&document.body.removeChild(w),F.classList.remove("ytls-fade-in"),F.classList.add("ytls-fade-out"),setTimeout(()=>{document.body.contains(F)&&document.body.removeChild(F),F=null,document.removeEventListener("click",me,!0),document.removeEventListener("keydown",It)},300)}},me=function(h){if(Nr&&Nr.contains(h.target))return;let g=document.getElementById("ytls-save-modal"),x=document.getElementById("ytls-load-modal"),w=document.getElementById("ytls-delete-all-modal");g&&g.contains(h.target)||x&&x.contains(h.target)||w&&w.contains(h.target)||F&&F.contains(h.target)||(g&&document.body.contains(g)&&document.body.removeChild(g),x&&document.body.contains(x)&&document.body.removeChild(x),w&&document.body.contains(w)&&document.body.removeChild(w),F&&F.parentNode===document.body&&(F.classList.remove("ytls-fade-in"),F.classList.add("ytls-fade-out"),setTimeout(()=>{document.body.contains(F)&&document.body.removeChild(F),F=null,document.removeEventListener("click",me,!0),document.removeEventListener("keydown",It)},300)))},Re=function(){i&&(c("Loading window position from IndexedDB"),Pi("windowPosition").then(h=>{let g=ao.safeParse(h);if(g.success){let w=g.data;i.style.left=`${w.x}px`,i.style.top=`${w.y}px`,i.style.right="auto",i.style.bottom="auto",typeof w.width=="number"&&w.width>0?i.style.width=`${w.width}px`:(i.style.width=`${Li}px`,c(`No stored window width found, using default width ${Li}px`)),typeof w.height=="number"&&w.height>0?i.style.height=`${w.height}px`:(i.style.height=`${Ii}px`,c(`No stored window height found, using default height ${Ii}px`));let D=Se();At(D,w.x,w.y),c("Restored window position from IndexedDB:",ke())}else g.success?c("No window position found in IndexedDB, applying default size and leaving default position"):c("Window position in IndexedDB failed validation:",g.error.format(),"warn"),i.style.width=`${Li}px`,i.style.height=`${Ii}px`,ae(null);Pn();let x=Se();x&&(x.width||x.height)&&At(x),typeof window.recalculateTimestampsArea=="function"&&window.recalculateTimestampsArea()}).catch(h=>{c("failed to load pane position from IndexedDB:",h,"warn"),Pn();let g=Se();g&&(g.width||g.height)&&ae({x:Math.max(0,Math.round(g.left)),y:0,width:Math.round(g.width),height:Math.round(g.height)}),typeof window.recalculateTimestampsArea=="function"&&window.recalculateTimestampsArea()}))},ut=function(){if(!i)return;let h=Se();if(!h)return;let g={x:Math.max(0,Math.round(h.left)),y:Math.max(0,Math.round(h.top)),width:Math.round(h.width),height:Math.round(h.height)},x=ke();if(x&&x.x===g.x&&x.y===g.y&&x.width===g.width&&x.height===g.height){c("Skipping window position save; position and size unchanged");return}ae({...g}),c(`Saving window position and size to IndexedDB: x=${g.x}, y=${g.y}, width=${g.width}, height=${g.height}`),ei("windowPosition",g),or({type:"window_position_updated",position:g,timestamp:Date.now()})},ii=function(h,g){h.addEventListener("dblclick",x=>{x.preventDefault(),x.stopPropagation(),i&&(i.style.width="300px",i.style.height="300px",ut(),xr())}),h.addEventListener("mousedown",x=>{x.preventDefault(),x.stopPropagation(),$n=!0,dn=g,Ha=x.clientX,Fa=x.clientY;let w=i.getBoundingClientRect();zn=w.width,Hn=w.height,ni=w.left,ri=w.top,g==="top-left"||g==="bottom-right"?document.body.style.cursor="nwse-resize":document.body.style.cursor="nesw-resize"})},xr=function(){if(i&&s&&m&&o){let h=i.getBoundingClientRect(),g=s.getBoundingClientRect(),x=m.getBoundingClientRect(),w=h.height-(g.height+x.height);o.style.maxHeight=w>0?w+"px":"0px",o.style.overflowY=w>0?"auto":"hidden"}};document.querySelectorAll("#ytls-pane").forEach(h=>h.remove()),i=document.createElement("div"),s=document.createElement("div"),o=document.createElement("ul"),m=document.createElement("div"),u=document.createElement("span"),p=document.createElement("style"),k=document.createElement("span"),A=document.createElement("span"),A.classList.add("ytls-backup-indicator"),A.style.cursor="pointer",A.style.backgroundColor="#666",A.onclick=h=>{h.stopPropagation(),ti("drive")},o.addEventListener("mouseenter",()=>{Pr=!0,mr=!1}),o.addEventListener("mouseleave",()=>{if(Pr=!1,mr)return;let h=oe(),g=h?Math.floor(h.getCurrentTime()):Pt();cn(g,!1);let x=null;if(document.activeElement instanceof HTMLInputElement&&o.contains(document.activeElement)&&(x=document.activeElement.closest("li")?.dataset.guid??null),Ma(),x){let D=de().find(P=>P.dataset.guid===x)?.querySelector("input");if(D)try{D.focus({preventScroll:!0})}catch{}}}),i.id="ytls-pane",s.id="ytls-pane-header",s.addEventListener("dblclick",h=>{let g=h.target instanceof HTMLElement?h.target:null;g&&(g.closest("a")||g.closest("button")||g.closest("#ytls-current-time")||g.closest(".ytls-version-display")||g.closest(".ytls-backup-indicator"))||(h.preventDefault(),Ni(!1))});let l=h=>{try{h.stopPropagation()}catch{}};["click","dblclick","mousedown","pointerdown","touchstart","wheel"].forEach(h=>{i.addEventListener(h,l)}),i.addEventListener("keydown",h=>{try{h.stopPropagation()}catch{}}),i.addEventListener("keyup",h=>{try{h.stopPropagation()}catch{}}),i.addEventListener("focus",h=>{try{h.stopPropagation()}catch{}},!0),i.addEventListener("blur",h=>{try{h.stopPropagation()}catch{}},!0);let d=GM_info.script.version;k.textContent=`v${d}`,k.classList.add("ytls-version-display");let f=document.createElement("span");f.style.display="inline-flex",f.style.alignItems="center",f.style.gap="6px",f.appendChild(k),f.appendChild(A),u.id="ytls-current-time",u.textContent="\u23F3",u.style.cursor="default",ht(u,()=>{let h=oe(),{isLive:g}=h?h.getVideoData()||{isLive:!1}:{isLive:!1};return g?"Skip to live":""}),u.onclick=()=>{let h=oe();if(!h)return;let{isLive:g}=h.getVideoData()||{isLive:!1};g&&(Jt=!0,h.seekToLiveHead(),setTimeout(()=>{Jt=!1},500))};let S=()=>{let h=oe();if(!h){u.style.cursor="default";return}let{isLive:g}=h.getVideoData()||{isLive:!1};u.style.cursor=g?"pointer":"default"};b(),lt&&clearInterval(lt),lt=setInterval(b,1e3),m.id="ytls-buttons";let v=(h,g)=>()=>{h.classList.remove("ytls-fade-in"),h.classList.add("ytls-fade-out"),setTimeout(()=>{document.body.contains(h)&&document.body.removeChild(h),g&&g()},300)},B=h=>g=>{g.key==="Escape"&&(g.preventDefault(),g.stopPropagation(),h())},z=h=>{setTimeout(()=>{document.addEventListener("keydown",h)},0)},R=(h,g)=>x=>{h.contains(x.target)||g()},H=h=>{setTimeout(()=>{document.addEventListener("click",h,!0)},0)},Tt=[{label:"\u{1F423}",title:"Add timestamp",action:()=>{if(!o||o.querySelector(".ytls-error-message")||Te)return;let h=typeof Bn<"u"?Bn:0,g=oe(),x=g?Math.floor(g.getCurrentTime()+h):0;if(!Number.isFinite(x))return;let w=gr(x,"");w&&w.focus()}},{label:"\u2699\uFE0F",title:"Settings",action:()=>ti()},{label:"\u{1F4CB}",title:"Copy timestamps to clipboard",action:function(h){if(!o||o.querySelector(".ytls-error-message")||Te){this.textContent="\u274C",setTimeout(()=>{this.textContent="\u{1F4CB}"},2e3);return}let g=Mi(),x=Math.max(Pt(),0);if(g.length===0){this.textContent="\u274C",setTimeout(()=>{this.textContent="\u{1F4CB}"},2e3);return}let w=h.ctrlKey,D=g.map(P=>{let $=Ut(P.start,x);return w?`${$} ${P.comment} <!-- guid:${P.guid} -->`.trimStart():`${$} ${P.comment}`}).join(`
`);navigator.clipboard.writeText(D).then(()=>{this.textContent="\u2705",setTimeout(()=>{this.textContent="\u{1F4CB}"},2e3)}).catch(P=>{c("Failed to copy timestamps: ",P,"error"),this.textContent="\u274C",setTimeout(()=>{this.textContent="\u{1F4CB}"},2e3)})}},{label:"\u23F1\uFE0F",title:"Offset all timestamps",action:()=>{if(!o||o.querySelector(".ytls-error-message")||Te)return;if(de().length===0){alert("No timestamps available to offset.");return}let g=prompt("Enter the number of seconds to offset all timestamps (positive or negative integer):","0");if(g===null)return;let x=g.trim();if(x.length===0)return;let w=Number.parseInt(x,10);if(!Number.isFinite(w)){alert("Please enter a valid integer number of seconds.");return}w!==0&&Ia(w,{alertOnNoChange:!0,failureMessage:"Offset had no effect because timestamps are already at the requested bounds.",logLabel:"bulk offset"})}},{label:"\u{1F5D1}\uFE0F",title:"Delete all timestamps for current video",action:async()=>{let h=Oi();if(!h){alert("Unable to determine current video ID.");return}let g=document.createElement("div");g.id="ytls-delete-all-modal",g.classList.remove("ytls-fade-out"),g.classList.add("ytls-fade-in");let x=document.createElement("p");x.textContent="Hold the button to delete all timestamps for:",x.style.marginBottom="10px";let w=document.createElement("p");w.textContent=h,w.style.fontFamily="monospace",w.style.fontSize="12px",w.style.marginBottom="15px",w.style.color="#aaa";let D=document.createElement("button");D.classList.add("ytls-save-modal-button"),D.style.background="#d32f2f",D.style.position="relative",D.style.overflow="hidden";let P=null,$=0,W=null,j=document.createElement("div");j.style.position="absolute",j.style.left="0",j.style.top="0",j.style.height="100%",j.style.width="0%",j.style.background="#ff6b6b",j.style.transition="none",j.style.pointerEvents="none",D.appendChild(j);let le=document.createElement("span");le.textContent="Hold to Delete All",le.style.position="relative",le.style.zIndex="1",D.appendChild(le);let it=()=>{if(!$)return;let Pe=Date.now()-$,mn=Math.min(Pe/5e3*100,100);j.style.width=`${mn}%`,mn<100&&(W=requestAnimationFrame(it))},ce=()=>{P&&(clearTimeout(P),P=null),W&&(cancelAnimationFrame(W),W=null),$=0,j.style.width="0%",le.textContent="Hold to Delete All"};D.onmousedown=()=>{$=Date.now(),le.textContent="Deleting...",W=requestAnimationFrame(it),P=setTimeout(async()=>{ce(),g.classList.remove("ytls-fade-in"),g.classList.add("ytls-fade-out"),setTimeout(async()=>{document.body.contains(g)&&document.body.removeChild(g);try{await Ds(h),$i()}catch(Pe){c("Failed to delete all timestamps:",Pe,"error"),alert("Failed to delete timestamps. Check console for details.")}},300)},5e3)},D.onmouseup=ce,D.onmouseleave=ce;let qe=null,Oe=null,Ze=v(g,()=>{ce(),qe&&document.removeEventListener("keydown",qe),Oe&&document.removeEventListener("click",Oe,!0)});qe=B(Ze),Oe=R(g,Ze);let We=document.createElement("button");We.textContent="Cancel",We.classList.add("ytls-save-modal-cancel-button"),We.onclick=Ze,g.appendChild(x),g.appendChild(w),g.appendChild(D),g.appendChild(We),document.body.appendChild(g),z(qe),H(Oe)}}],kt=to();Tt.forEach(h=>{let g=document.createElement("button");if(g.textContent=h.label,ht(g,h.title),g.classList.add("ytls-main-button"),h.label==="\u{1F423}"&&kt){let x=document.createElement("span");x.textContent=kt,x.classList.add("ytls-holiday-emoji"),g.appendChild(x)}h.label==="\u{1F4CB}"?g.onclick=function(x){h.action.call(this,x)}:g.onclick=h.action,h.label==="\u2699\uFE0F"&&(Nr=g),m.appendChild(g)});let ee=document.createElement("button");ee.textContent="\u{1F4BE} Save",ee.classList.add("ytls-file-operation-button"),ee.onclick=()=>{let h=document.createElement("div");h.id="ytls-save-modal",h.classList.remove("ytls-fade-out"),h.classList.add("ytls-fade-in");let g=document.createElement("p");g.textContent="Save as:";let x=null,w=null,D=v(h,()=>{x&&document.removeEventListener("keydown",x),w&&document.removeEventListener("click",w,!0)});x=B(D),w=R(h,D);let P=document.createElement("button");P.textContent="JSON",P.classList.add("ytls-save-modal-button"),P.onclick=()=>{x&&document.removeEventListener("keydown",x),w&&document.removeEventListener("click",w,!0),v(h,()=>Da("json"))()};let $=document.createElement("button");$.textContent="Plain Text",$.classList.add("ytls-save-modal-button"),$.onclick=()=>{x&&document.removeEventListener("keydown",x),w&&document.removeEventListener("click",w,!0),v(h,()=>Da("text"))()};let W=document.createElement("button");W.textContent="Cancel",W.classList.add("ytls-save-modal-cancel-button"),W.onclick=D,h.appendChild(g),h.appendChild(P),h.appendChild($),h.appendChild(W),document.body.appendChild(h),z(x),H(w)};let ge=document.createElement("button");ge.textContent="\u{1F4C2} Load",ge.classList.add("ytls-file-operation-button"),ge.onclick=()=>{let h=document.createElement("div");h.id="ytls-load-modal",h.classList.remove("ytls-fade-out"),h.classList.add("ytls-fade-in");let g=document.createElement("p");g.textContent="Load from:";let x=null,w=null,D=v(h,()=>{x&&document.removeEventListener("keydown",x),w&&document.removeEventListener("click",w,!0)});x=B(D),w=R(h,D);let P=document.createElement("button");P.textContent="File",P.classList.add("ytls-save-modal-button"),P.onclick=()=>{let j=document.createElement("input");j.type="file",j.accept=".json,.txt",j.classList.add("ytls-hidden-file-input"),j.onchange=le=>{let it=le.target.files?.[0];if(!it)return;x&&document.removeEventListener("keydown",x),w&&document.removeEventListener("click",w,!0),D();let ce=new FileReader;ce.onload=()=>{let qe=String(ce.result).trim();Na(qe)},ce.readAsText(it)},j.click()};let $=document.createElement("button");$.textContent="Clipboard",$.classList.add("ytls-save-modal-button"),$.onclick=async()=>{x&&document.removeEventListener("keydown",x),w&&document.removeEventListener("click",w,!0),v(h,async()=>{try{let j=await navigator.clipboard.readText();j?Na(j.trim()):alert("Clipboard is empty.")}catch(j){c("Failed to read from clipboard: ",j,"error"),alert("Failed to read from clipboard. Ensure you have granted permission.")}})()};let W=document.createElement("button");W.textContent="Cancel",W.classList.add("ytls-save-modal-cancel-button"),W.onclick=D,h.appendChild(g),h.appendChild(P),h.appendChild($),h.appendChild(W),document.body.appendChild(h),z(x),H(w)};let xe=document.createElement("button");xe.textContent="\u{1F4E4} Export",xe.classList.add("ytls-file-operation-button"),xe.onclick=async()=>{try{await Rs()}catch{alert("Failed to export data: Could not read from database.")}};let fe=document.createElement("button");fe.textContent="\u{1F4E5} Import",fe.classList.add("ytls-file-operation-button"),fe.onclick=()=>{let h=document.createElement("input");h.type="file",h.accept=".json",h.classList.add("ytls-hidden-file-input"),h.onchange=g=>{let x=g.target.files?.[0];if(!x)return;let w=new FileReader;w.onload=()=>{try{let D=JSON.parse(String(w.result)),P=[];for(let $ in D)if(Object.prototype.hasOwnProperty.call(D,$)&&$.startsWith("ytls-")){let W=$.substring(5),j=D[$];if(j&&typeof j.video_id=="string"&&Array.isArray(j.timestamps)){let le=j.timestamps.map(ce=>({...ce,guid:ce.guid||crypto.randomUUID()})),it=Oa(W,le).then(()=>c(`Imported ${W} to IndexedDB`)).catch(ce=>c(`Failed to import ${W} to IndexedDB:`,ce,"error"));P.push(it)}else c(`Skipping key ${$} during import due to unexpected data format.`,"warn")}Promise.all(P).then(()=>{$i()}).catch($=>{alert("An error occurred during import to IndexedDB. Check console for details."),c("Overall import error:",$,"error")})}catch(D){alert(`Failed to import data. Please ensure the file is in the correct format.
`+D.message),c("Import error:",D,"error")}},w.readAsText(x)},h.click()},p.textContent=ta,o.onclick=h=>{Ca(h)},o.ontouchstart=h=>{Ca(h)},i.style.position="fixed",i.style.bottom="0",i.style.right="0",i.style.transition="none",Re(),setTimeout(()=>Pn(),10);let dt=!1,vr,zi,un=!1;i.addEventListener("mousedown",h=>{let g=h.target;g instanceof Element&&(g instanceof HTMLInputElement||g instanceof HTMLTextAreaElement||g!==s&&!s.contains(g)&&window.getComputedStyle(g).cursor==="pointer"||(dt=!0,un=!1,vr=h.clientX-i.getBoundingClientRect().left,zi=h.clientY-i.getBoundingClientRect().top,i.style.transition="none"))}),document.addEventListener("mousemove",zr=h=>{if(!dt)return;un=!0;let g=h.clientX-vr,x=h.clientY-zi,w=i.getBoundingClientRect(),D=w.width,P=w.height,$=document.documentElement.clientWidth,W=document.documentElement.clientHeight;g=Math.max(0,Math.min(g,$-D)),x=Math.max(0,Math.min(x,W-P)),i.style.left=`${g}px`,i.style.top=`${x}px`,i.style.right="auto",i.style.bottom="auto"}),document.addEventListener("mouseup",Hr=()=>{if(!dt)return;dt=!1;let h=un;setTimeout(()=>{un=!1},50),Pn(),setTimeout(()=>{h&&ut()},200)}),i.addEventListener("dragstart",h=>h.preventDefault());let Nn=document.createElement("div"),Hi=document.createElement("div"),Fi=document.createElement("div"),ji=document.createElement("div");Nn.id="ytls-resize-tl",Hi.id="ytls-resize-tr",Fi.id="ytls-resize-bl",ji.id="ytls-resize-br";let $n=!1,Ha=0,Fa=0,zn=0,Hn=0,ni=0,ri=0,dn=null;ii(Nn,"top-left"),ii(Hi,"top-right"),ii(Fi,"bottom-left"),ii(ji,"bottom-right"),document.addEventListener("mousemove",h=>{if(!$n||!i||!dn)return;let g=h.clientX-Ha,x=h.clientY-Fa,w=zn,D=Hn,P=ni,$=ri,W=document.documentElement.clientWidth,j=document.documentElement.clientHeight;dn==="bottom-right"?(w=Math.max(200,Math.min(800,zn+g)),D=Math.max(250,Math.min(j,Hn+x))):dn==="top-left"?(w=Math.max(200,Math.min(800,zn-g)),P=ni+g,D=Math.max(250,Math.min(j,Hn-x)),$=ri+x):dn==="top-right"?(w=Math.max(200,Math.min(800,zn+g)),D=Math.max(250,Math.min(j,Hn-x)),$=ri+x):dn==="bottom-left"&&(w=Math.max(200,Math.min(800,zn-g)),P=ni+g,D=Math.max(250,Math.min(j,Hn+x))),P=Math.max(0,Math.min(P,W-w)),$=Math.max(0,Math.min($,j-D)),i.style.width=`${w}px`,i.style.height=`${D}px`,i.style.left=`${P}px`,i.style.top=`${$}px`,i.style.right="auto",i.style.bottom="auto"}),document.addEventListener("mouseup",()=>{$n&&($n=!1,dn=null,document.body.style.cursor="",Ie(!0))});let ai=null;window.addEventListener("resize",Fr=()=>{ai&&clearTimeout(ai),ai=setTimeout(()=>{Ie(!0),ai=null},200)}),s.appendChild(u),s.appendChild(f);let oi=document.createElement("div");if(oi.id="ytls-content",oi.append(o),oi.append(m),i.append(s,oi,p,Nn,Hi,Fi,ji),i.addEventListener("mousemove",h=>{try{if(dt||$n)return;let g=i.getBoundingClientRect(),x=20,w=h.clientX,D=h.clientY,P=w-g.left<=x,$=g.right-w<=x,W=D-g.top<=x,j=g.bottom-D<=x,le="";W&&P||j&&$?le="nwse-resize":W&&$||j&&P?le="nesw-resize":le="",document.body.style.cursor=le}catch{}}),i.addEventListener("mouseleave",()=>{!$n&&!dt&&(document.body.style.cursor="")}),window.recalculateTimestampsArea=xr,setTimeout(()=>{if(xr(),i&&s&&m&&o){let h=40,g=de();if(g.length>0)h=g[0].offsetHeight;else{let x=document.createElement("li");x.style.visibility="hidden",x.style.position="absolute",x.textContent="00:00 Example",o.appendChild(x),h=x.offsetHeight,o.removeChild(x)}ue(s.offsetHeight+m.offsetHeight+h),i.style.minHeight=re()+"px"}},0),window.addEventListener("resize",xr),bt){try{bt.disconnect()}catch{}bt=null}bt=new ResizeObserver(xr),bt.observe(i),ur||document.addEventListener("pointerdown",ur=()=>{Ta=Date.now()},!0),dr||document.addEventListener("pointerup",dr=()=>{},!0)}finally{Ci=!1}}}async function $s(){if(!i)return;if(document.querySelectorAll("#ytls-pane").forEach(f=>{f!==i&&(c("Removing duplicate pane element from DOM"),f.remove())}),document.body.contains(i)){c("Pane already in DOM, skipping append");return}await Ps(),typeof pa=="function"&&pa(Bs),typeof Ti=="function"&&Ti(ei),typeof ki=="function"&&ki(Pi),typeof ma=="function"&&ma(A),await fa(),await us(),await tr(),typeof Ei=="function"&&Ei();let d=document.querySelectorAll("#ytls-pane");if(d.length>0&&(c(`WARNING: Found ${d.length} existing pane(s) in DOM, removing all`),d.forEach(f=>f.remove())),document.body.contains(i)){c("ERROR: Pane already in body, aborting append");return}if(document.body.appendChild(i),c("Pane successfully appended to DOM"),gt(),_e&&(clearTimeout(_e),_e=null),_e=setTimeout(()=>{He(),typeof window.recalculateTimestampsArea=="function"&&window.recalculateTimestampsArea(),ze(),Ie(!0),_e=null},450),xt){try{xt.disconnect()}catch{}xt=null}xt=new MutationObserver(()=>{let f=document.querySelectorAll("#ytls-pane");f.length>1&&(c(`CRITICAL: Multiple panes detected (${f.length}), removing duplicates`),f.forEach((y,S)=>{(S>0||i&&y!==i)&&y.remove()}))}),xt.observe(document.body,{childList:!0,subtree:!0})}function $a(l=0){if(document.getElementById("ytls-header-button")){Nt();return}let d=document.querySelector("#logo");if(!d||!d.parentElement){l<10&&setTimeout(()=>$a(l+1),300);return}let f=document.createElement("button");f.id="ytls-header-button",f.type="button",f.className="ytls-header-button",ht(f,"Toggle Timekeeper UI"),f.setAttribute("aria-label","Toggle Timekeeper UI");let y=document.createElement("img");y.src=yt,y.alt="",y.decoding="async",f.appendChild(y),Yt=y,f.addEventListener("mouseenter",()=>{Yt&&($r=!0,Yt.src=rr)}),f.addEventListener("mouseleave",()=>{Yt&&($r=!1,Nt())}),f.addEventListener("click",()=>{i&&!document.body.contains(i)&&(c("Pane not in DOM, re-appending before toggle"),document.body.appendChild(i)),Ni()}),d.insertAdjacentElement("afterend",f),Nt(),c("Timekeeper header button added next to YouTube logo")}function za(){if(ie())return;we(!0);let l=history.pushState,d=history.replaceState;function f(){try{let y=new Event("locationchange");window.dispatchEvent(y)}catch{}}history.pushState=function(){let y=l.apply(this,arguments);return f(),y},history.replaceState=function(){let y=d.apply(this,arguments);return f(),y},window.addEventListener("popstate",f),window.addEventListener("locationchange",()=>{window.location.href!==G&&c("Location changed (locationchange event) \u2014 deferring UI update until navigation finish")})}async function $i(){if(!a()){Es();return}K(window.location.href),document.querySelectorAll("#ytls-pane").forEach((d,f)=>{(f>0||i&&d!==i)&&d.remove()}),await _i(),await Ns(),Le=Oi();let l=document.title;c("Page Title:",l),c("Video ID:",Le),c("Current URL:",window.location.href),Bi(!0),Rn(),Fe(),await Ra(),Fe(),Bi(!1),c("Timestamps loaded and UI unlocked for video:",Le),await $s(),$a(),Ls()}za(),window.addEventListener("yt-navigate-start",()=>{c("Navigation started (yt-navigate-start event fired)"),a()&&i&&o&&(c("Locking UI and showing loading state for navigation"),Bi(!0))}),cr=l=>{l.ctrlKey&&l.altKey&&l.shiftKey&&(l.key==="T"||l.key==="t")&&(l.preventDefault(),Ni(),c("Timekeeper UI toggled via keyboard shortcut (Ctrl+Alt+Shift+T)"))},document.addEventListener("keydown",cr),window.addEventListener("yt-navigate-finish",()=>{c("Navigation finished (yt-navigate-finish event fired)"),window.location.href!==G?$i():c("Navigation finished but URL already handled, skipping.")}),za(),c("Timekeeper initialized and waiting for navigation events")})();})();


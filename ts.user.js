// ==UserScript==
// @name         Timekeeper
// @namespace    https://violentmonkey.github.io/
// @version      4.4.79
// @description  Enhanced timestamp tool for YouTube videos
// @author       Silent Shout
// @match        https://www.youtube.com/*
// @run-at       document-idle
// @noframes
// @icon         https://raw.githubusercontent.com/KamoTimestamps/timekeeper/refs/heads/main/assets/Kamo_64px_Indexed.png
// @grant        GM.getValue
// @grant        GM.setValue
// @grant        GM.setClipboard
// @homepageURL  https://github.com/KamoTimestamps/timekeeper
// @supportURL   https://github.com/KamoTimestamps/timekeeper/issues
// @downloadURL  https://raw.githubusercontent.com/KamoTimestamps/timekeeper/main/timekeeper.user.js
// @updateURL    https://raw.githubusercontent.com/KamoTimestamps/timekeeper/main/timekeeper.user.js
// @license MIT
// ==/UserScript==

(()=>{var Wo=Object.defineProperty;var Ta=(t,e)=>{for(var n in e)Wo(t,n,{get:e[n],enumerable:!0})};var M={};Ta(M,{BRAND:()=>bs,DIRTY:()=>rn,EMPTY_PATH:()=>Xo,INVALID:()=>B,NEVER:()=>il,OK:()=>Pe,ParseStatus:()=>Me,Schema:()=>q,ZodAny:()=>Vt,ZodArray:()=>Ot,ZodBigInt:()=>on,ZodBoolean:()=>sn,ZodBranded:()=>yr,ZodCatch:()=>vn,ZodDate:()=>ln,ZodDefault:()=>yn,ZodDiscriminatedUnion:()=>ii,ZodEffects:()=>ut,ZodEnum:()=>hn,ZodError:()=>Ze,ZodFirstPartyTypeKind:()=>N,ZodFunction:()=>oi,ZodIntersection:()=>mn,ZodIssueCode:()=>T,ZodLazy:()=>fn,ZodLiteral:()=>pn,ZodMap:()=>jn,ZodNaN:()=>Vn,ZodNativeEnum:()=>gn,ZodNever:()=>bt,ZodNull:()=>un,ZodNullable:()=>_t,ZodNumber:()=>an,ZodObject:()=>We,ZodOptional:()=>lt,ZodParsedType:()=>C,ZodPipeline:()=>vr,ZodPromise:()=>Gt,ZodReadonly:()=>xn,ZodRecord:()=>ai,ZodSchema:()=>q,ZodSet:()=>Un,ZodString:()=>Ut,ZodSymbol:()=>Hn,ZodTransformer:()=>ut,ZodTuple:()=>Et,ZodType:()=>q,ZodUndefined:()=>cn,ZodUnion:()=>dn,ZodUnknown:()=>Bt,ZodVoid:()=>Fn,addIssueToContext:()=>S,any:()=>Is,array:()=>Rs,bigint:()=>Es,boolean:()=>Ra,coerce:()=>rl,custom:()=>Aa,date:()=>_s,datetimeRegex:()=>Ca,defaultErrorMap:()=>Dt,discriminatedUnion:()=>Ps,effect:()=>Ys,enum:()=>qs,function:()=>Us,getErrorMap:()=>Pn,getParsedType:()=>kt,instanceof:()=>Ts,intersection:()=>zs,isAborted:()=>ni,isAsync:()=>zn,isDirty:()=>ri,isValid:()=>jt,late:()=>ws,lazy:()=>Vs,literal:()=>Gs,makeIssue:()=>gr,map:()=>Fs,nan:()=>ks,nativeEnum:()=>Zs,never:()=>Ms,null:()=>Cs,nullable:()=>Js,number:()=>Da,object:()=>Bs,objectUtil:()=>Ai,oboolean:()=>nl,onumber:()=>tl,optional:()=>Ks,ostring:()=>el,pipeline:()=>Qs,preprocess:()=>Xs,promise:()=>Ws,quotelessJson:()=>Yo,record:()=>Hs,set:()=>js,setErrorMap:()=>Jo,strictObject:()=>Os,string:()=>Ma,symbol:()=>Ss,transformer:()=>Ys,tuple:()=>$s,undefined:()=>Ls,union:()=>Ns,unknown:()=>As,util:()=>Y,void:()=>Ds});var Y;(function(t){t.assertEqual=a=>{};function e(a){}t.assertIs=e;function n(a){throw new Error}t.assertNever=n,t.arrayToEnum=a=>{let i={};for(let s of a)i[s]=s;return i},t.getValidEnumValues=a=>{let i=t.objectKeys(a).filter(o=>typeof a[a[o]]!="number"),s={};for(let o of i)s[o]=a[o];return t.objectValues(s)},t.objectValues=a=>t.objectKeys(a).map(function(i){return a[i]}),t.objectKeys=typeof Object.keys=="function"?a=>Object.keys(a):a=>{let i=[];for(let s in a)Object.prototype.hasOwnProperty.call(a,s)&&i.push(s);return i},t.find=(a,i)=>{for(let s of a)if(i(s))return s},t.isInteger=typeof Number.isInteger=="function"?a=>Number.isInteger(a):a=>typeof a=="number"&&Number.isFinite(a)&&Math.floor(a)===a;function r(a,i=" | "){return a.map(s=>typeof s=="string"?`'${s}'`:s).join(i)}t.joinValues=r,t.jsonStringifyReplacer=(a,i)=>typeof i=="bigint"?i.toString():i})(Y||(Y={}));var Ai;(function(t){t.mergeShapes=(e,n)=>({...e,...n})})(Ai||(Ai={}));var C=Y.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),kt=t=>{switch(typeof t){case"undefined":return C.undefined;case"string":return C.string;case"number":return Number.isNaN(t)?C.nan:C.number;case"boolean":return C.boolean;case"function":return C.function;case"bigint":return C.bigint;case"symbol":return C.symbol;case"object":return Array.isArray(t)?C.array:t===null?C.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?C.promise:typeof Map<"u"&&t instanceof Map?C.map:typeof Set<"u"&&t instanceof Set?C.set:typeof Date<"u"&&t instanceof Date?C.date:C.object;default:return C.unknown}};var T=Y.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Yo=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:"),Ze=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};let n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=e}format(e){let n=e||function(i){return i.message},r={_errors:[]},a=i=>{for(let s of i.issues)if(s.code==="invalid_union")s.unionErrors.map(a);else if(s.code==="invalid_return_type")a(s.returnTypeError);else if(s.code==="invalid_arguments")a(s.argumentsError);else if(s.path.length===0)r._errors.push(n(s));else{let o=r,d=0;for(;d<s.path.length;){let m=s.path[d];d===s.path.length-1?(o[m]=o[m]||{_errors:[]},o[m]._errors.push(n(s))):o[m]=o[m]||{_errors:[]},o=o[m],d++}}};return a(this),r}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Y.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=n=>n.message){let n={},r=[];for(let a of this.issues)if(a.path.length>0){let i=a.path[0];n[i]=n[i]||[],n[i].push(e(a))}else r.push(e(a));return{formErrors:r,fieldErrors:n}}get formErrors(){return this.flatten()}};Ze.create=t=>new Ze(t);var Ko=(t,e)=>{let n;switch(t.code){case T.invalid_type:t.received===C.undefined?n="Required":n=`Expected ${t.expected}, received ${t.received}`;break;case T.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(t.expected,Y.jsonStringifyReplacer)}`;break;case T.unrecognized_keys:n=`Unrecognized key(s) in object: ${Y.joinValues(t.keys,", ")}`;break;case T.invalid_union:n="Invalid input";break;case T.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${Y.joinValues(t.options)}`;break;case T.invalid_enum_value:n=`Invalid enum value. Expected ${Y.joinValues(t.options)}, received '${t.received}'`;break;case T.invalid_arguments:n="Invalid function arguments";break;case T.invalid_return_type:n="Invalid function return type";break;case T.invalid_date:n="Invalid date";break;case T.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(n=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(n=`${n} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?n=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?n=`Invalid input: must end with "${t.validation.endsWith}"`:Y.assertNever(t.validation):t.validation!=="regex"?n=`Invalid ${t.validation}`:n="Invalid";break;case T.too_small:t.type==="array"?n=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?n=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?n=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="bigint"?n=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?n=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:n="Invalid input";break;case T.too_big:t.type==="array"?n=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?n=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?n=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?n=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?n=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:n="Invalid input";break;case T.custom:n="Invalid input";break;case T.invalid_intersection_types:n="Intersection results could not be merged";break;case T.not_multiple_of:n=`Number must be a multiple of ${t.multipleOf}`;break;case T.not_finite:n="Number must be finite";break;default:n=e.defaultError,Y.assertNever(t)}return{message:n}},Dt=Ko;var ka=Dt;function Jo(t){ka=t}function Pn(){return ka}var gr=t=>{let{data:e,path:n,errorMaps:r,issueData:a}=t,i=[...n,...a.path||[]],s={...a,path:i};if(a.message!==void 0)return{...a,path:i,message:a.message};let o="",d=r.filter(m=>!!m).slice().reverse();for(let m of d)o=m(s,{data:e,defaultError:o}).message;return{...a,path:i,message:o}},Xo=[];function S(t,e){let n=Pn(),r=gr({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,n,n===Dt?void 0:Dt].filter(a=>!!a)});t.common.issues.push(r)}var Me=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,n){let r=[];for(let a of n){if(a.status==="aborted")return B;a.status==="dirty"&&e.dirty(),r.push(a.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,n){let r=[];for(let a of n){let i=await a.key,s=await a.value;r.push({key:i,value:s})}return t.mergeObjectSync(e,r)}static mergeObjectSync(e,n){let r={};for(let a of n){let{key:i,value:s}=a;if(i.status==="aborted"||s.status==="aborted")return B;i.status==="dirty"&&e.dirty(),s.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof s.value<"u"||a.alwaysSet)&&(r[i.value]=s.value)}return{status:e.value,value:r}}},B=Object.freeze({status:"aborted"}),rn=t=>({status:"dirty",value:t}),Pe=t=>({status:"valid",value:t}),ni=t=>t.status==="aborted",ri=t=>t.status==="dirty",jt=t=>t.status==="valid",zn=t=>typeof Promise<"u"&&t instanceof Promise;var A;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(A||(A={}));var ct=class{constructor(e,n,r,a){this._cachedPath=[],this.parent=e,this.data=n,this._path=r,this._key=a}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},Ea=(t,e)=>{if(jt(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let n=new Ze(t.common.issues);return this._error=n,this._error}}};function V(t){if(!t)return{};let{errorMap:e,invalid_type_error:n,required_error:r,description:a}=t;if(e&&(n||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:a}:{errorMap:(s,o)=>{let{message:d}=t;return s.code==="invalid_enum_value"?{message:d??o.defaultError}:typeof o.data>"u"?{message:d??r??o.defaultError}:s.code!=="invalid_type"?{message:o.defaultError}:{message:d??n??o.defaultError}},description:a}}var q=class{get description(){return this._def.description}_getType(e){return kt(e.data)}_getOrReturnCtx(e,n){return n||{common:e.parent.common,data:e.data,parsedType:kt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Me,ctx:{common:e.parent.common,data:e.data,parsedType:kt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let n=this._parse(e);if(zn(n))throw new Error("Synchronous parse encountered promise.");return n}_parseAsync(e){let n=this._parse(e);return Promise.resolve(n)}parse(e,n){let r=this.safeParse(e,n);if(r.success)return r.data;throw r.error}safeParse(e,n){let r={common:{issues:[],async:n?.async??!1,contextualErrorMap:n?.errorMap},path:n?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:kt(e)},a=this._parseSync({data:e,path:r.path,parent:r});return Ea(r,a)}"~validate"(e){let n={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:kt(e)};if(!this["~standard"].async)try{let r=this._parseSync({data:e,path:[],parent:n});return jt(r)?{value:r.value}:{issues:n.common.issues}}catch(r){r?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),n.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:n}).then(r=>jt(r)?{value:r.value}:{issues:n.common.issues})}async parseAsync(e,n){let r=await this.safeParseAsync(e,n);if(r.success)return r.data;throw r.error}async safeParseAsync(e,n){let r={common:{issues:[],contextualErrorMap:n?.errorMap,async:!0},path:n?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:kt(e)},a=this._parse({data:e,path:r.path,parent:r}),i=await(zn(a)?a:Promise.resolve(a));return Ea(r,i)}refine(e,n){let r=a=>typeof n=="string"||typeof n>"u"?{message:n}:typeof n=="function"?n(a):n;return this._refinement((a,i)=>{let s=e(a),o=()=>i.addIssue({code:T.custom,...r(a)});return typeof Promise<"u"&&s instanceof Promise?s.then(d=>d?!0:(o(),!1)):s?!0:(o(),!1)})}refinement(e,n){return this._refinement((r,a)=>e(r)?!0:(a.addIssue(typeof n=="function"?n(r,a):n),!1))}_refinement(e){return new ut({schema:this,typeName:N.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:n=>this["~validate"](n)}}optional(){return lt.create(this,this._def)}nullable(){return _t.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Ot.create(this)}promise(){return Gt.create(this,this._def)}or(e){return dn.create([this,e],this._def)}and(e){return mn.create(this,e,this._def)}transform(e){return new ut({...V(this._def),schema:this,typeName:N.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let n=typeof e=="function"?e:()=>e;return new yn({...V(this._def),innerType:this,defaultValue:n,typeName:N.ZodDefault})}brand(){return new yr({typeName:N.ZodBranded,type:this,...V(this._def)})}catch(e){let n=typeof e=="function"?e:()=>e;return new vn({...V(this._def),innerType:this,catchValue:n,typeName:N.ZodCatch})}describe(e){let n=this.constructor;return new n({...this._def,description:e})}pipe(e){return vr.create(this,e)}readonly(){return xn.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},Qo=/^c[^\s-]{8,}$/i,es=/^[0-9a-z]+$/,ts=/^[0-9A-HJKMNP-TV-Z]{26}$/i,ns=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,rs=/^[a-z0-9_-]{21}$/i,is=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,as=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,os=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,ss="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",Mi,ls=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,cs=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,us=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,ds=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,ms=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,fs=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Sa="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",ps=new RegExp(`^${Sa}$`);function La(t){let e="[0-5]\\d";t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`);let n=t.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${n}`}function hs(t){return new RegExp(`^${La(t)}$`)}function Ca(t){let e=`${Sa}T${La(t)}`,n=[];return n.push(t.local?"Z?":"Z"),t.offset&&n.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${n.join("|")})`,new RegExp(`^${e}$`)}function gs(t,e){return!!((e==="v4"||!e)&&ls.test(t)||(e==="v6"||!e)&&us.test(t))}function ys(t,e){if(!is.test(t))return!1;try{let[n]=t.split(".");if(!n)return!1;let r=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(n.length+(4-n.length%4)%4,"="),a=JSON.parse(atob(r));return!(typeof a!="object"||a===null||"typ"in a&&a?.typ!=="JWT"||!a.alg||e&&a.alg!==e)}catch{return!1}}function vs(t,e){return!!((e==="v4"||!e)&&cs.test(t)||(e==="v6"||!e)&&ds.test(t))}var Ut=class t extends q{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==C.string){let i=this._getOrReturnCtx(e);return S(i,{code:T.invalid_type,expected:C.string,received:i.parsedType}),B}let r=new Me,a;for(let i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(a=this._getOrReturnCtx(e,a),S(a,{code:T.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),r.dirty());else if(i.kind==="max")e.data.length>i.value&&(a=this._getOrReturnCtx(e,a),S(a,{code:T.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),r.dirty());else if(i.kind==="length"){let s=e.data.length>i.value,o=e.data.length<i.value;(s||o)&&(a=this._getOrReturnCtx(e,a),s?S(a,{code:T.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):o&&S(a,{code:T.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),r.dirty())}else if(i.kind==="email")os.test(e.data)||(a=this._getOrReturnCtx(e,a),S(a,{validation:"email",code:T.invalid_string,message:i.message}),r.dirty());else if(i.kind==="emoji")Mi||(Mi=new RegExp(ss,"u")),Mi.test(e.data)||(a=this._getOrReturnCtx(e,a),S(a,{validation:"emoji",code:T.invalid_string,message:i.message}),r.dirty());else if(i.kind==="uuid")ns.test(e.data)||(a=this._getOrReturnCtx(e,a),S(a,{validation:"uuid",code:T.invalid_string,message:i.message}),r.dirty());else if(i.kind==="nanoid")rs.test(e.data)||(a=this._getOrReturnCtx(e,a),S(a,{validation:"nanoid",code:T.invalid_string,message:i.message}),r.dirty());else if(i.kind==="cuid")Qo.test(e.data)||(a=this._getOrReturnCtx(e,a),S(a,{validation:"cuid",code:T.invalid_string,message:i.message}),r.dirty());else if(i.kind==="cuid2")es.test(e.data)||(a=this._getOrReturnCtx(e,a),S(a,{validation:"cuid2",code:T.invalid_string,message:i.message}),r.dirty());else if(i.kind==="ulid")ts.test(e.data)||(a=this._getOrReturnCtx(e,a),S(a,{validation:"ulid",code:T.invalid_string,message:i.message}),r.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{a=this._getOrReturnCtx(e,a),S(a,{validation:"url",code:T.invalid_string,message:i.message}),r.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(a=this._getOrReturnCtx(e,a),S(a,{validation:"regex",code:T.invalid_string,message:i.message}),r.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(a=this._getOrReturnCtx(e,a),S(a,{code:T.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),r.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(a=this._getOrReturnCtx(e,a),S(a,{code:T.invalid_string,validation:{startsWith:i.value},message:i.message}),r.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(a=this._getOrReturnCtx(e,a),S(a,{code:T.invalid_string,validation:{endsWith:i.value},message:i.message}),r.dirty()):i.kind==="datetime"?Ca(i).test(e.data)||(a=this._getOrReturnCtx(e,a),S(a,{code:T.invalid_string,validation:"datetime",message:i.message}),r.dirty()):i.kind==="date"?ps.test(e.data)||(a=this._getOrReturnCtx(e,a),S(a,{code:T.invalid_string,validation:"date",message:i.message}),r.dirty()):i.kind==="time"?hs(i).test(e.data)||(a=this._getOrReturnCtx(e,a),S(a,{code:T.invalid_string,validation:"time",message:i.message}),r.dirty()):i.kind==="duration"?as.test(e.data)||(a=this._getOrReturnCtx(e,a),S(a,{validation:"duration",code:T.invalid_string,message:i.message}),r.dirty()):i.kind==="ip"?gs(e.data,i.version)||(a=this._getOrReturnCtx(e,a),S(a,{validation:"ip",code:T.invalid_string,message:i.message}),r.dirty()):i.kind==="jwt"?ys(e.data,i.alg)||(a=this._getOrReturnCtx(e,a),S(a,{validation:"jwt",code:T.invalid_string,message:i.message}),r.dirty()):i.kind==="cidr"?vs(e.data,i.version)||(a=this._getOrReturnCtx(e,a),S(a,{validation:"cidr",code:T.invalid_string,message:i.message}),r.dirty()):i.kind==="base64"?ms.test(e.data)||(a=this._getOrReturnCtx(e,a),S(a,{validation:"base64",code:T.invalid_string,message:i.message}),r.dirty()):i.kind==="base64url"?fs.test(e.data)||(a=this._getOrReturnCtx(e,a),S(a,{validation:"base64url",code:T.invalid_string,message:i.message}),r.dirty()):Y.assertNever(i);return{status:r.value,value:e.data}}_regex(e,n,r){return this.refinement(a=>e.test(a),{validation:n,code:T.invalid_string,...A.errToObj(r)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...A.errToObj(e)})}url(e){return this._addCheck({kind:"url",...A.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...A.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...A.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...A.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...A.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...A.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...A.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...A.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...A.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...A.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...A.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...A.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...A.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...A.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...A.errToObj(e)})}regex(e,n){return this._addCheck({kind:"regex",regex:e,...A.errToObj(n)})}includes(e,n){return this._addCheck({kind:"includes",value:e,position:n?.position,...A.errToObj(n?.message)})}startsWith(e,n){return this._addCheck({kind:"startsWith",value:e,...A.errToObj(n)})}endsWith(e,n){return this._addCheck({kind:"endsWith",value:e,...A.errToObj(n)})}min(e,n){return this._addCheck({kind:"min",value:e,...A.errToObj(n)})}max(e,n){return this._addCheck({kind:"max",value:e,...A.errToObj(n)})}length(e,n){return this._addCheck({kind:"length",value:e,...A.errToObj(n)})}nonempty(e){return this.min(1,A.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxLength(){let e=null;for(let n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}};Ut.create=t=>new Ut({checks:[],typeName:N.ZodString,coerce:t?.coerce??!1,...V(t)});function xs(t,e){let n=(t.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,a=n>r?n:r,i=Number.parseInt(t.toFixed(a).replace(".","")),s=Number.parseInt(e.toFixed(a).replace(".",""));return i%s/10**a}var an=class t extends q{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==C.number){let i=this._getOrReturnCtx(e);return S(i,{code:T.invalid_type,expected:C.number,received:i.parsedType}),B}let r,a=new Me;for(let i of this._def.checks)i.kind==="int"?Y.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),S(r,{code:T.invalid_type,expected:"integer",received:"float",message:i.message}),a.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(r=this._getOrReturnCtx(e,r),S(r,{code:T.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),a.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(r=this._getOrReturnCtx(e,r),S(r,{code:T.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),a.dirty()):i.kind==="multipleOf"?xs(e.data,i.value)!==0&&(r=this._getOrReturnCtx(e,r),S(r,{code:T.not_multiple_of,multipleOf:i.value,message:i.message}),a.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),S(r,{code:T.not_finite,message:i.message}),a.dirty()):Y.assertNever(i);return{status:a.value,value:e.data}}gte(e,n){return this.setLimit("min",e,!0,A.toString(n))}gt(e,n){return this.setLimit("min",e,!1,A.toString(n))}lte(e,n){return this.setLimit("max",e,!0,A.toString(n))}lt(e,n){return this.setLimit("max",e,!1,A.toString(n))}setLimit(e,n,r,a){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:r,message:A.toString(a)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:A.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:A.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:A.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:A.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:A.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:A.toString(n)})}finite(e){return this._addCheck({kind:"finite",message:A.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:A.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:A.toString(e)})}get minValue(){let e=null;for(let n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(let n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&Y.isInteger(e.value))}get isFinite(){let e=null,n=null;for(let r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(n===null||r.value>n)&&(n=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(n)&&Number.isFinite(e)}};an.create=t=>new an({checks:[],typeName:N.ZodNumber,coerce:t?.coerce||!1,...V(t)});var on=class t extends q{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==C.bigint)return this._getInvalidInput(e);let r,a=new Me;for(let i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(r=this._getOrReturnCtx(e,r),S(r,{code:T.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),a.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(r=this._getOrReturnCtx(e,r),S(r,{code:T.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),a.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),S(r,{code:T.not_multiple_of,multipleOf:i.value,message:i.message}),a.dirty()):Y.assertNever(i);return{status:a.value,value:e.data}}_getInvalidInput(e){let n=this._getOrReturnCtx(e);return S(n,{code:T.invalid_type,expected:C.bigint,received:n.parsedType}),B}gte(e,n){return this.setLimit("min",e,!0,A.toString(n))}gt(e,n){return this.setLimit("min",e,!1,A.toString(n))}lte(e,n){return this.setLimit("max",e,!0,A.toString(n))}lt(e,n){return this.setLimit("max",e,!1,A.toString(n))}setLimit(e,n,r,a){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:r,message:A.toString(a)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:A.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:A.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:A.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:A.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:A.toString(n)})}get minValue(){let e=null;for(let n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(let n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}};on.create=t=>new on({checks:[],typeName:N.ZodBigInt,coerce:t?.coerce??!1,...V(t)});var sn=class extends q{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==C.boolean){let r=this._getOrReturnCtx(e);return S(r,{code:T.invalid_type,expected:C.boolean,received:r.parsedType}),B}return Pe(e.data)}};sn.create=t=>new sn({typeName:N.ZodBoolean,coerce:t?.coerce||!1,...V(t)});var ln=class t extends q{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==C.date){let i=this._getOrReturnCtx(e);return S(i,{code:T.invalid_type,expected:C.date,received:i.parsedType}),B}if(Number.isNaN(e.data.getTime())){let i=this._getOrReturnCtx(e);return S(i,{code:T.invalid_date}),B}let r=new Me,a;for(let i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(a=this._getOrReturnCtx(e,a),S(a,{code:T.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),r.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(a=this._getOrReturnCtx(e,a),S(a,{code:T.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),r.dirty()):Y.assertNever(i);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}min(e,n){return this._addCheck({kind:"min",value:e.getTime(),message:A.toString(n)})}max(e,n){return this._addCheck({kind:"max",value:e.getTime(),message:A.toString(n)})}get minDate(){let e=null;for(let n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e!=null?new Date(e):null}};ln.create=t=>new ln({checks:[],coerce:t?.coerce||!1,typeName:N.ZodDate,...V(t)});var Hn=class extends q{_parse(e){if(this._getType(e)!==C.symbol){let r=this._getOrReturnCtx(e);return S(r,{code:T.invalid_type,expected:C.symbol,received:r.parsedType}),B}return Pe(e.data)}};Hn.create=t=>new Hn({typeName:N.ZodSymbol,...V(t)});var cn=class extends q{_parse(e){if(this._getType(e)!==C.undefined){let r=this._getOrReturnCtx(e);return S(r,{code:T.invalid_type,expected:C.undefined,received:r.parsedType}),B}return Pe(e.data)}};cn.create=t=>new cn({typeName:N.ZodUndefined,...V(t)});var un=class extends q{_parse(e){if(this._getType(e)!==C.null){let r=this._getOrReturnCtx(e);return S(r,{code:T.invalid_type,expected:C.null,received:r.parsedType}),B}return Pe(e.data)}};un.create=t=>new un({typeName:N.ZodNull,...V(t)});var Vt=class extends q{constructor(){super(...arguments),this._any=!0}_parse(e){return Pe(e.data)}};Vt.create=t=>new Vt({typeName:N.ZodAny,...V(t)});var Bt=class extends q{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Pe(e.data)}};Bt.create=t=>new Bt({typeName:N.ZodUnknown,...V(t)});var bt=class extends q{_parse(e){let n=this._getOrReturnCtx(e);return S(n,{code:T.invalid_type,expected:C.never,received:n.parsedType}),B}};bt.create=t=>new bt({typeName:N.ZodNever,...V(t)});var Fn=class extends q{_parse(e){if(this._getType(e)!==C.undefined){let r=this._getOrReturnCtx(e);return S(r,{code:T.invalid_type,expected:C.void,received:r.parsedType}),B}return Pe(e.data)}};Fn.create=t=>new Fn({typeName:N.ZodVoid,...V(t)});var Ot=class t extends q{_parse(e){let{ctx:n,status:r}=this._processInputParams(e),a=this._def;if(n.parsedType!==C.array)return S(n,{code:T.invalid_type,expected:C.array,received:n.parsedType}),B;if(a.exactLength!==null){let s=n.data.length>a.exactLength.value,o=n.data.length<a.exactLength.value;(s||o)&&(S(n,{code:s?T.too_big:T.too_small,minimum:o?a.exactLength.value:void 0,maximum:s?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),r.dirty())}if(a.minLength!==null&&n.data.length<a.minLength.value&&(S(n,{code:T.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),r.dirty()),a.maxLength!==null&&n.data.length>a.maxLength.value&&(S(n,{code:T.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),r.dirty()),n.common.async)return Promise.all([...n.data].map((s,o)=>a.type._parseAsync(new ct(n,s,n.path,o)))).then(s=>Me.mergeArray(r,s));let i=[...n.data].map((s,o)=>a.type._parseSync(new ct(n,s,n.path,o)));return Me.mergeArray(r,i)}get element(){return this._def.type}min(e,n){return new t({...this._def,minLength:{value:e,message:A.toString(n)}})}max(e,n){return new t({...this._def,maxLength:{value:e,message:A.toString(n)}})}length(e,n){return new t({...this._def,exactLength:{value:e,message:A.toString(n)}})}nonempty(e){return this.min(1,e)}};Ot.create=(t,e)=>new Ot({type:t,minLength:null,maxLength:null,exactLength:null,typeName:N.ZodArray,...V(e)});function $n(t){if(t instanceof We){let e={};for(let n in t.shape){let r=t.shape[n];e[n]=lt.create($n(r))}return new We({...t._def,shape:()=>e})}else return t instanceof Ot?new Ot({...t._def,type:$n(t.element)}):t instanceof lt?lt.create($n(t.unwrap())):t instanceof _t?_t.create($n(t.unwrap())):t instanceof Et?Et.create(t.items.map(e=>$n(e))):t}var We=class t extends q{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),n=Y.objectKeys(e);return this._cached={shape:e,keys:n},this._cached}_parse(e){if(this._getType(e)!==C.object){let m=this._getOrReturnCtx(e);return S(m,{code:T.invalid_type,expected:C.object,received:m.parsedType}),B}let{status:r,ctx:a}=this._processInputParams(e),{shape:i,keys:s}=this._getCached(),o=[];if(!(this._def.catchall instanceof bt&&this._def.unknownKeys==="strip"))for(let m in a.data)s.includes(m)||o.push(m);let d=[];for(let m of s){let f=i[m],k=a.data[m];d.push({key:{status:"valid",value:m},value:f._parse(new ct(a,k,a.path,m)),alwaysSet:m in a.data})}if(this._def.catchall instanceof bt){let m=this._def.unknownKeys;if(m==="passthrough")for(let f of o)d.push({key:{status:"valid",value:f},value:{status:"valid",value:a.data[f]}});else if(m==="strict")o.length>0&&(S(a,{code:T.unrecognized_keys,keys:o}),r.dirty());else if(m!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let m=this._def.catchall;for(let f of o){let k=a.data[f];d.push({key:{status:"valid",value:f},value:m._parse(new ct(a,k,a.path,f)),alwaysSet:f in a.data})}}return a.common.async?Promise.resolve().then(async()=>{let m=[];for(let f of d){let k=await f.key,L=await f.value;m.push({key:k,value:L,alwaysSet:f.alwaysSet})}return m}).then(m=>Me.mergeObjectSync(r,m)):Me.mergeObjectSync(r,d)}get shape(){return this._def.shape()}strict(e){return A.errToObj,new t({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(n,r)=>{let a=this._def.errorMap?.(n,r).message??r.defaultError;return n.code==="unrecognized_keys"?{message:A.errToObj(e).message??a}:{message:a}}}:{}})}strip(){return new t({...this._def,unknownKeys:"strip"})}passthrough(){return new t({...this._def,unknownKeys:"passthrough"})}extend(e){return new t({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new t({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:N.ZodObject})}setKey(e,n){return this.augment({[e]:n})}catchall(e){return new t({...this._def,catchall:e})}pick(e){let n={};for(let r of Y.objectKeys(e))e[r]&&this.shape[r]&&(n[r]=this.shape[r]);return new t({...this._def,shape:()=>n})}omit(e){let n={};for(let r of Y.objectKeys(this.shape))e[r]||(n[r]=this.shape[r]);return new t({...this._def,shape:()=>n})}deepPartial(){return $n(this)}partial(e){let n={};for(let r of Y.objectKeys(this.shape)){let a=this.shape[r];e&&!e[r]?n[r]=a:n[r]=a.optional()}return new t({...this._def,shape:()=>n})}required(e){let n={};for(let r of Y.objectKeys(this.shape))if(e&&!e[r])n[r]=this.shape[r];else{let i=this.shape[r];for(;i instanceof lt;)i=i._def.innerType;n[r]=i}return new t({...this._def,shape:()=>n})}keyof(){return Ia(Y.objectKeys(this.shape))}};We.create=(t,e)=>new We({shape:()=>t,unknownKeys:"strip",catchall:bt.create(),typeName:N.ZodObject,...V(e)});We.strictCreate=(t,e)=>new We({shape:()=>t,unknownKeys:"strict",catchall:bt.create(),typeName:N.ZodObject,...V(e)});We.lazycreate=(t,e)=>new We({shape:t,unknownKeys:"strip",catchall:bt.create(),typeName:N.ZodObject,...V(e)});var dn=class extends q{_parse(e){let{ctx:n}=this._processInputParams(e),r=this._def.options;function a(i){for(let o of i)if(o.result.status==="valid")return o.result;for(let o of i)if(o.result.status==="dirty")return n.common.issues.push(...o.ctx.common.issues),o.result;let s=i.map(o=>new Ze(o.ctx.common.issues));return S(n,{code:T.invalid_union,unionErrors:s}),B}if(n.common.async)return Promise.all(r.map(async i=>{let s={...n,common:{...n.common,issues:[]},parent:null};return{result:await i._parseAsync({data:n.data,path:n.path,parent:s}),ctx:s}})).then(a);{let i,s=[];for(let d of r){let m={...n,common:{...n.common,issues:[]},parent:null},f=d._parseSync({data:n.data,path:n.path,parent:m});if(f.status==="valid")return f;f.status==="dirty"&&!i&&(i={result:f,ctx:m}),m.common.issues.length&&s.push(m.common.issues)}if(i)return n.common.issues.push(...i.ctx.common.issues),i.result;let o=s.map(d=>new Ze(d));return S(n,{code:T.invalid_union,unionErrors:o}),B}}get options(){return this._def.options}};dn.create=(t,e)=>new dn({options:t,typeName:N.ZodUnion,...V(e)});var Rt=t=>t instanceof fn?Rt(t.schema):t instanceof ut?Rt(t.innerType()):t instanceof pn?[t.value]:t instanceof hn?t.options:t instanceof gn?Y.objectValues(t.enum):t instanceof yn?Rt(t._def.innerType):t instanceof cn?[void 0]:t instanceof un?[null]:t instanceof lt?[void 0,...Rt(t.unwrap())]:t instanceof _t?[null,...Rt(t.unwrap())]:t instanceof yr||t instanceof xn?Rt(t.unwrap()):t instanceof vn?Rt(t._def.innerType):[],ii=class t extends q{_parse(e){let{ctx:n}=this._processInputParams(e);if(n.parsedType!==C.object)return S(n,{code:T.invalid_type,expected:C.object,received:n.parsedType}),B;let r=this.discriminator,a=n.data[r],i=this.optionsMap.get(a);return i?n.common.async?i._parseAsync({data:n.data,path:n.path,parent:n}):i._parseSync({data:n.data,path:n.path,parent:n}):(S(n,{code:T.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),B)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,n,r){let a=new Map;for(let i of n){let s=Rt(i.shape[e]);if(!s.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let o of s){if(a.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);a.set(o,i)}}return new t({typeName:N.ZodDiscriminatedUnion,discriminator:e,options:n,optionsMap:a,...V(r)})}};function Di(t,e){let n=kt(t),r=kt(e);if(t===e)return{valid:!0,data:t};if(n===C.object&&r===C.object){let a=Y.objectKeys(e),i=Y.objectKeys(t).filter(o=>a.indexOf(o)!==-1),s={...t,...e};for(let o of i){let d=Di(t[o],e[o]);if(!d.valid)return{valid:!1};s[o]=d.data}return{valid:!0,data:s}}else if(n===C.array&&r===C.array){if(t.length!==e.length)return{valid:!1};let a=[];for(let i=0;i<t.length;i++){let s=t[i],o=e[i],d=Di(s,o);if(!d.valid)return{valid:!1};a.push(d.data)}return{valid:!0,data:a}}else return n===C.date&&r===C.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}var mn=class extends q{_parse(e){let{status:n,ctx:r}=this._processInputParams(e),a=(i,s)=>{if(ni(i)||ni(s))return B;let o=Di(i.value,s.value);return o.valid?((ri(i)||ri(s))&&n.dirty(),{status:n.value,value:o.data}):(S(r,{code:T.invalid_intersection_types}),B)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([i,s])=>a(i,s)):a(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}};mn.create=(t,e,n)=>new mn({left:t,right:e,typeName:N.ZodIntersection,...V(n)});var Et=class t extends q{_parse(e){let{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==C.array)return S(r,{code:T.invalid_type,expected:C.array,received:r.parsedType}),B;if(r.data.length<this._def.items.length)return S(r,{code:T.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),B;!this._def.rest&&r.data.length>this._def.items.length&&(S(r,{code:T.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),n.dirty());let i=[...r.data].map((s,o)=>{let d=this._def.items[o]||this._def.rest;return d?d._parse(new ct(r,s,r.path,o)):null}).filter(s=>!!s);return r.common.async?Promise.all(i).then(s=>Me.mergeArray(n,s)):Me.mergeArray(n,i)}get items(){return this._def.items}rest(e){return new t({...this._def,rest:e})}};Et.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Et({items:t,typeName:N.ZodTuple,rest:null,...V(e)})};var ai=class t extends q{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==C.object)return S(r,{code:T.invalid_type,expected:C.object,received:r.parsedType}),B;let a=[],i=this._def.keyType,s=this._def.valueType;for(let o in r.data)a.push({key:i._parse(new ct(r,o,r.path,o)),value:s._parse(new ct(r,r.data[o],r.path,o)),alwaysSet:o in r.data});return r.common.async?Me.mergeObjectAsync(n,a):Me.mergeObjectSync(n,a)}get element(){return this._def.valueType}static create(e,n,r){return n instanceof q?new t({keyType:e,valueType:n,typeName:N.ZodRecord,...V(r)}):new t({keyType:Ut.create(),valueType:e,typeName:N.ZodRecord,...V(n)})}},jn=class extends q{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==C.map)return S(r,{code:T.invalid_type,expected:C.map,received:r.parsedType}),B;let a=this._def.keyType,i=this._def.valueType,s=[...r.data.entries()].map(([o,d],m)=>({key:a._parse(new ct(r,o,r.path,[m,"key"])),value:i._parse(new ct(r,d,r.path,[m,"value"]))}));if(r.common.async){let o=new Map;return Promise.resolve().then(async()=>{for(let d of s){let m=await d.key,f=await d.value;if(m.status==="aborted"||f.status==="aborted")return B;(m.status==="dirty"||f.status==="dirty")&&n.dirty(),o.set(m.value,f.value)}return{status:n.value,value:o}})}else{let o=new Map;for(let d of s){let m=d.key,f=d.value;if(m.status==="aborted"||f.status==="aborted")return B;(m.status==="dirty"||f.status==="dirty")&&n.dirty(),o.set(m.value,f.value)}return{status:n.value,value:o}}}};jn.create=(t,e,n)=>new jn({valueType:e,keyType:t,typeName:N.ZodMap,...V(n)});var Un=class t extends q{_parse(e){let{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==C.set)return S(r,{code:T.invalid_type,expected:C.set,received:r.parsedType}),B;let a=this._def;a.minSize!==null&&r.data.size<a.minSize.value&&(S(r,{code:T.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),n.dirty()),a.maxSize!==null&&r.data.size>a.maxSize.value&&(S(r,{code:T.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),n.dirty());let i=this._def.valueType;function s(d){let m=new Set;for(let f of d){if(f.status==="aborted")return B;f.status==="dirty"&&n.dirty(),m.add(f.value)}return{status:n.value,value:m}}let o=[...r.data.values()].map((d,m)=>i._parse(new ct(r,d,r.path,m)));return r.common.async?Promise.all(o).then(d=>s(d)):s(o)}min(e,n){return new t({...this._def,minSize:{value:e,message:A.toString(n)}})}max(e,n){return new t({...this._def,maxSize:{value:e,message:A.toString(n)}})}size(e,n){return this.min(e,n).max(e,n)}nonempty(e){return this.min(1,e)}};Un.create=(t,e)=>new Un({valueType:t,minSize:null,maxSize:null,typeName:N.ZodSet,...V(e)});var oi=class t extends q{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:n}=this._processInputParams(e);if(n.parsedType!==C.function)return S(n,{code:T.invalid_type,expected:C.function,received:n.parsedType}),B;function r(o,d){return gr({data:o,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,Pn(),Dt].filter(m=>!!m),issueData:{code:T.invalid_arguments,argumentsError:d}})}function a(o,d){return gr({data:o,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,Pn(),Dt].filter(m=>!!m),issueData:{code:T.invalid_return_type,returnTypeError:d}})}let i={errorMap:n.common.contextualErrorMap},s=n.data;if(this._def.returns instanceof Gt){let o=this;return Pe(async function(...d){let m=new Ze([]),f=await o._def.args.parseAsync(d,i).catch(I=>{throw m.addIssue(r(d,I)),m}),k=await Reflect.apply(s,this,f);return await o._def.returns._def.type.parseAsync(k,i).catch(I=>{throw m.addIssue(a(k,I)),m})})}else{let o=this;return Pe(function(...d){let m=o._def.args.safeParse(d,i);if(!m.success)throw new Ze([r(d,m.error)]);let f=Reflect.apply(s,this,m.data),k=o._def.returns.safeParse(f,i);if(!k.success)throw new Ze([a(f,k.error)]);return k.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new t({...this._def,args:Et.create(e).rest(Bt.create())})}returns(e){return new t({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,n,r){return new t({args:e||Et.create([]).rest(Bt.create()),returns:n||Bt.create(),typeName:N.ZodFunction,...V(r)})}},fn=class extends q{get schema(){return this._def.getter()}_parse(e){let{ctx:n}=this._processInputParams(e);return this._def.getter()._parse({data:n.data,path:n.path,parent:n})}};fn.create=(t,e)=>new fn({getter:t,typeName:N.ZodLazy,...V(e)});var pn=class extends q{_parse(e){if(e.data!==this._def.value){let n=this._getOrReturnCtx(e);return S(n,{received:n.data,code:T.invalid_literal,expected:this._def.value}),B}return{status:"valid",value:e.data}}get value(){return this._def.value}};pn.create=(t,e)=>new pn({value:t,typeName:N.ZodLiteral,...V(e)});function Ia(t,e){return new hn({values:t,typeName:N.ZodEnum,...V(e)})}var hn=class t extends q{_parse(e){if(typeof e.data!="string"){let n=this._getOrReturnCtx(e),r=this._def.values;return S(n,{expected:Y.joinValues(r),received:n.parsedType,code:T.invalid_type}),B}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let n=this._getOrReturnCtx(e),r=this._def.values;return S(n,{received:n.data,code:T.invalid_enum_value,options:r}),B}return Pe(e.data)}get options(){return this._def.values}get enum(){let e={};for(let n of this._def.values)e[n]=n;return e}get Values(){let e={};for(let n of this._def.values)e[n]=n;return e}get Enum(){let e={};for(let n of this._def.values)e[n]=n;return e}extract(e,n=this._def){return t.create(e,{...this._def,...n})}exclude(e,n=this._def){return t.create(this.options.filter(r=>!e.includes(r)),{...this._def,...n})}};hn.create=Ia;var gn=class extends q{_parse(e){let n=Y.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==C.string&&r.parsedType!==C.number){let a=Y.objectValues(n);return S(r,{expected:Y.joinValues(a),received:r.parsedType,code:T.invalid_type}),B}if(this._cache||(this._cache=new Set(Y.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let a=Y.objectValues(n);return S(r,{received:r.data,code:T.invalid_enum_value,options:a}),B}return Pe(e.data)}get enum(){return this._def.values}};gn.create=(t,e)=>new gn({values:t,typeName:N.ZodNativeEnum,...V(e)});var Gt=class extends q{unwrap(){return this._def.type}_parse(e){let{ctx:n}=this._processInputParams(e);if(n.parsedType!==C.promise&&n.common.async===!1)return S(n,{code:T.invalid_type,expected:C.promise,received:n.parsedType}),B;let r=n.parsedType===C.promise?n.data:Promise.resolve(n.data);return Pe(r.then(a=>this._def.type.parseAsync(a,{path:n.path,errorMap:n.common.contextualErrorMap})))}};Gt.create=(t,e)=>new Gt({type:t,typeName:N.ZodPromise,...V(e)});var ut=class extends q{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===N.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:n,ctx:r}=this._processInputParams(e),a=this._def.effect||null,i={addIssue:s=>{S(r,s),s.fatal?n.abort():n.dirty()},get path(){return r.path}};if(i.addIssue=i.addIssue.bind(i),a.type==="preprocess"){let s=a.transform(r.data,i);if(r.common.async)return Promise.resolve(s).then(async o=>{if(n.value==="aborted")return B;let d=await this._def.schema._parseAsync({data:o,path:r.path,parent:r});return d.status==="aborted"?B:d.status==="dirty"?rn(d.value):n.value==="dirty"?rn(d.value):d});{if(n.value==="aborted")return B;let o=this._def.schema._parseSync({data:s,path:r.path,parent:r});return o.status==="aborted"?B:o.status==="dirty"?rn(o.value):n.value==="dirty"?rn(o.value):o}}if(a.type==="refinement"){let s=o=>{let d=a.refinement(o,i);if(r.common.async)return Promise.resolve(d);if(d instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(r.common.async===!1){let o=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return o.status==="aborted"?B:(o.status==="dirty"&&n.dirty(),s(o.value),{status:n.value,value:o.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(o=>o.status==="aborted"?B:(o.status==="dirty"&&n.dirty(),s(o.value).then(()=>({status:n.value,value:o.value}))))}if(a.type==="transform")if(r.common.async===!1){let s=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!jt(s))return B;let o=a.transform(s.value,i);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:n.value,value:o}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(s=>jt(s)?Promise.resolve(a.transform(s.value,i)).then(o=>({status:n.value,value:o})):B);Y.assertNever(a)}};ut.create=(t,e,n)=>new ut({schema:t,typeName:N.ZodEffects,effect:e,...V(n)});ut.createWithPreprocess=(t,e,n)=>new ut({schema:e,effect:{type:"preprocess",transform:t},typeName:N.ZodEffects,...V(n)});var lt=class extends q{_parse(e){return this._getType(e)===C.undefined?Pe(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};lt.create=(t,e)=>new lt({innerType:t,typeName:N.ZodOptional,...V(e)});var _t=class extends q{_parse(e){return this._getType(e)===C.null?Pe(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};_t.create=(t,e)=>new _t({innerType:t,typeName:N.ZodNullable,...V(e)});var yn=class extends q{_parse(e){let{ctx:n}=this._processInputParams(e),r=n.data;return n.parsedType===C.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:n.path,parent:n})}removeDefault(){return this._def.innerType}};yn.create=(t,e)=>new yn({innerType:t,typeName:N.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...V(e)});var vn=class extends q{_parse(e){let{ctx:n}=this._processInputParams(e),r={...n,common:{...n.common,issues:[]}},a=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return zn(a)?a.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new Ze(r.common.issues)},input:r.data})})):{status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new Ze(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}};vn.create=(t,e)=>new vn({innerType:t,typeName:N.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...V(e)});var Vn=class extends q{_parse(e){if(this._getType(e)!==C.nan){let r=this._getOrReturnCtx(e);return S(r,{code:T.invalid_type,expected:C.nan,received:r.parsedType}),B}return{status:"valid",value:e.data}}};Vn.create=t=>new Vn({typeName:N.ZodNaN,...V(t)});var bs=Symbol("zod_brand"),yr=class extends q{_parse(e){let{ctx:n}=this._processInputParams(e),r=n.data;return this._def.type._parse({data:r,path:n.path,parent:n})}unwrap(){return this._def.type}},vr=class t extends q{_parse(e){let{status:n,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{let i=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return i.status==="aborted"?B:i.status==="dirty"?(n.dirty(),rn(i.value)):this._def.out._parseAsync({data:i.value,path:r.path,parent:r})})();{let a=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return a.status==="aborted"?B:a.status==="dirty"?(n.dirty(),{status:"dirty",value:a.value}):this._def.out._parseSync({data:a.value,path:r.path,parent:r})}}static create(e,n){return new t({in:e,out:n,typeName:N.ZodPipeline})}},xn=class extends q{_parse(e){let n=this._def.innerType._parse(e),r=a=>(jt(a)&&(a.value=Object.freeze(a.value)),a);return zn(n)?n.then(a=>r(a)):r(n)}unwrap(){return this._def.innerType}};xn.create=(t,e)=>new xn({innerType:t,typeName:N.ZodReadonly,...V(e)});function _a(t,e){let n=typeof t=="function"?t(e):typeof t=="string"?{message:t}:t;return typeof n=="string"?{message:n}:n}function Aa(t,e={},n){return t?Vt.create().superRefine((r,a)=>{let i=t(r);if(i instanceof Promise)return i.then(s=>{if(!s){let o=_a(e,r),d=o.fatal??n??!0;a.addIssue({code:"custom",...o,fatal:d})}});if(!i){let s=_a(e,r),o=s.fatal??n??!0;a.addIssue({code:"custom",...s,fatal:o})}}):Vt.create()}var ws={object:We.lazycreate},N;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(N||(N={}));var Ts=(t,e={message:`Input not instance of ${t.name}`})=>Aa(n=>n instanceof t,e),Ma=Ut.create,Da=an.create,ks=Vn.create,Es=on.create,Ra=sn.create,_s=ln.create,Ss=Hn.create,Ls=cn.create,Cs=un.create,Is=Vt.create,As=Bt.create,Ms=bt.create,Ds=Fn.create,Rs=Ot.create,Bs=We.create,Os=We.strictCreate,Ns=dn.create,Ps=ii.create,zs=mn.create,$s=Et.create,Hs=ai.create,Fs=jn.create,js=Un.create,Us=oi.create,Vs=fn.create,Gs=pn.create,qs=hn.create,Zs=gn.create,Ws=Gt.create,Ys=ut.create,Ks=lt.create,Js=_t.create,Xs=ut.createWithPreprocess,Qs=vr.create,el=()=>Ma().optional(),tl=()=>Da().optional(),nl=()=>Ra().optional(),rl={string:(t=>Ut.create({...t,coerce:!0})),number:(t=>an.create({...t,coerce:!0})),boolean:(t=>sn.create({...t,coerce:!0})),bigint:(t=>on.create({...t,coerce:!0})),date:(t=>ln.create({...t,coerce:!0}))};var il=B;function c(t,...e){let n="debug",r=[...e];e.length>0&&typeof e[e.length-1]=="string"&&["debug","info","warn","error"].includes(e[e.length-1])&&(n=r.pop());let i=`[Timekeeper v${GM_info.script.version}]`;({debug:console.log,info:console.info,warn:console.warn,error:console.error})[n](`${i} ${t}`,...r)}function Nt(t,e=t){let n=Math.floor(t/3600),r=Math.floor(t%3600/60),a=String(t%60).padStart(2,"0");return e<3600?`${r<10?r:String(r).padStart(2,"0")}:${a}`:`${e>=36e3?String(n).padStart(2,"0"):n}:${String(r).padStart(2,"0")}:${a}`}function xr(t,e=window.location.href){try{let n=new URL(e);return n.searchParams.set("t",`${t}s`),n.toString()}catch{return`https://www.youtube.com/watch?v=${e.search(/[?&]v=/)>=0?e.split(/[?&]v=/)[1].split(/&/)[0]:e.split(/\/live\/|\/shorts\/|\?|&/)[1]}&t=${t}s`}}function Gn(){let t=new Date;return t.getUTCFullYear()+"-"+String(t.getUTCMonth()+1).padStart(2,"0")+"-"+String(t.getUTCDate()).padStart(2,"0")+"--"+String(t.getUTCHours()).padStart(2,"0")+"-"+String(t.getUTCMinutes()).padStart(2,"0")+"-"+String(t.getUTCSeconds()).padStart(2,"0")}var al=[{emoji:"\u{1F942}",month:1,day:1,name:"New Year's Day"},{emoji:"\u{1F49D}",month:2,day:14,name:"Valentine's Day"},{emoji:"\u{1F986}",month:5,day:25,name:"Kanna's Debut Anniversary"},{emoji:"\u{1F383}",month:10,day:31,name:"Halloween"},{emoji:"\u{1F382}",month:9,day:15,name:"Kanna's Birthday"},{emoji:"\u{1F332}",month:12,day:25,name:"Christmas"}];function Ba(){let t=new Date,e=t.getFullYear(),n=t.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});for(let r of al){let a=new Date(e,r.month-1,r.day),i=a.getTime()-t.getTime(),s=i/(1e3*60*60*24);if(s<=5&&s>=-2)return c(`Current date: ${n}, Selected emoji: ${r.emoji} (${r.name}), Days until holiday: ${Math.ceil(s)}`),r.emoji;if(s<-2&&(a=new Date(e+1,r.month-1,r.day),i=a.getTime()-t.getTime(),s=i/(1e3*60*60*24),s<=5&&s>=-2))return c(`Current date: ${n}, Selected emoji: ${r.emoji} (${r.name}), Days until holiday: ${Math.ceil(s)}`),r.emoji;if(s>5&&(a=new Date(e-1,r.month-1,r.day),i=a.getTime()-t.getTime(),s=i/(1e3*60*60*24),s<=5&&s>=-2))return c(`Current date: ${n}, Selected emoji: ${r.emoji} (${r.name}), Days until holiday: ${Math.ceil(s)}`),r.emoji}return c(`Current date: ${n}, No holiday emoji (not within range)`),null}var dt=null,qn=null,ol=500,bn=null,br=!1,qt=null;function sl(){return(!dt||!document.body.contains(dt))&&(dt=document.createElement("div"),dt.className="ytls-tooltip",dt.style.pointerEvents="none",document.body.appendChild(dt),window.addEventListener("scroll",Oa,!0),window.addEventListener("resize",Oa,!0)),dt}function ll(t,e,n){let a=window.innerWidth,i=window.innerHeight,s=t.getBoundingClientRect(),o=s.width,d=s.height,m=e+10,f=n+10;m+o>a-10&&(m=e-o-10),f+d>i-10&&(f=n-d-10),m=Math.max(10,Math.min(m,a-o-10)),f=Math.max(10,Math.min(f,i-d-10)),t.style.left=`${m}px`,t.style.top=`${f}px`}function Na(t,e){let r=window.innerWidth,a=window.innerHeight,i=e.getBoundingClientRect(),s=t.getBoundingClientRect(),o=s.width,d=s.height,m=Math.round(i.right+8),f=Math.round(i.top);m+o>r-8&&(m=Math.round(i.left-o-8)),m=Math.max(8,Math.min(m,r-o-8)),f+d>a-8&&(f=Math.round(i.bottom-d)),f=Math.max(8,Math.min(f,a-d-8)),t.style.left=`${m}px`,t.style.top=`${f}px`}function Oa(){if(!(!dt||!bn)&&dt.classList.contains("ytls-tooltip-visible"))try{Na(dt,bn)}catch{}}function cl(t=50){qt&&(clearTimeout(qt),qt=null),!br&&(qt=setTimeout(()=>{Ri(),qt=null},t))}function ul(t,e,n,r){qn&&clearTimeout(qn),r&&(bn=r,br=!0),qn=setTimeout(()=>{let a=sl();a.textContent=t,a.classList.remove("ytls-tooltip-visible"),r?requestAnimationFrame(()=>{Na(a,r),requestAnimationFrame(()=>{a.classList.add("ytls-tooltip-visible")})}):(ll(a,e,n),requestAnimationFrame(()=>{a.classList.add("ytls-tooltip-visible")}))},ol)}function Ri(){qn&&(clearTimeout(qn),qn=null),qt&&(clearTimeout(qt),qt=null),dt&&dt.classList.remove("ytls-tooltip-visible"),bn=null,br=!1}function wt(t,e){let n=0,r=0,a=d=>{n=d.clientX,r=d.clientY,br=!0,bn=t;let m=typeof e=="function"?e():e;m&&ul(m,n,r,t)},i=d=>{n=d.clientX,r=d.clientY},s=()=>{br=!1,cl()};t.addEventListener("mouseenter",a),t.addEventListener("mousemove",i),t.addEventListener("mouseleave",s);let o=new MutationObserver(()=>{try{if(!document.body.contains(t))bn===t&&Ri();else{let d=window.getComputedStyle(t);(d.display==="none"||d.visibility==="hidden"||d.opacity==="0")&&bn===t&&Ri()}}catch{}});try{o.observe(t,{attributes:!0,attributeFilter:["class","style"]}),o.observe(document.body,{childList:!0,subtree:!0})}catch{}t.__tooltipCleanup=()=>{t.removeEventListener("mouseenter",a),t.removeEventListener("mousemove",i),t.removeEventListener("mouseleave",s);try{o.disconnect()}catch{}delete t.__tooltipObserver},t.__tooltipObserver=o}var zi={};Ta(zi,{DB_NAME:()=>$a,DB_VERSION:()=>Ha,SETTINGS_STORE_NAME:()=>Tr,STORE_NAME:()=>wn,STORE_NAME_V2:()=>Ye,buildExportCsvPayload:()=>ja,buildExportPayload:()=>Fa,deleteSingleTimestampFromIndexedDB:()=>yl,executeTransaction:()=>li,exportAllTimestamps:()=>Tl,exportAllTimestampsCsv:()=>kl,getAllFromIndexedDB:()=>Pi,getDB:()=>Tn,loadFromIndexedDB:()=>vl,loadGlobalSettings:()=>wl,removeFromIndexedDB:()=>xl,saveGlobalSettings:()=>bl,saveSingleTimestampToIndexedDB:()=>gl,saveToIndexedDB:()=>hl});var dl=M.preprocess(t=>typeof t=="string"&&t.trim().length>0?t:crypto.randomUUID(),M.string()),Zn=M.object({guid:dl,start:M.number().finite().nonnegative(),comment:M.string()}),wr=Zn.array(),Bi=Zn.extend({video_id:M.string()}),za=M.object({x:M.number().finite(),y:M.number().finite(),width:M.number().finite().positive().optional(),height:M.number().finite().positive().optional()}),si=M.object({video_id:M.string(),timestamps:wr}),Rc=M.record(si),Pa=M.object({isSignedIn:M.boolean().catch(!1),accessToken:M.string().nullable().catch(null),userName:M.string().nullable().catch(null),email:M.string().nullable().catch(null)}),Oi=M.union([Pa,M.string().transform((t,e)=>{try{let n=JSON.parse(t);return Pa.parse(n)}catch{return e.addIssue({code:M.ZodIssueCode.custom,message:"Invalid JSON string for auth state"}),M.NEVER}})]).catch({isSignedIn:!1,accessToken:null,userName:null,email:null}),Ni=M.object({autoBackupEnabled:M.boolean(),autoBackupIntervalMinutes:M.number().positive(),lastAutoBackupAt:M.number().int().positive().nullable().optional()}),ml=M.object({type:M.literal("timekeeper_oauth_token"),token:M.string().min(1),timestamp:M.number().optional()}),fl=M.object({type:M.literal("timekeeper_oauth_error"),error:M.string(),timestamp:M.number().optional()}),Bc=M.union([ml,fl]),Oc=M.object({name:M.string().optional(),email:M.string().email().optional(),id:M.string().optional(),picture:M.string().url().optional()});var $a="ytls-timestamps-db",Ha=3,wn="timestamps",Ye="timestamps_v2",Tr="settings",Wn=null,Yn=null;function Tn(){if(Wn)try{if(Wn.objectStoreNames.length>=0)return Promise.resolve(Wn)}catch(t){c("IndexedDB connection is no longer usable:",t,"warn"),Wn=null}return Yn||(Yn=pl().then(t=>(Wn=t,Yn=null,t.onclose=()=>{c("IndexedDB connection closed unexpectedly","warn"),Wn=null},t.onerror=e=>{c("IndexedDB connection error:",e,"error")},t)).catch(t=>{throw Yn=null,t}),Yn)}function pl(){return new Promise((t,e)=>{let n=indexedDB.open($a,Ha);n.onupgradeneeded=r=>{let a=r.target.result,i=r.oldVersion,s=r.target.transaction;if(i<1&&a.createObjectStore(wn,{keyPath:"video_id"}),i<2&&!a.objectStoreNames.contains(Tr)&&a.createObjectStore(Tr,{keyPath:"key"}),i<3){if(a.objectStoreNames.contains(wn)){c("Exporting backup before v2 migration...");let m=s.objectStore(wn).getAll();m.onsuccess=()=>{let f=si.array().safeParse(m.result);if(f.success&&f.data.length>0)try{let k={},L=0;f.data.forEach(re=>{if(re.timestamps.length>0){let me=wr.parse(re.timestamps);k[`ytls-${re.video_id}`]={video_id:re.video_id,timestamps:[...me].sort((ue,J)=>ue.start-J.start)},L+=me.length}});let I=new Blob([JSON.stringify(k,null,2)],{type:"application/json"}),G=URL.createObjectURL(I),K=document.createElement("a");K.href=G,K.download=`timekeeper-data-${Gn()}.json`,K.click(),URL.revokeObjectURL(G),c(`Pre-migration backup exported: ${f.data.length} videos, ${L} timestamps`)}catch(k){c("Failed to export pre-migration backup:",k,"error")}else f.success||c("Skipping pre-migration backup: legacy data failed validation",f.error.format(),"warn")}}let o=a.createObjectStore(Ye,{keyPath:"guid"});if(o.createIndex("video_id","video_id",{unique:!1}),o.createIndex("video_start",["video_id","start"],{unique:!1}),a.objectStoreNames.contains(wn)){let m=s.objectStore(wn).getAll();m.onsuccess=()=>{let f=si.array().safeParse(m.result);if(f.success&&f.data.length>0){let k=0;f.data.forEach(L=>{L.timestamps.length>0&&L.timestamps.forEach(I=>{o.put({guid:I.guid,video_id:L.video_id,start:I.start,comment:I.comment}),k++})}),c(`Migrated ${k} timestamps from ${f.data.length} videos to v2 store`)}else f.success||c("Skipping v1 \u2192 v2 migration: legacy data failed validation",f.error.format(),"warn")},a.deleteObjectStore(wn),c("Deleted old timestamps store after migration to v2")}}},n.onsuccess=r=>{t(r.target.result)},n.onerror=r=>{let a=r.target.error;e(a??new Error("Failed to open IndexedDB"))}})}function li(t,e,n){return Tn().then(r=>new Promise((a,i)=>{let s;try{s=r.transaction(t,e)}catch(m){i(new Error(`Failed to create transaction for ${t}: ${m}`));return}let o=s.objectStore(t),d;try{d=n(o)}catch(m){i(new Error(`Failed to execute operation on ${t}: ${m}`));return}d&&(d.onsuccess=()=>a(d.result),d.onerror=()=>i(d.error??new Error(`IndexedDB ${e} operation failed`))),s.oncomplete=()=>{d||a(void 0)},s.onerror=()=>i(s.error??new Error("IndexedDB transaction failed")),s.onabort=()=>i(s.error??new Error("IndexedDB transaction aborted"))}))}function hl(t,e){let n=wr.safeParse(e);if(!n.success)return Promise.reject(new Error(`Invalid timestamp payload for ${t}`));let r=n.data;return Tn().then(a=>new Promise((i,s)=>{let o;try{o=a.transaction([Ye],"readwrite")}catch(k){s(new Error(`Failed to create transaction: ${k}`));return}let d=o.objectStore(Ye),f=d.index("video_id").getAll(IDBKeyRange.only(t));f.onsuccess=()=>{try{let k=f.result,L=new Set(r.map(I=>I.guid));k.forEach(I=>{L.has(I.guid)||d.delete(I.guid)}),r.forEach(I=>{d.put({guid:I.guid,video_id:t,start:I.start,comment:I.comment})})}catch(k){c("Error during save operation:",k,"error")}},f.onerror=()=>{s(f.error??new Error("Failed to get existing records"))},o.oncomplete=()=>i(),o.onerror=()=>s(o.error??new Error("Failed to save to IndexedDB")),o.onabort=()=>s(o.error??new Error("Transaction aborted during save"))}))}function gl(t,e){let n=Zn.safeParse(e);if(!n.success)return Promise.reject(new Error(`Invalid timestamp: ${n.error.message}`));let r=n.data;return Tn().then(a=>new Promise((i,s)=>{let o;try{o=a.transaction([Ye],"readwrite")}catch(f){s(new Error(`Failed to create transaction: ${f}`));return}let m=o.objectStore(Ye).put({guid:r.guid,video_id:t,start:r.start,comment:r.comment});m.onerror=()=>{s(m.error??new Error("Failed to put timestamp"))},o.oncomplete=()=>i(),o.onerror=()=>s(o.error??new Error("Failed to save single timestamp to IndexedDB")),o.onabort=()=>s(o.error??new Error("Transaction aborted during single timestamp save"))}))}function yl(t,e){return c(`Deleting timestamp ${e} for video ${t}`),Tn().then(n=>new Promise((r,a)=>{let i;try{i=n.transaction([Ye],"readwrite")}catch(d){a(new Error(`Failed to create transaction: ${d}`));return}let o=i.objectStore(Ye).delete(e);o.onerror=()=>{a(o.error??new Error("Failed to delete timestamp"))},i.oncomplete=()=>r(),i.onerror=()=>a(i.error??new Error("Failed to delete single timestamp from IndexedDB")),i.onabort=()=>a(i.error??new Error("Transaction aborted during timestamp deletion"))}))}function vl(t){return Tn().then(e=>new Promise(n=>{let r;try{r=e.transaction([Ye],"readonly")}catch(o){c("Failed to create read transaction:",o,"warn"),n(null);return}let s=r.objectStore(Ye).index("video_id").getAll(IDBKeyRange.only(t));s.onsuccess=()=>{let o=s.result;if(o.length===0){n(null);return}let d=o.map(k=>({guid:k.guid,start:k.start,comment:k.comment})),m=wr.safeParse(d);if(!m.success){c("Failed to parse timestamps from IndexedDB:",m.error.format(),"warn"),n(null);return}let f=[...m.data].sort((k,L)=>k.start-L.start);n(f)},s.onerror=()=>{c("Failed to load timestamps:",s.error,"warn"),n(null)},r.onabort=()=>{c("Transaction aborted during load:",r.error,"warn"),n(null)}}))}function xl(t){return Tn().then(e=>new Promise((n,r)=>{let a;try{a=e.transaction([Ye],"readwrite")}catch(d){r(new Error(`Failed to create transaction: ${d}`));return}let i=a.objectStore(Ye),o=i.index("video_id").getAll(IDBKeyRange.only(t));o.onsuccess=()=>{try{o.result.forEach(m=>{i.delete(m.guid)})}catch(d){c("Error during remove operation:",d,"error")}},o.onerror=()=>{r(o.error??new Error("Failed to get records for removal"))},a.oncomplete=()=>n(),a.onerror=()=>r(a.error??new Error("Failed to remove timestamps")),a.onabort=()=>r(a.error??new Error("Transaction aborted during timestamp removal"))}))}function Pi(t){return li(t,"readonly",e=>e.getAll()).then(e=>Array.isArray(e)?e:[])}function bl(t,e){li(Tr,"readwrite",n=>{n.put({key:t,value:e})}).catch(n=>{c(`Failed to save setting '${t}' to IndexedDB:`,n,"error")})}function wl(t){return li(Tr,"readonly",e=>e.get(t)).then(e=>e?.value).catch(e=>{c(`Failed to load setting '${t}' from IndexedDB:`,e,"error")})}async function Fa(){let t={},e=await Pi(Ye),n=Bi.array().safeParse(e);if(!n.success)return c("Failed to parse timestamp rows for export:",n.error.format(),"warn"),{json:"{}",filename:"timekeeper-data.json",totalVideos:0,totalTimestamps:0};let r=new Map;for(let s of n.data)r.has(s.video_id)||r.set(s.video_id,[]),r.get(s.video_id).push({guid:s.guid,start:s.start,comment:s.comment});for(let[s,o]of r)t[`ytls-${s}`]={video_id:s,timestamps:o.sort((d,m)=>d.start-m.start)};return{json:JSON.stringify(t,null,2),filename:"timekeeper-data.json",totalVideos:r.size,totalTimestamps:n.data.length}}async function Tl(){try{let{json:t,filename:e,totalVideos:n,totalTimestamps:r}=await Fa(),a=new Blob([t],{type:"application/json"}),i=URL.createObjectURL(a),s=document.createElement("a");s.href=i,s.download=e,s.click(),URL.revokeObjectURL(i),c(`Exported ${n} videos with ${r} timestamps`)}catch(t){throw c("Failed to export data:",t,"error"),t}}async function ja(){let t=Bi.array().safeParse(await Pi(Ye));if(!t.success||t.data.length===0){t.success||c("Failed to parse timestamp rows for CSV export:",t.error.format(),"warn");let f=`Tag,Timestamp,URL
`,k=`timestamps-${Gn()}.csv`;return{csv:f,filename:k,totalVideos:0,totalTimestamps:0}}let e=t.data,n=new Map;for(let f of e)n.has(f.video_id)||n.set(f.video_id,[]),n.get(f.video_id).push({start:f.start,comment:f.comment});let r=[];r.push("Tag,Timestamp,URL");let a=0,i=f=>`"${String(f).replace(/"/g,'""')}"`,s=f=>{let k=Math.floor(f/3600),L=Math.floor(f%3600/60),I=String(f%60).padStart(2,"0");return`${String(k).padStart(2,"0")}:${String(L).padStart(2,"0")}:${I}`},o=Array.from(n.keys()).sort();for(let f of o){let k=n.get(f).sort((L,I)=>L.start-I.start);for(let L of k){let I=L.comment,G=s(L.start),K=xr(L.start,`https://www.youtube.com/watch?v=${f}`);r.push([i(I),i(G),i(K)].join(",")),a++}}let d=r.join(`
`),m=`timestamps-${Gn()}.csv`;return{csv:d,filename:m,totalVideos:n.size,totalTimestamps:a}}async function kl(){try{let{csv:t,filename:e,totalVideos:n,totalTimestamps:r}=await ja(),a=new Blob([t],{type:"text/csv;charset=utf-8;"}),i=URL.createObjectURL(a),s=document.createElement("a");s.href=i,s.download=e,s.click(),URL.revokeObjectURL(i),c(`Exported ${n} videos with ${r} timestamps (CSV)`)}catch(t){throw c("Failed to export CSV data:",t,"error"),t}}function ci(t){return t?Array.from(t.querySelectorAll("li:not(.ytls-placeholder):not(.ytls-error-message)")):[]}function $i(t){if(t)for(;t.firstChild;)t.removeChild(t.firstChild)}function Hi(t,e){if(!t)return;$i(t);let n=document.createElement("li");n.className="ytls-placeholder",n.textContent=e,t.appendChild(n),t.style.overflowY="hidden"}function Ua(t){if(!t)return;let e=t.querySelector(".ytls-placeholder");e&&e.remove(),t.style.overflowY=""}function Va(t,e){if(!t||e)return;Array.from(t.children).some(r=>!r.classList.contains("ytls-placeholder")&&!r.classList.contains("ytls-error-message"))||Hi(t,"No timestamps for this video")}function Ga(t){if(!t)return[];let e=ci(t),n=[];return e.forEach(r=>{let a=r.querySelector("a[data-time]"),i=r.querySelector("input"),s=r.dataset.guid;if(!a||!i||!s)return;let o=a.dataset.time;if(!o)return;let d=Number.parseInt(o,10);Number.isFinite(d)&&n.push({guid:s,start:d,comment:i.value})}),n.sort((r,a)=>r.start-a.start)}function qa(t){if(!t)return 0;let e=ci(t),n=0;return e.forEach(r=>{let i=r.querySelector("a[data-time]")?.dataset.time;if(i){let s=Number.parseInt(i,10);Number.isFinite(s)&&(n=Math.max(n,s))}}),n}var Fi="#ytls-pane{background:rgba(19,19,19,.8);text-align:left;position:fixed;bottom:0;right:0;padding:0;margin:0;border-radius:12px;border:1px solid rgba(85,85,85,.8);opacity:.9;z-index:5000;font-family:Arial,sans-serif;width:300px;height:90vh;min-width:300px;max-width:800px;min-height:400px;max-height:90vh;user-select:none;display:flex;flex-direction:column;will-change:width,height;transform:translateZ(0);backface-visibility:hidden;contain:layout style paint;overflow:hidden}#ytls-pane:hover{opacity:1}#ytls-resize-handle{position:absolute;bottom:0;right:0;width:20px;height:20px;cursor:auto;z-index:10;pointer-events:none;background:0 0;margin:0;padding:0}#ytls-resize-handle::before{display:none;content:none}#ytls-resize-bl,#ytls-resize-br,#ytls-resize-tl,#ytls-resize-tr{position:absolute;width:16px;height:16px;z-index:11;background:0 0;pointer-events:auto}#ytls-resize-tl{top:0;left:0;cursor:nwse-resize}#ytls-resize-tr{top:0;right:0;cursor:nesw-resize}#ytls-resize-bl{bottom:0;left:0;cursor:nesw-resize}#ytls-resize-br{bottom:0;right:0;cursor:nwse-resize}#ytls-content{display:flex;flex-direction:column;width:100%;height:100%;min-height:0;box-sizing:border-box;position:relative}#ytls-content ul{flex:1 1 auto;overflow-y:auto;margin:0!important;padding:0!important;border:none!important;box-sizing:border-box;width:100%;max-width:100%;min-height:0;z-index:1}#ytls-content ul li.ytls-placeholder{display:flex;align-items:center;justify-content:center;height:100%;width:100%;color:#bfbfbf;font-size:14px;font-style:italic;padding:12px;text-align:center;box-sizing:border-box}#ytls-pane-header{position:relative;z-index:2}#ytls-buttons{position:relative;z-index:2;flex-shrink:0;display:flex;gap:8px;justify-content:flex-end;padding:10px 18px 10px 16px;background:linear-gradient(0deg,#23272b 0,#212121 100%);border-radius:0 0 12px 12px;border-top:1px solid #23272b;margin-top:auto}#ytls-pane li{display:flex;flex-direction:column;padding:8px 12px;margin:0!important;border:none;border-top:1px solid rgba(85,85,85,.8);user-select:none;box-sizing:border-box;width:100%;max-width:100%}#ytls-pane li:first-child{border-top:none}#ytls-pane li.ytls-timestamp-highlight{background:#1f251d}#ytls-pane li.ytls-timestamp-pending-delete{background:rgba(128,0,0,.8)}#ytls-pane .time-row{display:flex;gap:5px;align-items:center}#ytls-pane .time-row a{flex-grow:1;max-width:100%;text-align:left;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}#ytls-pane .ytls-marker{position:absolute;height:100%;width:2px;background-color:red;cursor:pointer}#ytls-pane a,#ytls-pane input,#ytls-pane span{background:0 0;color:#fff;font-family:inherit;font-size:14px;text-decoration:none;border:none;outline:0}#ytls-pane input,#ytls-pane textarea{-webkit-user-select:text;-moz-user-select:text;-ms-user-select:text;user-select:text;caret-color:white}#ytls-buttons{flex-shrink:0;display:flex;gap:5px;justify-content:space-between;padding:8px 12px;background:#212121;border-radius:0 0 12px 12px;border-top:1px solid rgba(85,85,85,.8);z-index:2}#ytls-buttons button:hover{background:rgba(255,255,255,.2)}.ytls-main-button{background:#272727;color:#fff;font-size:24px;border:none;border-radius:5px;padding:5px;cursor:pointer;position:relative}.ytls-main-button:hover{background:#3f3f3f}.ytls-holiday-emoji{position:absolute;bottom:0;right:0;font-size:.25em;pointer-events:none}#ytls-pane-header{display:flex;justify-content:space-between;align-items:center;padding:10px 18px 10px 16px;white-space:nowrap;cursor:default;border-radius:12px 12px 0 0;border:none;background:linear-gradient(180deg,#23272b 0,#212121 100%);box-shadow:0 1px 0 0 #23272b;flex-shrink:0;color:#fafafa}#ytls-pane .ytls-version-display{font-size:14px;color:#666;margin-left:auto;padding-right:5px;cursor:default}#ytls-pane .ytls-google-user-display{font-size:12px;color:#4285f4;margin-left:8px;padding:2px 6px;cursor:default;background:rgba(66,133,244,.1);border-radius:4px}#ytls-pane .ytls-backup-status-display{font-size:12px;color:#9acd32;margin-left:8px;padding:2px 6px;cursor:default;background:rgba(154,205,50,.12);border-radius:4px}#ytls-current-time{color:#fff;font-size:14px;cursor:pointer;position:relative}.ytls-backup-indicator{display:inline-block;width:8px;height:8px;border-radius:50%;background-color:#666;cursor:help;flex-shrink:0}#ytls-settings-modal{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#1a1a1a;padding:8px;border-radius:10px;z-index:10000;color:#fff;text-align:center;width:200px;box-shadow:0 0 10px rgba(0,0,0,.5)}#ytls-delete-all-modal,#ytls-load-modal,#ytls-save-modal{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#333;padding:8px;border-radius:10px;z-index:10000;color:#fff;text-align:center;width:fit-content;max-width:90vw;box-shadow:0 0 10px rgba(0,0,0,.5)}.ytls-modal-header{display:flex;align-items:flex-end;margin-bottom:0;gap:10px}.ytls-modal-close-button{position:absolute;top:8px;right:8px;width:16px;height:16px;background:#f44;color:#fff;border:none;border-radius:3px;font-size:14px;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;line-height:1;padding:0;flex-shrink:0;z-index:1}.ytls-modal-close-button:hover{background:#f66}#ytls-settings-content{display:flex;flex-direction:column;gap:10px;align-items:center;background:#2a2a2a;border:2px solid #3a3a3a;border-radius:0 4px 4px 4px;padding:10px;margin-top:-2px;position:relative;z-index:1}.ytls-section-heading{margin:0 0 10px 0;padding:0;font-size:16px;font-weight:700;color:#fff;text-align:center}#ytls-settings-nav{display:flex;gap:6px;flex:0}#ytls-settings-nav .ytls-settings-modal-button{flex:0;width:auto;height:24px;margin-bottom:0;background:#2a2a2a;font-size:13px;padding:0 8px;display:flex;align-items:center;justify-content:center;line-height:1;border:2px solid transparent;border-radius:4px 4px 0 0;border-bottom:2px solid transparent;white-space:nowrap;position:relative}#ytls-settings-nav .ytls-settings-modal-button .ytls-tab-text{display:none}#ytls-settings-nav .ytls-settings-modal-button.active .ytls-tab-text{display:inline}#ytls-settings-nav .ytls-settings-modal-button:hover{background:#3a3a3a}#ytls-settings-nav .ytls-settings-modal-button.active{background:#2a2a2a;border:2px solid #3a3a3a;border-bottom:2px solid #2a2a2a;z-index:2}.ytls-button-grid{display:grid;grid-template-columns:1fr;gap:5px;width:100%}.ytls-settings-modal-button{width:100%;height:32px;background:#555;color:#fff;border:none;border-radius:5px;cursor:pointer;font-size:13px;display:flex;justify-content:center;align-items:center;margin-bottom:5px;padding:0 8px}.ytls-settings-modal-button:hover{background:#777}#ytls-delete-all-modal p,#ytls-load-modal p,#ytls-save-modal p{margin-bottom:15px;font-size:16px}.ytls-save-modal-button{background:#555;color:#fff;padding:10px 20px;border:none;border-radius:5px;cursor:pointer;margin-right:10px}.ytls-save-modal-button:last-of-type{margin-right:0}.ytls-save-modal-cancel-button{background:#444;color:#fff;padding:10px 20px;border:none;border-radius:5px;cursor:pointer;margin-top:15px;display:block;width:100%}.ytls-file-operation-button{background:#555;color:#fff;font-size:12px;padding:5px 10px;border:none;border-radius:5px;cursor:pointer}.ytls-file-operation-button:hover{background:#777}.ytls-hidden-file-input{display:none}#ytls-header-button{align-items:center;background:0 0;border:none;color:var(--yt-spec-text-primary,currentColor);cursor:pointer;display:inline-flex;font-size:20px;height:40px;margin-left:6px;padding:0 6px;text-decoration:none}#ytls-header-button:hover{color:var(--yt-spec-call-to-action,#3ea6ff)}#ytls-header-button:focus-visible{outline:2px solid var(--yt-spec-call-to-action,#3ea6ff);outline-offset:2px}#ytls-header-button img{display:block;height:32px;max-width:48px;pointer-events:none;width:auto}.ytls-fade-in{animation:fadeIn .3s ease-in-out forwards}.ytls-fade-out{animation:fadeOut .3s ease-in-out forwards}.ytls-zoom-in{animation:zoomIn .4s cubic-bezier(.68,-.55,.265,1.55) forwards;transform-origin:center center}.ytls-zoom-out{animation:zoomOut .4s cubic-bezier(.68,-.55,.265,1.55) forwards;transform-origin:center center}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes fadeOut{from{opacity:1}to{opacity:0}}@keyframes zoomIn{from{opacity:0;transform:scale(.1)}to{opacity:1;transform:scale(1)}}@keyframes zoomOut{from{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.1)}}.ytls-tooltip{position:fixed;background:rgba(97,97,97,.92);color:#fff;padding:8px 10px;border-radius:2px;font-size:12px;font-family:Roboto,Arial,sans-serif;font-weight:400;line-height:1.4;letter-spacing:.2px;z-index:10001;pointer-events:none;white-space:pre-line;max-width:300px;box-shadow:0 1px 2px rgba(0,0,0,.1);opacity:0;transition:opacity .2s cubic-bezier(0, 0, .2, 1)}.ytls-tooltip.ytls-tooltip-visible{opacity:1}";var Re=Uint8Array,rt=Uint16Array,Zi=Int32Array,Wi=new Re([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Yi=new Re([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Za=new Re([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Qa=function(t,e){for(var n=new rt(31),r=0;r<31;++r)n[r]=e+=1<<t[r-1];for(var a=new Zi(n[30]),r=1;r<30;++r)for(var i=n[r];i<n[r+1];++i)a[i]=i-n[r]<<5|r;return{b:n,r:a}},eo=Qa(Wi,2),_l=eo.b,Ui=eo.r;_l[28]=258,Ui[258]=28;var to=Qa(Yi,0),qc=to.b,Wa=to.r,Vi=new rt(32768);for(ne=0;ne<32768;++ne)Pt=(ne&43690)>>1|(ne&21845)<<1,Pt=(Pt&52428)>>2|(Pt&13107)<<2,Pt=(Pt&61680)>>4|(Pt&3855)<<4,Vi[ne]=((Pt&65280)>>8|(Pt&255)<<8)>>1;var Pt,ne,_r=(function(t,e,n){for(var r=t.length,a=0,i=new rt(e);a<r;++a)t[a]&&++i[t[a]-1];var s=new rt(e);for(a=1;a<e;++a)s[a]=s[a-1]+i[a-1]<<1;var o;if(n){o=new rt(1<<e);var d=15-e;for(a=0;a<r;++a)if(t[a])for(var m=a<<4|t[a],f=e-t[a],k=s[t[a]-1]++<<f,L=k|(1<<f)-1;k<=L;++k)o[Vi[k]>>d]=m}else for(o=new rt(r),a=0;a<r;++a)t[a]&&(o[a]=Vi[s[t[a]-1]++]>>15-t[a]);return o}),kn=new Re(288);for(ne=0;ne<144;++ne)kn[ne]=8;var ne;for(ne=144;ne<256;++ne)kn[ne]=9;var ne;for(ne=256;ne<280;++ne)kn[ne]=7;var ne;for(ne=280;ne<288;++ne)kn[ne]=8;var ne,ui=new Re(32);for(ne=0;ne<32;++ne)ui[ne]=5;var ne,Sl=_r(kn,9,0);var Ll=_r(ui,5,0);var no=function(t){return(t+7)/8|0},ro=function(t,e,n){return(e==null||e<0)&&(e=0),(n==null||n>t.length)&&(n=t.length),new Re(t.subarray(e,n))};var Cl=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],mi=function(t,e,n){var r=new Error(e||Cl[t]);if(r.code=t,Error.captureStackTrace&&Error.captureStackTrace(r,mi),!n)throw r;return r};var zt=function(t,e,n){n<<=e&7;var r=e/8|0;t[r]|=n,t[r+1]|=n>>8},kr=function(t,e,n){n<<=e&7;var r=e/8|0;t[r]|=n,t[r+1]|=n>>8,t[r+2]|=n>>16},ji=function(t,e){for(var n=[],r=0;r<t.length;++r)t[r]&&n.push({s:r,f:t[r]});var a=n.length,i=n.slice();if(!a)return{t:ao,l:0};if(a==1){var s=new Re(n[0].s+1);return s[n[0].s]=1,{t:s,l:1}}n.sort(function(ye,Ie){return ye.f-Ie.f}),n.push({s:-1,f:25001});var o=n[0],d=n[1],m=0,f=1,k=2;for(n[0]={s:-1,f:o.f+d.f,l:o,r:d};f!=a-1;)o=n[n[m].f<n[k].f?m++:k++],d=n[m!=f&&n[m].f<n[k].f?m++:k++],n[f++]={s:-1,f:o.f+d.f,l:o,r:d};for(var L=i[0].s,r=1;r<a;++r)i[r].s>L&&(L=i[r].s);var I=new rt(L+1),G=Gi(n[f-1],I,0);if(G>e){var r=0,K=0,re=G-e,me=1<<re;for(i.sort(function(Ie,ge){return I[ge.s]-I[Ie.s]||Ie.f-ge.f});r<a;++r){var ue=i[r].s;if(I[ue]>e)K+=me-(1<<G-I[ue]),I[ue]=e;else break}for(K>>=re;K>0;){var J=i[r].s;I[J]<e?K-=1<<e-I[J]++-1:++r}for(;r>=0&&K;--r){var le=i[r].s;I[le]==e&&(--I[le],++K)}G=e}return{t:new Re(I),l:G}},Gi=function(t,e,n){return t.s==-1?Math.max(Gi(t.l,e,n+1),Gi(t.r,e,n+1)):e[t.s]=n},Ya=function(t){for(var e=t.length;e&&!t[--e];);for(var n=new rt(++e),r=0,a=t[0],i=1,s=function(d){n[r++]=d},o=1;o<=e;++o)if(t[o]==a&&o!=e)++i;else{if(!a&&i>2){for(;i>138;i-=138)s(32754);i>2&&(s(i>10?i-11<<5|28690:i-3<<5|12305),i=0)}else if(i>3){for(s(a),--i;i>6;i-=6)s(8304);i>2&&(s(i-3<<5|8208),i=0)}for(;i--;)s(a);i=1,a=t[o]}return{c:n.subarray(0,r),n:e}},Er=function(t,e){for(var n=0,r=0;r<e.length;++r)n+=t[r]*e[r];return n},io=function(t,e,n){var r=n.length,a=no(e+2);t[a]=r&255,t[a+1]=r>>8,t[a+2]=t[a]^255,t[a+3]=t[a+1]^255;for(var i=0;i<r;++i)t[a+i+4]=n[i];return(a+4+r)*8},Ka=function(t,e,n,r,a,i,s,o,d,m,f){zt(e,f++,n),++a[256];for(var k=ji(a,15),L=k.t,I=k.l,G=ji(i,15),K=G.t,re=G.l,me=Ya(L),ue=me.c,J=me.n,le=Ya(K),ye=le.c,Ie=le.n,ge=new rt(19),X=0;X<ue.length;++X)++ge[ue[X]&31];for(var X=0;X<ye.length;++X)++ge[ye[X]&31];for(var Z=ji(ge,7),ve=Z.t,we=Z.l,xe=19;xe>4&&!ve[Za[xe-1]];--xe);var Xe=m+5<<3,Be=Er(a,kn)+Er(i,ui)+s,Fe=Er(a,L)+Er(i,K)+s+14+3*xe+Er(ge,ve)+2*ge[16]+3*ge[17]+7*ge[18];if(d>=0&&Xe<=Be&&Xe<=Fe)return io(e,f,t.subarray(d,d+m));var ot,Te,je,Tt;if(zt(e,f,1+(Fe<Be)),f+=2,Fe<Be){ot=_r(L,I,0),Te=L,je=_r(K,re,0),Tt=K;var er=_r(ve,we,0);zt(e,f,J-257),zt(e,f+5,Ie-1),zt(e,f+10,xe-4),f+=14;for(var X=0;X<xe;++X)zt(e,f+3*X,ve[Za[X]]);f+=3*xe;for(var Qe=[ue,ye],et=0;et<2;++et)for(var Ue=Qe[et],X=0;X<Ue.length;++X){var Q=Ue[X]&31;zt(e,f,er[Q]),f+=ve[Q],Q>15&&(zt(e,f,Ue[X]>>5&127),f+=Ue[X]>>12)}}else ot=Sl,Te=kn,je=Ll,Tt=ui;for(var X=0;X<o;++X){var be=r[X];if(be>255){var Q=be>>18&31;kr(e,f,ot[Q+257]),f+=Te[Q+257],Q>7&&(zt(e,f,be>>23&31),f+=Wi[Q]);var $t=be&31;kr(e,f,je[$t]),f+=Tt[$t],$t>3&&(kr(e,f,be>>5&8191),f+=Yi[$t])}else kr(e,f,ot[be]),f+=Te[be]}return kr(e,f,ot[256]),f+Te[256]},Il=new Zi([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),ao=new Re(0),Al=function(t,e,n,r,a,i){var s=i.z||t.length,o=new Re(r+s+5*(1+Math.ceil(s/7e3))+a),d=o.subarray(r,o.length-a),m=i.l,f=(i.r||0)&7;if(e){f&&(d[0]=i.r>>3);for(var k=Il[e-1],L=k>>13,I=k&8191,G=(1<<n)-1,K=i.p||new rt(32768),re=i.h||new rt(G+1),me=Math.ceil(n/3),ue=2*me,J=function(Ve){return(t[Ve]^t[Ve+1]<<me^t[Ve+2]<<ue)&G},le=new Zi(25e3),ye=new rt(288),Ie=new rt(32),ge=0,X=0,Z=i.i||0,ve=0,we=i.w||0,xe=0;Z+2<s;++Z){var Xe=J(Z),Be=Z&32767,Fe=re[Xe];if(K[Be]=Fe,re[Xe]=Be,we<=Z){var ot=s-Z;if((ge>7e3||ve>24576)&&(ot>423||!m)){f=Ka(t,d,0,le,ye,Ie,X,ve,xe,Z-xe,f),ve=ge=X=0,xe=Z;for(var Te=0;Te<286;++Te)ye[Te]=0;for(var Te=0;Te<30;++Te)Ie[Te]=0}var je=2,Tt=0,er=I,Qe=Be-Fe&32767;if(ot>2&&Xe==J(Z-Qe))for(var et=Math.min(L,ot)-1,Ue=Math.min(32767,Z),Q=Math.min(258,ot);Qe<=Ue&&--er&&Be!=Fe;){if(t[Z+je]==t[Z+je-Qe]){for(var be=0;be<Q&&t[Z+be]==t[Z+be-Qe];++be);if(be>je){if(je=be,Tt=Qe,be>et)break;for(var $t=Math.min(Qe,be-2),Ar=0,Te=0;Te<$t;++Te){var En=Z-Qe+Te&32767,xi=K[En],tr=En-xi&32767;tr>Ar&&(Ar=tr,Fe=En)}}}Be=Fe,Fe=K[Be],Qe+=Be-Fe&32767}if(Tt){le[ve++]=268435456|Ui[je]<<18|Wa[Tt];var Mr=Ui[je]&31,_n=Wa[Tt]&31;X+=Wi[Mr]+Yi[_n],++ye[257+Mr],++Ie[_n],we=Z+je,++ge}else le[ve++]=t[Z],++ye[t[Z]]}}for(Z=Math.max(Z,we);Z<s;++Z)le[ve++]=t[Z],++ye[t[Z]];f=Ka(t,d,m,le,ye,Ie,X,ve,xe,Z-xe,f),m||(i.r=f&7|d[f/8|0]<<3,f-=7,i.h=re,i.p=K,i.i=Z,i.w=we)}else{for(var Z=i.w||0;Z<s+m;Z+=65535){var Zt=Z+65535;Zt>=s&&(d[f/8|0]=m,Zt=s),f=io(d,f+1,t.subarray(Z,Zt))}i.i=s}return ro(o,0,r+no(f)+a)},Ml=(function(){for(var t=new Int32Array(256),e=0;e<256;++e){for(var n=e,r=9;--r;)n=(n&1&&-306674912)^n>>>1;t[e]=n}return t})(),Dl=function(){var t=-1;return{p:function(e){for(var n=t,r=0;r<e.length;++r)n=Ml[n&255^e[r]]^n>>>8;t=n},d:function(){return~t}}};var Rl=function(t,e,n,r,a){if(!a&&(a={l:1},e.dictionary)){var i=e.dictionary.subarray(-32768),s=new Re(i.length+t.length);s.set(i),s.set(t,i.length),t=s,a.w=i.length}return Al(t,e.level==null?6:e.level,e.mem==null?a.l?Math.ceil(Math.max(8,Math.min(13,Math.log(t.length)))*1.5):20:12+e.mem,n,r,a)},oo=function(t,e){var n={};for(var r in t)n[r]=t[r];for(var r in e)n[r]=e[r];return n};var De=function(t,e,n){for(;n;++e)t[e]=n,n>>>=8};function Bl(t,e){return Rl(t,e||{},0,0)}var so=function(t,e,n,r){for(var a in t){var i=t[a],s=e+a,o=r;Array.isArray(i)&&(o=oo(r,i[1]),i=i[0]),i instanceof Re?n[s]=[i,o]:(n[s+="/"]=[new Re(0),o],so(i,s,n,r))}},Ja=typeof TextEncoder<"u"&&new TextEncoder,Ol=typeof TextDecoder<"u"&&new TextDecoder,Nl=0;try{Ol.decode(ao,{stream:!0}),Nl=1}catch{}function di(t,e){if(e){for(var n=new Re(t.length),r=0;r<t.length;++r)n[r]=t.charCodeAt(r);return n}if(Ja)return Ja.encode(t);for(var a=t.length,i=new Re(t.length+(t.length>>1)),s=0,o=function(f){i[s++]=f},r=0;r<a;++r){if(s+5>i.length){var d=new Re(s+8+(a-r<<1));d.set(i),i=d}var m=t.charCodeAt(r);m<128||e?o(m):m<2048?(o(192|m>>6),o(128|m&63)):m>55295&&m<57344?(m=65536+(m&1047552)|t.charCodeAt(++r)&1023,o(240|m>>18),o(128|m>>12&63),o(128|m>>6&63),o(128|m&63)):(o(224|m>>12),o(128|m>>6&63),o(128|m&63))}return ro(i,0,s)}var qi=function(t){var e=0;if(t)for(var n in t){var r=t[n].length;r>65535&&mi(9),e+=r+4}return e},Xa=function(t,e,n,r,a,i,s,o){var d=r.length,m=n.extra,f=o&&o.length,k=qi(m);De(t,e,s!=null?33639248:67324752),e+=4,s!=null&&(t[e++]=20,t[e++]=n.os),t[e]=20,e+=2,t[e++]=n.flag<<1|(i<0&&8),t[e++]=a&&8,t[e++]=n.compression&255,t[e++]=n.compression>>8;var L=new Date(n.mtime==null?Date.now():n.mtime),I=L.getFullYear()-1980;if((I<0||I>119)&&mi(10),De(t,e,I<<25|L.getMonth()+1<<21|L.getDate()<<16|L.getHours()<<11|L.getMinutes()<<5|L.getSeconds()>>1),e+=4,i!=-1&&(De(t,e,n.crc),De(t,e+4,i<0?-i-2:i),De(t,e+8,n.size)),De(t,e+12,d),De(t,e+14,k),e+=16,s!=null&&(De(t,e,f),De(t,e+6,n.attrs),De(t,e+10,s),e+=14),t.set(r,e),e+=d,k)for(var G in m){var K=m[G],re=K.length;De(t,e,+G),De(t,e+2,re),t.set(K,e+4),e+=4+re}return f&&(t.set(o,e),e+=f),e},Pl=function(t,e,n,r,a){De(t,e,101010256),De(t,e+8,n),De(t,e+10,n),De(t,e+12,r),De(t,e+16,a)};function lo(t,e){e||(e={});var n={},r=[];so(t,"",n,e);var a=0,i=0;for(var s in n){var o=n[s],d=o[0],m=o[1],f=m.level==0?0:8,k=di(s),L=k.length,I=m.comment,G=I&&di(I),K=G&&G.length,re=qi(m.extra);L>65535&&mi(11);var me=f?Bl(d,m):d,ue=me.length,J=Dl();J.p(d),r.push(oo(m,{size:d.length,crc:J.d(),c:me,f:k,m:G,u:L!=s.length||G&&I.length!=K,o:a,compression:f})),a+=30+L+re+ue,i+=76+2*(L+re)+(K||0)+ue}for(var le=new Re(i+22),ye=a,Ie=i-a,ge=0;ge<r.length;++ge){var k=r[ge];Xa(le,k.o,k,k.f,k.u,k.c.length);var X=30+k.f.length+qi(k.extra);le.set(k.c,k.o+X),Xa(le,a,k,k.f,k.u,k.c.length,k.o,k.m),a+=16+X+(k.m?k.m.length:0)}return Pl(le,a,r.length,Ie,ye),le}var O={isSignedIn:!1,accessToken:null,userName:null,email:null},ft=!0,Je=30,at=null,Jn=!1,Kn=0,mt=null,Ki=null,Ee=null,ae=null,fi=null;function fo(t){Ki=t}function po(t){Ee=t}function ho(t){ae=t}function Ji(t){fi=t}var co=!1;function go(){if(!co)try{let t=document.createElement("style");t.textContent=`
@keyframes tk-spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
@keyframes tk-blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.2; } }
.tk-auth-spinner { display:inline-block; width:12px; height:12px; border:2px solid rgba(255,165,0,0.3); border-top-color:#ffa500; border-radius:50%; margin-right:6px; vertical-align:-2px; animation: tk-spin 0.9s linear infinite; }
.tk-auth-blink { animation: tk-blink 0.4s ease-in-out 3; }
`,document.head.appendChild(t),co=!0}catch{}}var yo=null,Sr=null,Lr=null;function Xi(t){yo=t}function hi(t){Sr=t}function gi(t){Lr=t}var uo="1023528652072-45cu3dr7o5j79vsdn8643bhle9ee8kds.apps.googleusercontent.com",zl="https://www.googleapis.com/auth/drive.file https://www.googleapis.com/auth/userinfo.profile",$l="https://www.youtube.com/",Hl=30*1e3,Fl=1800*1e3,mo=5,pi=null,it=null;async function Qi(){try{let t=await Lr("googleAuthState"),e=t&&typeof t=="object"?{...t,accessToken:t.accessToken?"[REDACTED]":null}:t;c("Loading Google auth state from IndexedDB:",e);let n=Oi.safeParse(t);if(n.success)O={...O,...n.data},O.isSignedIn&&O.accessToken&&c(`Reusing stored Google auth token for ${O.userName||O.email||"user"}`),Ir(),O.isSignedIn&&O.accessToken&&await Qn(!0);else if(t!==void 0){let r=t&&typeof t=="object"?{...t,accessToken:t.accessToken?"[REDACTED]":null}:t;c("Google auth state failed validation:",{stored:r,errors:n.error.format()},"warn")}}catch(t){c("Failed to load Google auth state:",t,"error")}}async function yi(){try{let t=Oi.safeParse(O);if(!t.success){let e={...O,accessToken:O.accessToken?"[REDACTED]":null};c("Invalid auth state, cannot save",{state:e,errors:t.error.format()},"error");return}await Sr("googleAuthState",O),O.isSignedIn&&O.accessToken?c(`Saved Google auth state to IndexedDB for ${O.userName||O.email||"user"}`):c("Cleared Google auth state in IndexedDB (signed out)")}catch(t){c("Failed to save Google auth state:",t,"error")}}function Ir(){Ki&&(Ki.style.display="none")}function Ke(t,e){if(ae){if(ae.style.fontWeight="bold",t==="authenticating"){for(go(),ae.style.color="#ffa500";ae.firstChild;)ae.removeChild(ae.firstChild);let n=document.createElement("span");n.className="tk-auth-spinner";let r=document.createTextNode(` ${e||"Authorizing with Google\u2026"}`);ae.appendChild(n),ae.appendChild(r);return}if(t==="error"){ae.textContent=`\u274C ${e||"Authorization failed"}`,ae.style.color="#ff4d4f",he();return}O.isSignedIn?(ae.textContent="\u2705 Signed in",ae.style.color="#52c41a",ae.removeAttribute("title"),O.userName?(ae.onmouseenter=()=>{ae.textContent=`\u2705 Signed in as ${O.userName}`},ae.onmouseleave=()=>{ae.textContent="\u2705 Signed in"}):(ae.onmouseenter=null,ae.onmouseleave=null)):(ae.textContent="\u274C Not signed in",ae.style.color="#ff4d4f",ae.removeAttribute("title"),ae.onmouseenter=null,ae.onmouseleave=null),he()}}function jl(){ae&&(go(),ae.classList.remove("tk-auth-blink"),ae.offsetWidth,ae.classList.add("tk-auth-blink"),setTimeout(()=>{ae.classList.remove("tk-auth-blink")},1200))}function Ul(t){return new Promise((e,n)=>{if(!t){c&&c("OAuth monitor: popup is null",null,"error"),n(new Error("Failed to open popup"));return}c&&c("OAuth monitor: starting to monitor popup for token");let r=Date.now(),a=300*1e3,i="timekeeper_oauth",s=null,o=null,d=null,m=()=>{if(s){try{s.close()}catch{}s=null}o&&(clearInterval(o),o=null),d&&(clearInterval(d),d=null)};try{s=new BroadcastChannel(i),c&&c("OAuth monitor: BroadcastChannel created successfully"),s.onmessage=L=>{let I=L.data?.token?{...L.data,token:"[REDACTED]"}:L.data;c&&c("OAuth monitor: received BroadcastChannel message",I);let G=M.object({type:M.string(),token:M.string().optional(),error:M.string().optional()}).safeParse(L.data);if(!G.success){c&&c("OAuth monitor: invalid message format",G.error,"warn");return}if(G.data.type==="timekeeper_oauth_token"&&G.data.token){c&&c("OAuth monitor: token received via BroadcastChannel"),m();try{t.close()}catch{}e(G.data.token)}else if(G.data.type==="timekeeper_oauth_error"){c&&c("OAuth monitor: error received via BroadcastChannel",G.data.error,"error"),m();try{t.close()}catch{}n(new Error(G.data.error||"OAuth failed"))}}}catch(L){c&&c("OAuth monitor: BroadcastChannel not supported, using IndexedDB fallback",L)}c&&c("OAuth monitor: setting up IndexedDB polling");let f=Date.now();o=setInterval(async()=>{try{let L=indexedDB.open("ytls-timestamps-db",3);L.onsuccess=()=>{let I=L.result,re=I.transaction("settings","readonly").objectStore("settings").get("oauth_message");re.onsuccess=()=>{let me=re.result;if(me&&me.value){let ue=me.value,J=M.object({type:M.string(),token:M.string().optional(),error:M.string().optional(),timestamp:M.number().optional()}).safeParse(ue);if(!J.success){c&&c("OAuth monitor: invalid IndexedDB message format",J.error,"warn");return}if(J.data.timestamp&&J.data.timestamp>f){let le=J.data.token?{...J.data,token:"[REDACTED]"}:J.data;if(c&&c("OAuth monitor: received IndexedDB message",le),J.data.type==="timekeeper_oauth_token"&&J.data.token){c&&c("OAuth monitor: token received via IndexedDB"),m();try{t.close()}catch{}I.transaction("settings","readwrite").objectStore("settings").delete("oauth_message"),e(J.data.token)}else if(J.data.type==="timekeeper_oauth_error"){c&&c("OAuth monitor: error received via IndexedDB",J.data.error,"error"),m();try{t.close()}catch{}I.transaction("settings","readwrite").objectStore("settings").delete("oauth_message"),n(new Error(J.data.error||"OAuth failed"))}f=J.data.timestamp||Date.now()}}I.close()}}}catch(L){c&&c("OAuth monitor: IndexedDB polling error",L,"error")}},500),d=setInterval(()=>{if(Date.now()-r>a){c&&c("OAuth monitor: popup timed out after 5 minutes",null,"error"),m();try{t.close()}catch{}n(new Error("OAuth popup timed out"));return}},1e3)})}async function vo(){if(!uo){Ke("error","Google Client ID not configured");return}try{c&&c("OAuth signin: starting OAuth flow"),Ke("authenticating","Opening authentication window...");let t=new URL("https://accounts.google.com/o/oauth2/v2/auth");t.searchParams.set("client_id",uo),t.searchParams.set("redirect_uri",$l),t.searchParams.set("response_type","token"),t.searchParams.set("scope",zl),t.searchParams.set("include_granted_scopes","true"),t.searchParams.set("state","timekeeper_auth"),c&&c("OAuth signin: opening popup");let e=window.open(t.toString(),"TimekeeperGoogleAuth","width=500,height=600,menubar=no,toolbar=no,location=no");if(!e){c&&c("OAuth signin: popup blocked by browser",null,"error"),Ke("error","Popup blocked. Please enable popups for YouTube.");return}c&&c("OAuth signin: popup opened successfully"),Ke("authenticating","Waiting for authentication...");try{let n=await Ul(e),r=await fetch("https://www.googleapis.com/oauth2/v2/userinfo",{headers:{Authorization:`Bearer ${n}`}});if(r.ok){let a=await r.json(),i=M.object({name:M.string().optional(),email:M.string().optional()}).safeParse(a);if(!i.success)throw c&&c("Failed to validate user info response",i.error,"error"),new Error("Invalid user info response");let s=i.data;O.accessToken=n,O.isSignedIn=!0,O.userName=s.name||null,O.email=s.email||null,await yi(),Ir(),Ke(),he(),await Qn(),c?c(`Successfully authenticated as ${s.name}`):console.log(`[Timekeeper] Successfully authenticated as ${s.name}`)}else throw new Error("Failed to fetch user info")}catch(n){let r=n instanceof Error?n.message:"Authentication failed";c?c("OAuth failed:",n,"error"):console.error("[Timekeeper] OAuth failed:",n),Ke("error",r);return}}catch(t){let e=t instanceof Error?t.message:"Sign in failed";c?c("Failed to sign in to Google:",t,"error"):console.error("[Timekeeper] Failed to sign in to Google:",t),Ke("error",`Failed to sign in: ${e}`)}}async function xo(){if(!window.opener||window.opener===window)return!1;c&&c("OAuth popup: detected popup window, checking for OAuth response");let t=window.location.hash;if(!t||t.length<=1)return c&&c("OAuth popup: no hash params found"),!1;let e=t.startsWith("#")?t.substring(1):t,n=new URLSearchParams(e),r=n.get("state");if(c&&c("OAuth popup: hash params found, state="+r),r!=="timekeeper_auth")return c&&c("OAuth popup: not our OAuth flow (wrong state)"),!1;let a=n.get("error"),i=n.get("access_token"),s="timekeeper_oauth";if(a){try{let o=new BroadcastChannel(s);o.postMessage({type:"timekeeper_oauth_error",error:n.get("error_description")||a}),o.close(),c&&c("OAuth popup: error broadcast via BroadcastChannel")}catch{let d={type:"timekeeper_oauth_error",error:n.get("error_description")||a,timestamp:Date.now()};c&&c("OAuth popup: writing error to IndexedDB",d);let m=indexedDB.open("ytls-timestamps-db",3);m.onsuccess=()=>{let f=m.result,L=f.transaction("settings","readwrite").objectStore("settings").put({key:"oauth_message",value:d});L.onsuccess=()=>{c&&c("OAuth popup: error written to IndexedDB successfully")},L.onerror=()=>{c&&c("OAuth popup: failed to write error to IndexedDB",L.error,"error")},f.close()},m.onerror=()=>{c&&c("OAuth popup: failed to open IndexedDB",m.error,"error")}}return setTimeout(()=>{try{window.close()}catch{}},500),!0}if(i){c&&c("OAuth popup: access token found, broadcasting to opener");try{let o=new BroadcastChannel(s);o.postMessage({type:"timekeeper_oauth_token",token:i}),o.close(),c&&c("OAuth popup: token broadcast via BroadcastChannel")}catch(o){c&&c("OAuth popup: BroadcastChannel failed, using IndexedDB",o);let d={type:"timekeeper_oauth_token",token:i,timestamp:Date.now()},m={...d,token:"[REDACTED]"};c&&c("OAuth popup: writing token to IndexedDB",m);let f=indexedDB.open("ytls-timestamps-db",3);f.onsuccess=()=>{let k=f.result,I=k.transaction("settings","readwrite").objectStore("settings").put({key:"oauth_message",value:d});I.onsuccess=()=>{c&&c("OAuth popup: token written to IndexedDB successfully")},I.onerror=()=>{c&&c("OAuth popup: failed to write token to IndexedDB",I.error,"error")},k.close()},f.onerror=()=>{c&&c("OAuth popup: failed to open IndexedDB",f.error,"error")}}return setTimeout(()=>{try{window.close()}catch{}},500),!0}return!1}async function bo(){O={isSignedIn:!1,accessToken:null,userName:null,email:null},await yi(),Ir(),Ke(),he()}async function wo(){if(!O.isSignedIn||!O.accessToken)return!1;try{let t=await fetch("https://www.googleapis.com/oauth2/v2/userinfo",{headers:{Authorization:`Bearer ${O.accessToken}`}});return t.status===401?(await To({silent:!0}),!1):t.ok}catch(t){return c("Failed to verify auth state:",t,"error"),!1}}async function Vl(t){let e={Authorization:`Bearer ${t}`},r=`https://www.googleapis.com/drive/v3/files?q=${encodeURIComponent("name = 'Timekeeper' and mimeType = 'application/vnd.google-apps.folder' and trashed = false")}&fields=files(id,name)&pageSize=10`,a=await fetch(r,{headers:e});if(a.status===401)throw new Error("unauthorized");if(!a.ok)throw new Error("drive search failed");let i=await a.json();if(Array.isArray(i.files)&&i.files.length>0)return i.files[0].id;let s=await fetch("https://www.googleapis.com/drive/v3/files",{method:"POST",headers:{...e,"Content-Type":"application/json"},body:JSON.stringify({name:"Timekeeper",mimeType:"application/vnd.google-apps.folder"})});if(s.status===401)throw new Error("unauthorized");if(!s.ok)throw new Error("drive folder create failed");return(await s.json()).id}async function Gl(t,e,n){let r=`name='${t}' and '${e}' in parents and trashed=false`,a=encodeURIComponent(r),i=await fetch(`https://www.googleapis.com/drive/v3/files?q=${a}&fields=files(id,name)`,{method:"GET",headers:{Authorization:`Bearer ${n}`}});if(i.status===401)throw new Error("unauthorized");if(!i.ok)return null;let s=await i.json();return s.files&&s.files.length>0?s.files[0].id:null}function ql(t,e){let n=di(t),r=e.replace(/\\/g,"/").replace(/^\/+/,"");return r.endsWith(".json")||(r+=".json"),lo({[r]:[n,{level:6,mtime:new Date,os:0}]})}async function Zl(t,e,n,r){let a=t.replace(/\.json$/,".zip"),i=await Gl(a,n,r),s=new TextEncoder().encode(e).length,o=ql(e,t),d=o.length;c(`Compressing data: ${s} bytes -> ${d} bytes (${Math.round(100-d/s*100)}% reduction)`);let m="-------314159265358979",f=`\r
--${m}\r
`,k=`\r
--${m}--`,L=i?{name:a,mimeType:"application/zip"}:{name:a,mimeType:"application/zip",parents:[n]},I=8192,G="";for(let le=0;le<o.length;le+=I){let ye=o.subarray(le,Math.min(le+I,o.length));G+=String.fromCharCode.apply(null,Array.from(ye))}let K=btoa(G),re=f+`Content-Type: application/json; charset=UTF-8\r
\r
`+JSON.stringify(L)+f+`Content-Type: application/zip\r
Content-Transfer-Encoding: base64\r
\r
`+K+k,me,ue;i?(me=`https://www.googleapis.com/upload/drive/v3/files/${i}?uploadType=multipart&fields=id,name`,ue="PATCH"):(me="https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart&fields=id,name",ue="POST");let J=await fetch(me,{method:ue,headers:{Authorization:`Bearer ${r}`,"Content-Type":`multipart/related; boundary=${m}`},body:re});if(J.status===401)throw new Error("unauthorized");if(!J.ok)throw new Error("drive upload failed")}async function To(t){c("Auth expired, clearing token",null,"warn"),O.isSignedIn=!1,O.accessToken=null,await yi(),Ke("error","Authorization expired. Please sign in again."),he()}async function Wl(t){if(!O.isSignedIn||!O.accessToken){t?.silent||Ke("error","Please sign in to Google Drive first");return}try{let{json:e,filename:n,totalVideos:r,totalTimestamps:a}=await yo();if(a===0){t?.silent||c("Skipping export: no timestamps to back up");return}let i=await Vl(O.accessToken);await Zl(n,e,i,O.accessToken),c(`Exported to Google Drive (${n}) with ${r} videos / ${a} timestamps.`)}catch(e){throw e.message==="unauthorized"?(await To({silent:t?.silent}),e):(c("Drive export failed:",e,"error"),t?.silent||Ke("error","Failed to export to Google Drive."),e)}}async function ko(){try{let t=Ni.partial().safeParse({autoBackupEnabled:await Lr("autoBackupEnabled"),autoBackupIntervalMinutes:await Lr("autoBackupIntervalMinutes"),lastAutoBackupAt:await Lr("lastAutoBackupAt")});t.success?(typeof t.data.autoBackupEnabled=="boolean"&&(ft=t.data.autoBackupEnabled),typeof t.data.autoBackupIntervalMinutes=="number"&&(Je=t.data.autoBackupIntervalMinutes),typeof t.data.lastAutoBackupAt=="number"&&(at=t.data.lastAutoBackupAt)):c("Failed to validate auto backup settings:",t.error.format(),"warn")}catch(t){c("Failed to load auto backup settings:",t,"error")}}async function ea(){try{let t={autoBackupEnabled:ft,autoBackupIntervalMinutes:Je,lastAutoBackupAt:at??0},e=Ni.safeParse(t);if(!e.success){c("Invalid auto backup settings, cannot save",{settings:t,errors:e.error.format()},"error");return}await Sr("autoBackupEnabled",ft),await Sr("autoBackupIntervalMinutes",Je),await Sr("lastAutoBackupAt",at??0)}catch(t){c("Failed to save auto backup settings:",t,"error")}}function Yl(){pi&&(clearInterval(pi),pi=null),it&&(clearTimeout(it),it=null)}function Xn(t){try{let e=new Date(t),n=new Date,r=e.toDateString()===n.toDateString(),a=e.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"});return r?a:`${e.toLocaleDateString()} ${a}`}catch{return""}}function Eo(){return ft?Jn?"#4285f4":mt&&mt>0?"#ffa500":O.isSignedIn&&at?"#52c41a":O.isSignedIn?"#ffa500":"#ff4d4f":"#ff4d4f"}function he(){if(!Ee)return;let t="",e="";if(!ft)t="\u{1F501} Backup: Off",Ee.onmouseenter=null,Ee.onmouseleave=null;else if(Jn)t="\u{1F501} Backing up\u2026",Ee.onmouseenter=null,Ee.onmouseleave=null;else if(mt&&mt>0)t=`\u26A0\uFE0F Retry in ${Math.ceil(mt/6e4)}m`,Ee.onmouseenter=null,Ee.onmouseleave=null;else if(at){t=`\u{1F5C4}\uFE0F Last backup: ${Xn(at)}`;let n=at+Math.max(1,Je)*60*1e3;e=`\u{1F5C4}\uFE0F Next backup: ${Xn(n)}`,Ee.onmouseenter=()=>{Ee.textContent=e},Ee.onmouseleave=()=>{Ee.textContent=t}}else{t="\u{1F5C4}\uFE0F Last backup: never";let n=Date.now()+Math.max(1,Je)*60*1e3;e=`\u{1F5C4}\uFE0F Next backup: ${Xn(n)}`,Ee.onmouseenter=()=>{Ee.textContent=e},Ee.onmouseleave=()=>{Ee.textContent=t}}Ee.textContent=t,Ee.style.display=t?"inline":"none";try{let n=Eo();Ee.style.color=n}catch{}vi()}function vi(){if(!fi)return;let t=Eo();fi.style.backgroundColor=t,wt(fi,()=>{let e="";if(!ft)e="Auto backup is disabled";else if(Jn)e="Backup in progress";else if(mt&&mt>0)e=`Retrying backup in ${Math.ceil(mt/6e4)}m`;else if(O.isSignedIn&&at){let n=at+Math.max(1,Je)*60*1e3,r=Xn(n);e=`Last backup: ${Xn(at)}
Next backup: ${r}`}else if(O.isSignedIn){let n=Date.now()+Math.max(1,Je)*60*1e3;e=`No backup yet
Next backup: ${Xn(n)}`}else e="Not signed in to Google Drive";return e})}async function Cr(t=!0){if(!O.isSignedIn||!O.accessToken){t||jl();return}if(it){c("Auto backup: backoff in progress, skipping scheduled run");return}if(!Jn){Jn=!0,he();try{await Wl({silent:t}),at=Date.now(),Kn=0,mt=null,it&&(clearTimeout(it),it=null),await ea()}catch(e){if(c("Auto backup failed:",e,"error"),e.message==="unauthorized")c("Auth error detected, clearing token and stopping retries",null,"warn"),O.isSignedIn=!1,O.accessToken=null,await yi(),Ke("error","Authorization expired. Please sign in again."),he(),Kn=0,mt=null,it&&(clearTimeout(it),it=null);else if(Kn<mo){Kn+=1;let a=Math.min(Hl*Math.pow(2,Kn-1),Fl);mt=a,it&&clearTimeout(it),it=setTimeout(()=>{Cr(!0)},a),c(`Scheduling backup retry ${Kn}/${mo} in ${Math.round(a/1e3)}s`),he()}else mt=null}finally{Jn=!1,he()}}}async function Qn(t=!1){if(Yl(),!!ft&&!(!O.isSignedIn||!O.accessToken)){if(pi=setInterval(()=>{Cr(!0)},Math.max(1,Je)*60*1e3),!t){let e=Date.now(),n=Math.max(1,Je)*60*1e3;(!at||e-at>=n)&&Cr(!0)}he()}}async function _o(){ft=!ft,await ea(),await Qn(),he()}async function So(){let t=prompt("Set Auto Backup interval (minutes):",String(Je));if(t===null)return;let e=Math.floor(Number(t));if(!Number.isFinite(e)||e<5||e>1440){alert("Please enter a number between 5 and 1440 minutes.");return}Je=e,await ea(),await Qn(),he()}var ta=window.location.hash;if(ta&&ta.length>1){let t=new URLSearchParams(ta.substring(1));if(t.get("state")==="timekeeper_auth"){let n=t.get("access_token");if(n){console.log("[Timekeeper] Auth token detected in URL, broadcasting token"),console.log("[Timekeeper] Token length:",n.length,"characters");try{let r=new BroadcastChannel("timekeeper_oauth"),a={type:"timekeeper_oauth_token",token:n};console.log("[Timekeeper] Sending auth message via BroadcastChannel:",{type:a.type,tokenLength:n.length}),r.postMessage(a),r.close(),console.log("[Timekeeper] Token broadcast via BroadcastChannel completed")}catch(r){console.log("[Timekeeper] BroadcastChannel failed, using IndexedDB fallback:",r);let a={type:"timekeeper_oauth_token",token:n,timestamp:Date.now()},i=indexedDB.open("ytls-timestamps-db",3);i.onsuccess=()=>{let s=i.result,o=s.transaction("settings","readwrite");o.objectStore("settings").put({key:"oauth_message",value:a}),o.oncomplete=()=>{console.log("[Timekeeper] Token broadcast via IndexedDB completed, timestamp:",a.timestamp),s.close()}}}if(history.replaceState){let r=window.location.pathname+window.location.search;history.replaceState(null,"",r)}throw console.log("[Timekeeper] Closing window after broadcasting auth token"),window.close(),new Error("OAuth window closed")}}}(async function(){"use strict";if(window.top!==window.self)return;function t(l){return GM.getValue(`timekeeper_${l}`,void 0)}function e(l,u){return GM.setValue(`timekeeper_${l}`,JSON.stringify(u))}if(gi(t),hi(e),await xo()){c("OAuth popup detected, broadcasting token and closing");return}await Qi();let r=["/watch","/live"];function a(l=window.location.href){try{let u=new URL(l);return u.origin!=="https://www.youtube.com"?!1:r.some(p=>u.pathname===p||u.pathname.startsWith(`${p}/`))}catch(u){return c("Timekeeper failed to parse URL for support check:",u,"error"),!1}}let i=null,s=null,o=null,d=null,m=null,f=null,k=null,L=null,I=250,G=null,K=!1;function re(){return i?i.getBoundingClientRect():null}function me(l,u,p){l&&(Ge={x:Math.round(typeof u=="number"?u:l.left),y:Math.round(typeof p=="number"?p:l.top),width:Math.round(l.width),height:Math.round(l.height)})}function ue(l=!0){if(!i)return;In();let u=re();u&&(u.width||u.height)&&(me(u),l&&(Yr("windowPosition",Ge),nr({type:"window_position_updated",position:Ge,timestamp:Date.now()})))}function J(){if(!i||!s||!d||!o)return;let l=40,u=pe();if(u.length>0)l=u[0].offsetHeight;else{let p=document.createElement("li");p.style.visibility="hidden",p.style.position="absolute",p.textContent="00:00 Example",o.appendChild(p),l=p.offsetHeight,o.removeChild(p)}I=s.offsetHeight+d.offsetHeight+l,i.style.minHeight=I+"px"}function le(){requestAnimationFrame(()=>{typeof window.recalculateTimestampsArea=="function"&&window.recalculateTimestampsArea(),J(),ue(!0)})}function ye(l=450){ke&&(clearTimeout(ke),ke=null),ke=setTimeout(()=>{Z(),le(),ke=null},l)}function Ie(){ke&&(clearTimeout(ke),ke=null)}function ge(){o&&(o.style.visibility="hidden",c("Hiding timestamps during show animation")),le(),ye()}function X(){Z(),Ie(),pt&&(clearTimeout(pt),pt=null),pt=setTimeout(()=>{i&&(i.style.display="none",ha(),pt=null)},400)}function Z(){if(!o){tt&&(tt(),tt=null,St=null,Yt=null);return}if(!Yt){o.style.visibility==="hidden"&&(o.style.visibility="",c("Restoring timestamp visibility (no deferred fragment)")),tt&&(tt(),tt=null,St=null);return}c("Appending deferred timestamps after animation"),o.appendChild(Yt),Yt=null,o.style.visibility==="hidden"&&(o.style.visibility="",c("Restoring timestamp visibility after append")),tt&&(tt(),tt=null,St=null),yt(),ze(),typeof window.recalculateTimestampsArea=="function"&&requestAnimationFrame(()=>window.recalculateTimestampsArea());let l=Q(),u=l?Math.floor(l.getCurrentTime()):Jt();Number.isFinite(u)&&Qt(u,!1)}let ve=null,we=!1,xe="ytls-timestamp-pending-delete",Xe="ytls-timestamp-highlight",Be="https://raw.githubusercontent.com/KamoTimestamps/timekeeper/refs/heads/main/assets/Kamo_64px_Indexed.png",Fe="https://raw.githubusercontent.com/KamoTimestamps/timekeeper/refs/heads/main/assets/Kamo_Eyebrow_64px_Indexed.png";function ot(){let l=u=>{let p=new Image;p.src=u};l(Be),l(Fe)}ot();async function Te(){for(;!document.querySelector("video")||!document.querySelector("#movie_player");)await new Promise(l=>setTimeout(l,100));for(;!document.querySelector(".ytp-progress-bar");)await new Promise(l=>setTimeout(l,100));await new Promise(l=>setTimeout(l,200))}let je=["getCurrentTime","seekTo","getPlayerState","seekToLiveHead","getVideoData","getDuration"],Tt=5e3,er=new Set(["getCurrentTime","seekTo","getPlayerState","seekToLiveHead","getVideoData","getDuration"]);function Qe(l){return er.has(l)}function et(){return document.querySelector("video")}let Ue=null;function Q(){if(Ue&&document.contains(Ue))return Ue;let l=document.getElementById("movie_player");return l&&document.contains(l)?l:null}function be(l){return je.every(u=>typeof l?.[u]=="function"?!0:Qe(u)?!!et():!1)}function $t(l){return je.filter(u=>typeof l?.[u]=="function"?!1:Qe(u)?!et():!0)}async function Ar(l=Tt){let u=Date.now();for(;Date.now()-u<l;){let y=Q();if(be(y))return y;await new Promise(E=>setTimeout(E,100))}let p=Q();return be(p),p}let En="timestampOffsetSeconds",xi=-5,tr="shiftClickTimeSkipSeconds",Mr=10,_n=300,Zt=300,Ve=null;function na(){try{return new URL(window.location.href).origin==="https://www.youtube.com"}catch{return!1}}function ra(){if(na()&&!Ve)try{Ve=new BroadcastChannel("ytls_timestamp_channel"),Ve.onmessage=ia}catch(l){c("Failed to create BroadcastChannel:",l,"warn"),Ve=null}}function nr(l){if(!na()){c("Skipping BroadcastChannel message: not on https://www.youtube.com","warn");return}if(ra(),!Ve){c("No BroadcastChannel available to post message","warn");return}try{Ve.postMessage(l)}catch(u){c("BroadcastChannel error, reopening:",u,"warn");try{Ve=new BroadcastChannel("ytls_timestamp_channel"),Ve.onmessage=ia,Ve.postMessage(l)}catch(p){c("Failed to reopen BroadcastChannel:",p,"error")}}}function ia(l){if(c("Received message from another tab:",l.data),!(!a()||!o||!i)&&l.data){if(l.data.type==="timestamps_updated"&&l.data.videoId===_e)c("Debouncing timestamp load due to external update for video:",l.data.videoId),clearTimeout(ir),ir=setTimeout(()=>{c("Reloading timestamps due to external update for video:",l.data.videoId),fa()},500);else if(l.data.type==="window_position_updated"&&i){let u=l.data.position;if(u&&typeof u.x=="number"&&typeof u.y=="number"){i.style.left=`${u.x}px`,i.style.top=`${u.y}px`,i.style.right="auto",i.style.bottom="auto",typeof u.width=="number"&&u.width>0&&(i.style.width=`${u.width}px`),typeof u.height=="number"&&u.height>0&&(i.style.height=`${u.height}px`);let p=i.getBoundingClientRect();Ge={x:Math.round(u.x),y:Math.round(u.y),width:Math.round(p.width),height:Math.round(p.height)};let y=document.documentElement.clientWidth,E=document.documentElement.clientHeight;(p.left<0||p.top<0||p.right>y||p.bottom>E)&&In()}}}}ra();let Sn=await GM.getValue(En);(typeof Sn!="number"||Number.isNaN(Sn))&&(Sn=xi,await GM.setValue(En,Sn));let rr=await GM.getValue(tr);(typeof rr!="number"||Number.isNaN(rr))&&(rr=Mr,await GM.setValue(tr,rr));let ir=null,Wt=new Map,Dr=!1,H=null,Rr=null,_e=null,pt=null,ke=null,Yt=null,St=null,tt=null,Ht=null,Br=!1,Ge=null,bi=!1,Or=null,Nr=null,Pr=null,zr=null,$r=null,Hr=null,Fr=null,ar=null,or=null,sr=null,ht=null,gt=null,aa=0,lr=!1,Kt=null,cr=null;function pe(){return ci(o)}function wi(){return Ga(o)}function Jt(){return cr!==null||(cr=qa(o)),cr}function jr(){cr=null}function Lo(l){let u=l.querySelector(".time-diff");return u?(u.textContent?.trim()||"").startsWith("-"):!1}function Co(l,u){return l?u?"\u2514\u2500 ":"\u251C\u2500 ":""}function ur(l){return l.startsWith("\u251C\u2500 ")||l.startsWith("\u2514\u2500 ")?1:0}function oa(l){return l.replace(/^[]\s/,"")}function Io(l){let u=pe();if(l>=u.length-1)return"\u2514\u2500 ";let p=u[l+1].querySelector("input");return p&&ur(p.value)===1?"\u251C\u2500 ":"\u2514\u2500 "}function yt(){if(!o)return;let l=pe(),u=!0,p=0,y=l.length;for(;u&&p<y;)u=!1,p++,l.forEach((E,_)=>{let v=E.querySelector("input");if(!v||!(ur(v.value)===1))return;let D=!1;if(_<l.length-1){let ie=l[_+1].querySelector("input");ie&&(D=!(ur(ie.value)===1))}else D=!0;let F=oa(v.value),j=`${Co(!0,D)}${F}`;v.value!==j&&(v.value=j,u=!0)})}function Ln(){$i(o),Yt&&(Yt=null),tt&&(tt(),tt=null,St=null)}function dr(){Va(o,we)}function sa(l){Hi(o,l)}function Ti(){Ua(o)}function ki(l){if(!(!i||!o)){if(we=l,l)i.style.display="",i.classList.remove("ytls-fade-out"),i.classList.add("ytls-fade-in"),sa("Loading timestamps...");else if(Ti(),i.style.display="",i.classList.remove("ytls-fade-out"),i.classList.add("ytls-fade-in"),m){let u=Q();if(u){let p=u.getCurrentTime(),y=Number.isFinite(p)?Math.max(0,Math.floor(p)):Math.max(0,Jt()),E=Math.floor(y/3600),_=Math.floor(y/60)%60,v=y%60,{isLive:x}=u.getVideoData()||{isLive:!1},D=o?pe().map(P=>{let j=P.querySelector("a[data-time]");return j?parseFloat(j.getAttribute("data-time")??"0"):0}):[],F="";if(D.length>0)if(x){let P=Math.max(1,y/60),j=D.filter(ie=>ie<=y);if(j.length>0){let ie=(j.length/P).toFixed(2);parseFloat(ie)>0&&(F=` (${ie}/min)`)}}else{let P=u.getDuration(),j=Number.isFinite(P)&&P>0?P:0,ie=Math.max(1,j/60),Oe=(D.length/ie).toFixed(1);parseFloat(Oe)>0&&(F=` (${Oe}/min)`)}m.textContent=`\u23F3${E?E+":"+String(_).padStart(2,"0"):_}:${String(v).padStart(2,"0")}${F}`}}!we&&o&&!o.querySelector(".ytls-error-message")&&dr(),Lt()}}function Ao(l){return l?Zn.safeParse(l).success:!1}function Ur(l,u){l.textContent=Nt(u),l.dataset.time=String(u),l.href=xr(u,window.location.href)}let Vr=null,Gr=null,Xt=!1;function Mo(l){if(!l||typeof l.getVideoData!="function"||!l.getVideoData()?.isLive)return!1;if(typeof l.getProgressState=="function"){let p=l.getProgressState(),y=Number(p?.seekableEnd??p?.liveHead??p?.head??p?.duration),E=Number(p?.current??l.getCurrentTime?.());if(Number.isFinite(y)&&Number.isFinite(E))return y-E>2}return!1}function Qt(l,u){if(!Number.isFinite(l))return;let p=qr(l);mr(p,u)}function qr(l){if(!Number.isFinite(l))return null;let u=pe();if(u.length===0)return null;let p=null,y=-1/0;for(let E of u){let v=E.querySelector("a[data-time]")?.dataset.time;if(!v)continue;let x=Number.parseInt(v,10);Number.isFinite(x)&&x<=l&&x>y&&(y=x,p=E)}return p}function mr(l,u=!1){if(!l)return;if(pe().forEach(y=>{y.classList.contains(xe)||y.classList.remove(Xe)}),!l.classList.contains(xe)&&(l.classList.add(Xe),u&&!Dr))try{if(o instanceof HTMLElement){let y=l.getBoundingClientRect(),E=o.getBoundingClientRect();!(y.bottom<E.top||y.top>E.bottom)||l.scrollIntoView({behavior:"smooth",block:"center"})}else l.scrollIntoView({behavior:"smooth",block:"center"})}catch{try{l.scrollIntoView({behavior:"smooth",block:"center"})}catch{}}}function Do(l){if(!o||o.querySelector(".ytls-error-message")||!Number.isFinite(l)||l===0)return!1;let u=pe();if(u.length===0)return!1;let p=!1;return u.forEach(y=>{let E=y.querySelector("a[data-time]"),_=E?.dataset.time;if(!E||!_)return;let v=Number.parseInt(_,10);if(!Number.isFinite(v))return;let x=Math.max(0,v+l);x!==v&&(Ur(E,x),p=!0)}),p?(pr(),yt(),ze(),Wr(_e),Kt=null,!0):!1}function la(l,u={}){if(!Number.isFinite(l)||l===0)return!1;if(!Do(l)){if(u.alertOnNoChange){let v=u.failureMessage??"Offset did not change any timestamps.";alert(v)}return!1}let y=u.logLabel??"bulk offset";c(`Timestamps changed: Offset all timestamps by ${l>0?"+":""}${l} seconds (${y})`);let E=Q(),_=E?Math.floor(E.getCurrentTime()):0;if(Number.isFinite(_)){let v=qr(_);mr(v,!1)}return!0}function ca(l){if(!o||we)return;let u=l.target instanceof HTMLElement?l.target:null;if(u)if(u.dataset.time){l.preventDefault();let p=Number(u.dataset.time);if(Number.isFinite(p)){Xt=!0;let E=Q();E&&E.seekTo(p),setTimeout(()=>{Xt=!1},500)}let y=u.closest("li");y&&(pe().forEach(E=>{E.classList.contains(xe)||E.classList.remove(Xe)}),y.classList.contains(xe)||(y.classList.add(Xe),y.scrollIntoView({behavior:"smooth",block:"center"})))}else if(u.dataset.increment){l.preventDefault();let y=u.parentElement?.querySelector("a[data-time]");if(!y||!y.dataset.time)return;let E=parseInt(y.dataset.time,10),_=parseInt(u.dataset.increment,10);if("shiftKey"in l&&l.shiftKey&&(_*=rr),"altKey"in l?l.altKey:!1){la(_,{logLabel:"Alt adjust"});return}let D=Math.max(0,E+_);c(`Timestamps changed: Timestamp time incremented from ${E} to ${D}`),Ur(y,D),jr();let F=u.closest("li");if(Gr=D,Vr&&clearTimeout(Vr),Xt=!0,Vr=setTimeout(()=>{if(Gr!==null){let P=Q();P&&P.seekTo(Gr)}Vr=null,Gr=null,setTimeout(()=>{Xt=!1},500)},500),pr(),yt(),ze(),F){let P=F.querySelector("input"),j=F.dataset.guid;P&&j&&(Cn(_e,j,D,P.value),Kt=j)}}else u.dataset.action==="clear"&&(l.preventDefault(),c("Timestamps changed: All timestamps cleared from UI"),o.textContent="",jr(),ze(),Zr(),Wr(_e,{allowEmpty:!0}),Kt=null,dr())}function fr(l,u="",p=!1,y=null,E=!0){if(!o)return null;let _=Math.max(0,l),v=y??crypto.randomUUID(),x=document.createElement("li"),D=document.createElement("div"),F=document.createElement("span"),P=document.createElement("span"),j=document.createElement("span"),ie=document.createElement("a"),Oe=document.createElement("span"),ee=document.createElement("input"),ce=document.createElement("button");x.dataset.guid=v,D.className="time-row";let Ct=document.createElement("div");Ct.style.cssText="position:absolute;left:0;top:0;width:20px;height:100%;display:flex;align-items:center;justify-content:center;cursor:pointer;",wt(Ct,"Click to toggle indent");let qe=document.createElement("span");qe.style.cssText="color:#999;font-size:12px;pointer-events:none;display:none;";let vt=()=>{let fe=ur(ee.value);qe.textContent=fe===1?"\u25C0":"\u25B6"},An=fe=>{fe.stopPropagation();let te=ur(ee.value),Se=oa(ee.value),Ae=te===0?1:0,de="";if(Ae===1){let st=pe().indexOf(x);de=Io(st)}ee.value=`${de}${Se}`,vt(),yt();let Le=Number.parseInt(ie.dataset.time??"0",10);Cn(_e,v,Le,ee.value)};Ct.onclick=An,Ct.append(qe),x.style.cssText="position:relative;padding-left:20px;",x.addEventListener("mouseenter",()=>{vt(),qe.style.display="inline"}),x.addEventListener("mouseleave",()=>{qe.style.display="none"}),x.addEventListener("mouseleave",()=>{x.dataset.guid===Kt&&Lo(x)&&ua()}),ee.value=u||"",ee.style.cssText="width:100%;margin-top:5px;display:block;",ee.type="text",ee.setAttribute("inputmode","text"),ee.autocapitalize="off",ee.autocomplete="off",ee.spellcheck=!1,ee.addEventListener("focusin",()=>{lr=!1}),ee.addEventListener("focusout",fe=>{let te=fe.relatedTarget,Se=Date.now()-aa<250,Ae=!!te&&!!i&&i.contains(te);!Se&&!Ae&&(lr=!0,setTimeout(()=>{(document.activeElement===document.body||document.activeElement==null)&&(ee.focus({preventScroll:!0}),lr=!1)},0))}),ee.addEventListener("input",fe=>{let te=fe;if(te&&(te.isComposing||te.inputType==="insertCompositionText"))return;let Se=Wt.get(v);Se&&clearTimeout(Se);let Ae=setTimeout(()=>{let de=Number.parseInt(ie.dataset.time??"0",10);Cn(_e,v,de,ee.value),Wt.delete(v)},500);Wt.set(v,Ae)}),ee.addEventListener("compositionend",()=>{let fe=Number.parseInt(ie.dataset.time??"0",10);setTimeout(()=>{Cn(_e,v,fe,ee.value)},50)}),F.textContent="\u2796",F.dataset.increment="-1",F.style.cursor="pointer",F.style.margin="0px",F.addEventListener("mouseenter",()=>{F.style.textShadow="0 0 8px rgba(255, 255, 255, 0.8), 0 0 12px rgba(100, 200, 255, 0.6)"}),F.addEventListener("mouseleave",()=>{F.style.textShadow="none"}),j.textContent="\u2795",j.dataset.increment="1",j.style.cursor="pointer",j.style.margin="0px",j.addEventListener("mouseenter",()=>{j.style.textShadow="0 0 8px rgba(255, 255, 255, 0.8), 0 0 12px rgba(100, 200, 255, 0.6)"}),j.addEventListener("mouseleave",()=>{j.style.textShadow="none"}),P.textContent="\u23FA\uFE0F",P.style.cursor="pointer",P.style.margin="0px",wt(P,"Set to current playback time"),P.addEventListener("mouseenter",()=>{P.style.textShadow="0 0 8px rgba(255, 255, 255, 0.8), 0 0 12px rgba(100, 200, 255, 0.6)"}),P.addEventListener("mouseleave",()=>{P.style.textShadow="none"}),P.onclick=()=>{let fe=Q(),te=fe?Math.floor(fe.getCurrentTime()):0;Number.isFinite(te)&&(c(`Timestamps changedset to current playback time ${te}`),Ur(ie,te),pr(),yt(),Cn(_e,v,te,ee.value),Kt=v)},Ur(ie,_),jr(),ce.textContent="\u{1F5D1}\uFE0F",ce.style.cssText="background:transparent;border:none;color:white;cursor:pointer;margin-left:5px;",ce.addEventListener("mouseenter",()=>{ce.style.textShadow="0 0 8px rgba(255, 255, 255, 0.8), 0 0 12px rgba(255, 100, 100, 0.6)"}),ce.addEventListener("mouseleave",()=>{ce.style.textShadow="none"}),ce.onclick=()=>{let fe=null,te=null,Se=null,Ae=()=>{try{x.removeEventListener("click",te,!0)}catch{}try{document.removeEventListener("click",te,!0)}catch{}if(o)try{o.removeEventListener("mouseleave",Se)}catch{}fe&&(clearTimeout(fe),fe=null)};if(x.dataset.deleteConfirmed==="true"){c("Timestamps changed: Timestamp deleted");let de=x.dataset.guid??"",Le=Wt.get(de);Le&&(clearTimeout(Le),Wt.delete(de)),Ae(),x.remove(),jr(),pr(),yt(),ze(),Zr(),Ro(_e,de),Kt=null,dr()}else{x.dataset.deleteConfirmed="true",x.classList.add(xe),x.classList.remove(Xe);let de=()=>{x.dataset.deleteConfirmed="false",x.classList.remove(xe);let Le=Q(),xt=Le?Le.getCurrentTime():0,st=Number.parseInt(x.querySelector("a[data-time]")?.dataset.time??"0",10);Number.isFinite(xt)&&Number.isFinite(st)&&xt>=st&&x.classList.add(Xe),Ae()};te=Le=>{Le.target!==ce&&de()},Se=()=>{x.dataset.deleteConfirmed==="true"&&de()},x.addEventListener("click",te,!0),document.addEventListener("click",te,!0),o&&o.addEventListener("mouseleave",Se),fe=setTimeout(()=>{x.dataset.deleteConfirmed==="true"&&de(),Ae()},5e3)}},Oe.className="time-diff",Oe.style.color="#888",Oe.style.marginLeft="5px",D.append(F,P,j,ie,Oe,ce),x.append(Ct,D,ee);let It=Number.parseInt(ie.dataset.time??"0",10);if(E){Ti();let fe=!1,te=pe();for(let Se=0;Se<te.length;Se++){let Ae=te[Se],Le=Ae.querySelector("a[data-time]")?.dataset.time;if(!Le)continue;let xt=Number.parseInt(Le,10);if(Number.isFinite(xt)&&It<xt){o.insertBefore(x,Ae),fe=!0;let st=te[Se-1];if(st){let Dn=st.querySelector("a[data-time]")?.dataset.time;if(Dn){let Rn=Number.parseInt(Dn,10);Number.isFinite(Rn)&&(Oe.textContent=Nt(It-Rn))}}else Oe.textContent="";let Mn=Ae.querySelector(".time-diff");Mn&&(Mn.textContent=Nt(xt-It));break}}if(!fe&&(o.appendChild(x),te.length>0)){let de=te[te.length-1].querySelector("a[data-time]")?.dataset.time;if(de){let Le=Number.parseInt(de,10);Number.isFinite(Le)&&(Oe.textContent=Nt(It-Le))}}x.scrollIntoView({behavior:"smooth",block:"center"}),Zr(),yt(),ze(),p||(Cn(_e,v,_,u),Kt=v,mr(x,!1))}else ee.__ytls_li=x;return ee}function pr(){if(!o||o.querySelector(".ytls-error-message"))return;let l=pe();l.forEach((u,p)=>{let y=u.querySelector(".time-diff");if(!y)return;let _=u.querySelector("a[data-time]")?.dataset.time;if(!_){y.textContent="";return}let v=Number.parseInt(_,10);if(!Number.isFinite(v)){y.textContent="";return}if(p===0){y.textContent="";return}let F=l[p-1].querySelector("a[data-time]")?.dataset.time;if(!F){y.textContent="";return}let P=Number.parseInt(F,10);if(!Number.isFinite(P)){y.textContent="";return}let j=v-P,ie=j<0?"-":"";y.textContent=` ${ie}${Nt(Math.abs(j))}`})}function ua(){if(!o||o.querySelector(".ytls-error-message")||we)return;let l=null;if(document.activeElement instanceof HTMLInputElement&&o.contains(document.activeElement)){let v=document.activeElement,D=v.closest("li")?.dataset.guid;if(D){let F=v.selectionStart??v.value.length,P=v.selectionEnd??F,j=v.scrollLeft;l={guid:D,start:F,end:P,scroll:j}}}let u=pe();if(u.length===0)return;let p=u.map(v=>v.dataset.guid),y=u.map(v=>{let x=v.querySelector("a[data-time]"),D=x?.dataset.time;if(!x||!D)return null;let F=Number.parseInt(D,10);if(!Number.isFinite(F))return null;let P=v.dataset.guid??"";return{time:F,guid:P,element:v}}).filter(v=>v!==null).sort((v,x)=>{let D=v.time-x.time;return D!==0?D:v.guid.localeCompare(x.guid)}),E=y.map(v=>v.guid),_=p.length!==E.length||p.some((v,x)=>v!==E[x]);for(;o.firstChild;)o.removeChild(o.firstChild);if(y.forEach(v=>{o.appendChild(v.element)}),pr(),yt(),ze(),l){let x=pe().find(D=>D.dataset.guid===l.guid)?.querySelector("input");if(x)try{x.focus({preventScroll:!0})}catch{}}_&&(c("Timestamps changed: Timestamps sorted"),Wr(_e))}function Zr(){if(!o||!i||!s||!d)return;let l=pe().length;typeof window.recalculateTimestampsArea=="function"&&window.recalculateTimestampsArea();let u=i.getBoundingClientRect(),p=s.getBoundingClientRect(),y=d.getBoundingClientRect(),E=Math.max(0,u.height-(p.height+y.height));l===0?(dr(),o.style.overflowY="hidden"):o.style.overflowY=o.scrollHeight>E?"auto":"hidden"}function ze(){if(!o)return;let l=et(),u=document.querySelector(".ytp-progress-bar"),p=Q(),y=p?p.getVideoData():null,E=!!y&&!!y.isLive;if(!l||!u||!isFinite(l.duration)||E)return;ma(),pe().map(v=>{let x=v.querySelector("a[data-time]"),D=x?.dataset.time;if(!x||!D)return null;let F=Number.parseInt(D,10);if(!Number.isFinite(F))return null;let j=v.querySelector("input")?.value??"",ie=v.dataset.guid??crypto.randomUUID();return v.dataset.guid||(v.dataset.guid=ie),{start:F,comment:j,guid:ie}}).filter(Ao).forEach(v=>{if(!Number.isFinite(v.start))return;let x=document.createElement("div");x.className="ytls-marker",x.style.position="absolute",x.style.height="100%",x.style.width="2px",x.style.backgroundColor="#ff0000",x.style.cursor="pointer",x.style.left=v.start/l.duration*100+"%",x.dataset.time=String(v.start),x.addEventListener("click",()=>{let D=Q();D&&D.seekTo(v.start)}),u.appendChild(x)})}function Wr(l,u={}){if(!o||o.querySelector(".ytls-error-message")||!l)return;if(we){c("Save blocked: timestamps are currently loading");return}yt();let p=wi().sort((y,E)=>y.start-E.start);if(p.length===0&&!u.allowEmpty){c("Save skipped: no timestamps to save");return}pa(l,p).then(()=>c(`Successfully saved ${p.length} timestamps for ${l} to IndexedDB`)).catch(y=>c(`Failed to save timestamps for ${l} to IndexedDB:`,y,"error")),nr({type:"timestamps_updated",videoId:l,action:"saved"})}function Cn(l,u,p,y){if(!l||we)return;let E={guid:u,start:p,comment:y};c(`Saving timestamp: guid=${u}, start=${p}, comment="${y}"`),zo(l,E).catch(_=>c(`Failed to save timestamp ${u}:`,_,"error")),nr({type:"timestamps_updated",videoId:l,action:"saved"})}function Ro(l,u){!l||we||(c(`Deleting timestamp: guid=${u}`),$o(l,u).catch(p=>c(`Failed to delete timestamp ${u}:`,p,"error")),nr({type:"timestamps_updated",videoId:l,action:"saved"}))}async function da(l){if(!o||o.querySelector(".ytls-error-message")){alert("Cannot export timestamps while displaying an error message.");return}let u=_e;if(!u)return;c(`Exporting timestamps for video ID: ${u}`);let p=wi(),y=Math.max(Jt(),0),E=Gn();if(l==="json"){let _=new Blob([JSON.stringify(p,null,2)],{type:"application/json"}),v=URL.createObjectURL(_),x=document.createElement("a");x.href=v,x.download=`timestamps-${u}-${E}.json`,x.click(),URL.revokeObjectURL(v)}else if(l==="text"){let _=p.map(F=>{let P=Nt(F.start,y),j=`${F.comment} <!-- guid:${F.guid} -->`.trimStart();return`${P} ${j}`}).join(`
`),v=new Blob([_],{type:"text/plain"}),x=URL.createObjectURL(v),D=document.createElement("a");D.href=x,D.download=`timestamps-${u}-${E}.txt`,D.click(),URL.revokeObjectURL(x)}}function Ei(l){if(!i||!o){c("Timekeeper error:",l,"error");return}Ln();let u=document.createElement("li");u.textContent=l,u.classList.add("ytls-error-message"),u.style.color="#ff6b6b",u.style.fontWeight="bold",u.style.padding="8px",u.style.background="rgba(255, 0, 0, 0.1)",o.appendChild(u),ze()}function ma(){document.querySelectorAll(".ytls-marker").forEach(l=>l.remove())}function In(){if(!i||!document.body.contains(i))return;let l=i.getBoundingClientRect(),u=document.documentElement.clientWidth,p=document.documentElement.clientHeight,y=l.width,E=l.height;if(l.left<0&&(i.style.left="0",i.style.right="auto"),l.right>u){let _=Math.max(0,u-y);i.style.left=`${_}px`,i.style.right="auto"}if(l.top<0&&(i.style.top="0",i.style.bottom="auto"),l.bottom>p){let _=Math.max(0,p-E);i.style.top=`${_}px`,i.style.bottom="auto"}}function Bo(){if(Or&&(document.removeEventListener("mousemove",Or),Or=null),Nr&&(document.removeEventListener("mouseup",Nr),Nr=null),ar&&(document.removeEventListener("keydown",ar),ar=null),Pr&&(window.removeEventListener("resize",Pr),Pr=null),or&&(document.removeEventListener("pointerdown",or,!0),or=null),sr&&(document.removeEventListener("pointerup",sr,!0),sr=null),ht){try{ht.disconnect()}catch{}ht=null}if(gt){try{gt.disconnect()}catch{}gt=null}let l=et();l&&(zr&&(l.removeEventListener("timeupdate",zr),zr=null),$r&&(l.removeEventListener("pause",$r),$r=null),Hr&&(l.removeEventListener("play",Hr),Hr=null),Fr&&(l.removeEventListener("seeking",Fr),Fr=null))}function Oo(){ma(),Wt.forEach(u=>clearTimeout(u)),Wt.clear(),ir&&(clearTimeout(ir),ir=null),ve&&(clearInterval(ve),ve=null),pt&&(clearTimeout(pt),pt=null),Bo();try{Ve.close()}catch{}if(H&&H.parentNode===document.body&&document.body.removeChild(H),H=null,Rr=null,Dr=!1,_e=null,ht){try{ht.disconnect()}catch{}ht=null}if(gt){try{gt.disconnect()}catch{}gt=null}i&&i.parentNode&&i.remove();let l=document.getElementById("ytls-header-button");l&&l.parentNode&&l.remove(),Ht=null,Br=!1,Ge=null,Ln(),i=null,s=null,o=null,d=null,m=null,f=null,k=null,Ue=null}async function No(){let l=_i();if(!l)return Ue=null,{ok:!1,message:"Timekeeper cannot determine the current video ID. Please refresh the page or open a standard YouTube watch URL."};let u=await Ar();if(!be(u)){let p=$t(u),y=p.length?` Missing methods: ${p.join(", ")}.`:"",E=u?"Timekeeper cannot access the YouTube player API.":"Timekeeper cannot find the YouTube player on this page.";return Ue=null,{ok:!1,message:`${E}${y} Try refreshing once playback is ready.`}}return Ue=u,{ok:!0,player:u,videoId:l}}async function fa(){if(!i||!o)return;let l=o.scrollTop,u=!0,p=()=>{if(!o||!u)return;let y=Math.max(0,o.scrollHeight-o.clientHeight);o.scrollTop=Math.min(l,y)};try{let y=await No();if(!y.ok){Ei(y.message),Ln(),ze();return}let{videoId:E}=y,_=[];try{let v=await Ho(E);v?(_=v.map(x=>({...x,guid:x.guid||crypto.randomUUID()})),c(`Loaded ${_.length} timestamps from IndexedDB for ${E}`)):c(`No timestamps found in IndexedDB for ${E}`)}catch(v){c(`Failed to load timestamps from IndexedDB for ${E}:`,v,"error"),Ei("Failed to load timestamps from IndexedDB. Try refreshing the page."),ze();return}if(_.length>0){_.sort((P,j)=>P.start-j.start),Ln(),Ti();let v=document.createDocumentFragment();_.forEach(P=>{let ie=fr(P.start,P.comment,!0,P.guid,!1).__ytls_li;ie&&v.appendChild(ie)}),i&&i.classList.contains("ytls-zoom-in")&&ke!=null?(c("Deferring timestamp DOM append until show animation completes"),Yt=v,St||(St=new Promise(P=>{tt=P})),await St):o&&(o.appendChild(v),yt(),ze(),typeof window.recalculateTimestampsArea=="function"&&requestAnimationFrame(()=>window.recalculateTimestampsArea()));let D=Q(),F=D?Math.floor(D.getCurrentTime()):Jt();Number.isFinite(F)&&(Qt(F,!1),u=!1)}else Ln(),sa("No timestamps for this video"),ze(),typeof window.recalculateTimestampsArea=="function"&&requestAnimationFrame(()=>window.recalculateTimestampsArea())}catch(y){c("Unexpected error while loading timestamps:",y,"error"),Ei("Timekeeper encountered an unexpected error while loading timestamps. Check the console for details.")}finally{St&&await St,requestAnimationFrame(p),typeof window.recalculateTimestampsArea=="function"&&requestAnimationFrame(()=>window.recalculateTimestampsArea()),o&&!o.querySelector(".ytls-error-message")&&dr()}}function _i(){let u=new URLSearchParams(location.search).get("v");if(u)return u;let p=document.querySelector('meta[itemprop="identifier"]');return p?.content?p.content:null}function Po(){let l=et();if(!l)return;let u=()=>{if(!o)return;let v=Q(),x=v?Math.floor(v.getCurrentTime()):0;if(!Number.isFinite(x))return;let D=qr(x);mr(D,!1)},p=v=>{try{let x=new URL(window.location.href);v!==null&&Number.isFinite(v)?x.searchParams.set("t",`${Math.floor(v)}s`):x.searchParams.delete("t"),window.history.replaceState({},"",x.toString())}catch{}},y=()=>{let v=Q(),x=v?Math.floor(v.getCurrentTime()):NaN;if(Number.isFinite(x)){p(x);try{Qt(x,!0)}catch(D){c("Failed to highlight nearest timestamp on pause:",D,"warn")}}},E=()=>{p(null);try{let v=Q(),x=v?Math.floor(v.getCurrentTime()):NaN;Number.isFinite(x)&&Qt(x,!0)}catch(v){c("Failed to highlight nearest timestamp on play:",v,"warn")}},_=()=>{let v=et();if(!v)return;let x=Q(),D=x?Math.floor(x.getCurrentTime()):0;if(!Number.isFinite(D))return;v.paused&&p(D);let F=qr(D);mr(F,!0)};zr=u,$r=y,Hr=E,Fr=_,l.addEventListener("timeupdate",u),l.addEventListener("pause",y),l.addEventListener("play",E),l.addEventListener("seeking",_)}let{saveToIndexedDB:pa,saveSingleTimestampToIndexedDB:zo,deleteSingleTimestampFromIndexedDB:$o,loadFromIndexedDB:Ho,removeFromIndexedDB:Fo,saveGlobalSettings:Yr,loadGlobalSettings:Si,buildExportPayload:jo,exportAllTimestamps:Uo,buildExportCsvPayload:Jl,exportAllTimestampsCsv:Vo,getAllFromIndexedDB:Xl,SETTINGS_STORE_NAME:Ql,STORE_NAME_V2:ec}=zi;function ha(){if(!i)return;let l=i.style.display!=="none";Yr("uiVisible",l)}function Lt(l){let u=typeof l=="boolean"?l:!!i&&i.style.display!=="none",p=document.getElementById("ytls-header-button");p instanceof HTMLButtonElement&&p.setAttribute("aria-pressed",String(u)),Ht&&!Br&&Ht.src!==Be&&(Ht.src=Be)}function Go(){i&&Si("uiVisible").then(l=>{let u=M.boolean().safeParse(l),p=u.success?u.data:void 0;typeof p=="boolean"?(p?(i.style.display="flex",i.classList.remove("ytls-zoom-out"),i.classList.add("ytls-zoom-in")):i.style.display="none",Lt(p)):(!u.success&&l!==void 0&&c("UI visibility state failed validation, defaulting to visible",u.error.format(),"warn"),i.style.display="flex",i.classList.remove("ytls-zoom-out"),i.classList.add("ytls-zoom-in"),Lt(!0))}).catch(l=>{c("Failed to load UI visibility state:",l,"error"),i.style.display="flex",i.classList.remove("ytls-zoom-out"),i.classList.add("ytls-zoom-in"),Lt(!0)})}function Li(l){if(!i){c("ERROR: togglePaneVisibility called but pane is null");return}document.body.contains(i)||(c("Pane not in DOM during toggle, appending it"),document.querySelectorAll("#ytls-pane").forEach(E=>{E!==i&&E.remove()}),document.body.appendChild(i));let u=document.querySelectorAll("#ytls-pane");u.length>1&&(c(`ERROR: Multiple panes detected in togglePaneVisibility (${u.length}), cleaning up`),u.forEach(E=>{E!==i&&E.remove()})),pt&&(clearTimeout(pt),pt=null);let p=i.style.display==="none";(typeof l=="boolean"?l:p)?(i.style.display="flex",i.classList.remove("ytls-fade-out"),i.classList.remove("ytls-zoom-out"),i.classList.add("ytls-zoom-in"),Lt(!0),ha(),ge(),ke&&(clearTimeout(ke),ke=null),ke=setTimeout(()=>{Z(),typeof window.recalculateTimestampsArea=="function"&&window.recalculateTimestampsArea(),J(),ue(!0);try{let E=Q(),_=E?Math.floor(E.getCurrentTime()):NaN;Number.isFinite(_)&&Qt(_,!0)}catch(E){c("Failed to scroll to nearest timestamp after toggle:",E,"warn")}ke=null},450)):(i.classList.remove("ytls-fade-in"),i.classList.remove("ytls-zoom-in"),i.classList.add("ytls-zoom-out"),Lt(!1),X())}function ga(l){if(!o){c("UI is not initialized; cannot import timestamps.","warn");return}let u=!1;try{let p=JSON.parse(l),y=null;if(Array.isArray(p))y=p;else if(typeof p=="object"&&p!==null){let E=_e;if(E){let _=`timekeeper-${E}`;p[_]&&Array.isArray(p[_].timestamps)&&(y=p[_].timestamps,c(`Found timestamps for current video (${E}) in export format`,"info"))}if(!y){let _=Object.keys(p).filter(v=>v.startsWith("ytls-"));if(_.length===1&&Array.isArray(p[_[0]].timestamps)){y=p[_[0]].timestamps;let v=p[_[0]].video_id;c(`Found timestamps for video ${v} in export format`,"info")}}}y&&Array.isArray(y)?y.every(_=>typeof _.start=="number"&&typeof _.comment=="string")?(y.forEach(_=>{if(_.guid){let v=pe().find(x=>x.dataset.guid===_.guid);if(v){let x=v.querySelector("input");x&&(x.value=_.comment)}else fr(_.start,_.comment,!1,_.guid)}else fr(_.start,_.comment,!1,crypto.randomUUID())}),u=!0):c("Parsed JSON array, but items are not in the expected timestamp format. Trying as plain text.","warn"):c("Parsed JSON, but couldn't find valid timestamps. Trying as plain text.","warn")}catch{}if(!u){let p=l.split(`
`).map(y=>y.trim()).filter(y=>y);if(p.length>0){let y=!1;p.forEach(E=>{let _=E.match(/^(?:(\d{1,2}):)?(\d{1,2}):(\d{2})\s*(.*)$/);if(_){y=!0;let v=parseInt(_[1])||0,x=parseInt(_[2]),D=parseInt(_[3]),F=v*3600+x*60+D,P=_[4]?_[4].trim():"",j=null,ie=P,Oe=P.match(/<!--\s*guid:([^>]+?)\s*-->/);Oe&&(j=Oe[1].trim(),ie=P.replace(/<!--\s*guid:[^>]+?\s*-->/,"").trim());let ee;if(j&&(ee=pe().find(ce=>ce.dataset.guid===j)),!ee&&!j&&(ee=pe().find(ce=>{if(ce.dataset.guid)return!1;let qe=ce.querySelector("a[data-time]")?.dataset.time;if(!qe)return!1;let vt=Number.parseInt(qe,10);return Number.isFinite(vt)&&vt===F})),ee){let ce=ee.querySelector("input");ce&&(ce.value=ie)}else fr(F,ie,!1,j||crypto.randomUUID())}}),y&&(u=!0)}}u?(c("Timestamps changed: Imported timestamps from file/clipboard"),yt(),Wr(_e),ze(),Zr()):alert("Failed to parse content. Please ensure it is in the correct JSON or plain text format.")}async function qo(){if(bi){c("Pane initialization already in progress, skipping duplicate call");return}if(!(i&&document.body.contains(i))){bi=!0;try{let y=function(){if(we||Xt)return;let g=et(),h=Q();if(!g&&!h)return;let b=h?h.getCurrentTime():0,w=Number.isFinite(b)?Math.max(0,Math.floor(b)):Math.max(0,Jt()),R=Math.floor(w/3600),$=Math.floor(w/60)%60,z=w%60,{isLive:W}=h?h.getVideoData()||{isLive:!1}:{isLive:!1},U=h?Mo(h):!1,se=o?pe().map(oe=>{let Ce=oe.querySelector("a[data-time]");return Ce?parseFloat(Ce.getAttribute("data-time")??"0"):0}):[],$e="";if(se.length>0)if(W){let oe=Math.max(1,w/60),Ce=se.filter(He=>He<=w);if(Ce.length>0){let He=(Ce.length/oe).toFixed(2);parseFloat(He)>0&&($e=` (${He}/min)`)}}else{let oe=h?h.getDuration():0,Ce=Number.isFinite(oe)&&oe>0?oe:g&&Number.isFinite(g.duration)&&g.duration>0?g.duration:0,He=Math.max(1,Ce/60),At=(se.length/He).toFixed(1);parseFloat(At)>0&&($e=` (${At}/min)`)}m.textContent=`\u23F3${R?R+":"+String($).padStart(2,"0"):$}:${String(z).padStart(2,"0")}${$e}`,m.style.color=U?"#ff4d4f":"",se.length>0&&Qt(w,!1)},ce=function(g,h,b){let w=document.createElement("button");return w.textContent=g,wt(w,h),w.classList.add("ytls-settings-modal-button"),w.onclick=b,w},Ct=function(g="general"){if(H&&H.parentNode===document.body){let Ne=document.getElementById("ytls-save-modal"),Ft=document.getElementById("ytls-load-modal"),Mt=document.getElementById("ytls-delete-all-modal");Ne&&document.body.contains(Ne)&&document.body.removeChild(Ne),Ft&&document.body.contains(Ft)&&document.body.removeChild(Ft),Mt&&document.body.contains(Mt)&&document.body.removeChild(Mt),H.classList.remove("ytls-fade-in"),H.classList.add("ytls-fade-out"),setTimeout(()=>{document.body.contains(H)&&document.body.removeChild(H),H=null,document.removeEventListener("click",vt,!0),document.removeEventListener("keydown",qe)},300);return}H=document.createElement("div"),H.id="ytls-settings-modal",H.classList.remove("ytls-fade-out"),H.classList.add("ytls-fade-in");let h=document.createElement("div");h.className="ytls-modal-header";let b=document.createElement("div");b.id="ytls-settings-nav";let w=document.createElement("button");w.className="ytls-modal-close-button",w.textContent="\u2715",w.onclick=()=>{if(H&&H.parentNode===document.body){let Ne=document.getElementById("ytls-save-modal"),Ft=document.getElementById("ytls-load-modal"),Mt=document.getElementById("ytls-delete-all-modal");Ne&&document.body.contains(Ne)&&document.body.removeChild(Ne),Ft&&document.body.contains(Ft)&&document.body.removeChild(Ft),Mt&&document.body.contains(Mt)&&document.body.removeChild(Mt),H.classList.remove("ytls-fade-in"),H.classList.add("ytls-fade-out"),setTimeout(()=>{document.body.contains(H)&&document.body.removeChild(H),H=null,document.removeEventListener("click",vt,!0),document.removeEventListener("keydown",qe)},300)}};let R=document.createElement("div");R.id="ytls-settings-content";let $=document.createElement("h3");$.className="ytls-section-heading",$.textContent="General",$.style.display="none";let z=document.createElement("div"),W=document.createElement("div");W.className="ytls-button-grid";function U(Ne){z.style.display=Ne==="general"?"block":"none",W.style.display=Ne==="drive"?"block":"none",se.classList.toggle("active",Ne==="general"),oe.classList.toggle("active",Ne==="drive"),$.textContent=Ne==="general"?"General":"Google Drive"}let se=document.createElement("button");se.textContent="\u{1F6E0}\uFE0F";let $e=document.createElement("span");$e.className="ytls-tab-text",$e.textContent=" General",se.appendChild($e),wt(se,"General settings"),se.classList.add("ytls-settings-modal-button"),se.onclick=()=>U("general");let oe=document.createElement("button");oe.textContent="\u2601\uFE0F";let Ce=document.createElement("span");Ce.className="ytls-tab-text",Ce.textContent=" Backup",oe.appendChild(Ce),wt(oe,"Google Drive sign-in and backup"),oe.classList.add("ytls-settings-modal-button"),oe.onclick=async()=>{O.isSignedIn&&await wo(),U("drive")},b.appendChild(se),b.appendChild(oe),h.appendChild(b),h.appendChild(w),H.appendChild(h),z.className="ytls-button-grid",z.appendChild(ce("\u{1F4BE} Save","Save As...",An.onclick)),z.appendChild(ce("\u{1F4C2} Load","Load",It.onclick)),z.appendChild(ce("\u{1F4E4} Export All","Export All Data",fe.onclick)),z.appendChild(ce("\u{1F4E5} Import All","Import All Data",te.onclick)),z.appendChild(ce("\u{1F4C4} Export All (CSV)","Export All Timestamps to CSV",async()=>{try{await Vo()}catch{alert("Failed to export CSV: Could not read from database.")}}));let He=ce(O.isSignedIn?"\u{1F513} Sign Out":"\u{1F510} Sign In",O.isSignedIn?"Sign out from Google Drive":"Sign in to Google Drive",async()=>{O.isSignedIn?await bo():await vo(),He.textContent=O.isSignedIn?"\u{1F513} Sign Out":"\u{1F510} Sign In",wt(He,O.isSignedIn?"Sign out from Google Drive":"Sign in to Google Drive"),typeof he=="function"&&he()});W.appendChild(He);let At=ce(ft?"\u{1F501} Auto Backup: On":"\u{1F501} Auto Backup: Off","Toggle Auto Backup",async()=>{await _o(),At.textContent=ft?"\u{1F501} Auto Backup: On":"\u{1F501} Auto Backup: Off",typeof he=="function"&&he()});W.appendChild(At);let tn=ce(`\u23F1\uFE0F Backup Interval: ${Je}min`,"Set periodic backup interval (minutes)",async()=>{await So(),tn.textContent=`\u23F1\uFE0F Backup Interval: ${Je}min`,typeof he=="function"&&he()});W.appendChild(tn),W.appendChild(ce("\u{1F5C4}\uFE0F Backup Now","Run a backup immediately",async()=>{await Cr(!1),typeof he=="function"&&he()}));let nt=document.createElement("div");nt.style.marginTop="15px",nt.style.paddingTop="10px",nt.style.borderTop="1px solid #555",nt.style.fontSize="12px",nt.style.color="#aaa";let nn=document.createElement("div");nn.style.marginBottom="8px",nn.style.fontWeight="bold",nt.appendChild(nn),ho(nn);let Ii=document.createElement("div");Ii.style.marginBottom="8px",fo(Ii),nt.appendChild(Ii);let wa=document.createElement("div");po(wa),nt.appendChild(wa),W.appendChild(nt),Ke(),Ir(),he(),R.appendChild($),R.appendChild(z),R.appendChild(W),U(g),H.appendChild(R),document.body.appendChild(H),requestAnimationFrame(()=>{let Ne=H.getBoundingClientRect(),Mt=(window.innerHeight-Ne.height)/2;H.style.top=`${Math.max(20,Mt)}px`,H.style.transform="translateX(-50%)"}),setTimeout(()=>{document.addEventListener("click",vt,!0),document.addEventListener("keydown",qe)},0)},qe=function(g){if(g.key==="Escape"&&H&&H.parentNode===document.body){let h=document.getElementById("ytls-save-modal"),b=document.getElementById("ytls-load-modal"),w=document.getElementById("ytls-delete-all-modal");if(h||b||w)return;g.preventDefault(),h&&document.body.contains(h)&&document.body.removeChild(h),b&&document.body.contains(b)&&document.body.removeChild(b),w&&document.body.contains(w)&&document.body.removeChild(w),H.classList.remove("ytls-fade-in"),H.classList.add("ytls-fade-out"),setTimeout(()=>{document.body.contains(H)&&document.body.removeChild(H),H=null,document.removeEventListener("click",vt,!0),document.removeEventListener("keydown",qe)},300)}},vt=function(g){if(Rr&&Rr.contains(g.target))return;let h=document.getElementById("ytls-save-modal"),b=document.getElementById("ytls-load-modal"),w=document.getElementById("ytls-delete-all-modal");h&&h.contains(g.target)||b&&b.contains(g.target)||w&&w.contains(g.target)||H&&H.contains(g.target)||(h&&document.body.contains(h)&&document.body.removeChild(h),b&&document.body.contains(b)&&document.body.removeChild(b),w&&document.body.contains(w)&&document.body.removeChild(w),H&&H.parentNode===document.body&&(H.classList.remove("ytls-fade-in"),H.classList.add("ytls-fade-out"),setTimeout(()=>{document.body.contains(H)&&document.body.removeChild(H),H=null,document.removeEventListener("click",vt,!0),document.removeEventListener("keydown",qe)},300)))},Se=function(){i&&(c("Loading window position from IndexedDB"),Si("windowPosition").then(g=>{let h=za.safeParse(g);if(h.success){let w=h.data;i.style.left=`${w.x}px`,i.style.top=`${w.y}px`,i.style.right="auto",i.style.bottom="auto",typeof w.width=="number"&&w.width>0?i.style.width=`${w.width}px`:(i.style.width=`${_n}px`,c(`No stored window width found, using default width ${_n}px`)),typeof w.height=="number"&&w.height>0?i.style.height=`${w.height}px`:(i.style.height=`${Zt}px`,c(`No stored window height found, using default height ${Zt}px`));let R=re();me(R,w.x,w.y),c("Restored window position from IndexedDB:",Ge)}else h.success?c("No window position found in IndexedDB, applying default size and leaving default position"):c("Window position in IndexedDB failed validation:",h.error.format(),"warn"),i.style.width=`${_n}px`,i.style.height=`${Zt}px`,Ge=null;In();let b=re();b&&(b.width||b.height)&&me(b),typeof window.recalculateTimestampsArea=="function"&&window.recalculateTimestampsArea()}).catch(g=>{c("failed to load pane position from IndexedDB:",g,"warn"),In();let h=re();h&&(h.width||h.height)&&(Ge={x:Math.max(0,Math.round(h.left)),y:0,width:Math.round(h.width),height:Math.round(h.height)}),typeof window.recalculateTimestampsArea=="function"&&window.recalculateTimestampsArea()}))},Ae=function(){if(!i)return;let g=re();if(!g)return;let h={x:Math.max(0,Math.round(g.left)),y:Math.max(0,Math.round(g.top)),width:Math.round(g.width),height:Math.round(g.height)};if(Ge&&Ge.x===h.x&&Ge.y===h.y&&Ge.width===h.width&&Ge.height===h.height){c("Skipping window position save; position and size unchanged");return}Ge={...h},c(`Saving window position and size to IndexedDB: x=${h.x}, y=${h.y}, width=${h.width}, height=${h.height}`),Yr("windowPosition",h),nr({type:"window_position_updated",position:h,timestamp:Date.now()})},Qr=function(g,h){g.addEventListener("dblclick",b=>{b.preventDefault(),b.stopPropagation(),i&&(i.style.width="300px",i.style.height="300px",Ae(),hr())}),g.addEventListener("mousedown",b=>{b.preventDefault(),b.stopPropagation(),Bn=!0,en=h,xa=b.clientX,ba=b.clientY;let w=i.getBoundingClientRect();On=w.width,Nn=w.height,Jr=w.left,Xr=w.top,h==="top-left"||h==="bottom-right"?document.body.style.cursor="nwse-resize":document.body.style.cursor="nesw-resize"})},hr=function(){if(i&&s&&d&&o){let g=i.getBoundingClientRect(),h=s.getBoundingClientRect(),b=d.getBoundingClientRect(),w=g.height-(h.height+b.height);o.style.maxHeight=w>0?w+"px":"0px",o.style.overflowY=w>0?"auto":"hidden"}};document.querySelectorAll("#ytls-pane").forEach(g=>g.remove()),i=document.createElement("div"),s=document.createElement("div"),o=document.createElement("ul"),d=document.createElement("div"),m=document.createElement("span"),f=document.createElement("style"),k=document.createElement("span"),L=document.createElement("span"),L.classList.add("ytls-backup-indicator"),L.style.cursor="pointer",L.style.backgroundColor="#666",L.onclick=g=>{g.stopPropagation(),Ct("drive")},o.addEventListener("mouseenter",()=>{Dr=!0,lr=!1}),o.addEventListener("mouseleave",()=>{if(Dr=!1,lr)return;let g=Q(),h=g?Math.floor(g.getCurrentTime()):Jt();Qt(h,!1);let b=null;if(document.activeElement instanceof HTMLInputElement&&o.contains(document.activeElement)&&(b=document.activeElement.closest("li")?.dataset.guid??null),ua(),b){let R=pe().find($=>$.dataset.guid===b)?.querySelector("input");if(R)try{R.focus({preventScroll:!0})}catch{}}}),i.id="ytls-pane",s.id="ytls-pane-header",s.addEventListener("dblclick",g=>{let h=g.target instanceof HTMLElement?g.target:null;h&&(h.closest("a")||h.closest("button")||h.closest("#ytls-current-time")||h.closest(".ytls-version-display")||h.closest(".ytls-backup-indicator"))||(g.preventDefault(),Li(!1))});let l=g=>{try{g.stopPropagation()}catch{}};["click","dblclick","mousedown","pointerdown","touchstart","wheel"].forEach(g=>{i.addEventListener(g,l)}),i.addEventListener("keydown",g=>{try{g.stopPropagation()}catch{}}),i.addEventListener("keyup",g=>{try{g.stopPropagation()}catch{}}),i.addEventListener("focus",g=>{try{g.stopPropagation()}catch{}},!0),i.addEventListener("blur",g=>{try{g.stopPropagation()}catch{}},!0);let u=GM_info.script.version;k.textContent=`v${u}`,k.classList.add("ytls-version-display");let p=document.createElement("span");p.style.display="inline-flex",p.style.alignItems="center",p.style.gap="6px",p.appendChild(k),p.appendChild(L),m.id="ytls-current-time",m.textContent="\u23F3",m.onclick=()=>{Xt=!0;let g=Q();g&&g.seekToLiveHead(),setTimeout(()=>{Xt=!1},500)},y(),ve&&clearInterval(ve),ve=setInterval(y,1e3),d.id="ytls-buttons";let E=(g,h)=>()=>{g.classList.remove("ytls-fade-in"),g.classList.add("ytls-fade-out"),setTimeout(()=>{document.body.contains(g)&&document.body.removeChild(g),h&&h()},300)},_=g=>h=>{h.key==="Escape"&&(h.preventDefault(),h.stopPropagation(),g())},v=g=>{setTimeout(()=>{document.addEventListener("keydown",g)},0)},x=(g,h)=>b=>{g.contains(b.target)||h()},D=g=>{setTimeout(()=>{document.addEventListener("click",g,!0)},0)},Oe=[{label:"\u{1F423}",title:"Add timestamp",action:()=>{if(!o||o.querySelector(".ytls-error-message")||we)return;let g=typeof Sn<"u"?Sn:0,h=Q(),b=h?Math.floor(h.getCurrentTime()+g):0;if(!Number.isFinite(b))return;let w=fr(b,"");w&&w.focus()}},{label:"\u2699\uFE0F",title:"Settings",action:()=>Ct()},{label:"\u{1F4CB}",title:"Copy timestamps to clipboard",action:function(g){if(!o||o.querySelector(".ytls-error-message")||we){this.textContent="\u274C",setTimeout(()=>{this.textContent="\u{1F4CB}"},2e3);return}let h=wi(),b=Math.max(Jt(),0);if(h.length===0){this.textContent="\u274C",setTimeout(()=>{this.textContent="\u{1F4CB}"},2e3);return}let w=g.ctrlKey,R=h.map($=>{let z=Nt($.start,b);return w?`${z} ${$.comment} <!-- guid:${$.guid} -->`.trimStart():`${z} ${$.comment}`}).join(`
`);navigator.clipboard.writeText(R).then(()=>{this.textContent="\u2705",setTimeout(()=>{this.textContent="\u{1F4CB}"},2e3)}).catch($=>{c("Failed to copy timestamps: ",$,"error"),this.textContent="\u274C",setTimeout(()=>{this.textContent="\u{1F4CB}"},2e3)})}},{label:"\u23F1\uFE0F",title:"Offset all timestamps",action:()=>{if(!o||o.querySelector(".ytls-error-message")||we)return;if(pe().length===0){alert("No timestamps available to offset.");return}let h=prompt("Enter the number of seconds to offset all timestamps (positive or negative integer):","0");if(h===null)return;let b=h.trim();if(b.length===0)return;let w=Number.parseInt(b,10);if(!Number.isFinite(w)){alert("Please enter a valid integer number of seconds.");return}w!==0&&la(w,{alertOnNoChange:!0,failureMessage:"Offset had no effect because timestamps are already at the requested bounds.",logLabel:"bulk offset"})}},{label:"\u{1F5D1}\uFE0F",title:"Delete all timestamps for current video",action:async()=>{let g=_i();if(!g){alert("Unable to determine current video ID.");return}let h=document.createElement("div");h.id="ytls-delete-all-modal",h.classList.remove("ytls-fade-out"),h.classList.add("ytls-fade-in");let b=document.createElement("p");b.textContent="Hold the button to delete all timestamps for:",b.style.marginBottom="10px";let w=document.createElement("p");w.textContent=g,w.style.fontFamily="monospace",w.style.fontSize="12px",w.style.marginBottom="15px",w.style.color="#aaa";let R=document.createElement("button");R.classList.add("ytls-save-modal-button"),R.style.background="#d32f2f",R.style.position="relative",R.style.overflow="hidden";let $=null,z=0,W=null,U=document.createElement("div");U.style.position="absolute",U.style.left="0",U.style.top="0",U.style.height="100%",U.style.width="0%",U.style.background="#ff6b6b",U.style.transition="none",U.style.pointerEvents="none",R.appendChild(U);let se=document.createElement("span");se.textContent="Hold to Delete All",se.style.position="relative",se.style.zIndex="1",R.appendChild(se);let $e=()=>{if(!z)return;let nt=Date.now()-z,nn=Math.min(nt/5e3*100,100);U.style.width=`${nn}%`,nn<100&&(W=requestAnimationFrame($e))},oe=()=>{$&&(clearTimeout($),$=null),W&&(cancelAnimationFrame(W),W=null),z=0,U.style.width="0%",se.textContent="Hold to Delete All"};R.onmousedown=()=>{z=Date.now(),se.textContent="Deleting...",W=requestAnimationFrame($e),$=setTimeout(async()=>{oe(),h.classList.remove("ytls-fade-in"),h.classList.add("ytls-fade-out"),setTimeout(async()=>{document.body.contains(h)&&document.body.removeChild(h);try{await Fo(g),Ci()}catch(nt){c("Failed to delete all timestamps:",nt,"error"),alert("Failed to delete timestamps. Check console for details.")}},300)},5e3)},R.onmouseup=oe,R.onmouseleave=oe;let Ce=null,He=null,At=E(h,()=>{oe(),Ce&&document.removeEventListener("keydown",Ce),He&&document.removeEventListener("click",He,!0)});Ce=_(At),He=x(h,At);let tn=document.createElement("button");tn.textContent="Cancel",tn.classList.add("ytls-save-modal-cancel-button"),tn.onclick=At,h.appendChild(b),h.appendChild(w),h.appendChild(R),h.appendChild(tn),document.body.appendChild(h),v(Ce),D(He)}}],ee=Ba();Oe.forEach(g=>{let h=document.createElement("button");if(h.textContent=g.label,wt(h,g.title),h.classList.add("ytls-main-button"),g.label==="\u{1F423}"&&ee){let b=document.createElement("span");b.textContent=ee,b.classList.add("ytls-holiday-emoji"),h.appendChild(b)}g.label==="\u{1F4CB}"?h.onclick=function(b){g.action.call(this,b)}:h.onclick=g.action,g.label==="\u2699\uFE0F"&&(Rr=h),d.appendChild(h)});let An=document.createElement("button");An.textContent="\u{1F4BE} Save",An.classList.add("ytls-file-operation-button"),An.onclick=()=>{let g=document.createElement("div");g.id="ytls-save-modal",g.classList.remove("ytls-fade-out"),g.classList.add("ytls-fade-in");let h=document.createElement("p");h.textContent="Save as:";let b=null,w=null,R=E(g,()=>{b&&document.removeEventListener("keydown",b),w&&document.removeEventListener("click",w,!0)});b=_(R),w=x(g,R);let $=document.createElement("button");$.textContent="JSON",$.classList.add("ytls-save-modal-button"),$.onclick=()=>{b&&document.removeEventListener("keydown",b),w&&document.removeEventListener("click",w,!0),E(g,()=>da("json"))()};let z=document.createElement("button");z.textContent="Plain Text",z.classList.add("ytls-save-modal-button"),z.onclick=()=>{b&&document.removeEventListener("keydown",b),w&&document.removeEventListener("click",w,!0),E(g,()=>da("text"))()};let W=document.createElement("button");W.textContent="Cancel",W.classList.add("ytls-save-modal-cancel-button"),W.onclick=R,g.appendChild(h),g.appendChild($),g.appendChild(z),g.appendChild(W),document.body.appendChild(g),v(b),D(w)};let It=document.createElement("button");It.textContent="\u{1F4C2} Load",It.classList.add("ytls-file-operation-button"),It.onclick=()=>{let g=document.createElement("div");g.id="ytls-load-modal",g.classList.remove("ytls-fade-out"),g.classList.add("ytls-fade-in");let h=document.createElement("p");h.textContent="Load from:";let b=null,w=null,R=E(g,()=>{b&&document.removeEventListener("keydown",b),w&&document.removeEventListener("click",w,!0)});b=_(R),w=x(g,R);let $=document.createElement("button");$.textContent="File",$.classList.add("ytls-save-modal-button"),$.onclick=()=>{let U=document.createElement("input");U.type="file",U.accept=".json,.txt",U.classList.add("ytls-hidden-file-input"),U.onchange=se=>{let $e=se.target.files?.[0];if(!$e)return;b&&document.removeEventListener("keydown",b),w&&document.removeEventListener("click",w,!0),R();let oe=new FileReader;oe.onload=()=>{let Ce=String(oe.result).trim();ga(Ce)},oe.readAsText($e)},U.click()};let z=document.createElement("button");z.textContent="Clipboard",z.classList.add("ytls-save-modal-button"),z.onclick=async()=>{b&&document.removeEventListener("keydown",b),w&&document.removeEventListener("click",w,!0),E(g,async()=>{try{let U=await navigator.clipboard.readText();U?ga(U.trim()):alert("Clipboard is empty.")}catch(U){c("Failed to read from clipboard: ",U,"error"),alert("Failed to read from clipboard. Ensure you have granted permission.")}})()};let W=document.createElement("button");W.textContent="Cancel",W.classList.add("ytls-save-modal-cancel-button"),W.onclick=R,g.appendChild(h),g.appendChild($),g.appendChild(z),g.appendChild(W),document.body.appendChild(g),v(b),D(w)};let fe=document.createElement("button");fe.textContent="\u{1F4E4} Export",fe.classList.add("ytls-file-operation-button"),fe.onclick=async()=>{try{await Uo()}catch{alert("Failed to export data: Could not read from database.")}};let te=document.createElement("button");te.textContent="\u{1F4E5} Import",te.classList.add("ytls-file-operation-button"),te.onclick=()=>{let g=document.createElement("input");g.type="file",g.accept=".json",g.classList.add("ytls-hidden-file-input"),g.onchange=h=>{let b=h.target.files?.[0];if(!b)return;let w=new FileReader;w.onload=()=>{try{let R=JSON.parse(String(w.result)),$=[];for(let z in R)if(Object.prototype.hasOwnProperty.call(R,z)&&z.startsWith("ytls-")){let W=z.substring(5),U=R[z];if(U&&typeof U.video_id=="string"&&Array.isArray(U.timestamps)){let se=U.timestamps.map(oe=>({...oe,guid:oe.guid||crypto.randomUUID()})),$e=pa(W,se).then(()=>c(`Imported ${W} to IndexedDB`)).catch(oe=>c(`Failed to import ${W} to IndexedDB:`,oe,"error"));$.push($e)}else c(`Skipping key ${z} during import due to unexpected data format.`,"warn")}Promise.all($).then(()=>{Ci()}).catch(z=>{alert("An error occurred during import to IndexedDB. Check console for details."),c("Overall import error:",z,"error")})}catch(R){alert(`Failed to import data. Please ensure the file is in the correct format.
`+R.message),c("Import error:",R,"error")}},w.readAsText(b)},g.click()},f.textContent=Fi,o.onclick=g=>{ca(g)},o.ontouchstart=g=>{ca(g)},i.style.position="fixed",i.style.bottom="0",i.style.right="0",i.style.transition="none",Se(),setTimeout(()=>In(),10);let de=!1,Le,xt,st=!1;i.addEventListener("mousedown",g=>{let h=g.target;h instanceof Element&&(h instanceof HTMLInputElement||h instanceof HTMLTextAreaElement||h!==s&&!s.contains(h)&&window.getComputedStyle(h).cursor==="pointer"||(de=!0,st=!1,Le=g.clientX-i.getBoundingClientRect().left,xt=g.clientY-i.getBoundingClientRect().top,i.style.transition="none"))}),document.addEventListener("mousemove",Or=g=>{if(!de)return;st=!0;let h=g.clientX-Le,b=g.clientY-xt,w=i.getBoundingClientRect(),R=w.width,$=w.height,z=document.documentElement.clientWidth,W=document.documentElement.clientHeight;h=Math.max(0,Math.min(h,z-R)),b=Math.max(0,Math.min(b,W-$)),i.style.left=`${h}px`,i.style.top=`${b}px`,i.style.right="auto",i.style.bottom="auto"}),document.addEventListener("mouseup",Nr=()=>{if(!de)return;de=!1;let g=st;setTimeout(()=>{st=!1},50),In(),setTimeout(()=>{g&&Ae()},200)}),i.addEventListener("dragstart",g=>g.preventDefault());let Mn=document.createElement("div"),Kr=document.createElement("div"),Dn=document.createElement("div"),Rn=document.createElement("div");Mn.id="ytls-resize-tl",Kr.id="ytls-resize-tr",Dn.id="ytls-resize-bl",Rn.id="ytls-resize-br";let Bn=!1,xa=0,ba=0,On=0,Nn=0,Jr=0,Xr=0,en=null;Qr(Mn,"top-left"),Qr(Kr,"top-right"),Qr(Dn,"bottom-left"),Qr(Rn,"bottom-right"),document.addEventListener("mousemove",g=>{if(!Bn||!i||!en)return;let h=g.clientX-xa,b=g.clientY-ba,w=On,R=Nn,$=Jr,z=Xr,W=document.documentElement.clientWidth,U=document.documentElement.clientHeight;en==="bottom-right"?(w=Math.max(200,Math.min(800,On+h)),R=Math.max(250,Math.min(U,Nn+b))):en==="top-left"?(w=Math.max(200,Math.min(800,On-h)),$=Jr+h,R=Math.max(250,Math.min(U,Nn-b)),z=Xr+b):en==="top-right"?(w=Math.max(200,Math.min(800,On+h)),R=Math.max(250,Math.min(U,Nn-b)),z=Xr+b):en==="bottom-left"&&(w=Math.max(200,Math.min(800,On-h)),$=Jr+h,R=Math.max(250,Math.min(U,Nn+b))),$=Math.max(0,Math.min($,W-w)),z=Math.max(0,Math.min(z,U-R)),i.style.width=`${w}px`,i.style.height=`${R}px`,i.style.left=`${$}px`,i.style.top=`${z}px`,i.style.right="auto",i.style.bottom="auto"}),document.addEventListener("mouseup",()=>{Bn&&(Bn=!1,en=null,document.body.style.cursor="",ue(!0))});let ei=null;window.addEventListener("resize",Pr=()=>{ei&&clearTimeout(ei),ei=setTimeout(()=>{ue(!0),ei=null},200)}),s.appendChild(m),s.appendChild(p);let ti=document.createElement("div");if(ti.id="ytls-content",ti.append(o),ti.append(d),i.append(s,ti,f,Mn,Kr,Dn,Rn),i.addEventListener("mousemove",g=>{try{if(de||Bn)return;let h=i.getBoundingClientRect(),b=20,w=g.clientX,R=g.clientY,$=w-h.left<=b,z=h.right-w<=b,W=R-h.top<=b,U=h.bottom-R<=b,se="";W&&$||U&&z?se="nwse-resize":W&&z||U&&$?se="nesw-resize":se="",document.body.style.cursor=se}catch{}}),i.addEventListener("mouseleave",()=>{!Bn&&!de&&(document.body.style.cursor="")}),window.recalculateTimestampsArea=hr,setTimeout(()=>{if(hr(),i&&s&&d&&o){let g=40,h=pe();if(h.length>0)g=h[0].offsetHeight;else{let b=document.createElement("li");b.style.visibility="hidden",b.style.position="absolute",b.textContent="00:00 Example",o.appendChild(b),g=b.offsetHeight,o.removeChild(b)}I=s.offsetHeight+d.offsetHeight+g,i.style.minHeight=I+"px"}},0),window.addEventListener("resize",hr),gt){try{gt.disconnect()}catch{}gt=null}gt=new ResizeObserver(hr),gt.observe(i),or||document.addEventListener("pointerdown",or=()=>{aa=Date.now()},!0),sr||document.addEventListener("pointerup",sr=()=>{},!0)}finally{bi=!1}}}async function Zo(){if(!i)return;if(document.querySelectorAll("#ytls-pane").forEach(p=>{p!==i&&(c("Removing duplicate pane element from DOM"),p.remove())}),document.body.contains(i)){c("Pane already in DOM, skipping append");return}await Go(),typeof Xi=="function"&&Xi(jo),typeof hi=="function"&&hi(Yr),typeof gi=="function"&&gi(Si),typeof Ji=="function"&&Ji(L),await Qi(),await ko(),await Qn(),typeof vi=="function"&&vi();let u=document.querySelectorAll("#ytls-pane");if(u.length>0&&(c(`WARNING: Found ${u.length} existing pane(s) in DOM, removing all`),u.forEach(p=>p.remove())),document.body.contains(i)){c("ERROR: Pane already in body, aborting append");return}if(document.body.appendChild(i),c("Pane successfully appended to DOM"),ge(),ke&&(clearTimeout(ke),ke=null),ke=setTimeout(()=>{Z(),typeof window.recalculateTimestampsArea=="function"&&window.recalculateTimestampsArea(),J(),ue(!0),ke=null},450),ht){try{ht.disconnect()}catch{}ht=null}ht=new MutationObserver(()=>{let p=document.querySelectorAll("#ytls-pane");p.length>1&&(c(`CRITICAL: Multiple panes detected (${p.length}), removing duplicates`),p.forEach((y,E)=>{(E>0||i&&y!==i)&&y.remove()}))}),ht.observe(document.body,{childList:!0,subtree:!0})}function ya(l=0){if(document.getElementById("ytls-header-button")){Lt();return}let u=document.querySelector("#logo");if(!u||!u.parentElement){l<10&&setTimeout(()=>ya(l+1),300);return}let p=document.createElement("button");p.id="ytls-header-button",p.type="button",p.className="ytls-header-button",wt(p,"Toggle Timekeeper UI"),p.setAttribute("aria-label","Toggle Timekeeper UI");let y=document.createElement("img");y.src=Be,y.alt="",y.decoding="async",p.appendChild(y),Ht=y,p.addEventListener("mouseenter",()=>{Ht&&(Br=!0,Ht.src=Fe)}),p.addEventListener("mouseleave",()=>{Ht&&(Br=!1,Lt())}),p.addEventListener("click",()=>{i&&!document.body.contains(i)&&(c("Pane not in DOM, re-appending before toggle"),document.body.appendChild(i)),Li()}),u.insertAdjacentElement("afterend",p),Lt(),c("Timekeeper header button added next to YouTube logo")}function va(){if(K)return;K=!0;let l=history.pushState,u=history.replaceState;function p(){try{let y=new Event("locationchange");window.dispatchEvent(y)}catch{}}history.pushState=function(){let y=l.apply(this,arguments);return p(),y},history.replaceState=function(){let y=u.apply(this,arguments);return p(),y},window.addEventListener("popstate",p),window.addEventListener("locationchange",()=>{window.location.href!==G&&c("Location changed (locationchange event) \u2014 deferring UI update until navigation finish")})}async function Ci(){if(!a()){Oo();return}G=window.location.href,document.querySelectorAll("#ytls-pane").forEach((u,p)=>{(p>0||i&&u!==i)&&u.remove()}),await Te(),await qo(),_e=_i();let l=document.title;c("Page Title:",l),c("Video ID:",_e),c("Current URL:",window.location.href),ki(!0),Ln(),ze(),await fa(),ze(),ki(!1),c("Timestamps loaded and UI unlocked for video:",_e),await Zo(),ya(),Po()}va(),window.addEventListener("yt-navigate-start",()=>{c("Navigation started (yt-navigate-start event fired)"),a()&&i&&o&&(c("Locking UI and showing loading state for navigation"),ki(!0))}),ar=l=>{l.ctrlKey&&l.altKey&&l.shiftKey&&(l.key==="T"||l.key==="t")&&(l.preventDefault(),Li(),c("Timekeeper UI toggled via keyboard shortcut (Ctrl+Alt+Shift+T)"))},document.addEventListener("keydown",ar),window.addEventListener("yt-navigate-finish",()=>{c("Navigation finished (yt-navigate-finish event fired)"),window.location.href!==G?Ci():c("Navigation finished but URL already handled, skipping.")}),va(),c("Timekeeper initialized and waiting for navigation events")})();})();


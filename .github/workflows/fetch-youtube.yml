name: Fetch YouTube Channel Videos

# Fetch videos for channel UClxj3GlGphZVgd1SLYhZKmg and upload a CSV artifact
on:
  workflow_dispatch: {}
  schedule:
  # Weekly (UTC) - change or remove as you like
  - cron: '0 0 * * 0'

jobs:
  fetch:
    runs-on: ubuntu-latest
    environment: production
    env:
      # This must be set in repo or org secrets (Settings → Secrets → Actions)
      YOUTUBE_API_KEY: ${{ secrets.YOUTUBE_API_KEY }}

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Install jq
      run: |
        sudo apt-get update
        sudo apt-get install -y jq

    - name: Run fetch script
      run: |
        bash scripts/fetch-youtube.sh artifacts

    - name: Upload CSV artifact
      uses: actions/upload-artifact@v4
      with:
        name: youtube-videos
        path: artifacts/videos.csv
